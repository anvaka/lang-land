var If=Object.defineProperty;var up=M=>{throw TypeError(M)};var Ff=(M,w,f)=>w in M?If(M,w,{enumerable:!0,configurable:!0,writable:!0,value:f}):M[w]=f;var ui=(M,w,f)=>Ff(M,typeof w!="symbol"?w+"":w,f),Bf=(M,w,f)=>w.has(M)||up("Cannot "+f);var cp=(M,w,f)=>w.has(M)?up("Cannot add the same private member more than once"):w instanceof WeakSet?w.add(M):w.set(M,f);var su=(M,w,f)=>(Bf(M,w,"access private method"),f);(function(){const w=document.createElement("link").relList;if(w&&w.supports&&w.supports("modulepreload"))return;for(const $ of document.querySelectorAll('link[rel="modulepreload"]'))T($);new MutationObserver($=>{for(const H of $)if(H.type==="childList")for(const Q of H.addedNodes)Q.tagName==="LINK"&&Q.rel==="modulepreload"&&T(Q)}).observe(document,{childList:!0,subtree:!0});function f($){const H={};return $.integrity&&(H.integrity=$.integrity),$.referrerPolicy&&(H.referrerPolicy=$.referrerPolicy),$.crossOrigin==="use-credentials"?H.credentials="include":$.crossOrigin==="anonymous"?H.credentials="omit":H.credentials="same-origin",H}function T($){if($.ep)return;$.ep=!0;const H=f($);fetch($.href,H)}})();var zf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function yp(M){return M&&M.__esModule&&Object.prototype.hasOwnProperty.call(M,"default")?M.default:M}var xp={exports:{}};(function(M,w){(function(f,T){M.exports=T()})(zf,function(){var f,T,$;function H(l,_e){if(!f)f=_e;else if(!T)T=_e;else{var ee="var sharedChunk = {}; ("+f+")(sharedChunk); ("+T+")(sharedChunk);",Te={};f(Te),$=_e(Te),typeof window<"u"&&($.workerUrl=window.URL.createObjectURL(new Blob([ee],{type:"text/javascript"})))}}H(["exports"],function(l){function _e(i,e,r,n){return new(r||(r=Promise))(function(o,p){function d(v){try{y(n.next(v))}catch(E){p(E)}}function m(v){try{y(n.throw(v))}catch(E){p(E)}}function y(v){var E;v.done?o(v.value):(E=v.value,E instanceof r?E:new r(function(k){k(E)})).then(d,m)}y((n=n.apply(i,e||[])).next())})}function ee(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var Te=Ve;function Ve(i,e){this.x=i,this.y=e}Ve.prototype={clone:function(){return new Ve(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),n=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=n,this},_rotateAround:function(i,e){var r=Math.cos(i),n=Math.sin(i),o=e.y+n*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-n*(this.y-e.y),this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ve.convert=function(i){return i instanceof Ve?i:Array.isArray(i)?new Ve(i[0],i[1]):i};var Ee=ee(Te),ft=ci;function ci(i,e,r,n){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=n}ci.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,n=0;n<8;n++){var o=this.sampleCurveX(r)-i;if(Math.abs(o)<e)return r;var p=this.sampleCurveDerivativeX(r);if(Math.abs(p)<1e-6)break;r-=o/p}var d=0,m=1;for(r=i,n=0;n<20&&(o=this.sampleCurveX(r),!(Math.abs(o-i)<e));n++)i>o?d=r:m=r,r=.5*(m-d)+d;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var Vt=ee(ft);let Ct,vt;function Mr(){return Ct==null&&(Ct=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ct}function Ji(){if(vt==null&&(vt=!1,Mr())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let n=0;n<5*5;n++){const o=4*n;e.fillStyle=`rgb(${o},${o+1},${o+2})`,e.fillRect(n%5,Math.floor(n/5),1,1)}const r=e.getImageData(0,0,5,5).data;for(let n=0;n<5*5*4;n++)if(n%4!=3&&r[n]!==n){vt=!0;break}}}return vt||!1}function lr(i,e,r,n){const o=new Vt(i,e,r,n);return function(p){return o.solve(p)}}const Mi=lr(.25,.1,.25,1);function oi(i,e,r){return Math.min(r,Math.max(e,i))}function ts(i,e,r){const n=r-e,o=((i-e)%n+n)%n+e;return o===e?r:o}function mi(i,...e){for(const r of e)for(const n in r)i[n]=r[n];return i}let qs=1;function Ut(i,e,r){const n={};for(const o in i)n[o]=e.call(r||this,i[o],o,i);return n}function Ur(i,e,r){const n={};for(const o in i)e.call(r||this,i[o],o,i)&&(n[o]=i[o]);return n}function $i(i){return Array.isArray(i)?i.map($i):typeof i=="object"&&i?Ut(i,$i):i}const qr={};function Ai(i){qr[i]||(typeof console<"u"&&console.warn(i),qr[i]=!0)}function Pi(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function Gi(i){let e=0;for(let r,n,o=0,p=i.length,d=p-1;o<p;d=o++)r=i[o],n=i[d],e+=(n.x-r.x)*(r.y+n.y);return e}function Hi(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let jr=null;function ys(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const js="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function xs(i,e,r,n,o){return _e(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const p=new VideoFrame(i,{timestamp:0});try{const d=p==null?void 0:p.format;if(!d||!d.startsWith("BGR")&&!d.startsWith("RGB"))throw new Error(`Unrecognized format ${d}`);const m=d.startsWith("BGR"),y=new Uint8ClampedArray(n*o*4);if(yield p.copyTo(y,function(v,E,k,F,P){const L=4*Math.max(-E,0),N=(Math.max(0,k)-k)*F*4+L,W=4*F,J=Math.max(0,E),oe=Math.max(0,k);return{rect:{x:J,y:oe,width:Math.min(v.width,E+F)-J,height:Math.min(v.height,k+P)-oe},layout:[{offset:N,stride:W}]}}(i,e,r,n,o)),m)for(let v=0;v<y.length;v+=4){const E=y[v];y[v]=y[v+2],y[v+2]=E}return y}finally{p.close()}})}let Li,Lt,Ei,Pr;const je={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){return this.getImageCanvasContext(i).getImageData(-e,-e,i.width+2*e,i.height+2*e)},getImageCanvasContext(i){const e=window.document.createElement("canvas"),r=e.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return e.width=i.width,e.height=i.height,r.drawImage(i,0,0,i.width,i.height),r},resolveURL:i=>(Ei||(Ei=document.createElement("a")),Ei.href=i,Ei.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Pr==null&&(Pr=matchMedia("(prefers-reduced-motion: reduce)")),Pr.matches)}},et={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class ct extends Error{constructor(e,r,n,o){super(`AJAXError: ${r} (${e}): ${n}`),this.status=e,this.statusText=r,this.url=n,this.body=o}}const Tt=Hi()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,Pt=i=>et.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))];function qt(i,e){const r=new AbortController,n=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,cache:i.cache,referrer:Tt(),signal:r.signal});let o=!1,p=!1;return i.type==="json"&&n.headers.set("Accept","application/json"),p||fetch(n).then(d=>d.ok?(m=>{(i.type==="arrayBuffer"||i.type==="image"?m.arrayBuffer():i.type==="json"?m.json():m.text()).then(y=>{p||(o=!0,e(null,y,m.headers.get("Cache-Control"),m.headers.get("Expires")))}).catch(y=>{p||e(new Error(y.message))})})(d):d.blob().then(m=>e(new ct(d.status,d.statusText,i.url,m)))).catch(d=>{d.code!==20&&e(new Error(d.message))}),{cancel:()=>{p=!0,o||r.abort()}}}const gi=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(Hi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e);if(!Hi())return(Pt(i.url)||qt)(i,e)}if(!(/^file:/.test(r=i.url)||/^file:/.test(Tt())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return qt(i,e);if(Hi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var r;return function(n,o){const p=new XMLHttpRequest;p.open(n.method||"GET",n.url,!0),n.type!=="arrayBuffer"&&n.type!=="image"||(p.responseType="arraybuffer");for(const d in n.headers)p.setRequestHeader(d,n.headers[d]);return n.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=n.credentials==="include",p.onerror=()=>{o(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let d=p.response;if(n.type==="json")try{d=JSON.parse(p.response)}catch(m){return o(m)}o(null,d,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else{const d=new Blob([p.response],{type:p.getResponseHeader("Content-Type")});o(new ct(p.status,p.statusText,n.url,d))}},p.send(n.body),{cancel:()=>p.abort()}}(i,e)},vs=function(i,e){return gi(mi(i,{type:"arrayBuffer"}),e)};function Zr(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),r=window.location;return e.protocol===r.protocol&&e.host===r.host}function Zs(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function bs(i,e,r){if(r&&r[i]){const n=r[i].indexOf(e);n!==-1&&r[i].splice(n,1)}}class is{constructor(e,r={}){mi(this,r),this.type=e}}class rs extends is{constructor(e,r={}){super("error",mi({error:e},r))}}class ws{on(e,r){return this._listeners=this._listeners||{},Zs(e,r,this._listeners),this}off(e,r){return bs(e,r,this._listeners),bs(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Zs(e,r,this._oneTimeListeners),this):new Promise(n=>this.once(e,n))}fire(e,r){typeof e=="string"&&(e=new is(e,r||{}));const n=e.type;if(this.listens(n)){e.target=this;const o=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const m of o)m.call(this,e);const p=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const m of p)bs(n,m,this._oneTimeListeners),m.call(this,e);const d=this._eventedParent;d&&(mi(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),d.fire(e))}else e instanceof rs&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var ye={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ni=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ur(i,e){const r={};for(const n in i)n!=="ref"&&(r[n]=i[n]);return Ni.forEach(n=>{n in e&&(r[n]=e[n])}),r}function Rt(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(!Rt(i[r],e[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const r in i)if(!Rt(i[r],e[r]))return!1;return!0}return i===e}const St={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ar(i,e,r){r.push({command:St.addSource,args:[i,e[i]]})}function Gs(i,e,r){e.push({command:St.removeSource,args:[i]}),r[i]=!0}function Gr(i,e,r,n){Gs(i,r,n),Ar(i,e,r)}function Tn(i,e,r){let n;for(n in i[r])if(Object.prototype.hasOwnProperty.call(i[r],n)&&n!=="data"&&!Rt(i[r][n],e[r][n]))return!1;for(n in e[r])if(Object.prototype.hasOwnProperty.call(e[r],n)&&n!=="data"&&!Rt(i[r][n],e[r][n]))return!1;return!0}function As(i,e,r,n,o,p){let d;for(d in e=e||{},i=i||{})Object.prototype.hasOwnProperty.call(i,d)&&(Rt(i[d],e[d])||r.push({command:p,args:[n,d,e[d],o]}));for(d in e)Object.prototype.hasOwnProperty.call(e,d)&&!Object.prototype.hasOwnProperty.call(i,d)&&(Rt(i[d],e[d])||r.push({command:p,args:[n,d,e[d],o]}))}function ss(i){return i.id}function Es(i,e){return i[e.id]=e,i}class Be{constructor(e,r,n,o){this.message=(e?`${e}: `:"")+n,o&&(this.identifier=o),r!=null&&r.__line__&&(this.line=r.__line__)}}function Er(i,...e){for(const r of e)for(const n in r)i[n]=r[n];return i}class ri extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Cs{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[n,o]of r)this.bindings[n]=o}concat(e){return new Cs(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Hr={kind:"null"},Me={kind:"number"},ut={kind:"string"},at={kind:"boolean"},Vi={kind:"color"},Lr={kind:"object"},lt={kind:"value"},Wr={kind:"collator"},j={kind:"formatted"},D={kind:"padding"},B={kind:"resolvedImage"},R={kind:"variableAnchorOffsetCollection"};function Z(i,e){return{kind:"array",itemType:i,N:e}}function X(i){if(i.kind==="array"){const e=X(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const le=[Hr,Me,ut,at,Vi,j,Lr,Z(lt),D,B,R];function ie(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ie(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of le)if(!ie(r,e))return null}}return`Expected ${X(i)} but found ${X(e)} instead.`}function Y(i,e){return e.some(r=>r.kind===i.kind)}function se(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function xe(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const be=.96422,ve=.82521,We=4/29,nt=6/29,Ze=3*nt*nt,Qe=nt*nt*nt,ot=Math.PI/180,It=180/Math.PI;function Bt(i){return(i%=360)<0&&(i+=360),i}function bt([i,e,r,n]){let o,p;const d=Ri((.2225045*(i=wt(i))+.7168786*(e=wt(e))+.0606169*(r=wt(r)))/1);i===e&&e===r?o=p=d:(o=Ri((.4360747*i+.3850649*e+.1430804*r)/be),p=Ri((.0139322*i+.0971045*e+.7141733*r)/ve));const m=116*d-16;return[m<0?0:m,500*(o-d),200*(d-p),n]}function wt(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Ri(i){return i>Qe?Math.pow(i,1/3):i/Ze+We}function $t([i,e,r,n]){let o=(i+16)/116,p=isNaN(e)?o:o+e/500,d=isNaN(r)?o:o-r/200;return o=1*Ci(o),p=be*Ci(p),d=ve*Ci(d),[hi(3.1338561*p-1.6168667*o-.4906146*d),hi(-.9787684*p+1.9161415*o+.033454*d),hi(.0719453*p-.2289914*o+1.4052427*d),n]}function hi(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function Ci(i){return i>nt?i*i*i:Ze*(i-We)}function cr(i){return parseInt(i.padEnd(2,i),16)/255}function Na(i,e){return Ss(e?i/100:i,0,1)}function Ss(i,e,r){return Math.min(Math.max(e,i),r)}function Hs(i){return!i.some(Number.isNaN)}const go={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class zt{constructor(e,r,n,o=1,p=!0){this.r=e,this.g=r,this.b=n,this.a=o,p||(this.r*=o,this.g*=o,this.b*=o,o||this.overwriteGetter("rgb",[e,r,n,o]))}static parse(e){if(e instanceof zt)return e;if(typeof e!="string")return;const r=function(n){if((n=n.toLowerCase().trim())==="transparent")return[0,0,0,0];const o=go[n];if(o){const[d,m,y]=o;return[d/255,m/255,y/255,1]}if(n.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(n)){const d=n.length<6?1:2;let m=1;return[cr(n.slice(m,m+=d)),cr(n.slice(m,m+=d)),cr(n.slice(m,m+=d)),cr(n.slice(m,m+d)||"ff")]}if(n.startsWith("rgb")){const d=n.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(d){const[m,y,v,E,k,F,P,L,N,W,J,oe]=d,te=[E||" ",P||" ",W].join("");if(te==="  "||te==="  /"||te===",,"||te===",,,"){const ue=[v,F,N].join(""),pe=ue==="%%%"?100:ue===""?255:0;if(pe){const Ae=[Ss(+y/pe,0,1),Ss(+k/pe,0,1),Ss(+L/pe,0,1),J?Na(+J,oe):1];if(Hs(Ae))return Ae}}return}}const p=n.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[d,m,y,v,E,k,F,P,L]=p,N=[y||" ",E||" ",F].join("");if(N==="  "||N==="  /"||N===",,"||N===",,,"){const W=[+m,Ss(+v,0,100),Ss(+k,0,100),P?Na(+P,L):1];if(Hs(W))return function([J,oe,te,ue]){function pe(Ae){const Ne=(Ae+J/30)%12,He=oe*Math.min(te,1-te);return te-He*Math.max(-1,Math.min(Ne-3,9-Ne,1))}return J=Bt(J),oe/=100,te/=100,[pe(0),pe(8),pe(4),ue]}(W)}}}(e);return r?new zt(...r,!1):void 0}get rgb(){const{r:e,g:r,b:n,a:o}=this,p=o||1/0;return this.overwriteGetter("rgb",[e/p,r/p,n/p,o])}get hcl(){return this.overwriteGetter("hcl",function(e){const[r,n,o,p]=bt(e),d=Math.sqrt(n*n+o*o);return[Math.round(1e4*d)?Bt(Math.atan2(o,n)*It):NaN,d,r,p]}(this.rgb))}get lab(){return this.overwriteGetter("lab",bt(this.rgb))}overwriteGetter(e,r){return Object.defineProperty(this,e,{value:r}),r}toString(){const[e,r,n,o]=this.rgb;return`rgba(${[e,r,n].map(p=>Math.round(255*p)).join(",")},${o})`}}zt.black=new zt(0,0,0,1),zt.white=new zt(1,1,1,1),zt.transparent=new zt(0,0,0,0),zt.red=new zt(1,0,0,1);class na{constructor(e,r,n){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Dn{constructor(e,r,n,o,p){this.text=e,this.image=r,this.scale=n,this.fontStack=o,this.textColor=p}}class Oi{constructor(e){this.sections=e}static fromString(e){return new Oi([new Dn(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Oi?e:Oi.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class Qi{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Qi)return e;if(typeof e=="number")return new Qi([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Qi(e)}}toString(){return JSON.stringify(this.values)}}const _o=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class hr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof hr)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let r=0;r<e.length;r+=2){const n=e[r],o=e[r+1];if(typeof n!="string"||!_o.has(n)||!Array.isArray(o)||o.length!==2||typeof o[0]!="number"||typeof o[1]!="number")return}return new hr(e)}}toString(){return JSON.stringify(this.values)}}class vi{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new vi({name:e,available:!1}):null}}function In(i,e,r,n){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?n===void 0||typeof n=="number"&&n>=0&&n<=1?null:`Invalid rgba value [${[i,e,r,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof n=="number"?[i,e,r,n]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Cr(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof zt||i instanceof na||i instanceof Oi||i instanceof Qi||i instanceof hr||i instanceof vi)return!0;if(Array.isArray(i)){for(const e of i)if(!Cr(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!Cr(i[e]))return!1;return!0}return!1}function jt(i){if(i===null)return Hr;if(typeof i=="string")return ut;if(typeof i=="boolean")return at;if(typeof i=="number")return Me;if(i instanceof zt)return Vi;if(i instanceof na)return Wr;if(i instanceof Oi)return j;if(i instanceof Qi)return D;if(i instanceof hr)return R;if(i instanceof vi)return B;if(Array.isArray(i)){const e=i.length;let r;for(const n of i){const o=jt(n);if(r){if(r===o)continue;r=lt;break}r=o}return Z(r||lt,e)}return Lr}function kt(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof zt||i instanceof Oi||i instanceof Qi||i instanceof hr||i instanceof vi?i.toString():JSON.stringify(i)}class ks{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Cr(e[1]))return r.error("invalid value");const n=e[1];let o=jt(n);const p=r.expectedType;return o.kind!=="array"||o.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(o=p),new ks(o,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class si{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const on={string:ut,number:Me,boolean:at,object:Lr};class pr{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let n,o=1;const p=e[0];if(p==="array"){let m,y;if(e.length>2){const v=e[1];if(typeof v!="string"||!(v in on)||v==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);m=on[v],o++}else m=lt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);y=e[2],o++}n=Z(m,y)}else{if(!on[p])throw new Error(`Types doesn't contain name = ${p}`);n=on[p]}const d=[];for(;o<e.length;o++){const m=r.parse(e[o],o,lt);if(!m)return null;d.push(m)}return new pr(n,d)}evaluate(e){for(let r=0;r<this.args.length;r++){const n=this.args[r].evaluate(e);if(!ie(this.type,jt(n)))return n;if(r===this.args.length-1)throw new si(`Expected value to be of type ${X(this.type)}, but found ${X(jt(n))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const ns={"to-boolean":at,"to-color":Vi,"to-number":Me,"to-string":ut};class er{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const n=e[0];if(!ns[n])throw new Error(`Can't parse ${n} as it is not part of the known types`);if((n==="to-boolean"||n==="to-string")&&e.length!==2)return r.error("Expected one argument.");const o=ns[n],p=[];for(let d=1;d<e.length;d++){const m=r.parse(e[d],d,lt);if(!m)return null;p.push(m)}return new er(o,p)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let r,n;for(const o of this.args){if(r=o.evaluate(e),n=null,r instanceof zt)return r;if(typeof r=="string"){const p=e.parseColor(r);if(p)return p}else if(Array.isArray(r)&&(n=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:In(r[0],r[1],r[2],r[3]),!n))return new zt(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new si(n||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const n of this.args){r=n.evaluate(e);const o=Qi.parse(r);if(o)return o}throw new si(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const n of this.args){r=n.evaluate(e);const o=hr.parse(r);if(o)return o}throw new si(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const n of this.args){if(r=n.evaluate(e),r===null)return 0;const o=Number(r);if(!isNaN(o))return o}throw new si(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return Oi.fromString(kt(this.args[0].evaluate(e)));case"resolvedImage":return vi.fromString(kt(this.args[0].evaluate(e)));default:return kt(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const aa=["Unknown","Point","LineString","Polygon"];class oa{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?aa[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=zt.parse(e)),r}}class Fn{constructor(e,r,n=[],o,p=new Cs,d=[]){this.registry=e,this.path=n,this.key=n.map(m=>`[${m}]`).join(""),this.scope=p,this.errors=d,this.expectedType=o,this._isConstant=r}parse(e,r,n,o,p={}){return r?this.concat(r,n,o)._parse(e,p):this._parse(e,p)}_parse(e,r){function n(o,p,d){return d==="assert"?new pr(p,[o]):d==="coerce"?new er(p,[o]):o}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const o=e[0];if(typeof o!="string")return this.error(`Expression name must be a string, but found ${typeof o} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[o];if(p){let d=p.parse(e,this);if(!d)return null;if(this.expectedType){const m=this.expectedType,y=d.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||y.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||y.kind!=="value"&&y.kind!=="string")if(m.kind!=="padding"||y.kind!=="value"&&y.kind!=="number"&&y.kind!=="array")if(m.kind!=="variableAnchorOffsetCollection"||y.kind!=="value"&&y.kind!=="array"){if(this.checkSubtype(m,y))return null}else d=n(d,m,r.typeAnnotation||"coerce");else d=n(d,m,r.typeAnnotation||"coerce");else d=n(d,m,r.typeAnnotation||"coerce");else d=n(d,m,r.typeAnnotation||"assert")}if(!(d instanceof ks)&&d.type.kind!=="resolvedImage"&&this._isConstant(d)){const m=new oa;try{d=new ks(d.type,d.evaluate(m))}catch(y){return this.error(y.message),null}}return d}return this.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,n){const o=typeof e=="number"?this.path.concat(e):this.path,p=n?this.scope.concat(n):this.scope;return new Fn(this.registry,this._isConstant,o,r||null,p,this.errors)}error(e,...r){const n=`${this.key}${r.map(o=>`[${o}]`).join("")}`;this.errors.push(new ri(n,e))}checkSubtype(e,r){const n=ie(e,r);return n&&this.error(n),n}}class Bn{constructor(e,r,n){this.type=Wr,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const n=e[1];if(typeof n!="object"||Array.isArray(n))return r.error("Collator options argument must be an object.");const o=r.parse(n["case-sensitive"]!==void 0&&n["case-sensitive"],1,at);if(!o)return null;const p=r.parse(n["diacritic-sensitive"]!==void 0&&n["diacritic-sensitive"],1,at);if(!p)return null;let d=null;return n.locale&&(d=r.parse(n.locale,1,ut),!d)?null:new Bn(o,p,d)}evaluate(e){return new na(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const as=8192;function zn(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Ws(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function la(i,e){const r=(180+i[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,o=Math.pow(2,e.z);return[Math.round(r*o*as),Math.round(n*o*as)]}function Va(i,e,r){const n=i[0]-e[0],o=i[1]-e[1],p=i[0]-r[0],d=i[1]-r[1];return n*d-p*o==0&&n*p<=0&&o*d<=0}function ua(i,e){let r=!1;for(let d=0,m=e.length;d<m;d++){const y=e[d];for(let v=0,E=y.length;v<E-1;v++){if(Va(i,y[v],y[v+1]))return!1;(o=y[v])[1]>(n=i)[1]!=(p=y[v+1])[1]>n[1]&&n[0]<(p[0]-o[0])*(n[1]-o[1])/(p[1]-o[1])+o[0]&&(r=!r)}}var n,o,p;return r}function ca(i,e){for(let r=0;r<e.length;r++)if(ua(i,e[r]))return!0;return!1}function Ua(i,e,r,n){const o=n[0]-r[0],p=n[1]-r[1],d=(i[0]-r[0])*p-o*(i[1]-r[1]),m=(e[0]-r[0])*p-o*(e[1]-r[1]);return d>0&&m<0||d<0&&m>0}function yo(i,e,r){for(const v of r)for(let E=0;E<v.length-1;++E)if((m=[(d=v[E+1])[0]-(p=v[E])[0],d[1]-p[1]])[0]*(y=[(o=e)[0]-(n=i)[0],o[1]-n[1]])[1]-m[1]*y[0]!=0&&Ua(n,o,p,d)&&Ua(p,d,n,o))return!0;var n,o,p,d,m,y;return!1}function qa(i,e){for(let r=0;r<i.length;++r)if(!ua(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(yo(i[r],i[r+1],e))return!1;return!0}function ja(i,e){for(let r=0;r<e.length;r++)if(qa(i,e[r]))return!0;return!1}function Mn(i,e,r){const n=[];for(let o=0;o<i.length;o++){const p=[];for(let d=0;d<i[o].length;d++){const m=la(i[o][d],r);zn(e,m),p.push(m)}n.push(p)}return n}function Za(i,e,r){const n=[];for(let o=0;o<i.length;o++){const p=Mn(i[o],e,r);n.push(p)}return n}function Ga(i,e,r,n){if(i[0]<r[0]||i[0]>r[2]){const o=.5*n;let p=i[0]-r[0]>o?-n:r[0]-i[0]>o?n:0;p===0&&(p=i[0]-r[2]>o?-n:r[2]-i[0]>o?n:0),i[0]+=p}zn(e,i)}function ha(i,e,r,n){const o=Math.pow(2,n.z)*as,p=[n.x*as,n.y*as],d=[];for(const m of i)for(const y of m){const v=[y.x+p[0],y.y+p[1]];Ga(v,e,r,o),d.push(v)}return d}function pa(i,e,r,n){const o=Math.pow(2,n.z)*as,p=[n.x*as,n.y*as],d=[];for(const y of i){const v=[];for(const E of y){const k=[E.x+p[0],E.y+p[1]];zn(e,k),v.push(k)}d.push(v)}if(e[2]-e[0]<=o/2){(m=e)[0]=m[1]=1/0,m[2]=m[3]=-1/0;for(const y of d)for(const v of y)Ga(v,e,r,o)}var m;return d}class Ts{constructor(e,r){this.type=at,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Cr(e[1])){const n=e[1];if(n.type==="FeatureCollection")for(let o=0;o<n.features.length;++o){const p=n.features[o].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Ts(n,n.features[o].geometry)}else if(n.type==="Feature"){const o=n.geometry.type;if(o==="Polygon"||o==="MultiPolygon")return new Ts(n,n.geometry)}else if(n.type==="Polygon"||n.type==="MultiPolygon")return new Ts(n,n)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,n){const o=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],d=r.canonicalID();if(n.type==="Polygon"){const m=Mn(n.coordinates,p,d),y=ha(r.geometry(),o,p,d);if(!Ws(o,p))return!1;for(const v of y)if(!ua(v,m))return!1}if(n.type==="MultiPolygon"){const m=Za(n.coordinates,p,d),y=ha(r.geometry(),o,p,d);if(!Ws(o,p))return!1;for(const v of y)if(!ca(v,m))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,n){const o=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],d=r.canonicalID();if(n.type==="Polygon"){const m=Mn(n.coordinates,p,d),y=pa(r.geometry(),o,p,d);if(!Ws(o,p))return!1;for(const v of y)if(!qa(v,m))return!1}if(n.type==="MultiPolygon"){const m=Za(n.coordinates,p,d),y=pa(r.geometry(),o,p,d);if(!Ws(o,p))return!1;for(const v of y)if(!ja(v,m))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Pn{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const n=e[1];return r.scope.has(n)?new Pn(n,r.scope.get(n)):r.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class dr{constructor(e,r,n,o){this.name=e,this.type=r,this._evaluate=n,this.args=o}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const n=e[0],o=dr.definitions[n];if(!o)return r.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(o)?o[0]:o.type,d=Array.isArray(o)?[[o[1],o[2]]]:o.overloads,m=d.filter(([v])=>!Array.isArray(v)||v.length===e.length-1);let y=null;for(const[v,E]of m){y=new Fn(r.registry,I,r.path,null,r.scope);const k=[];let F=!1;for(let P=1;P<e.length;P++){const L=e[P],N=Array.isArray(v)?v[P-1]:v.type,W=y.parse(L,1+k.length,N);if(!W){F=!0;break}k.push(W)}if(!F)if(Array.isArray(v)&&v.length!==k.length)y.error(`Expected ${v.length} arguments, but found ${k.length} instead.`);else{for(let P=0;P<k.length;P++){const L=Array.isArray(v)?v[P]:v.type,N=k[P];y.concat(P+1).checkSubtype(L,N.type)}if(y.errors.length===0)return new dr(n,p,E,k)}}if(m.length===1)r.errors.push(...y.errors);else{const v=(m.length?m:d).map(([k])=>{return F=k,Array.isArray(F)?`(${F.map(X).join(", ")})`:`(${X(F.type)}...)`;var F}).join(" | "),E=[];for(let k=1;k<e.length;k++){const F=r.parse(e[k],1+E.length);if(!F)return null;E.push(X(F.type))}r.error(`Expected arguments of type ${v}, but found (${E.join(", ")}) instead.`)}return null}static register(e,r){dr.definitions=r;for(const n in r)e[n]=dr}}function I(i){if(i instanceof Pn)return I(i.boundExpression);if(i instanceof dr&&i.name==="error"||i instanceof Bn||i instanceof Ts)return!1;const e=i instanceof er||i instanceof pr;let r=!0;return i.eachChild(n=>{r=e?r&&I(n):r&&n instanceof ks}),!!r&&ht(i)&&tr(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ht(i){if(i instanceof dr&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Ts)return!1;let e=!0;return i.eachChild(r=>{e&&!ht(r)&&(e=!1)}),e}function os(i){if(i instanceof dr&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!os(r)&&(e=!1)}),e}function tr(i,e){if(i instanceof dr&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(n=>{r&&!tr(n,e)&&(r=!1)}),r}function ls(i,e){const r=i.length-1;let n,o,p=0,d=r,m=0;for(;p<=d;)if(m=Math.floor((p+d)/2),n=i[m],o=i[m+1],n<=e){if(m===r||e<o)return m;p=m+1}else{if(!(n>e))throw new si("Input is not a number.");d=m-1}return 0}class me{constructor(e,r,n){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[o,p]of n)this.labels.push(o),this.outputs.push(p)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const n=r.parse(e[1],1,Me);if(!n)return null;const o=[];let p=null;r.expectedType&&r.expectedType.kind!=="value"&&(p=r.expectedType);for(let d=1;d<e.length;d+=2){const m=d===1?-1/0:e[d],y=e[d+1],v=d,E=d+1;if(typeof m!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',v);if(o.length&&o[o.length-1][0]>=m)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',v);const k=r.parse(y,E,p);if(!k)return null;p=p||k.type,o.push([m,k])}return new me(p,n,o)}evaluate(e){const r=this.labels,n=this.outputs;if(r.length===1)return n[0].evaluate(e);const o=this.input.evaluate(e);if(o<=r[0])return n[0].evaluate(e);const p=r.length;return o>=r[p-1]?n[p-1].evaluate(e):n[ls(r,o)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function dt(i,e,r){return i+r*(e-i)}function ln(i,e,r){return i.map((n,o)=>dt(n,e[o],r))}const st={number:dt,color:function(i,e,r,n="rgb"){switch(n){case"rgb":{const[o,p,d,m]=ln(i.rgb,e.rgb,r);return new zt(o,p,d,m,!1)}case"hcl":{const[o,p,d,m]=i.hcl,[y,v,E,k]=e.hcl;let F,P;if(isNaN(o)||isNaN(y))isNaN(o)?isNaN(y)?F=NaN:(F=y,d!==1&&d!==0||(P=v)):(F=o,E!==1&&E!==0||(P=p));else{let oe=y-o;y>o&&oe>180?oe-=360:y<o&&o-y>180&&(oe+=360),F=o+r*oe}const[L,N,W,J]=function([oe,te,ue,pe]){return oe=isNaN(oe)?0:oe*ot,$t([ue,Math.cos(oe)*te,Math.sin(oe)*te,pe])}([F,P??dt(p,v,r),dt(d,E,r),dt(m,k,r)]);return new zt(L,N,W,J,!1)}case"lab":{const[o,p,d,m]=$t(ln(i.lab,e.lab,r));return new zt(o,p,d,m,!1)}}},array:ln,padding:function(i,e,r){return new Qi(ln(i.values,e.values,r))},variableAnchorOffsetCollection:function(i,e,r){const n=i.values,o=e.values;if(n.length!==o.length)throw new si(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${e.toString()}`);const p=[];for(let d=0;d<n.length;d+=2){if(n[d]!==o[d])throw new si(`Cannot interpolate values containing mismatched anchors. from[${d}]: ${n[d]}, to[${d}]: ${o[d]}`);p.push(n[d]);const[m,y]=n[d+1],[v,E]=o[d+1];p.push([dt(m,v,r),dt(y,E,r)])}return new hr(p)}};class Yt{constructor(e,r,n,o,p){this.type=e,this.operator=r,this.interpolation=n,this.input=o,this.labels=[],this.outputs=[];for(const[d,m]of p)this.labels.push(d),this.outputs.push(m)}static interpolationFactor(e,r,n,o){let p=0;if(e.name==="exponential")p=da(r,e.base,n,o);else if(e.name==="linear")p=da(r,1,n,o);else if(e.name==="cubic-bezier"){const d=e.controlPoints;p=new Vt(d[0],d[1],d[2],d[3]).solve(da(r,1,n,o))}return p}static parse(e,r){let[n,o,p,...d]=e;if(!Array.isArray(o)||o.length===0)return r.error("Expected an interpolation type expression.",1);if(o[0]==="linear")o={name:"linear"};else if(o[0]==="exponential"){const v=o[1];if(typeof v!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);o={name:"exponential",base:v}}else{if(o[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(o[0])}`,1,0);{const v=o.slice(1);if(v.length!==4||v.some(E=>typeof E!="number"||E<0||E>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);o={name:"cubic-bezier",controlPoints:v}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(p=r.parse(p,2,Me),!p)return null;const m=[];let y=null;n==="interpolate-hcl"||n==="interpolate-lab"?y=Vi:r.expectedType&&r.expectedType.kind!=="value"&&(y=r.expectedType);for(let v=0;v<d.length;v+=2){const E=d[v],k=d[v+1],F=v+3,P=v+4;if(typeof E!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(m.length&&m[m.length-1][0]>=E)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',F);const L=r.parse(k,P,y);if(!L)return null;y=y||L.type,m.push([E,L])}return xe(y,Me)||xe(y,Vi)||xe(y,D)||xe(y,R)||xe(y,Z(Me))?new Yt(y,n,o,p,m):r.error(`Type ${X(y)} is not interpolatable.`)}evaluate(e){const r=this.labels,n=this.outputs;if(r.length===1)return n[0].evaluate(e);const o=this.input.evaluate(e);if(o<=r[0])return n[0].evaluate(e);const p=r.length;if(o>=r[p-1])return n[p-1].evaluate(e);const d=ls(r,o),m=Yt.interpolationFactor(this.interpolation,o,r[d],r[d+1]),y=n[d].evaluate(e),v=n[d+1].evaluate(e);switch(this.operator){case"interpolate":return st[this.type.kind](y,v,m);case"interpolate-hcl":return st.color(y,v,m,"hcl");case"interpolate-lab":return st.color(y,v,m,"lab")}}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function da(i,e,r,n){const o=n-r,p=i-r;return o===0?0:e===1?p/o:(Math.pow(e,p)-1)/(Math.pow(e,o)-1)}class Ln{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let n=null;const o=r.expectedType;o&&o.kind!=="value"&&(n=o);const p=[];for(const m of e.slice(1)){const y=r.parse(m,1+p.length,n,void 0,{typeAnnotation:"omit"});if(!y)return null;n=n||y.type,p.push(y)}if(!n)throw new Error("No output type");const d=o&&p.some(m=>ie(o,m.type));return new Ln(d?lt:n,p)}evaluate(e){let r,n=null,o=0;for(const p of this.args)if(o++,n=p.evaluate(e),n&&n instanceof vi&&!n.available&&(r||(r=n.name),n=null,o===this.args.length&&(n=r)),n!==null)break;return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class fr{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const n=[];for(let p=1;p<e.length-1;p+=2){const d=e[p];if(typeof d!="string")return r.error(`Expected string, but found ${typeof d} instead.`,p);if(/[^a-zA-Z0-9_]/.test(d))return r.error("Variable names must contain only alphanumeric characters or '_'.",p);const m=r.parse(e[p+1],p+1);if(!m)return null;n.push([d,m])}const o=r.parse(e[e.length-1],e.length-1,r.expectedType,n);return o?new fr(n,o):null}outputDefined(){return this.result.outputDefined()}}class Rn{constructor(e,r,n){this.type=e,this.index=r,this.input=n}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,Me),o=r.parse(e[2],2,Z(r.expectedType||lt));return n&&o?new Rn(o.type.itemType,n,o):null}evaluate(e){const r=this.index.evaluate(e),n=this.input.evaluate(e);if(r<0)throw new si(`Array index out of bounds: ${r} < 0.`);if(r>=n.length)throw new si(`Array index out of bounds: ${r} > ${n.length-1}.`);if(r!==Math.floor(r))throw new si(`Array index must be an integer, but found ${r} instead.`);return n[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class On{constructor(e,r){this.type=at,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,lt),o=r.parse(e[2],2,lt);return n&&o?Y(n.type,[at,ut,Me,Hr,lt])?new On(n,o):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${X(n.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!n)return!1;if(!se(r,["boolean","string","number","null"]))throw new si(`Expected first argument to be of type boolean, string, number or null, but found ${X(jt(r))} instead.`);if(!se(n,["string","array"]))throw new si(`Expected second argument to be of type array or string, but found ${X(jt(n))} instead.`);return n.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Se{constructor(e,r,n){this.type=Me,this.needle=e,this.haystack=r,this.fromIndex=n}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,lt),o=r.parse(e[2],2,lt);if(!n||!o)return null;if(!Y(n.type,[at,ut,Me,Hr,lt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${X(n.type)} instead`);if(e.length===4){const p=r.parse(e[3],3,Me);return p?new Se(n,o,p):null}return new Se(n,o)}evaluate(e){const r=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!se(r,["boolean","string","number","null"]))throw new si(`Expected first argument to be of type boolean, string, number or null, but found ${X(jt(r))} instead.`);if(!se(n,["string","array"]))throw new si(`Expected second argument to be of type array or string, but found ${X(jt(n))} instead.`);if(this.fromIndex){const o=this.fromIndex.evaluate(e);return n.indexOf(r,o)}return n.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class fa{constructor(e,r,n,o,p,d){this.inputType=e,this.type=r,this.input=n,this.cases=o,this.outputs=p,this.otherwise=d}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let n,o;r.expectedType&&r.expectedType.kind!=="value"&&(o=r.expectedType);const p={},d=[];for(let v=2;v<e.length-1;v+=2){let E=e[v];const k=e[v+1];Array.isArray(E)||(E=[E]);const F=r.concat(v);if(E.length===0)return F.error("Expected at least one branch label.");for(const L of E){if(typeof L!="number"&&typeof L!="string")return F.error("Branch labels must be numbers or strings.");if(typeof L=="number"&&Math.abs(L)>Number.MAX_SAFE_INTEGER)return F.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof L=="number"&&Math.floor(L)!==L)return F.error("Numeric branch labels must be integer values.");if(n){if(F.checkSubtype(n,jt(L)))return null}else n=jt(L);if(p[String(L)]!==void 0)return F.error("Branch labels must be unique.");p[String(L)]=d.length}const P=r.parse(k,v,o);if(!P)return null;o=o||P.type,d.push(P)}const m=r.parse(e[1],1,lt);if(!m)return null;const y=r.parse(e[e.length-1],e.length-1,o);return y?m.type.kind!=="value"&&r.concat(1).checkSubtype(n,m.type)?null:new fa(n,o,m,p,d,y):null}evaluate(e){const r=this.input.evaluate(e);return(jt(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class $n{constructor(e,r,n){this.type=e,this.branches=r,this.otherwise=n}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let n;r.expectedType&&r.expectedType.kind!=="value"&&(n=r.expectedType);const o=[];for(let d=1;d<e.length-1;d+=2){const m=r.parse(e[d],d,at);if(!m)return null;const y=r.parse(e[d+1],d+1,n);if(!y)return null;o.push([m,y]),n=n||y.type}const p=r.parse(e[e.length-1],e.length-1,n);if(!p)return null;if(!n)throw new Error("Can't infer output type");return new $n(n,o,p)}evaluate(e){for(const[r,n]of this.branches)if(r.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,n]of this.branches)e(r),e(n);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class un{constructor(e,r,n,o){this.type=e,this.input=r,this.beginIndex=n,this.endIndex=o}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,lt),o=r.parse(e[2],2,Me);if(!n||!o)return null;if(!Y(n.type,[Z(lt),ut,lt]))return r.error(`Expected first argument to be of type array or string, but found ${X(n.type)} instead`);if(e.length===4){const p=r.parse(e[3],3,Me);return p?new un(n.type,n,o,p):null}return new un(n.type,n,o)}evaluate(e){const r=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!se(r,["string","array"]))throw new si(`Expected first argument to be of type array or string, but found ${X(jt(r))} instead.`);if(this.endIndex){const o=this.endIndex.evaluate(e);return r.slice(n,o)}return r.slice(n)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function ma(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Nn(i,e,r,n){return n.compare(e,r)===0}function Xs(i,e,r){const n=i!=="=="&&i!=="!=";return class vp{constructor(p,d,m){this.type=at,this.lhs=p,this.rhs=d,this.collator=m,this.hasUntypedArgument=p.type.kind==="value"||d.type.kind==="value"}static parse(p,d){if(p.length!==3&&p.length!==4)return d.error("Expected two or three arguments.");const m=p[0];let y=d.parse(p[1],1,lt);if(!y)return null;if(!ma(m,y.type))return d.concat(1).error(`"${m}" comparisons are not supported for type '${X(y.type)}'.`);let v=d.parse(p[2],2,lt);if(!v)return null;if(!ma(m,v.type))return d.concat(2).error(`"${m}" comparisons are not supported for type '${X(v.type)}'.`);if(y.type.kind!==v.type.kind&&y.type.kind!=="value"&&v.type.kind!=="value")return d.error(`Cannot compare types '${X(y.type)}' and '${X(v.type)}'.`);n&&(y.type.kind==="value"&&v.type.kind!=="value"?y=new pr(v.type,[y]):y.type.kind!=="value"&&v.type.kind==="value"&&(v=new pr(y.type,[v])));let E=null;if(p.length===4){if(y.type.kind!=="string"&&v.type.kind!=="string"&&y.type.kind!=="value"&&v.type.kind!=="value")return d.error("Cannot use collator to compare non-string types.");if(E=d.parse(p[3],3,Wr),!E)return null}return new vp(y,v,E)}evaluate(p){const d=this.lhs.evaluate(p),m=this.rhs.evaluate(p);if(n&&this.hasUntypedArgument){const y=jt(d),v=jt(m);if(y.kind!==v.kind||y.kind!=="string"&&y.kind!=="number")throw new si(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${y.kind}, ${v.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const y=jt(d),v=jt(m);if(y.kind!=="string"||v.kind!=="string")return e(p,d,m)}return this.collator?r(p,d,m,this.collator.evaluate(p)):e(p,d,m)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}}}const Vn=Xs("==",function(i,e,r){return e===r},Nn),Ha=Xs("!=",function(i,e,r){return e!==r},function(i,e,r,n){return!Nn(0,e,r,n)}),xo=Xs("<",function(i,e,r){return e<r},function(i,e,r,n){return n.compare(e,r)<0}),Wa=Xs(">",function(i,e,r){return e>r},function(i,e,r,n){return n.compare(e,r)>0}),vo=Xs("<=",function(i,e,r){return e<=r},function(i,e,r,n){return n.compare(e,r)<=0}),ga=Xs(">=",function(i,e,r){return e>=r},function(i,e,r,n){return n.compare(e,r)>=0});class _a{constructor(e,r,n,o,p){this.type=ut,this.number=e,this.locale=r,this.currency=n,this.minFractionDigits=o,this.maxFractionDigits=p}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const n=r.parse(e[1],1,Me);if(!n)return null;const o=e[2];if(typeof o!="object"||Array.isArray(o))return r.error("NumberFormat options argument must be an object.");let p=null;if(o.locale&&(p=r.parse(o.locale,1,ut),!p))return null;let d=null;if(o.currency&&(d=r.parse(o.currency,1,ut),!d))return null;let m=null;if(o["min-fraction-digits"]&&(m=r.parse(o["min-fraction-digits"],1,Me),!m))return null;let y=null;return o["max-fraction-digits"]&&(y=r.parse(o["max-fraction-digits"],1,Me),!y)?null:new _a(n,p,d,m,y)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Ks{constructor(e){this.type=j,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&typeof n=="object")return r.error("First argument must be an image or text section.");const o=[];let p=!1;for(let d=1;d<=e.length-1;++d){const m=e[d];if(p&&typeof m=="object"&&!Array.isArray(m)){p=!1;let y=null;if(m["font-scale"]&&(y=r.parse(m["font-scale"],1,Me),!y))return null;let v=null;if(m["text-font"]&&(v=r.parse(m["text-font"],1,Z(ut)),!v))return null;let E=null;if(m["text-color"]&&(E=r.parse(m["text-color"],1,Vi),!E))return null;const k=o[o.length-1];k.scale=y,k.font=v,k.textColor=E}else{const y=r.parse(e[d],1,lt);if(!y)return null;const v=y.type.kind;if(v!=="string"&&v!=="value"&&v!=="null"&&v!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,o.push({content:y,scale:null,font:null,textColor:null})}}return new Ks(o)}evaluate(e){return new Oi(this.sections.map(r=>{const n=r.content.evaluate(e);return jt(n)===B?new Dn("",n,null,null,null):new Dn(kt(n),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}}class Un{constructor(e){this.type=B,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const n=r.parse(e[1],1,ut);return n?new Un(n):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),n=vi.fromString(r);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(r)>-1),n}eachChild(e){e(this.input)}outputDefined(){return!1}}class mr{constructor(e){this.type=Me,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=r.parse(e[1],1);return n?n.type.kind!=="array"&&n.type.kind!=="string"&&n.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${X(n.type)} instead.`):new mr(n):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new si(`Expected value to be of type string or array, but found ${X(jt(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Ds={"==":Vn,"!=":Ha,">":Wa,"<":xo,">=":ga,"<=":vo,array:pr,at:Rn,boolean:pr,case:$n,coalesce:Ln,collator:Bn,format:Ks,image:Un,in:On,"index-of":Se,interpolate:Yt,"interpolate-hcl":Yt,"interpolate-lab":Yt,length:mr,let:fr,literal:ks,match:fa,number:pr,"number-format":_a,object:pr,slice:un,step:me,string:pr,"to-boolean":er,"to-color":er,"to-number":er,"to-string":er,var:Pn,within:Ts};function Xa(i,[e,r,n,o]){e=e.evaluate(i),r=r.evaluate(i),n=n.evaluate(i);const p=o?o.evaluate(i):1,d=In(e,r,n,p);if(d)throw new si(d);return new zt(e/255,r/255,n/255,p,!1)}function ya(i,e){return i in e}function qn(i,e){const r=e[i];return r===void 0?null:r}function us(i){return{type:i}}function Ka(i){return{result:"success",value:i}}function Rr(i){return{result:"error",value:i}}function Is(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Ya(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function jn(i){return!!i.expression&&i.expression.interpolated}function Dt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Jt(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function bo(i){return i}function _t(i,e){const r=e.type==="color",n=i.stops&&typeof i.stops[0][0]=="object",o=n||!(n||i.property!==void 0),p=i.type||(jn(e)?"exponential":"interval");if(r||e.type==="padding"){const E=r?zt.parse:Qi.parse;(i=Er({},i)).stops&&(i.stops=i.stops.map(k=>[k[0],E(k[1])])),i.default=E(i.default?i.default:e.default)}if(i.colorSpace&&(d=i.colorSpace)!=="rgb"&&d!=="hcl"&&d!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var d;let m,y,v;if(p==="exponential")m=cn;else if(p==="interval")m=Wt;else if(p==="categorical"){m=Ht,y=Object.create(null);for(const E of i.stops)y[E[0]]=E[1];v=typeof i.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);m=Ja}if(n){const E={},k=[];for(let L=0;L<i.stops.length;L++){const N=i.stops[L],W=N[0].zoom;E[W]===void 0&&(E[W]={zoom:W,type:i.type,property:i.property,default:i.default,stops:[]},k.push(W)),E[W].stops.push([N[0].value,N[1]])}const F=[];for(const L of k)F.push([E[L].zoom,_t(E[L],e)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:Yt.interpolationFactor.bind(void 0,P),zoomStops:F.map(L=>L[0]),evaluate:({zoom:L},N)=>cn({stops:F,base:i.base},e,L).evaluate(L,N)}}if(o){const E=p==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:Yt.interpolationFactor.bind(void 0,E),zoomStops:i.stops.map(k=>k[0]),evaluate:({zoom:k})=>m(i,e,k,y,v)}}return{kind:"source",evaluate(E,k){const F=k&&k.properties?k.properties[i.property]:void 0;return F===void 0?Fs(i.default,e.default):m(i,e,F,y,v)}}}function Fs(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function Ht(i,e,r,n,o){return Fs(typeof r===o?n[r]:void 0,i.default,e.default)}function Wt(i,e,r){if(Dt(r)!=="number")return Fs(i.default,e.default);const n=i.stops.length;if(n===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[n-1][0])return i.stops[n-1][1];const o=ls(i.stops.map(p=>p[0]),r);return i.stops[o][1]}function cn(i,e,r){const n=i.base!==void 0?i.base:1;if(Dt(r)!=="number")return Fs(i.default,e.default);const o=i.stops.length;if(o===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[o-1][0])return i.stops[o-1][1];const p=ls(i.stops.map(E=>E[0]),r),d=function(E,k,F,P){const L=P-F,N=E-F;return L===0?0:k===1?N/L:(Math.pow(k,N)-1)/(Math.pow(k,L)-1)}(r,n,i.stops[p][0],i.stops[p+1][0]),m=i.stops[p][1],y=i.stops[p+1][1],v=st[e.type]||bo;return typeof m.evaluate=="function"?{evaluate(...E){const k=m.evaluate.apply(void 0,E),F=y.evaluate.apply(void 0,E);if(k!==void 0&&F!==void 0)return v(k,F,d,i.colorSpace)}}:v(m,y,d,i.colorSpace)}function Ja(i,e,r){switch(e.type){case"color":r=zt.parse(r);break;case"formatted":r=Oi.fromString(r.toString());break;case"resolvedImage":r=vi.fromString(r.toString());break;case"padding":r=Qi.parse(r);break;default:Dt(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return Fs(r,i.default,e.default)}dr.register(Ds,{error:[{kind:"error"},[ut],(i,[e])=>{throw new si(e.evaluate(i))}],typeof:[ut,[lt],(i,[e])=>X(jt(e.evaluate(i)))],"to-rgba":[Z(Me,4),[Vi],(i,[e])=>{const[r,n,o,p]=e.evaluate(i).rgb;return[255*r,255*n,255*o,p]}],rgb:[Vi,[Me,Me,Me],Xa],rgba:[Vi,[Me,Me,Me,Me],Xa],has:{type:at,overloads:[[[ut],(i,[e])=>ya(e.evaluate(i),i.properties())],[[ut,Lr],(i,[e,r])=>ya(e.evaluate(i),r.evaluate(i))]]},get:{type:lt,overloads:[[[ut],(i,[e])=>qn(e.evaluate(i),i.properties())],[[ut,Lr],(i,[e,r])=>qn(e.evaluate(i),r.evaluate(i))]]},"feature-state":[lt,[ut],(i,[e])=>qn(e.evaluate(i),i.featureState||{})],properties:[Lr,[],i=>i.properties()],"geometry-type":[ut,[],i=>i.geometryType()],id:[lt,[],i=>i.id()],zoom:[Me,[],i=>i.globals.zoom],"heatmap-density":[Me,[],i=>i.globals.heatmapDensity||0],"line-progress":[Me,[],i=>i.globals.lineProgress||0],accumulated:[lt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Me,us(Me),(i,e)=>{let r=0;for(const n of e)r+=n.evaluate(i);return r}],"*":[Me,us(Me),(i,e)=>{let r=1;for(const n of e)r*=n.evaluate(i);return r}],"-":{type:Me,overloads:[[[Me,Me],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[Me],(i,[e])=>-e.evaluate(i)]]},"/":[Me,[Me,Me],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[Me,[Me,Me],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[Me,[],()=>Math.LN2],pi:[Me,[],()=>Math.PI],e:[Me,[],()=>Math.E],"^":[Me,[Me,Me],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[Me,[Me],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Me,[Me],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Me,[Me],(i,[e])=>Math.log(e.evaluate(i))],log2:[Me,[Me],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Me,[Me],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Me,[Me],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Me,[Me],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Me,[Me],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Me,[Me],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Me,[Me],(i,[e])=>Math.atan(e.evaluate(i))],min:[Me,us(Me),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[Me,us(Me),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[Me,[Me],(i,[e])=>Math.abs(e.evaluate(i))],round:[Me,[Me],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[Me,[Me],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Me,[Me],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[at,[ut,lt],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[at,[lt],(i,[e])=>i.id()===e.value],"filter-type-==":[at,[ut],(i,[e])=>i.geometryType()===e.value],"filter-<":[at,[ut,lt],(i,[e,r])=>{const n=i.properties()[e.value],o=r.value;return typeof n==typeof o&&n<o}],"filter-id-<":[at,[lt],(i,[e])=>{const r=i.id(),n=e.value;return typeof r==typeof n&&r<n}],"filter->":[at,[ut,lt],(i,[e,r])=>{const n=i.properties()[e.value],o=r.value;return typeof n==typeof o&&n>o}],"filter-id->":[at,[lt],(i,[e])=>{const r=i.id(),n=e.value;return typeof r==typeof n&&r>n}],"filter-<=":[at,[ut,lt],(i,[e,r])=>{const n=i.properties()[e.value],o=r.value;return typeof n==typeof o&&n<=o}],"filter-id-<=":[at,[lt],(i,[e])=>{const r=i.id(),n=e.value;return typeof r==typeof n&&r<=n}],"filter->=":[at,[ut,lt],(i,[e,r])=>{const n=i.properties()[e.value],o=r.value;return typeof n==typeof o&&n>=o}],"filter-id->=":[at,[lt],(i,[e])=>{const r=i.id(),n=e.value;return typeof r==typeof n&&r>=n}],"filter-has":[at,[lt],(i,[e])=>e.value in i.properties()],"filter-has-id":[at,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[at,[Z(ut)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[at,[Z(lt)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[at,[ut,Z(lt)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[at,[ut,Z(lt)],(i,[e,r])=>function(n,o,p,d){for(;p<=d;){const m=p+d>>1;if(o[m]===n)return!0;o[m]>n?d=m-1:p=m+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:at,overloads:[[[at,at],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[us(at),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:at,overloads:[[[at,at],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[us(at),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[at,[at],(i,[e])=>!e.evaluate(i)],"is-supported-script":[at,[ut],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[ut,[ut],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[ut,[ut],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[ut,us(lt),(i,e)=>e.map(r=>kt(r.evaluate(i))).join("")],"resolved-locale":[ut,[Wr],(i,[e])=>e.evaluate(i).resolvedLocale()]});class Mt{constructor(e,r){var n;this.expression=e,this._warningHistory={},this._evaluator=new oa,this._defaultValue=r?(n=r).type==="color"&&Jt(n.default)?new zt(0,0,0,0):n.type==="color"?zt.parse(n.default)||null:n.type==="padding"?Qi.parse(n.default)||null:n.type==="variableAnchorOffsetCollection"?hr.parse(n.default)||null:n.default===void 0?null:n.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,n,o,p,d){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=n,this._evaluator.canonical=o,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=d,this.expression.evaluate(this._evaluator)}evaluate(e,r,n,o,p,d){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=n||null,this._evaluator.canonical=o,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=d||null;try{const m=this.expression.evaluate(this._evaluator);if(m==null||typeof m=="number"&&m!=m)return this._defaultValue;if(this._enumValues&&!(m in this._enumValues))throw new si(`Expected value to be one of ${Object.keys(this._enumValues).map(y=>JSON.stringify(y)).join(", ")}, but found ${JSON.stringify(m)} instead.`);return m}catch(m){return this._warningHistory[m.message]||(this._warningHistory[m.message]=!0,typeof console<"u"&&console.warn(m.message)),this._defaultValue}}}function hn(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Ds}function pn(i,e){const r=new Fn(Ds,I,[],e?function(o){const p={color:Vi,string:ut,number:Me,enum:ut,boolean:at,formatted:j,padding:D,resolvedImage:B,variableAnchorOffsetCollection:R};return o.type==="array"?Z(p[o.value]||lt,o.length):p[o.type]}(e):void 0),n=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return n?Ka(new Mt(n,e)):Rr(r.errors)}class xa{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!os(r.expression)}evaluateWithoutErrorHandling(e,r,n,o,p,d){return this._styleExpression.evaluateWithoutErrorHandling(e,r,n,o,p,d)}evaluate(e,r,n,o,p,d){return this._styleExpression.evaluate(e,r,n,o,p,d)}}class Zn{constructor(e,r,n,o){this.kind=e,this.zoomStops=n,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!os(r.expression),this.interpolationType=o}evaluateWithoutErrorHandling(e,r,n,o,p,d){return this._styleExpression.evaluateWithoutErrorHandling(e,r,n,o,p,d)}evaluate(e,r,n,o,p,d){return this._styleExpression.evaluate(e,r,n,o,p,d)}interpolationFactor(e,r,n){return this.interpolationType?Yt.interpolationFactor(this.interpolationType,e,r,n):0}}function va(i,e){const r=pn(i,e);if(r.result==="error")return r;const n=r.value.expression,o=ht(n);if(!o&&!Is(e))return Rr([new ri("","data expressions not supported")]);const p=tr(n,["zoom"]);if(!p&&!Ya(e))return Rr([new ri("","zoom expressions not supported")]);const d=fn(n);return d||p?d instanceof ri?Rr([d]):d instanceof Yt&&!jn(e)?Rr([new ri("",'"interpolate" expressions cannot be used with this property')]):Ka(d?new Zn(o?"camera":"composite",r.value,d.labels,d instanceof Yt?d.interpolation:void 0):new xa(o?"constant":"source",r.value)):Rr([new ri("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class dn{constructor(e,r){this._parameters=e,this._specification=r,Er(this,_t(this._parameters,this._specification))}static deserialize(e){return new dn(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function fn(i){let e=null;if(i instanceof fr)e=fn(i.result);else if(i instanceof Ln){for(const r of i.args)if(e=fn(r),e)break}else(i instanceof me||i instanceof Yt)&&i.input instanceof dr&&i.input.name==="zoom"&&(e=i);return e instanceof ri||i.eachChild(r=>{const n=fn(r);n instanceof ri?e=n:!e&&n?e=new ri("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&n&&e!==n&&(e=new ri("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function mn(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!mn(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const wo={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ba(i){if(i==null)return{filter:()=>!0,needGeometry:!1};mn(i)||(i=ce(i));const e=pn(i,wo);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,n,o)=>e.value.evaluate(r,n,{},o),needGeometry:q(i)}}function A(i,e){return i<e?-1:i>e?1:0}function q(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(q(i[e]))return!0;return!1}function ce(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?ne(i[1],i[2],"=="):e==="!="?Xe(ne(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ne(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(ce))):e==="all"?["all"].concat(i.slice(1).map(ce)):e==="none"?["all"].concat(i.slice(1).map(ce).map(Xe)):e==="in"?ge(i[1],i.slice(2)):e==="!in"?Xe(ge(i[1],i.slice(2))):e==="has"?ke(i[1]):e==="!has"?Xe(ke(i[1])):e!=="within"||i;var r}function ne(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function ge(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(A)]]:["filter-in-small",i,["literal",e]]}}function ke(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Xe(i){return["!",i]}function Zt(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let o="[";for(const p of i)o+=`${Zt(p)},`;return`${o}]`}const r=Object.keys(i).sort();let n="{";for(let o=0;o<r.length;o++)n+=`${JSON.stringify(r[o])}:${Zt(i[r[o]])},`;return`${n}}`}function Gt(i){let e="";for(const r of Ni)e+=`/${Zt(i[r])}`;return e}function Sr(i){const e=i.value;return e?[new Be(i.key,e,"constants have been deprecated as of v8")]:[]}function Et(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Xr(i){if(Array.isArray(i))return i.map(Xr);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=Xr(i[r]);return e}return Et(i)}function Ui(i){const e=i.key,r=i.value,n=i.valueSpec||{},o=i.objectElementValidators||{},p=i.style,d=i.styleSpec,m=i.validateSpec;let y=[];const v=Dt(r);if(v!=="object")return[new Be(e,r,`object expected, ${v} found`)];for(const E in r){const k=E.split(".")[0],F=n[k]||n["*"];let P;if(o[k])P=o[k];else if(n[k])P=m;else if(o["*"])P=o["*"];else{if(!n["*"]){y.push(new Be(e,r[E],`unknown property "${E}"`));continue}P=m}y=y.concat(P({key:(e&&`${e}.`)+E,value:r[E],valueSpec:F,style:p,styleSpec:d,object:r,objectKey:E,validateSpec:m},r))}for(const E in n)o[E]||n[E].required&&n[E].default===void 0&&r[E]===void 0&&y.push(new Be(e,r,`missing required property "${E}"`));return y}function Gn(i){const e=i.value,r=i.valueSpec,n=i.style,o=i.styleSpec,p=i.key,d=i.arrayElementValidator||i.validateSpec;if(Dt(e)!=="array")return[new Be(p,e,`array expected, ${Dt(e)} found`)];if(r.length&&e.length!==r.length)return[new Be(p,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new Be(p,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let m={type:r.value,values:r.values};o.$version<7&&(m.function=r.function),Dt(r.value)==="object"&&(m=r.value);let y=[];for(let v=0;v<e.length;v++)y=y.concat(d({array:e,arrayIndex:v,value:e[v],valueSpec:m,validateSpec:i.validateSpec,style:n,styleSpec:o,key:`${p}[${v}]`}));return y}function wa(i){const e=i.key,r=i.value,n=i.valueSpec;let o=Dt(r);return o==="number"&&r!=r&&(o="NaN"),o!=="number"?[new Be(e,r,`number expected, ${o} found`)]:"minimum"in n&&r<n.minimum?[new Be(e,r,`${r} is less than the minimum value ${n.minimum}`)]:"maximum"in n&&r>n.maximum?[new Be(e,r,`${r} is greater than the maximum value ${n.maximum}`)]:[]}function Qa(i){const e=i.valueSpec,r=Et(i.value.type);let n,o,p,d={};const m=r!=="categorical"&&i.value.property===void 0,y=!m,v=Dt(i.value.stops)==="array"&&Dt(i.value.stops[0])==="array"&&Dt(i.value.stops[0][0])==="object",E=Ui({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(P){if(r==="identity")return[new Be(P.key,P.value,'identity function may not have a "stops" property')];let L=[];const N=P.value;return L=L.concat(Gn({key:P.key,value:N,valueSpec:P.valueSpec,validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec,arrayElementValidator:k})),Dt(N)==="array"&&N.length===0&&L.push(new Be(P.key,N,"array must have at least one stop")),L},default:function(P){return P.validateSpec({key:P.key,value:P.value,valueSpec:e,validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec})}}});return r==="identity"&&m&&E.push(new Be(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||E.push(new Be(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!jn(i.valueSpec)&&E.push(new Be(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(y&&!Is(i.valueSpec)?E.push(new Be(i.key,i.value,"property functions not supported")):m&&!Ya(i.valueSpec)&&E.push(new Be(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!v||i.value.property!==void 0||E.push(new Be(i.key,i.value,'"property" property is required')),E;function k(P){let L=[];const N=P.value,W=P.key;if(Dt(N)!=="array")return[new Be(W,N,`array expected, ${Dt(N)} found`)];if(N.length!==2)return[new Be(W,N,`array length 2 expected, length ${N.length} found`)];if(v){if(Dt(N[0])!=="object")return[new Be(W,N,`object expected, ${Dt(N[0])} found`)];if(N[0].zoom===void 0)return[new Be(W,N,"object stop key must have zoom")];if(N[0].value===void 0)return[new Be(W,N,"object stop key must have value")];if(p&&p>Et(N[0].zoom))return[new Be(W,N[0].zoom,"stop zoom values must appear in ascending order")];Et(N[0].zoom)!==p&&(p=Et(N[0].zoom),o=void 0,d={}),L=L.concat(Ui({key:`${W}[0]`,value:N[0],valueSpec:{zoom:{}},validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec,objectElementValidators:{zoom:wa,value:F}}))}else L=L.concat(F({key:`${W}[0]`,value:N[0],validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec},N));return hn(Xr(N[1]))?L.concat([new Be(`${W}[1]`,N[1],"expressions are not allowed in function stops.")]):L.concat(P.validateSpec({key:`${W}[1]`,value:N[1],valueSpec:e,validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec}))}function F(P,L){const N=Dt(P.value),W=Et(P.value),J=P.value!==null?P.value:L;if(n){if(N!==n)return[new Be(P.key,J,`${N} stop domain type must match previous stop domain type ${n}`)]}else n=N;if(N!=="number"&&N!=="string"&&N!=="boolean")return[new Be(P.key,J,"stop domain value must be a number, string, or boolean")];if(N!=="number"&&r!=="categorical"){let oe=`number expected, ${N} found`;return Is(e)&&r===void 0&&(oe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Be(P.key,J,oe)]}return r!=="categorical"||N!=="number"||isFinite(W)&&Math.floor(W)===W?r!=="categorical"&&N==="number"&&o!==void 0&&W<o?[new Be(P.key,J,"stop domain values must appear in ascending order")]:(o=W,r==="categorical"&&W in d?[new Be(P.key,J,"stop domain values must be unique")]:(d[W]=!0,[])):[new Be(P.key,J,`integer expected, found ${W}`)]}}function gn(i){const e=(i.expressionContext==="property"?va:pn)(Xr(i.value),i.valueSpec);if(e.result==="error")return e.value.map(n=>new Be(`${i.key}${n.key}`,i.value,n.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new Be(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!os(r))return[new Be(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!os(r))return[new Be(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!tr(r,["zoom","feature-state"]))return[new Be(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!ht(r))return[new Be(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Aa(i){const e=i.key,r=i.value,n=i.valueSpec,o=[];return Array.isArray(n.values)?n.values.indexOf(Et(r))===-1&&o.push(new Be(e,r,`expected one of [${n.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(n.values).indexOf(Et(r))===-1&&o.push(new Be(e,r,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(r)} found`)),o}function Hn(i){return mn(Xr(i.value))?gn(Er({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):gl(i)}function gl(i){const e=i.value,r=i.key;if(Dt(e)!=="array")return[new Be(r,e,`array expected, ${Dt(e)} found`)];const n=i.styleSpec;let o,p=[];if(e.length<1)return[new Be(r,e,"filter array must have at least 1 element")];switch(p=p.concat(Aa({key:`${r}[0]`,value:e[0],valueSpec:n.filter_operator,style:i.style,styleSpec:i.styleSpec})),Et(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Et(e[1])==="$type"&&p.push(new Be(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&p.push(new Be(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(o=Dt(e[1]),o!=="string"&&p.push(new Be(`${r}[1]`,e[1],`string expected, ${o} found`)));for(let d=2;d<e.length;d++)o=Dt(e[d]),Et(e[1])==="$type"?p=p.concat(Aa({key:`${r}[${d}]`,value:e[d],valueSpec:n.geometry_type,style:i.style,styleSpec:i.styleSpec})):o!=="string"&&o!=="number"&&o!=="boolean"&&p.push(new Be(`${r}[${d}]`,e[d],`string, number, or boolean expected, ${o} found`));break;case"any":case"all":case"none":for(let d=1;d<e.length;d++)p=p.concat(gl({key:`${r}[${d}]`,value:e[d],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":o=Dt(e[1]),e.length!==2?p.push(new Be(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):o!=="string"&&p.push(new Be(`${r}[1]`,e[1],`string expected, ${o} found`));break;case"within":o=Dt(e[1]),e.length!==2?p.push(new Be(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):o!=="object"&&p.push(new Be(`${r}[1]`,e[1],`object expected, ${o} found`))}return p}function _l(i,e){const r=i.key,n=i.validateSpec,o=i.style,p=i.styleSpec,d=i.value,m=i.objectKey,y=p[`${e}_${i.layerType}`];if(!y)return[];const v=m.match(/^(.*)-transition$/);if(e==="paint"&&v&&y[v[1]]&&y[v[1]].transition)return n({key:r,value:d,valueSpec:p.transition,style:o,styleSpec:p});const E=i.valueSpec||y[m];if(!E)return[new Be(r,d,`unknown property "${m}"`)];let k;if(Dt(d)==="string"&&Is(E)&&!E.tokens&&(k=/^{([^}]+)}$/.exec(d)))return[new Be(r,d,`"${m}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(k[1])} }\`.`)];const F=[];return i.layerType==="symbol"&&(m==="text-field"&&o&&!o.glyphs&&F.push(new Be(r,d,'use of "text-field" requires a style "glyphs" property')),m==="text-font"&&Jt(Xr(d))&&Et(d.type)==="identity"&&F.push(new Be(r,d,'"text-font" does not support identity functions'))),F.concat(n({key:i.key,value:d,valueSpec:E,style:o,styleSpec:p,expressionContext:"property",propertyType:e,propertyKey:m}))}function yl(i){return _l(i,"paint")}function xl(i){return _l(i,"layout")}function vl(i){let e=[];const r=i.value,n=i.key,o=i.style,p=i.styleSpec;r.type||r.ref||e.push(new Be(n,r,'either "type" or "ref" is required'));let d=Et(r.type);const m=Et(r.ref);if(r.id){const y=Et(r.id);for(let v=0;v<i.arrayIndex;v++){const E=o.layers[v];Et(E.id)===y&&e.push(new Be(n,r.id,`duplicate layer id "${r.id}", previously used at line ${E.id.__line__}`))}}if("ref"in r){let y;["type","source","source-layer","filter","layout"].forEach(v=>{v in r&&e.push(new Be(n,r[v],`"${v}" is prohibited for ref layers`))}),o.layers.forEach(v=>{Et(v.id)===m&&(y=v)}),y?y.ref?e.push(new Be(n,r.ref,"ref cannot reference another ref layer")):d=Et(y.type):e.push(new Be(n,r.ref,`ref layer "${m}" not found`))}else if(d!=="background")if(r.source){const y=o.sources&&o.sources[r.source],v=y&&Et(y.type);y?v==="vector"&&d==="raster"?e.push(new Be(n,r.source,`layer "${r.id}" requires a raster source`)):v!=="raster-dem"&&d==="hillshade"?e.push(new Be(n,r.source,`layer "${r.id}" requires a raster-dem source`)):v==="raster"&&d!=="raster"?e.push(new Be(n,r.source,`layer "${r.id}" requires a vector source`)):v!=="vector"||r["source-layer"]?v==="raster-dem"&&d!=="hillshade"?e.push(new Be(n,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):d!=="line"||!r.paint||!r.paint["line-gradient"]||v==="geojson"&&y.lineMetrics||e.push(new Be(n,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Be(n,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Be(n,r.source,`source "${r.source}" not found`))}else e.push(new Be(n,r,'missing required property "source"'));return e=e.concat(Ui({key:n,value:r,valueSpec:p.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${n}.type`,value:r.type,valueSpec:p.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:Hn,layout:y=>Ui({layer:r,key:y.key,value:y.value,style:y.style,styleSpec:y.styleSpec,validateSpec:y.validateSpec,objectElementValidators:{"*":v=>xl(Er({layerType:d},v))}}),paint:y=>Ui({layer:r,key:y.key,value:y.value,style:y.style,styleSpec:y.styleSpec,validateSpec:y.validateSpec,objectElementValidators:{"*":v=>yl(Er({layerType:d},v))}})}})),e}function cs(i){const e=i.value,r=i.key,n=Dt(e);return n!=="string"?[new Be(r,e,`string expected, ${n} found`)]:[]}const Ea={promoteId:function({key:i,value:e}){if(Dt(e)==="string")return cs({key:i,value:e});{const r=[];for(const n in e)r.push(...cs({key:`${i}.${n}`,value:e[n]}));return r}}};function kr(i){const e=i.value,r=i.key,n=i.styleSpec,o=i.style,p=i.validateSpec;if(!e.type)return[new Be(r,e,'"type" is required')];const d=Et(e.type);let m;switch(d){case"vector":case"raster":return m=Ui({key:r,value:e,valueSpec:n[`source_${d.replace("-","_")}`],style:i.style,styleSpec:n,objectElementValidators:Ea,validateSpec:p}),m;case"raster-dem":return m=function(y){var v;const E=(v=y.sourceName)!==null&&v!==void 0?v:"",k=y.value,F=y.styleSpec,P=F.source_raster_dem,L=y.style;let N=[];const W=Dt(k);if(k===void 0)return N;if(W!=="object")return N.push(new Be("source_raster_dem",k,`object expected, ${W} found`)),N;const J=Et(k.encoding)==="custom",oe=["redFactor","greenFactor","blueFactor","baseShift"],te=y.value.encoding?`"${y.value.encoding}"`:"Default";for(const ue in k)!J&&oe.includes(ue)?N.push(new Be(ue,k[ue],`In "${E}": "${ue}" is only valid when "encoding" is set to "custom". ${te} encoding found`)):P[ue]?N=N.concat(y.validateSpec({key:ue,value:k[ue],valueSpec:P[ue],validateSpec:y.validateSpec,style:L,styleSpec:F})):N.push(new Be(ue,k[ue],`unknown property "${ue}"`));return N}({sourceName:r,value:e,style:i.style,styleSpec:n,validateSpec:p}),m;case"geojson":if(m=Ui({key:r,value:e,valueSpec:n.source_geojson,style:o,styleSpec:n,validateSpec:p,objectElementValidators:Ea}),e.cluster)for(const y in e.clusterProperties){const[v,E]=e.clusterProperties[y],k=typeof v=="string"?[v,["accumulated"],["get",y]]:v;m.push(...gn({key:`${r}.${y}.map`,value:E,expressionContext:"cluster-map"})),m.push(...gn({key:`${r}.${y}.reduce`,value:k,expressionContext:"cluster-reduce"}))}return m;case"video":return Ui({key:r,value:e,valueSpec:n.source_video,style:o,validateSpec:p,styleSpec:n});case"image":return Ui({key:r,value:e,valueSpec:n.source_image,style:o,validateSpec:p,styleSpec:n});case"canvas":return[new Be(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Aa({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Ca(i){const e=i.value,r=i.styleSpec,n=r.light,o=i.style;let p=[];const d=Dt(e);if(e===void 0)return p;if(d!=="object")return p=p.concat([new Be("light",e,`object expected, ${d} found`)]),p;for(const m in e){const y=m.match(/^(.*)-transition$/);p=p.concat(y&&n[y[1]]&&n[y[1]].transition?i.validateSpec({key:m,value:e[m],valueSpec:r.transition,validateSpec:i.validateSpec,style:o,styleSpec:r}):n[m]?i.validateSpec({key:m,value:e[m],valueSpec:n[m],validateSpec:i.validateSpec,style:o,styleSpec:r}):[new Be(m,e[m],`unknown property "${m}"`)])}return p}function bl(i){const e=i.value,r=i.styleSpec,n=r.terrain,o=i.style;let p=[];const d=Dt(e);if(e===void 0)return p;if(d!=="object")return p=p.concat([new Be("terrain",e,`object expected, ${d} found`)]),p;for(const m in e)p=p.concat(n[m]?i.validateSpec({key:m,value:e[m],valueSpec:n[m],validateSpec:i.validateSpec,style:o,styleSpec:r}):[new Be(m,e[m],`unknown property "${m}"`)]);return p}function wl(i){let e=[];const r=i.value,n=i.key;if(Array.isArray(r)){const o=[],p=[];for(const d in r)r[d].id&&o.includes(r[d].id)&&e.push(new Be(n,r,`all the sprites' ids must be unique, but ${r[d].id} is duplicated`)),o.push(r[d].id),r[d].url&&p.includes(r[d].url)&&e.push(new Be(n,r,`all the sprites' URLs must be unique, but ${r[d].url} is duplicated`)),p.push(r[d].url),e=e.concat(Ui({key:`${n}[${d}]`,value:r[d],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return cs({key:n,value:r})}const Al={"*":()=>[],array:Gn,boolean:function(i){const e=i.value,r=i.key,n=Dt(e);return n!=="boolean"?[new Be(r,e,`boolean expected, ${n} found`)]:[]},number:wa,color:function(i){const e=i.key,r=i.value,n=Dt(r);return n!=="string"?[new Be(e,r,`color expected, ${n} found`)]:zt.parse(String(r))?[]:[new Be(e,r,`color expected, "${r}" found`)]},constants:Sr,enum:Aa,filter:Hn,function:Qa,layer:vl,object:Ui,source:kr,light:Ca,terrain:bl,string:cs,formatted:function(i){return cs(i).length===0?[]:gn(i)},resolvedImage:function(i){return cs(i).length===0?[]:gn(i)},padding:function(i){const e=i.key,r=i.value;if(Dt(r)==="array"){if(r.length<1||r.length>4)return[new Be(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const n={type:"number"};let o=[];for(let p=0;p<r.length;p++)o=o.concat(i.validateSpec({key:`${e}[${p}]`,value:r[p],validateSpec:i.validateSpec,valueSpec:n}));return o}return wa({key:e,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const e=i.key,r=i.value,n=Dt(r),o=i.styleSpec;if(n!=="array"||r.length<1||r.length%2!=0)return[new Be(e,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let p=[];for(let d=0;d<r.length;d+=2)p=p.concat(Aa({key:`${e}[${d}]`,value:r[d],valueSpec:o.layout_symbol["text-anchor"]})),p=p.concat(Gn({key:`${e}[${d+1}]`,value:r[d+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:o}));return p},sprite:wl};function Ys(i){const e=i.value,r=i.valueSpec,n=i.styleSpec;return i.validateSpec=Ys,r.expression&&Jt(Et(e))?Qa(i):r.expression&&hn(Xr(e))?gn(i):r.type&&Al[r.type]?Al[r.type](i):Ui(Er({},i,{valueSpec:r.type?n[r.type]:r}))}function El(i){const e=i.value,r=i.key,n=cs(i);return n.length||(e.indexOf("{fontstack}")===-1&&n.push(new Be(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&n.push(new Be(r,e,'"glyphs" url must include a "{range}" token'))),n}function Or(i,e=ye){let r=[];return r=r.concat(Ys({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:Ys,objectElementValidators:{glyphs:El,"*":()=>[]}})),i.constants&&(r=r.concat(Sr({key:"constants",value:i.constants}))),eo(r)}function Bs(i){return function(e){return i({...e,validateSpec:Ys})}}function eo(i){return[].concat(i).sort((e,r)=>e.line-r.line)}function zs(i){return function(...e){return eo(i.apply(this,e))}}Or.source=zs(Bs(kr)),Or.sprite=zs(Bs(wl)),Or.glyphs=zs(Bs(El)),Or.light=zs(Bs(Ca)),Or.terrain=zs(Bs(bl)),Or.layer=zs(Bs(vl)),Or.filter=zs(Bs(Hn)),Or.paintProperty=zs(Bs(yl)),Or.layoutProperty=zs(Bs(xl));const Ms=Or,xu=Ms.light,Ao=Ms.paintProperty,Cl=Ms.layoutProperty;function to(i,e){let r=!1;if(e&&e.length)for(const n of e)i.fire(new rs(new Error(n.message))),r=!0;return r}class Wn{constructor(e,r,n){const o=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const d=new Int32Array(this.arrayBuffer);e=d[0],this.d=(r=d[1])+2*(n=d[2]);for(let y=0;y<this.d*this.d;y++){const v=d[3+y],E=d[3+y+1];o.push(v===E?null:d.subarray(v,E))}const m=d[3+o.length+1];this.keys=d.subarray(d[3+o.length],m),this.bboxes=d.subarray(m),this.insert=this._insertReadonly}else{this.d=r+2*n;for(let d=0;d<this.d*this.d;d++)o.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=n,this.scale=r/e,this.uid=0;const p=n/r*e;this.min=-p,this.max=e+p}insert(e,r,n,o,p){this._forEachCell(r,n,o,p,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(p)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,n,o,p,d){this.cells[p].push(d)}query(e,r,n,o,p){const d=this.min,m=this.max;if(e<=d&&r<=d&&m<=n&&m<=o&&!p)return Array.prototype.slice.call(this.keys);{const y=[];return this._forEachCell(e,r,n,o,this._queryCell,y,{},p),y}}_queryCell(e,r,n,o,p,d,m,y){const v=this.cells[p];if(v!==null){const E=this.keys,k=this.bboxes;for(let F=0;F<v.length;F++){const P=v[F];if(m[P]===void 0){const L=4*P;(y?y(k[L+0],k[L+1],k[L+2],k[L+3]):e<=k[L+2]&&r<=k[L+3]&&n>=k[L+0]&&o>=k[L+1])?(m[P]=!0,d.push(E[P])):m[P]=!1}}}}_forEachCell(e,r,n,o,p,d,m,y){const v=this._convertToCellCoord(e),E=this._convertToCellCoord(r),k=this._convertToCellCoord(n),F=this._convertToCellCoord(o);for(let P=v;P<=k;P++)for(let L=E;L<=F;L++){const N=this.d*L+P;if((!y||y(this._convertFromCellCoord(P),this._convertFromCellCoord(L),this._convertFromCellCoord(P+1),this._convertFromCellCoord(L+1)))&&p.call(this,e,r,n,o,N,d,m,y))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let n=0;for(let d=0;d<this.cells.length;d++)n+=this.cells[d].length;const o=new Int32Array(r+n+this.keys.length+this.bboxes.length);o[0]=this.extent,o[1]=this.n,o[2]=this.padding;let p=r;for(let d=0;d<e.length;d++){const m=e[d];o[3+d]=p,o.set(m,p),p+=m.length}return o[3+e.length]=p,o.set(this.keys,p),p+=this.keys.length,o[3+e.length+1]=p,o.set(this.bboxes,p),p+=this.bboxes.length,o.buffer}static serialize(e,r){const n=e.toArrayBuffer();return r&&r.push(n),{buffer:n}}static deserialize(e){return new Wn(e.buffer)}}const Ps={};function Ue(i,e,r={}){if(Ps[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),Ps[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}Ue("Object",Object),Ue("TransferableGridIndex",Wn),Ue("Color",zt),Ue("Error",Error),Ue("AJAXError",ct),Ue("ResolvedImage",vi),Ue("StylePropertyFunction",dn),Ue("StyleExpression",Mt,{omit:["_evaluator"]}),Ue("ZoomDependentExpression",Zn),Ue("ZoomConstantExpression",xa),Ue("CompoundExpression",dr,{omit:["_evaluate"]});for(const i in Ds)Ds[i]._classRegistryKey||Ue(`Expression_${i}`,Ds[i]);function io(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Js(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(io(i)||ys(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const n of i)r.push(Js(n,e));return r}if(typeof i=="object"){const r=i.constructor,n=r._classRegistryKey;if(!n)throw new Error("can't serialize object of unregistered class");if(!Ps[n])throw new Error(`${n} is not registered.`);const o=r.serialize?r.serialize(i,e):{};if(r.serialize){if(e&&o===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const p in i){if(!i.hasOwnProperty(p)||Ps[n].omit.indexOf(p)>=0)continue;const d=i[p];o[p]=Ps[n].shallow.indexOf(p)>=0?d:Js(d,e)}i instanceof Error&&(o.message=i.message)}if(o.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(o.$name=n),o}throw new Error("can't serialize object of type "+typeof i)}function Xn(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||io(i)||ys(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(Xn);if(typeof i=="object"){const e=i.$name||"Object";if(!Ps[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=Ps[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const n=Object.create(r.prototype);for(const o of Object.keys(i)){if(o==="$name")continue;const p=i[o];n[o]=Ps[e].shallow.indexOf(o)>=0?p:Xn(p)}return n}throw new Error("can't deserialize object of type "+typeof i)}class Sl{constructor(){this.first=!0}update(e,r){const n=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=n,!0))}}const $e={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Eo(i){for(const e of i)if(So(e.charCodeAt(0)))return!0;return!1}function Co(i){for(const e of i)if(!vu(e.charCodeAt(0)))return!1;return!0}function vu(i){return!($e.Arabic(i)||$e["Arabic Supplement"](i)||$e["Arabic Extended-A"](i)||$e["Arabic Presentation Forms-A"](i)||$e["Arabic Presentation Forms-B"](i))}function So(i){return!(i!==746&&i!==747&&(i<4352||!($e["Bopomofo Extended"](i)||$e.Bopomofo(i)||$e["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||$e["CJK Compatibility Ideographs"](i)||$e["CJK Compatibility"](i)||$e["CJK Radicals Supplement"](i)||$e["CJK Strokes"](i)||!(!$e["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||$e["CJK Unified Ideographs Extension A"](i)||$e["CJK Unified Ideographs"](i)||$e["Enclosed CJK Letters and Months"](i)||$e["Hangul Compatibility Jamo"](i)||$e["Hangul Jamo Extended-A"](i)||$e["Hangul Jamo Extended-B"](i)||$e["Hangul Jamo"](i)||$e["Hangul Syllables"](i)||$e.Hiragana(i)||$e["Ideographic Description Characters"](i)||$e.Kanbun(i)||$e["Kangxi Radicals"](i)||$e["Katakana Phonetic Extensions"](i)||$e.Katakana(i)&&i!==12540||!(!$e["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!$e["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||$e["Unified Canadian Aboriginal Syllabics"](i)||$e["Unified Canadian Aboriginal Syllabics Extended"](i)||$e["Vertical Forms"](i)||$e["Yijing Hexagram Symbols"](i)||$e["Yi Syllables"](i)||$e["Yi Radicals"](i))))}function kl(i){return!(So(i)||function(e){return!!($e["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||$e["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||$e["Letterlike Symbols"](e)||$e["Number Forms"](e)||$e["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||$e["Control Pictures"](e)&&e!==9251||$e["Optical Character Recognition"](e)||$e["Enclosed Alphanumerics"](e)||$e["Geometric Shapes"](e)||$e["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||$e["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||$e["CJK Symbols and Punctuation"](e)||$e.Katakana(e)||$e["Private Use Area"](e)||$e["CJK Compatibility Forms"](e)||$e["Small Form Variants"](e)||$e["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function Tl(i){return i>=1424&&i<=2303||$e["Arabic Presentation Forms-A"](i)||$e["Arabic Presentation Forms-B"](i)}function Dl(i,e){return!(!e&&Tl(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||$e.Khmer(i))}function bu(i){for(const e of i)if(Tl(e.charCodeAt(0)))return!0;return!1}const ko="deferred",To="loading",Do="loaded";let Io=null,gr="unavailable",Qs=null;const Sa=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(gr="error"),Io&&Io(i)};function Fo(){ka.fire(new is("pluginStateChange",{pluginStatus:gr,pluginURL:Qs}))}const ka=new ws,Bo=function(){return gr},Il=function(){if(gr!==ko||!Qs)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");gr=To,Fo(),Qs&&vs({url:Qs},i=>{i?Sa(i):(gr=Do,Fo())})},Tr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>gr===Do||Tr.applyArabicShaping!=null,isLoading:()=>gr===To,setState(i){if(!Hi())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");gr=i.pluginStatus,Qs=i.pluginURL},isParsed(){if(!Hi())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Tr.applyArabicShaping!=null&&Tr.processBidirectionalText!=null&&Tr.processStyledBidirectionalText!=null},getPluginURL(){if(!Hi())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Qs}};class Qt{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Sl,this.transition={})}isSupportedScript(e){return function(r,n){for(const o of r)if(!Dl(o.charCodeAt(0),n))return!1;return!0}(e,Tr.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),n=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*r}}}class ro{constructor(e,r){this.property=e,this.value=r,this.expression=function(n,o){if(Jt(n))return new dn(n,o);if(hn(n)){const p=va(n,o);if(p.result==="error")throw new Error(p.value.map(d=>`${d.key}: ${d.message}`).join(", "));return p.value}{let p=n;return o.type==="color"&&typeof n=="string"?p=zt.parse(n):o.type!=="padding"||typeof n!="number"&&!Array.isArray(n)?o.type==="variableAnchorOffsetCollection"&&Array.isArray(n)&&(p=hr.parse(n)):p=Qi.parse(n),{kind:"constant",evaluate:()=>p}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,n){return this.property.possiblyEvaluate(this,e,r,n)}}class zo{constructor(e){this.property=e,this.value=new ro(e,void 0)}transitioned(e,r){return new Bl(this.property,this.value,r,mi({},e.transition,this.transition),e.now)}untransitioned(){return new Bl(this.property,this.value,null,{},0)}}class Fl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return $i(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new zo(this._values[e].property)),this._values[e].value=new ro(this._values[e].property,r===null?void 0:$i(r))}getTransition(e){return $i(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new zo(this._values[e].property)),this._values[e].transition=$i(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const n=this.getValue(r);n!==void 0&&(e[r]=n);const o=this.getTransition(r);o!==void 0&&(e[`${r}-transition`]=o)}return e}transitioned(e,r){const n=new zl(this._properties);for(const o of Object.keys(this._values))n._values[o]=this._values[o].transitioned(e,r._values[o]);return n}untransitioned(){const e=new zl(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Bl{constructor(e,r,n,o,p){this.property=e,this.value=r,this.begin=p+o.delay||0,this.end=this.begin+o.duration||0,e.specification.transition&&(o.delay||o.duration)&&(this.prior=n)}possiblyEvaluate(e,r,n){const o=e.now||0,p=this.value.possiblyEvaluate(e,r,n),d=this.prior;if(d){if(o>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(o<this.begin)return d.possiblyEvaluate(e,r,n);{const m=(o-this.begin)/(this.end-this.begin);return this.property.interpolate(d.possiblyEvaluate(e,r,n),p,function(y){if(y<=0)return 0;if(y>=1)return 1;const v=y*y,E=v*y;return 4*(y<.5?E:3*(y-v)+E-.75)}(m))}}return p}}class zl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,n){const o=new so(this._properties);for(const p of Object.keys(this._values))o._values[p]=this._values[p].possiblyEvaluate(e,r,n);return o}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class wu{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return $i(this._values[e].value)}setValue(e,r){this._values[e]=new ro(this._values[e].property,r===null?void 0:$i(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const n=this.getValue(r);n!==void 0&&(e[r]=n)}return e}possiblyEvaluate(e,r,n){const o=new so(this._properties);for(const p of Object.keys(this._values))o._values[p]=this._values[p].possiblyEvaluate(e,r,n);return o}}class ir{constructor(e,r,n){this.property=e,this.value=r,this.parameters=n}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,n,o){return this.property.evaluate(this.value,this.parameters,e,r,n,o)}}class so{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Je{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,n){const o=st[this.specification.type];return o?o(e,r,n):e}}class it{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,n,o){return new ir(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},n,o)}:e.expression,r)}interpolate(e,r,n){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new ir(this,{kind:"constant",value:void 0},e.parameters);const o=st[this.specification.type];if(o){const p=o(e.value.value,r.value.value,n);return new ir(this,{kind:"constant",value:p},e.parameters)}return e}evaluate(e,r,n,o,p,d){return e.kind==="constant"?e.value:e.evaluate(r,n,o,p,d)}}class Ta extends it{possiblyEvaluate(e,r,n,o){if(e.value===void 0)return new ir(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const p=e.expression.evaluate(r,null,{},n,o),d=e.property.specification.type==="resolvedImage"&&typeof p!="string"?p.name:p,m=this._calculate(d,d,d,r);return new ir(this,{kind:"constant",value:m},r)}if(e.expression.kind==="camera"){const p=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new ir(this,{kind:"constant",value:p},r)}return new ir(this,e.expression,r)}evaluate(e,r,n,o,p,d){if(e.kind==="source"){const m=e.evaluate(r,n,o,p,d);return this._calculate(m,m,m,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},n,o),e.evaluate({zoom:Math.floor(r.zoom)},n,o),e.evaluate({zoom:Math.floor(r.zoom)+1},n,o),r):e.value}_calculate(e,r,n,o){return o.zoom>o.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:n,to:r}}interpolate(e){return e}}class Mo{constructor(e){this.specification=e}possiblyEvaluate(e,r,n,o){if(e.value!==void 0){if(e.expression.kind==="constant"){const p=e.expression.evaluate(r,null,{},n,o);return this._calculate(p,p,p,r)}return this._calculate(e.expression.evaluate(new Qt(Math.floor(r.zoom-1),r)),e.expression.evaluate(new Qt(Math.floor(r.zoom),r)),e.expression.evaluate(new Qt(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,n,o){return o.zoom>o.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:n,to:r}}interpolate(e){return e}}class Po{constructor(e){this.specification=e}possiblyEvaluate(e,r,n,o){return!!e.expression.evaluate(r,null,{},n,o)}interpolate(){return!1}}class _i{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const n=e[r];n.specification.overridable&&this.overridableProperties.push(r);const o=this.defaultPropertyValues[r]=new ro(n,void 0),p=this.defaultTransitionablePropertyValues[r]=new zo(n);this.defaultTransitioningPropertyValues[r]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=o.possiblyEvaluate({})}}}Ue("DataDrivenProperty",it),Ue("DataConstantProperty",Je),Ue("CrossFadedDataDrivenProperty",Ta),Ue("CrossFadedProperty",Mo),Ue("ColorRampProperty",Po);const Lo="-transition";class $r extends ws{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new wu(r.layout)),r.paint)){this._transitionablePaint=new Fl(r.paint);for(const n in e.paint)this.setPaintProperty(n,e.paint[n],{validate:!1});for(const n in e.layout)this.setLayoutProperty(n,e.layout[n],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new so(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,n={}){r!=null&&this._validate(Cl,`layers.${this.id}.layout.${e}`,e,r,n)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith(Lo)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,n={}){if(r!=null&&this._validate(Ao,`layers.${this.id}.paint.${e}`,e,r,n))return!1;if(e.endsWith(Lo))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const o=this._transitionablePaint._values[e],p=o.property.specification["property-type"]==="cross-faded-data-driven",d=o.value.isDataDriven(),m=o.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const y=this._transitionablePaint._values[e].value;return y.isDataDriven()||d||p||this._handleOverridablePaintPropertyUpdate(e,m,y)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,n){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Ur(e,(r,n)=>!(r===void 0||n==="layout"&&!Object.keys(r).length||n==="paint"&&!Object.keys(r).length))}_validate(e,r,n,o,p={}){return(!p||p.validate!==!1)&&to(this,e.call(Ms,{key:r,layerType:this.type,objectKey:n,value:o,styleSpec:ye,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof ir&&Is(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const Ml={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class _n{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class li{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function ai(i,e=1){let r=0,n=0;return{members:i.map(o=>{const p=Ml[o.type].BYTES_PER_ELEMENT,d=r=Kn(r,Math.max(e,p)),m=o.components||1;return n=Math.max(n,p),r+=p*m,{name:o.name,type:o.type,components:m,offset:d}}),size:Kn(r,Math.max(n,e)),alignment:e}}function Kn(i,e){return Math.ceil(i/e)*e}class Da extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,r)}emplace(e,r,n){const o=2*e;return this.int16[o+0]=r,this.int16[o+1]=n,e}}Da.prototype.bytesPerElement=4,Ue("StructArrayLayout2i4",Da);class Ia extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,r,n)}emplace(e,r,n,o){const p=3*e;return this.int16[p+0]=r,this.int16[p+1]=n,this.int16[p+2]=o,e}}Ia.prototype.bytesPerElement=6,Ue("StructArrayLayout3i6",Ia);class yn extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,o){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,n,o)}emplace(e,r,n,o,p){const d=4*e;return this.int16[d+0]=r,this.int16[d+1]=n,this.int16[d+2]=o,this.int16[d+3]=p,e}}yn.prototype.bytesPerElement=8,Ue("StructArrayLayout4i8",yn);class Ro extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,o,p,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,n,o,p,d)}emplace(e,r,n,o,p,d,m){const y=6*e;return this.int16[y+0]=r,this.int16[y+1]=n,this.int16[y+2]=o,this.int16[y+3]=p,this.int16[y+4]=d,this.int16[y+5]=m,e}}Ro.prototype.bytesPerElement=12,Ue("StructArrayLayout2i4i12",Ro);class Oo extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,o,p,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,n,o,p,d)}emplace(e,r,n,o,p,d,m){const y=4*e,v=8*e;return this.int16[y+0]=r,this.int16[y+1]=n,this.uint8[v+4]=o,this.uint8[v+5]=p,this.uint8[v+6]=d,this.uint8[v+7]=m,e}}Oo.prototype.bytesPerElement=8,Ue("StructArrayLayout2i4ub8",Oo);class Yn extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,r)}emplace(e,r,n){const o=2*e;return this.float32[o+0]=r,this.float32[o+1]=n,e}}Yn.prototype.bytesPerElement=8,Ue("StructArrayLayout2f8",Yn);class $o extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,o,p,d,m,y,v,E){const k=this.length;return this.resize(k+1),this.emplace(k,e,r,n,o,p,d,m,y,v,E)}emplace(e,r,n,o,p,d,m,y,v,E,k){const F=10*e;return this.uint16[F+0]=r,this.uint16[F+1]=n,this.uint16[F+2]=o,this.uint16[F+3]=p,this.uint16[F+4]=d,this.uint16[F+5]=m,this.uint16[F+6]=y,this.uint16[F+7]=v,this.uint16[F+8]=E,this.uint16[F+9]=k,e}}$o.prototype.bytesPerElement=20,Ue("StructArrayLayout10ui20",$o);class No extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,o,p,d,m,y,v,E,k,F){const P=this.length;return this.resize(P+1),this.emplace(P,e,r,n,o,p,d,m,y,v,E,k,F)}emplace(e,r,n,o,p,d,m,y,v,E,k,F,P){const L=12*e;return this.int16[L+0]=r,this.int16[L+1]=n,this.int16[L+2]=o,this.int16[L+3]=p,this.uint16[L+4]=d,this.uint16[L+5]=m,this.uint16[L+6]=y,this.uint16[L+7]=v,this.int16[L+8]=E,this.int16[L+9]=k,this.int16[L+10]=F,this.int16[L+11]=P,e}}No.prototype.bytesPerElement=24,Ue("StructArrayLayout4i4ui4i24",No);class Ft extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,r,n)}emplace(e,r,n,o){const p=3*e;return this.float32[p+0]=r,this.float32[p+1]=n,this.float32[p+2]=o,e}}Ft.prototype.bytesPerElement=12,Ue("StructArrayLayout3f12",Ft);class c extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}c.prototype.bytesPerElement=4,Ue("StructArrayLayout1ul4",c);class t extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,o,p,d,m,y,v){const E=this.length;return this.resize(E+1),this.emplace(E,e,r,n,o,p,d,m,y,v)}emplace(e,r,n,o,p,d,m,y,v,E){const k=10*e,F=5*e;return this.int16[k+0]=r,this.int16[k+1]=n,this.int16[k+2]=o,this.int16[k+3]=p,this.int16[k+4]=d,this.int16[k+5]=m,this.uint32[F+3]=y,this.uint16[k+8]=v,this.uint16[k+9]=E,e}}t.prototype.bytesPerElement=20,Ue("StructArrayLayout6i1ul2ui20",t);class s extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,o,p,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,n,o,p,d)}emplace(e,r,n,o,p,d,m){const y=6*e;return this.int16[y+0]=r,this.int16[y+1]=n,this.int16[y+2]=o,this.int16[y+3]=p,this.int16[y+4]=d,this.int16[y+5]=m,e}}s.prototype.bytesPerElement=12,Ue("StructArrayLayout2i2i2i12",s);class a extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,o,p){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,n,o,p)}emplace(e,r,n,o,p,d){const m=4*e,y=8*e;return this.float32[m+0]=r,this.float32[m+1]=n,this.float32[m+2]=o,this.int16[y+6]=p,this.int16[y+7]=d,e}}a.prototype.bytesPerElement=16,Ue("StructArrayLayout2f1f2i16",a);class u extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,o){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,n,o)}emplace(e,r,n,o,p){const d=12*e,m=3*e;return this.uint8[d+0]=r,this.uint8[d+1]=n,this.float32[m+1]=o,this.float32[m+2]=p,e}}u.prototype.bytesPerElement=12,Ue("StructArrayLayout2ub2f12",u);class h extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,r,n)}emplace(e,r,n,o){const p=3*e;return this.uint16[p+0]=r,this.uint16[p+1]=n,this.uint16[p+2]=o,e}}h.prototype.bytesPerElement=6,Ue("StructArrayLayout3ui6",h);class g extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,o,p,d,m,y,v,E,k,F,P,L,N,W,J){const oe=this.length;return this.resize(oe+1),this.emplace(oe,e,r,n,o,p,d,m,y,v,E,k,F,P,L,N,W,J)}emplace(e,r,n,o,p,d,m,y,v,E,k,F,P,L,N,W,J,oe){const te=24*e,ue=12*e,pe=48*e;return this.int16[te+0]=r,this.int16[te+1]=n,this.uint16[te+2]=o,this.uint16[te+3]=p,this.uint32[ue+2]=d,this.uint32[ue+3]=m,this.uint32[ue+4]=y,this.uint16[te+10]=v,this.uint16[te+11]=E,this.uint16[te+12]=k,this.float32[ue+7]=F,this.float32[ue+8]=P,this.uint8[pe+36]=L,this.uint8[pe+37]=N,this.uint8[pe+38]=W,this.uint32[ue+10]=J,this.int16[te+22]=oe,e}}g.prototype.bytesPerElement=48,Ue("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",g);class _ extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,o,p,d,m,y,v,E,k,F,P,L,N,W,J,oe,te,ue,pe,Ae,Ne,He,Oe,Re,ze,qe){const Pe=this.length;return this.resize(Pe+1),this.emplace(Pe,e,r,n,o,p,d,m,y,v,E,k,F,P,L,N,W,J,oe,te,ue,pe,Ae,Ne,He,Oe,Re,ze,qe)}emplace(e,r,n,o,p,d,m,y,v,E,k,F,P,L,N,W,J,oe,te,ue,pe,Ae,Ne,He,Oe,Re,ze,qe,Pe){const Ie=32*e,tt=16*e;return this.int16[Ie+0]=r,this.int16[Ie+1]=n,this.int16[Ie+2]=o,this.int16[Ie+3]=p,this.int16[Ie+4]=d,this.int16[Ie+5]=m,this.int16[Ie+6]=y,this.int16[Ie+7]=v,this.uint16[Ie+8]=E,this.uint16[Ie+9]=k,this.uint16[Ie+10]=F,this.uint16[Ie+11]=P,this.uint16[Ie+12]=L,this.uint16[Ie+13]=N,this.uint16[Ie+14]=W,this.uint16[Ie+15]=J,this.uint16[Ie+16]=oe,this.uint16[Ie+17]=te,this.uint16[Ie+18]=ue,this.uint16[Ie+19]=pe,this.uint16[Ie+20]=Ae,this.uint16[Ie+21]=Ne,this.uint16[Ie+22]=He,this.uint32[tt+12]=Oe,this.float32[tt+13]=Re,this.float32[tt+14]=ze,this.uint16[Ie+30]=qe,this.uint16[Ie+31]=Pe,e}}_.prototype.bytesPerElement=64,Ue("StructArrayLayout8i15ui1ul2f2ui64",_);class x extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}x.prototype.bytesPerElement=4,Ue("StructArrayLayout1f4",x);class b extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,r,n)}emplace(e,r,n,o){const p=3*e;return this.uint16[6*e+0]=r,this.float32[p+1]=n,this.float32[p+2]=o,e}}b.prototype.bytesPerElement=12,Ue("StructArrayLayout1ui2f12",b);class C extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,r,n)}emplace(e,r,n,o){const p=4*e;return this.uint32[2*e+0]=r,this.uint16[p+2]=n,this.uint16[p+3]=o,e}}C.prototype.bytesPerElement=8,Ue("StructArrayLayout1ul2ui8",C);class S extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,r)}emplace(e,r,n){const o=2*e;return this.uint16[o+0]=r,this.uint16[o+1]=n,e}}S.prototype.bytesPerElement=4,Ue("StructArrayLayout2ui4",S);class z extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}z.prototype.bytesPerElement=2,Ue("StructArrayLayout1ui2",z);class U extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,o){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,n,o)}emplace(e,r,n,o,p){const d=4*e;return this.float32[d+0]=r,this.float32[d+1]=n,this.float32[d+2]=o,this.float32[d+3]=p,e}}U.prototype.bytesPerElement=16,Ue("StructArrayLayout4f16",U);class V extends _n{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Ee(this.anchorPointX,this.anchorPointY)}}V.prototype.size=20;class G extends t{get(e){return new V(this,e)}}Ue("CollisionBoxArray",G);class O extends _n{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}O.prototype.size=48;class re extends g{get(e){return new O(this,e)}}Ue("PlacedSymbolArray",re);class he extends _n{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}he.prototype.size=64;class K extends _{get(e){return new he(this,e)}}Ue("SymbolInstanceArray",K);class ae extends x{getoffsetX(e){return this.float32[1*e+0]}}Ue("GlyphOffsetArray",ae);class de extends Ia{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Ue("SymbolLineVertexArray",de);class fe extends _n{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}fe.prototype.size=12;class we extends b{get(e){return new fe(this,e)}}Ue("TextAnchorOffsetArray",we);class De extends _n{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}De.prototype.size=8;class Ce extends C{get(e){return new De(this,e)}}Ue("FeatureIndexArray",Ce);class Fe extends Da{}class Ge extends Da{}class yt extends Da{}class Le extends Ro{}class rt extends Oo{}class Ke extends Yn{}class Ot extends $o{}class gt extends No{}class pt extends Ft{}class xt extends c{}class pi extends s{}class Xt extends u{}class qi extends h{}class Si extends S{}const yi=ai([{name:"a_pos",components:2,type:"Int16"}],4),{members:Dr}=yi;class ei{constructor(e=[]){this.segments=e}prepareSegment(e,r,n,o){let p=this.segments[this.segments.length-1];return e>ei.MAX_VERTEX_ARRAY_LENGTH&&Ai(`Max vertices per segment is ${ei.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!p||p.vertexLength+e>ei.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==o)&&(p={vertexOffset:r.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},o!==void 0&&(p.sortKey=o),this.segments.push(p)),p}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,n,o){return new ei([{vertexOffset:e,primitiveOffset:r,vertexLength:n,primitiveLength:o,vaos:{},sortKey:0}])}}function hs(i,e){return 256*(i=oi(Math.floor(i),0,255))+oi(Math.floor(e),0,255)}ei.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ue("SegmentVector",ei);const ps=ai([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var en={exports:{}},xn={exports:{}};xn.exports=function(i,e){var r,n,o,p,d,m,y,v;for(n=i.length-(r=3&i.length),o=e,d=3432918353,m=461845907,v=0;v<n;)y=255&i.charCodeAt(v)|(255&i.charCodeAt(++v))<<8|(255&i.charCodeAt(++v))<<16|(255&i.charCodeAt(++v))<<24,++v,o=27492+(65535&(p=5*(65535&(o=(o^=y=(65535&(y=(y=(65535&y)*d+(((y>>>16)*d&65535)<<16)&4294967295)<<15|y>>>17))*m+(((y>>>16)*m&65535)<<16)&4294967295)<<13|o>>>19))+((5*(o>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(y=0,r){case 3:y^=(255&i.charCodeAt(v+2))<<16;case 2:y^=(255&i.charCodeAt(v+1))<<8;case 1:o^=y=(65535&(y=(y=(65535&(y^=255&i.charCodeAt(v)))*d+(((y>>>16)*d&65535)<<16)&4294967295)<<15|y>>>17))*m+(((y>>>16)*m&65535)<<16)&4294967295}return o^=i.length,o=2246822507*(65535&(o^=o>>>16))+((2246822507*(o>>>16)&65535)<<16)&4294967295,o=3266489909*(65535&(o^=o>>>13))+((3266489909*(o>>>16)&65535)<<16)&4294967295,(o^=o>>>16)>>>0};var Jn=xn.exports,Wi={exports:{}};Wi.exports=function(i,e){for(var r,n=i.length,o=e^n,p=0;n>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(p)|(255&i.charCodeAt(++p))<<8|(255&i.charCodeAt(++p))<<16|(255&i.charCodeAt(++p))<<24))+((1540483477*(r>>>16)&65535)<<16),o=1540483477*(65535&o)+((1540483477*(o>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),n-=4,++p;switch(n){case 3:o^=(255&i.charCodeAt(p+2))<<16;case 2:o^=(255&i.charCodeAt(p+1))<<8;case 1:o=1540483477*(65535&(o^=255&i.charCodeAt(p)))+((1540483477*(o>>>16)&65535)<<16)}return o=1540483477*(65535&(o^=o>>>13))+((1540483477*(o>>>16)&65535)<<16),(o^=o>>>15)>>>0};var ji=Jn,rr=Wi.exports;en.exports=ji,en.exports.murmur3=ji,en.exports.murmur2=rr;var vn=ee(en.exports);class di{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,n,o){this.ids.push(ki(e)),this.positions.push(r,n,o)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=ki(e);let n=0,o=this.ids.length-1;for(;n<o;){const d=n+o>>1;this.ids[d]>=r?o=d:n=d+1}const p=[];for(;this.ids[n]===r;)p.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return p}static serialize(e,r){const n=new Float64Array(e.ids),o=new Uint32Array(e.positions);return _r(n,o,0,n.length-1),r&&r.push(n.buffer,o.buffer),{ids:n,positions:o}}static deserialize(e){const r=new di;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function ki(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:vn(String(i))}function _r(i,e,r,n){for(;r<n;){const o=i[r+n>>1];let p=r-1,d=n+1;for(;;){do p++;while(i[p]<o);do d--;while(i[d]>o);if(p>=d)break;fi(i,p,d),fi(e,3*p,3*d),fi(e,3*p+1,3*d+1),fi(e,3*p+2,3*d+2)}d-r<n-d?(_r(i,e,r,d),r=d+1):(_r(i,e,d+1,n),n=d)}}function fi(i,e,r){const n=i[e];i[e]=i[r],i[r]=n}Ue("FeaturePositionMap",di);class bn{constructor(e,r){this.gl=e.gl,this.location=r}}class no extends bn{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Pl extends bn{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Ll extends bn{constructor(e,r){super(e,r),this.current=zt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Au=new Float32Array(16);function Vo(i){return[hs(255*i.r,255*i.g),hs(255*i.b,255*i.a)]}class ds{constructor(e,r,n){this.value=e,this.uniformNames=r.map(o=>`u_${o}`),this.type=n}setUniform(e,r,n){e.set(n.constantOr(this.value))}getBinding(e,r,n){return this.type==="color"?new Ll(e,r):new no(e,r)}}class wn{constructor(e,r){this.uniformNames=r.map(n=>`u_${n}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setUniform(e,r,n,o){const p=o==="u_pattern_to"?this.patternTo:o==="u_pattern_from"?this.patternFrom:o==="u_pixel_ratio_to"?this.pixelRatioTo:o==="u_pixel_ratio_from"?this.pixelRatioFrom:null;p&&e.set(p)}getBinding(e,r,n){return n.substr(0,9)==="u_pattern"?new Pl(e,r):new no(e,r)}}class fs{constructor(e,r,n,o){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=r.map(p=>({name:`a_${p}`,type:"Float32",components:n==="color"?2:1,offset:0})),this.paintVertexArray=new o}populatePaintArray(e,r,n,o,p){const d=this.paintVertexArray.length,m=this.expression.evaluate(new Qt(0),r,{},o,[],p);this.paintVertexArray.resize(e),this._setPaintValue(d,e,m)}updatePaintArray(e,r,n,o){const p=this.expression.evaluate({zoom:0},n,o);this._setPaintValue(e,r,p)}_setPaintValue(e,r,n){if(this.type==="color"){const o=Vo(n);for(let p=e;p<r;p++)this.paintVertexArray.emplace(p,o[0],o[1])}else{for(let o=e;o<r;o++)this.paintVertexArray.emplace(o,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Nr{constructor(e,r,n,o,p,d){this.expression=e,this.uniformNames=r.map(m=>`u_${m}_t`),this.type=n,this.useIntegerZoom=o,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=r.map(m=>({name:`a_${m}`,type:"Float32",components:n==="color"?4:2,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,r,n,o,p){const d=this.expression.evaluate(new Qt(this.zoom),r,{},o,[],p),m=this.expression.evaluate(new Qt(this.zoom+1),r,{},o,[],p),y=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(y,e,d,m)}updatePaintArray(e,r,n,o){const p=this.expression.evaluate({zoom:this.zoom},n,o),d=this.expression.evaluate({zoom:this.zoom+1},n,o);this._setPaintValue(e,r,p,d)}_setPaintValue(e,r,n,o){if(this.type==="color"){const p=Vo(n),d=Vo(o);for(let m=e;m<r;m++)this.paintVertexArray.emplace(m,p[0],p[1],d[0],d[1])}else{for(let p=e;p<r;p++)this.paintVertexArray.emplace(p,n,o);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const n=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,o=oi(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);e.set(o)}getBinding(e,r,n){return new no(e,r)}}class ms{constructor(e,r,n,o,p,d){this.expression=e,this.type=r,this.useIntegerZoom=n,this.zoom=o,this.layerId=d,this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(e,r,n){const o=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(o,e,r.patterns&&r.patterns[this.layerId],n)}updatePaintArray(e,r,n,o,p){this._setPaintValues(e,r,n.patterns&&n.patterns[this.layerId],p)}_setPaintValues(e,r,n,o){if(!o||!n)return;const{min:p,mid:d,max:m}=n,y=o[p],v=o[d],E=o[m];if(y&&v&&E)for(let k=e;k<r;k++)this.zoomInPaintVertexArray.emplace(k,v.tl[0],v.tl[1],v.br[0],v.br[1],y.tl[0],y.tl[1],y.br[0],y.br[1],v.pixelRatio,y.pixelRatio),this.zoomOutPaintVertexArray.emplace(k,v.tl[0],v.tl[1],v.br[0],v.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],v.pixelRatio,E.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,ps.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,ps.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Uo{constructor(e,r,n){this.binders={},this._buffers=[];const o=[];for(const p in e.paint._values){if(!n(p))continue;const d=e.paint.get(p);if(!(d instanceof ir&&Is(d.property.specification)))continue;const m=Mp(p,e.type),y=d.value,v=d.property.specification.type,E=d.property.useIntegerZoom,k=d.property.specification["property-type"],F=k==="cross-faded"||k==="cross-faded-data-driven";if(y.kind==="constant")this.binders[p]=F?new wn(y.value,m):new ds(y.value,m,v),o.push(`/u_${p}`);else if(y.kind==="source"||F){const P=Ic(p,v,"source");this.binders[p]=F?new ms(y,v,E,r,P,e.id):new fs(y,m,v,P),o.push(`/a_${p}`)}else{const P=Ic(p,v,"composite");this.binders[p]=new Nr(y,m,v,E,r,P),o.push(`/z_${p}`)}}this.cacheKey=o.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof fs||r instanceof Nr?r.maxValue:0}populatePaintArrays(e,r,n,o,p){for(const d in this.binders){const m=this.binders[d];(m instanceof fs||m instanceof Nr||m instanceof ms)&&m.populatePaintArray(e,r,n,o,p)}}setConstantPatternPositions(e,r){for(const n in this.binders){const o=this.binders[n];o instanceof wn&&o.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,n,o,p){let d=!1;for(const m in e){const y=r.getPositions(m);for(const v of y){const E=n.feature(v.index);for(const k in this.binders){const F=this.binders[k];if((F instanceof fs||F instanceof Nr||F instanceof ms)&&F.expression.isStateDependent===!0){const P=o.paint.get(k);F.expression=P.value,F.updatePaintArray(v.start,v.end,E,e[m],p),d=!0}}}}return d}defines(){const e=[];for(const r in this.binders){const n=this.binders[r];(n instanceof ds||n instanceof wn)&&e.push(...n.uniformNames.map(o=>`#define HAS_UNIFORM_${o}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof fs||n instanceof Nr)for(let o=0;o<n.paintVertexAttributes.length;o++)e.push(n.paintVertexAttributes[o].name);else if(n instanceof ms)for(let o=0;o<ps.members.length;o++)e.push(ps.members[o].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof ds||n instanceof wn||n instanceof Nr)for(const o of n.uniformNames)e.push(o)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const n=[];for(const o in this.binders){const p=this.binders[o];if(p instanceof ds||p instanceof wn||p instanceof Nr){for(const d of p.uniformNames)if(r[d]){const m=p.getBinding(e,r[d],d);n.push({name:d,property:o,binding:m})}}}return n}setUniforms(e,r,n,o){for(const{name:p,property:d,binding:m}of r)this.binders[d].setUniform(m,o,n.get(d),p)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const n=this.binders[r];if(e&&n instanceof ms){const o=e.fromScale===2?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;o&&this._buffers.push(o)}else(n instanceof fs||n instanceof Nr)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const r in this.binders){const n=this.binders[r];(n instanceof fs||n instanceof Nr||n instanceof ms)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof fs||r instanceof Nr||r instanceof ms)&&r.destroy()}}}class Ls{constructor(e,r,n=()=>!0){this.programConfigurations={};for(const o of e)this.programConfigurations[o.id]=new Uo(o,r,n);this.needsUpload=!1,this._featureMap=new di,this._bufferOffset=0}populatePaintArrays(e,r,n,o,p,d){for(const m in this.programConfigurations)this.programConfigurations[m].populatePaintArrays(e,r,o,p,d);r.id!==void 0&&this._featureMap.add(r.id,n,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,n,o){for(const p of n)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(e,this._featureMap,r,p,o)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Mp(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function Ic(i,e,r){const n={color:{source:Yn,composite:U},number:{source:x,composite:Yn}},o=function(p){return{"line-pattern":{source:Ot,composite:Ot},"fill-pattern":{source:Ot,composite:Ot},"fill-extrusion-pattern":{source:Ot,composite:Ot}}[p]}(i);return o&&o[r]||n[e][r]}Ue("ConstantBinder",ds),Ue("CrossFadedConstantBinder",wn),Ue("SourceExpressionBinder",fs),Ue("CrossFadedCompositeBinder",ms),Ue("CompositeExpressionBinder",Nr),Ue("ProgramConfiguration",Uo,{omit:["_buffers"]}),Ue("ProgramConfigurationSet",Ls);const bi=8192,Eu=Math.pow(2,14)-1,Fc=-Eu-1;function Fa(i){const e=bi/i.extent,r=i.loadGeometry();for(let n=0;n<r.length;n++){const o=r[n];for(let p=0;p<o.length;p++){const d=o[p],m=Math.round(d.x*e),y=Math.round(d.y*e);d.x=oi(m,Fc,Eu),d.y=oi(y,Fc,Eu),(m<d.x||m>d.x+1||y<d.y||y>d.y+1)&&Ai("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Ba(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Fa(i):[]}}function Rl(i,e,r,n,o){i.emplaceBack(2*e+(n+1)/2,2*r+(o+1)/2)}class Cu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Ge,this.indexArray=new qi,this.segments=new ei,this.programConfigurations=new Ls(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,n){const o=this.layers[0],p=[];let d=null,m=!1;o.type==="circle"&&(d=o.layout.get("circle-sort-key"),m=!d.isConstant());for(const{feature:y,id:v,index:E,sourceLayerIndex:k}of e){const F=this.layers[0]._featureFilter.needGeometry,P=Ba(y,F);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),P,n))continue;const L=m?d.evaluate(P,{},n):void 0,N={id:v,properties:y.properties,type:y.type,sourceLayerIndex:k,index:E,geometry:F?P.geometry:Fa(y),patterns:{},sortKey:L};p.push(N)}m&&p.sort((y,v)=>y.sortKey-v.sortKey);for(const y of p){const{geometry:v,index:E,sourceLayerIndex:k}=y,F=e[E].feature;this.addFeature(y,v,E,n),r.featureIndex.insert(F,v,E,k,this.index)}}update(e,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,n)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Dr),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,n,o){for(const p of r)for(const d of p){const m=d.x,y=d.y;if(m<0||m>=bi||y<0||y>=bi)continue;const v=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),E=v.vertexLength;Rl(this.layoutVertexArray,m,y,-1,-1),Rl(this.layoutVertexArray,m,y,1,-1),Rl(this.layoutVertexArray,m,y,1,1),Rl(this.layoutVertexArray,m,y,-1,1),this.indexArray.emplaceBack(E,E+1,E+2),this.indexArray.emplaceBack(E,E+3,E+2),v.vertexLength+=4,v.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},o)}}function Bc(i,e){for(let r=0;r<i.length;r++)if(ao(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(ao(i,e[r]))return!0;return!!Su(i,e)}function Pp(i,e,r){return!!ao(i,e)||!!ku(e,i,r)}function zc(i,e){if(i.length===1)return Pc(e,i[0]);for(let r=0;r<e.length;r++){const n=e[r];for(let o=0;o<n.length;o++)if(ao(i,n[o]))return!0}for(let r=0;r<i.length;r++)if(Pc(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Su(i,e[r]))return!0;return!1}function Lp(i,e,r){if(i.length>1){if(Su(i,e))return!0;for(let n=0;n<e.length;n++)if(ku(e[n],i,r))return!0}for(let n=0;n<i.length;n++)if(ku(i[n],e,r))return!0;return!1}function Su(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const n=i[r],o=i[r+1];for(let p=0;p<e.length-1;p++)if(Rp(n,o,e[p],e[p+1]))return!0}return!1}function Rp(i,e,r,n){return Pi(i,r,n)!==Pi(e,r,n)&&Pi(i,e,r)!==Pi(i,e,n)}function ku(i,e,r){const n=r*r;if(e.length===1)return i.distSqr(e[0])<n;for(let o=1;o<e.length;o++)if(Mc(i,e[o-1],e[o])<n)return!0;return!1}function Mc(i,e,r){const n=e.distSqr(r);if(n===0)return i.distSqr(e);const o=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/n;return i.distSqr(o<0?e:o>1?r:r.sub(e)._mult(o)._add(e))}function Pc(i,e){let r,n,o,p=!1;for(let d=0;d<i.length;d++){r=i[d];for(let m=0,y=r.length-1;m<r.length;y=m++)n=r[m],o=r[y],n.y>e.y!=o.y>e.y&&e.x<(o.x-n.x)*(e.y-n.y)/(o.y-n.y)+n.x&&(p=!p)}return p}function ao(i,e){let r=!1;for(let n=0,o=i.length-1;n<i.length;o=n++){const p=i[n],d=i[o];p.y>e.y!=d.y>e.y&&e.x<(d.x-p.x)*(e.y-p.y)/(d.y-p.y)+p.x&&(r=!r)}return r}function Op(i,e,r){const n=r[0],o=r[2];if(i.x<n.x&&e.x<n.x||i.x>o.x&&e.x>o.x||i.y<n.y&&e.y<n.y||i.y>o.y&&e.y>o.y)return!1;const p=Pi(i,e,r[0]);return p!==Pi(i,e,r[1])||p!==Pi(i,e,r[2])||p!==Pi(i,e,r[3])}function qo(i,e,r){const n=e.paint.get(i).value;return n.kind==="constant"?n.value:r.programConfigurations.get(e.id).getMaxValue(i)}function Ol(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function $l(i,e,r,n,o){if(!e[0]&&!e[1])return i;const p=Ee.convert(e)._mult(o);r==="viewport"&&p._rotate(-n);const d=[];for(let m=0;m<i.length;m++)d.push(i[m].sub(p));return d}let Lc,Rc;Ue("CircleBucket",Cu,{omit:["layers"]});var $p={get paint(){return Rc=Rc||new _i({"circle-radius":new it(ye.paint_circle["circle-radius"]),"circle-color":new it(ye.paint_circle["circle-color"]),"circle-blur":new it(ye.paint_circle["circle-blur"]),"circle-opacity":new it(ye.paint_circle["circle-opacity"]),"circle-translate":new Je(ye.paint_circle["circle-translate"]),"circle-translate-anchor":new Je(ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Je(ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Je(ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new it(ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new it(ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new it(ye.paint_circle["circle-stroke-opacity"])})},get layout(){return Lc=Lc||new _i({"circle-sort-key":new it(ye.layout_circle["circle-sort-key"])})}},yr=1e-6,oo=typeof Float32Array<"u"?Float32Array:Array;function Tu(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Oc(i,e,r){var n=e[0],o=e[1],p=e[2],d=e[3],m=e[4],y=e[5],v=e[6],E=e[7],k=e[8],F=e[9],P=e[10],L=e[11],N=e[12],W=e[13],J=e[14],oe=e[15],te=r[0],ue=r[1],pe=r[2],Ae=r[3];return i[0]=te*n+ue*m+pe*k+Ae*N,i[1]=te*o+ue*y+pe*F+Ae*W,i[2]=te*p+ue*v+pe*P+Ae*J,i[3]=te*d+ue*E+pe*L+Ae*oe,i[4]=(te=r[4])*n+(ue=r[5])*m+(pe=r[6])*k+(Ae=r[7])*N,i[5]=te*o+ue*y+pe*F+Ae*W,i[6]=te*p+ue*v+pe*P+Ae*J,i[7]=te*d+ue*E+pe*L+Ae*oe,i[8]=(te=r[8])*n+(ue=r[9])*m+(pe=r[10])*k+(Ae=r[11])*N,i[9]=te*o+ue*y+pe*F+Ae*W,i[10]=te*p+ue*v+pe*P+Ae*J,i[11]=te*d+ue*E+pe*L+Ae*oe,i[12]=(te=r[12])*n+(ue=r[13])*m+(pe=r[14])*k+(Ae=r[15])*N,i[13]=te*o+ue*y+pe*F+Ae*W,i[14]=te*p+ue*v+pe*P+Ae*J,i[15]=te*d+ue*E+pe*L+Ae*oe,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var jo,Np=Oc;function Nl(i,e,r){var n=e[0],o=e[1],p=e[2],d=e[3];return i[0]=r[0]*n+r[4]*o+r[8]*p+r[12]*d,i[1]=r[1]*n+r[5]*o+r[9]*p+r[13]*d,i[2]=r[2]*n+r[6]*o+r[10]*p+r[14]*d,i[3]=r[3]*n+r[7]*o+r[11]*p+r[15]*d,i}jo=new oo(4),oo!=Float32Array&&(jo[0]=0,jo[1]=0,jo[2]=0,jo[3]=0);class Vp extends $r{constructor(e){super(e,$p)}createBucket(e){return new Cu(e)}queryRadius(e){const r=e;return qo("circle-radius",this,r)+qo("circle-stroke-width",this,r)+Ol(this.paint.get("circle-translate"))}queryIntersectsFeature(e,r,n,o,p,d,m,y){const v=$l(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,m),E=this.paint.get("circle-radius").evaluate(r,n)+this.paint.get("circle-stroke-width").evaluate(r,n),k=this.paint.get("circle-pitch-alignment")==="map",F=k?v:function(L,N){return L.map(W=>$c(W,N))}(v,y),P=k?E*m:E;for(const L of o)for(const N of L){const W=k?N:$c(N,y);let J=P;const oe=Nl([],[N.x,N.y,0,1],y);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?J*=oe[3]/d.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(J*=d.cameraToCenterDistance/oe[3]),Pp(F,W,J))return!0}return!1}}function $c(i,e){const r=Nl([],[i.x,i.y,0,1],e);return new Ee(r[0]/r[3],r[1]/r[3])}class Nc extends Cu{}let Vc;Ue("HeatmapBucket",Nc,{omit:["layers"]});var Up={get paint(){return Vc=Vc||new _i({"heatmap-radius":new it(ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new it(ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Je(ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Po(ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Je(ye.paint_heatmap["heatmap-opacity"])})}};function Du(i,{width:e,height:r},n,o){if(o){if(o instanceof Uint8ClampedArray)o=new Uint8Array(o.buffer);else if(o.length!==e*r*n)throw new RangeError(`mismatched image size. expected: ${o.length} but got: ${e*r*n}`)}else o=new Uint8Array(e*r*n);return i.width=e,i.height=r,i.data=o,i}function Uc(i,{width:e,height:r},n){if(e===i.width&&r===i.height)return;const o=Du({},{width:e,height:r},n);Iu(i,o,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},n),i.width=e,i.height=r,i.data=o.data}function Iu(i,e,r,n,o,p){if(o.width===0||o.height===0)return e;if(o.width>i.width||o.height>i.height||r.x>i.width-o.width||r.y>i.height-o.height)throw new RangeError("out of range source coordinates for image copy");if(o.width>e.width||o.height>e.height||n.x>e.width-o.width||n.y>e.height-o.height)throw new RangeError("out of range destination coordinates for image copy");const d=i.data,m=e.data;if(d===m)throw new Error("srcData equals dstData, so image is already copied");for(let y=0;y<o.height;y++){const v=((r.y+y)*i.width+r.x)*p,E=((n.y+y)*e.width+n.x)*p;for(let k=0;k<o.width*p;k++)m[E+k]=d[v+k]}return e}class Zo{constructor(e,r){Du(this,e,1,r)}resize(e){Uc(this,e,1)}clone(){return new Zo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,n,o,p){Iu(e,r,n,o,p,1)}}class Kr{constructor(e,r){Du(this,e,4,r)}resize(e){Uc(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Kr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,n,o,p){Iu(e,r,n,o,p,4)}}function qc(i){const e={},r=i.resolution||256,n=i.clips?i.clips.length:1,o=i.image||new Kr({width:r,height:n});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const p=(d,m,y)=>{e[i.evaluationKey]=y;const v=i.expression.evaluate(e);o.data[d+m+0]=Math.floor(255*v.r/v.a),o.data[d+m+1]=Math.floor(255*v.g/v.a),o.data[d+m+2]=Math.floor(255*v.b/v.a),o.data[d+m+3]=Math.floor(255*v.a)};if(i.clips)for(let d=0,m=0;d<n;++d,m+=4*r)for(let y=0,v=0;y<r;y++,v+=4){const E=y/(r-1),{start:k,end:F}=i.clips[d];p(m,v,k*(1-E)+F*E)}else for(let d=0,m=0;d<r;d++,m+=4)p(0,m,d/(r-1));return o}Ue("AlphaImage",Zo),Ue("RGBAImage",Kr);class qp extends $r{createBucket(e){return new Nc(e)}constructor(e){super(e,Up),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=qc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let jc;var jp={get paint(){return jc=jc||new _i({"hillshade-illumination-direction":new Je(ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Je(ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Je(ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Je(ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Je(ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Je(ye.paint_hillshade["hillshade-accent-color"])})}};class Zp extends $r{constructor(e){super(e,jp)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Gp=ai([{name:"a_pos",components:2,type:"Int16"}],4),{members:Hp}=Gp;var Fu={exports:{}};function Vl(i,e,r){r=r||2;var n,o,p,d,m,y,v,E=e&&e.length,k=E?e[0]*r:i.length,F=Zc(i,0,k,r,!0),P=[];if(!F||F.next===F.prev)return P;if(E&&(F=function(N,W,J,oe){var te,ue,pe,Ae=[];for(te=0,ue=W.length;te<ue;te++)(pe=Zc(N,W[te]*oe,te<ue-1?W[te+1]*oe:N.length,oe,!1))===pe.next&&(pe.steiner=!0),Ae.push(td(pe));for(Ae.sort(Jp),te=0;te<Ae.length;te++)J=Qp(Ae[te],J);return J}(i,e,F,r)),i.length>80*r){n=p=i[0],o=d=i[1];for(var L=r;L<k;L+=r)(m=i[L])<n&&(n=m),(y=i[L+1])<o&&(o=y),m>p&&(p=m),y>d&&(d=y);v=(v=Math.max(p-n,d-o))!==0?32767/v:0}return Go(F,P,r,n,o,v,0),P}function Zc(i,e,r,n,o){var p,d;if(o===Mu(i,e,r,n)>0)for(p=e;p<r;p+=n)d=Wc(p,i[p],i[p+1],d);else for(p=r-n;p>=e;p-=n)d=Wc(p,i[p],i[p+1],d);return d&&Ul(d,d.next)&&(Wo(d),d=d.next),d}function za(i,e){if(!i)return i;e||(e=i);var r,n=i;do if(r=!1,n.steiner||!Ul(n,n.next)&&xi(n.prev,n,n.next)!==0)n=n.next;else{if(Wo(n),(n=e=n.prev)===n.next)break;r=!0}while(r||n!==e);return e}function Go(i,e,r,n,o,p,d){if(i){!d&&p&&function(E,k,F,P){var L=E;do L.z===0&&(L.z=Bu(L.x,L.y,k,F,P)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==E);L.prevZ.nextZ=null,L.prevZ=null,function(N){var W,J,oe,te,ue,pe,Ae,Ne,He=1;do{for(J=N,N=null,ue=null,pe=0;J;){for(pe++,oe=J,Ae=0,W=0;W<He&&(Ae++,oe=oe.nextZ);W++);for(Ne=He;Ae>0||Ne>0&&oe;)Ae!==0&&(Ne===0||!oe||J.z<=oe.z)?(te=J,J=J.nextZ,Ae--):(te=oe,oe=oe.nextZ,Ne--),ue?ue.nextZ=te:N=te,te.prevZ=ue,ue=te;J=oe}ue.nextZ=null,He*=2}while(pe>1)}(L)}(i,n,o,p);for(var m,y,v=i;i.prev!==i.next;)if(m=i.prev,y=i.next,p?Xp(i,n,o,p):Wp(i))e.push(m.i/r|0),e.push(i.i/r|0),e.push(y.i/r|0),Wo(i),i=y.next,v=y.next;else if((i=y)===v){d?d===1?Go(i=Kp(za(i),e,r),e,r,n,o,p,2):d===2&&Yp(i,e,r,n,o,p):Go(za(i),e,r,n,o,p,1);break}}}function Wp(i){var e=i.prev,r=i,n=i.next;if(xi(e,r,n)>=0)return!1;for(var o=e.x,p=r.x,d=n.x,m=e.y,y=r.y,v=n.y,E=o<p?o<d?o:d:p<d?p:d,k=m<y?m<v?m:v:y<v?y:v,F=o>p?o>d?o:d:p>d?p:d,P=m>y?m>v?m:v:y>v?y:v,L=n.next;L!==e;){if(L.x>=E&&L.x<=F&&L.y>=k&&L.y<=P&&lo(o,m,p,y,d,v,L.x,L.y)&&xi(L.prev,L,L.next)>=0)return!1;L=L.next}return!0}function Xp(i,e,r,n){var o=i.prev,p=i,d=i.next;if(xi(o,p,d)>=0)return!1;for(var m=o.x,y=p.x,v=d.x,E=o.y,k=p.y,F=d.y,P=m<y?m<v?m:v:y<v?y:v,L=E<k?E<F?E:F:k<F?k:F,N=m>y?m>v?m:v:y>v?y:v,W=E>k?E>F?E:F:k>F?k:F,J=Bu(P,L,e,r,n),oe=Bu(N,W,e,r,n),te=i.prevZ,ue=i.nextZ;te&&te.z>=J&&ue&&ue.z<=oe;){if(te.x>=P&&te.x<=N&&te.y>=L&&te.y<=W&&te!==o&&te!==d&&lo(m,E,y,k,v,F,te.x,te.y)&&xi(te.prev,te,te.next)>=0||(te=te.prevZ,ue.x>=P&&ue.x<=N&&ue.y>=L&&ue.y<=W&&ue!==o&&ue!==d&&lo(m,E,y,k,v,F,ue.x,ue.y)&&xi(ue.prev,ue,ue.next)>=0))return!1;ue=ue.nextZ}for(;te&&te.z>=J;){if(te.x>=P&&te.x<=N&&te.y>=L&&te.y<=W&&te!==o&&te!==d&&lo(m,E,y,k,v,F,te.x,te.y)&&xi(te.prev,te,te.next)>=0)return!1;te=te.prevZ}for(;ue&&ue.z<=oe;){if(ue.x>=P&&ue.x<=N&&ue.y>=L&&ue.y<=W&&ue!==o&&ue!==d&&lo(m,E,y,k,v,F,ue.x,ue.y)&&xi(ue.prev,ue,ue.next)>=0)return!1;ue=ue.nextZ}return!0}function Kp(i,e,r){var n=i;do{var o=n.prev,p=n.next.next;!Ul(o,p)&&Gc(o,n,n.next,p)&&Ho(o,p)&&Ho(p,o)&&(e.push(o.i/r|0),e.push(n.i/r|0),e.push(p.i/r|0),Wo(n),Wo(n.next),n=i=p),n=n.next}while(n!==i);return za(n)}function Yp(i,e,r,n,o,p){var d=i;do{for(var m=d.next.next;m!==d.prev;){if(d.i!==m.i&&id(d,m)){var y=Hc(d,m);return d=za(d,d.next),y=za(y,y.next),Go(d,e,r,n,o,p,0),void Go(y,e,r,n,o,p,0)}m=m.next}d=d.next}while(d!==i)}function Jp(i,e){return i.x-e.x}function Qp(i,e){var r=function(o,p){var d,m=p,y=o.x,v=o.y,E=-1/0;do{if(v<=m.y&&v>=m.next.y&&m.next.y!==m.y){var k=m.x+(v-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(k<=y&&k>E&&(E=k,d=m.x<m.next.x?m:m.next,k===y))return d}m=m.next}while(m!==p);if(!d)return null;var F,P=d,L=d.x,N=d.y,W=1/0;m=d;do y>=m.x&&m.x>=L&&y!==m.x&&lo(v<N?y:E,v,L,N,v<N?E:y,v,m.x,m.y)&&(F=Math.abs(v-m.y)/(y-m.x),Ho(m,o)&&(F<W||F===W&&(m.x>d.x||m.x===d.x&&ed(d,m)))&&(d=m,W=F)),m=m.next;while(m!==P);return d}(i,e);if(!r)return e;var n=Hc(r,i);return za(n,n.next),za(r,r.next)}function ed(i,e){return xi(i.prev,i,e.prev)<0&&xi(e.next,i,i.next)<0}function Bu(i,e,r,n,o){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*o|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function td(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function lo(i,e,r,n,o,p,d,m){return(o-d)*(e-m)>=(i-d)*(p-m)&&(i-d)*(n-m)>=(r-d)*(e-m)&&(r-d)*(p-m)>=(o-d)*(n-m)}function id(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,n){var o=r;do{if(o.i!==r.i&&o.next.i!==r.i&&o.i!==n.i&&o.next.i!==n.i&&Gc(o,o.next,r,n))return!0;o=o.next}while(o!==r);return!1}(i,e)&&(Ho(i,e)&&Ho(e,i)&&function(r,n){var o=r,p=!1,d=(r.x+n.x)/2,m=(r.y+n.y)/2;do o.y>m!=o.next.y>m&&o.next.y!==o.y&&d<(o.next.x-o.x)*(m-o.y)/(o.next.y-o.y)+o.x&&(p=!p),o=o.next;while(o!==r);return p}(i,e)&&(xi(i.prev,i,e.prev)||xi(i,e.prev,e))||Ul(i,e)&&xi(i.prev,i,i.next)>0&&xi(e.prev,e,e.next)>0)}function xi(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function Ul(i,e){return i.x===e.x&&i.y===e.y}function Gc(i,e,r,n){var o=jl(xi(i,e,r)),p=jl(xi(i,e,n)),d=jl(xi(r,n,i)),m=jl(xi(r,n,e));return o!==p&&d!==m||!(o!==0||!ql(i,r,e))||!(p!==0||!ql(i,n,e))||!(d!==0||!ql(r,i,n))||!(m!==0||!ql(r,e,n))}function ql(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function jl(i){return i>0?1:i<0?-1:0}function Ho(i,e){return xi(i.prev,i,i.next)<0?xi(i,e,i.next)>=0&&xi(i,i.prev,e)>=0:xi(i,e,i.prev)<0||xi(i,i.next,e)<0}function Hc(i,e){var r=new zu(i.i,i.x,i.y),n=new zu(e.i,e.x,e.y),o=i.next,p=e.prev;return i.next=e,e.prev=i,r.next=o,o.prev=r,n.next=r,r.prev=n,p.next=n,n.prev=p,n}function Wc(i,e,r,n){var o=new zu(i,e,r);return n?(o.next=n.next,o.prev=n,n.next.prev=o,n.next=o):(o.prev=o,o.next=o),o}function Wo(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function zu(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Mu(i,e,r,n){for(var o=0,p=e,d=r-n;p<r;p+=n)o+=(i[d]-i[p])*(i[p+1]+i[d+1]),d=p;return o}Fu.exports=Vl,Fu.exports.default=Vl,Vl.deviation=function(i,e,r,n){var o=e&&e.length,p=Math.abs(Mu(i,0,o?e[0]*r:i.length,r));if(o)for(var d=0,m=e.length;d<m;d++)p-=Math.abs(Mu(i,e[d]*r,d<m-1?e[d+1]*r:i.length,r));var y=0;for(d=0;d<n.length;d+=3){var v=n[d]*r,E=n[d+1]*r,k=n[d+2]*r;y+=Math.abs((i[v]-i[k])*(i[E+1]-i[v+1])-(i[v]-i[E])*(i[k+1]-i[v+1]))}return p===0&&y===0?0:Math.abs((y-p)/p)},Vl.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,o=0;o<i.length;o++){for(var p=0;p<i[o].length;p++)for(var d=0;d<e;d++)r.vertices.push(i[o][p][d]);o>0&&r.holes.push(n+=i[o-1].length)}return r};var Xc=ee(Fu.exports);function rd(i,e,r,n,o){Kc(i,e,r,n||i.length-1,o||sd)}function Kc(i,e,r,n,o){for(;n>r;){if(n-r>600){var p=n-r+1,d=e-r+1,m=Math.log(p),y=.5*Math.exp(2*m/3),v=.5*Math.sqrt(m*y*(p-y)/p)*(d-p/2<0?-1:1);Kc(i,e,Math.max(r,Math.floor(e-d*y/p+v)),Math.min(n,Math.floor(e+(p-d)*y/p+v)),o)}var E=i[e],k=r,F=n;for(Xo(i,r,e),o(i[n],E)>0&&Xo(i,r,n);k<F;){for(Xo(i,k,F),k++,F--;o(i[k],E)<0;)k++;for(;o(i[F],E)>0;)F--}o(i[r],E)===0?Xo(i,r,F):Xo(i,++F,n),F<=e&&(r=F+1),e<=F&&(n=F-1)}}function Xo(i,e,r){var n=i[e];i[e]=i[r],i[r]=n}function sd(i,e){return i<e?-1:i>e?1:0}function Pu(i,e){const r=i.length;if(r<=1)return[i];const n=[];let o,p;for(let d=0;d<r;d++){const m=Gi(i[d]);m!==0&&(i[d].area=Math.abs(m),p===void 0&&(p=m<0),p===m<0?(o&&n.push(o),o=[i[d]]):o.push(i[d]))}if(o&&n.push(o),e>1)for(let d=0;d<n.length;d++)n[d].length<=e||(rd(n[d],e,1,n[d].length-1,nd),n[d]=n[d].slice(0,e));return n}function nd(i,e){return e.area-i.area}function Lu(i,e,r){const n=r.patternDependencies;let o=!1;for(const p of e){const d=p.paint.get(`${i}-pattern`);d.isConstant()||(o=!0);const m=d.constantOr(null);m&&(o=!0,n[m.to]=!0,n[m.from]=!0)}return o}function Ru(i,e,r,n,o){const p=o.patternDependencies;for(const d of e){const m=d.paint.get(`${i}-pattern`).value;if(m.kind!=="constant"){let y=m.evaluate({zoom:n-1},r,{},o.availableImages),v=m.evaluate({zoom:n},r,{},o.availableImages),E=m.evaluate({zoom:n+1},r,{},o.availableImages);y=y&&y.name?y.name:y,v=v&&v.name?v.name:v,E=E&&E.name?E.name:E,p[y]=!0,p[v]=!0,p[E]=!0,r.patterns[d.id]={min:y,mid:v,max:E}}}return r}class Ou{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new yt,this.indexArray=new qi,this.indexArray2=new Si,this.programConfigurations=new Ls(e.layers,e.zoom),this.segments=new ei,this.segments2=new ei,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,n){this.hasPattern=Lu("fill",this.layers,r);const o=this.layers[0].layout.get("fill-sort-key"),p=!o.isConstant(),d=[];for(const{feature:m,id:y,index:v,sourceLayerIndex:E}of e){const k=this.layers[0]._featureFilter.needGeometry,F=Ba(m,k);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),F,n))continue;const P=p?o.evaluate(F,{},n,r.availableImages):void 0,L={id:y,properties:m.properties,type:m.type,sourceLayerIndex:E,index:v,geometry:k?F.geometry:Fa(m),patterns:{},sortKey:P};d.push(L)}p&&d.sort((m,y)=>m.sortKey-y.sortKey);for(const m of d){const{geometry:y,index:v,sourceLayerIndex:E}=m;if(this.hasPattern){const k=Ru("fill",this.layers,m,this.zoom,r);this.patternFeatures.push(k)}else this.addFeature(m,y,v,n,{});r.featureIndex.insert(e[v].feature,y,v,E,this.index)}}update(e,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,n)}addFeatures(e,r,n){for(const o of this.patternFeatures)this.addFeature(o,o.geometry,o.index,r,n)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Hp),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,n,o,p){for(const d of Pu(r,500)){let m=0;for(const P of d)m+=P.length;const y=this.segments.prepareSegment(m,this.layoutVertexArray,this.indexArray),v=y.vertexLength,E=[],k=[];for(const P of d){if(P.length===0)continue;P!==d[0]&&k.push(E.length/2);const L=this.segments2.prepareSegment(P.length,this.layoutVertexArray,this.indexArray2),N=L.vertexLength;this.layoutVertexArray.emplaceBack(P[0].x,P[0].y),this.indexArray2.emplaceBack(N+P.length-1,N),E.push(P[0].x),E.push(P[0].y);for(let W=1;W<P.length;W++)this.layoutVertexArray.emplaceBack(P[W].x,P[W].y),this.indexArray2.emplaceBack(N+W-1,N+W),E.push(P[W].x),E.push(P[W].y);L.vertexLength+=P.length,L.primitiveLength+=P.length}const F=Xc(E,k);for(let P=0;P<F.length;P+=3)this.indexArray.emplaceBack(v+F[P],v+F[P+1],v+F[P+2]);y.vertexLength+=m,y.primitiveLength+=F.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,p,o)}}let Yc,Jc;Ue("FillBucket",Ou,{omit:["layers","patternFeatures"]});var ad={get paint(){return Jc=Jc||new _i({"fill-antialias":new Je(ye.paint_fill["fill-antialias"]),"fill-opacity":new it(ye.paint_fill["fill-opacity"]),"fill-color":new it(ye.paint_fill["fill-color"]),"fill-outline-color":new it(ye.paint_fill["fill-outline-color"]),"fill-translate":new Je(ye.paint_fill["fill-translate"]),"fill-translate-anchor":new Je(ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ta(ye.paint_fill["fill-pattern"])})},get layout(){return Yc=Yc||new _i({"fill-sort-key":new it(ye.layout_fill["fill-sort-key"])})}};class od extends $r{constructor(e){super(e,ad)}recalculate(e,r){super.recalculate(e,r);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Ou(e)}queryRadius(){return Ol(this.paint.get("fill-translate"))}queryIntersectsFeature(e,r,n,o,p,d,m){return zc($l(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,m),o)}isTileClipped(){return!0}}const ld=ai([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),ud=ai([{name:"a_centroid",components:2,type:"Int16"}],4),{members:cd}=ld;var Qn={},hd=Te,Qc=uo;function uo(i,e,r,n,o){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=n,this._values=o,i.readFields(pd,this,e)}function pd(i,e,r){i==1?e.id=r.readVarint():i==2?function(n,o){for(var p=n.readVarint()+n.pos;n.pos<p;){var d=o._keys[n.readVarint()],m=o._values[n.readVarint()];o.properties[d]=m}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function dd(i){for(var e,r,n=0,o=0,p=i.length,d=p-1;o<p;d=o++)n+=((r=i[d]).x-(e=i[o]).x)*(e.y+r.y);return n}uo.types=["Unknown","Point","LineString","Polygon"],uo.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,n=1,o=0,p=0,d=0,m=[];i.pos<r;){if(o<=0){var y=i.readVarint();n=7&y,o=y>>3}if(o--,n===1||n===2)p+=i.readSVarint(),d+=i.readSVarint(),n===1&&(e&&m.push(e),e=[]),e.push(new hd(p,d));else{if(n!==7)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&m.push(e),m},uo.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,n=0,o=0,p=0,d=1/0,m=-1/0,y=1/0,v=-1/0;i.pos<e;){if(n<=0){var E=i.readVarint();r=7&E,n=E>>3}if(n--,r===1||r===2)(o+=i.readSVarint())<d&&(d=o),o>m&&(m=o),(p+=i.readSVarint())<y&&(y=p),p>v&&(v=p);else if(r!==7)throw new Error("unknown command "+r)}return[d,y,m,v]},uo.prototype.toGeoJSON=function(i,e,r){var n,o,p=this.extent*Math.pow(2,r),d=this.extent*i,m=this.extent*e,y=this.loadGeometry(),v=uo.types[this.type];function E(P){for(var L=0;L<P.length;L++){var N=P[L];P[L]=[360*(N.x+d)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(N.y+m)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var k=[];for(n=0;n<y.length;n++)k[n]=y[n][0];E(y=k);break;case 2:for(n=0;n<y.length;n++)E(y[n]);break;case 3:for(y=function(P){var L=P.length;if(L<=1)return[P];for(var N,W,J=[],oe=0;oe<L;oe++){var te=dd(P[oe]);te!==0&&(W===void 0&&(W=te<0),W===te<0?(N&&J.push(N),N=[P[oe]]):N.push(P[oe]))}return N&&J.push(N),J}(y),n=0;n<y.length;n++)for(o=0;o<y[n].length;o++)E(y[n][o])}y.length===1?y=y[0]:v="Multi"+v;var F={type:"Feature",geometry:{type:v,coordinates:y},properties:this.properties};return"id"in this&&(F.id=this.id),F};var fd=Qc,eh=th;function th(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(md,this,e),this.length=this._features.length}function md(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(n){for(var o=null,p=n.readVarint()+n.pos;n.pos<p;){var d=n.readVarint()>>3;o=d===1?n.readString():d===2?n.readFloat():d===3?n.readDouble():d===4?n.readVarint64():d===5?n.readVarint():d===6?n.readSVarint():d===7?n.readBoolean():null}return o}(r))}th.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new fd(this._pbf,e,this.extent,this._keys,this._values)};var gd=eh;function _d(i,e,r){if(i===3){var n=new gd(r,r.readVarint()+r.pos);n.length&&(e[n.name]=n)}}Qn.VectorTile=function(i,e){this.layers=i.readFields(_d,{},e)},Qn.VectorTileFeature=Qc,Qn.VectorTileLayer=eh;const yd=Qn.VectorTileFeature.types,$u=Math.pow(2,13);function Ko(i,e,r,n,o,p,d,m){i.emplaceBack(e,r,2*Math.floor(n*$u)+d,o*$u*2,p*$u*2,Math.round(m))}class Nu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Le,this.centroidVertexArray=new Fe,this.indexArray=new qi,this.programConfigurations=new Ls(e.layers,e.zoom),this.segments=new ei,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,n){this.features=[],this.hasPattern=Lu("fill-extrusion",this.layers,r);for(const{feature:o,id:p,index:d,sourceLayerIndex:m}of e){const y=this.layers[0]._featureFilter.needGeometry,v=Ba(o,y);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),v,n))continue;const E={id:p,sourceLayerIndex:m,index:d,geometry:y?v.geometry:Fa(o),properties:o.properties,type:o.type,patterns:{}};this.hasPattern?this.features.push(Ru("fill-extrusion",this.layers,E,this.zoom,r)):this.addFeature(E,E.geometry,d,n,{}),r.featureIndex.insert(o,E.geometry,d,m,this.index,!0)}}addFeatures(e,r,n){for(const o of this.features){const{geometry:p}=o;this.addFeature(o,p,o.index,r,n)}}update(e,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,n)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,cd),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,ud.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,n,o,p){const d={x:0,y:0,vertexCount:0};for(const m of Pu(r,500)){let y=0;for(const L of m)y+=L.length;let v=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const L of m){if(L.length===0||vd(L))continue;let N=0;for(let W=0;W<L.length;W++){const J=L[W];if(W>=1){const oe=L[W-1];if(!xd(J,oe)){v.vertexLength+4>ei.MAX_VERTEX_ARRAY_LENGTH&&(v=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const te=J.sub(oe)._perp()._unit(),ue=oe.dist(J);N+ue>32768&&(N=0),Ko(this.layoutVertexArray,J.x,J.y,te.x,te.y,0,0,N),Ko(this.layoutVertexArray,J.x,J.y,te.x,te.y,0,1,N),d.x+=2*J.x,d.y+=2*J.y,d.vertexCount+=2,N+=ue,Ko(this.layoutVertexArray,oe.x,oe.y,te.x,te.y,0,0,N),Ko(this.layoutVertexArray,oe.x,oe.y,te.x,te.y,0,1,N),d.x+=2*oe.x,d.y+=2*oe.y,d.vertexCount+=2;const pe=v.vertexLength;this.indexArray.emplaceBack(pe,pe+2,pe+1),this.indexArray.emplaceBack(pe+1,pe+2,pe+3),v.vertexLength+=4,v.primitiveLength+=2}}}}if(v.vertexLength+y>ei.MAX_VERTEX_ARRAY_LENGTH&&(v=this.segments.prepareSegment(y,this.layoutVertexArray,this.indexArray)),yd[e.type]!=="Polygon")continue;const E=[],k=[],F=v.vertexLength;for(const L of m)if(L.length!==0){L!==m[0]&&k.push(E.length/2);for(let N=0;N<L.length;N++){const W=L[N];Ko(this.layoutVertexArray,W.x,W.y,0,0,1,1,0),d.x+=W.x,d.y+=W.y,d.vertexCount+=1,E.push(W.x),E.push(W.y)}}const P=Xc(E,k);for(let L=0;L<P.length;L+=3)this.indexArray.emplaceBack(F+P[L],F+P[L+2],F+P[L+1]);v.primitiveLength+=P.length/3,v.vertexLength+=y}for(let m=0;m<d.vertexCount;m++)this.centroidVertexArray.emplaceBack(Math.floor(d.x/d.vertexCount),Math.floor(d.y/d.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,p,o)}}function xd(i,e){return i.x===e.x&&(i.x<0||i.x>bi)||i.y===e.y&&(i.y<0||i.y>bi)}function vd(i){return i.every(e=>e.x<0)||i.every(e=>e.x>bi)||i.every(e=>e.y<0)||i.every(e=>e.y>bi)}let ih;Ue("FillExtrusionBucket",Nu,{omit:["layers","features"]});var bd={get paint(){return ih=ih||new _i({"fill-extrusion-opacity":new Je(ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new it(ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Je(ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Je(ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ta(ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new it(ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new it(ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Je(ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class wd extends $r{constructor(e){super(e,bd)}createBucket(e){return new Nu(e)}queryRadius(){return Ol(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,r,n,o,p,d,m,y){const v=$l(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,m),E=this.paint.get("fill-extrusion-height").evaluate(r,n),k=this.paint.get("fill-extrusion-base").evaluate(r,n),F=function(L,N,W,J){const oe=[];for(const te of L){const ue=[te.x,te.y,0,1];Nl(ue,ue,N),oe.push(new Ee(ue[0]/ue[3],ue[1]/ue[3]))}return oe}(v,y),P=function(L,N,W,J){const oe=[],te=[],ue=J[8]*N,pe=J[9]*N,Ae=J[10]*N,Ne=J[11]*N,He=J[8]*W,Oe=J[9]*W,Re=J[10]*W,ze=J[11]*W;for(const qe of L){const Pe=[],Ie=[];for(const tt of qe){const Ye=tt.x,mt=tt.y,ti=J[0]*Ye+J[4]*mt+J[12],ni=J[1]*Ye+J[5]*mt+J[13],Di=J[2]*Ye+J[6]*mt+J[14],Vr=J[3]*Ye+J[7]*mt+J[15],xr=Di+Ae,wi=Vr+Ne,Zi=ti+He,Ki=ni+Oe,vr=Di+Re,br=Vr+ze,Ii=new Ee((ti+ue)/wi,(ni+pe)/wi);Ii.z=xr/wi,Pe.push(Ii);const Fi=new Ee(Zi/br,Ki/br);Fi.z=vr/br,Ie.push(Fi)}oe.push(Pe),te.push(Ie)}return[oe,te]}(o,k,E,y);return function(L,N,W){let J=1/0;zc(W,N)&&(J=rh(W,N[0]));for(let oe=0;oe<N.length;oe++){const te=N[oe],ue=L[oe];for(let pe=0;pe<te.length-1;pe++){const Ae=te[pe],Ne=[Ae,te[pe+1],ue[pe+1],ue[pe],Ae];Bc(W,Ne)&&(J=Math.min(J,rh(W,Ne)))}}return J!==1/0&&J}(P[0],P[1],F)}}function Yo(i,e){return i.x*e.x+i.y*e.y}function rh(i,e){if(i.length===1){let r=0;const n=e[r++];let o;for(;!o||n.equals(o);)if(o=e[r++],!o)return 1/0;for(;r<e.length;r++){const p=e[r],d=i[0],m=o.sub(n),y=p.sub(n),v=d.sub(n),E=Yo(m,m),k=Yo(m,y),F=Yo(y,y),P=Yo(v,m),L=Yo(v,y),N=E*F-k*k,W=(F*P-k*L)/N,J=(E*L-k*P)/N,oe=n.z*(1-W-J)+o.z*W+p.z*J;if(isFinite(oe))return oe}return 1/0}{let r=1/0;for(const n of e)r=Math.min(r,n.z);return r}}const Ad=ai([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Ed}=Ad,Cd=ai([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Sd}=Cd,kd=Qn.VectorTileFeature.types,Td=Math.cos(Math.PI/180*37.5),sh=Math.pow(2,14)/.5;class Vu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new rt,this.layoutVertexArray2=new Ke,this.indexArray=new qi,this.programConfigurations=new Ls(e.layers,e.zoom),this.segments=new ei,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,n){this.hasPattern=Lu("line",this.layers,r);const o=this.layers[0].layout.get("line-sort-key"),p=!o.isConstant(),d=[];for(const{feature:m,id:y,index:v,sourceLayerIndex:E}of e){const k=this.layers[0]._featureFilter.needGeometry,F=Ba(m,k);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),F,n))continue;const P=p?o.evaluate(F,{},n):void 0,L={id:y,properties:m.properties,type:m.type,sourceLayerIndex:E,index:v,geometry:k?F.geometry:Fa(m),patterns:{},sortKey:P};d.push(L)}p&&d.sort((m,y)=>m.sortKey-y.sortKey);for(const m of d){const{geometry:y,index:v,sourceLayerIndex:E}=m;if(this.hasPattern){const k=Ru("line",this.layers,m,this.zoom,r);this.patternFeatures.push(k)}else this.addFeature(m,y,v,n,{});r.featureIndex.insert(e[v].feature,y,v,E,this.index)}}update(e,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,n)}addFeatures(e,r,n){for(const o of this.patternFeatures)this.addFeature(o,o.geometry,o.index,r,n)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Sd)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ed),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,n,o,p){const d=this.layers[0].layout,m=d.get("line-join").evaluate(e,{}),y=d.get("line-cap"),v=d.get("line-miter-limit"),E=d.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const k of r)this.addLine(k,e,m,y,v,E);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,p,o)}addLine(e,r,n,o,p,d){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let J=0;J<e.length-1;J++)this.totalDistance+=e[J].dist(e[J+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const m=kd[r.type]==="Polygon";let y=e.length;for(;y>=2&&e[y-1].equals(e[y-2]);)y--;let v=0;for(;v<y-1&&e[v].equals(e[v+1]);)v++;if(y<(m?3:2))return;n==="bevel"&&(p=1.05);const E=this.overscaling<=16?15*bi/(512*this.overscaling):0,k=this.segments.prepareSegment(10*y,this.layoutVertexArray,this.indexArray);let F,P,L,N,W;this.e1=this.e2=-1,m&&(F=e[y-2],W=e[v].sub(F)._unit()._perp());for(let J=v;J<y;J++){if(L=J===y-1?m?e[v+1]:void 0:e[J+1],L&&e[J].equals(L))continue;W&&(N=W),F&&(P=F),F=e[J],W=L?L.sub(F)._unit()._perp():N,N=N||W;let oe=N.add(W);oe.x===0&&oe.y===0||oe._unit();const te=N.x*W.x+N.y*W.y,ue=oe.x*W.x+oe.y*W.y,pe=ue!==0?1/ue:1/0,Ae=2*Math.sqrt(2-2*ue),Ne=ue<Td&&P&&L,He=N.x*W.y-N.y*W.x>0;if(Ne&&J>v){const ze=F.dist(P);if(ze>2*E){const qe=F.sub(F.sub(P)._mult(E/ze)._round());this.updateDistance(P,qe),this.addCurrentVertex(qe,N,0,0,k),P=qe}}const Oe=P&&L;let Re=Oe?n:m?"butt":o;if(Oe&&Re==="round"&&(pe<d?Re="miter":pe<=2&&(Re="fakeround")),Re==="miter"&&pe>p&&(Re="bevel"),Re==="bevel"&&(pe>2&&(Re="flipbevel"),pe<p&&(Re="miter")),P&&this.updateDistance(P,F),Re==="miter")oe._mult(pe),this.addCurrentVertex(F,oe,0,0,k);else if(Re==="flipbevel"){if(pe>100)oe=W.mult(-1);else{const ze=pe*N.add(W).mag()/N.sub(W).mag();oe._perp()._mult(ze*(He?-1:1))}this.addCurrentVertex(F,oe,0,0,k),this.addCurrentVertex(F,oe.mult(-1),0,0,k)}else if(Re==="bevel"||Re==="fakeround"){const ze=-Math.sqrt(pe*pe-1),qe=He?ze:0,Pe=He?0:ze;if(P&&this.addCurrentVertex(F,N,qe,Pe,k),Re==="fakeround"){const Ie=Math.round(180*Ae/Math.PI/20);for(let tt=1;tt<Ie;tt++){let Ye=tt/Ie;if(Ye!==.5){const ti=Ye-.5;Ye+=Ye*ti*(Ye-1)*((1.0904+te*(te*(3.55645-1.43519*te)-3.2452))*ti*ti+(.848013+te*(.215638*te-1.06021)))}const mt=W.sub(N)._mult(Ye)._add(N)._unit()._mult(He?-1:1);this.addHalfVertex(F,mt.x,mt.y,!1,He,0,k)}}L&&this.addCurrentVertex(F,W,-qe,-Pe,k)}else if(Re==="butt")this.addCurrentVertex(F,oe,0,0,k);else if(Re==="square"){const ze=P?1:-1;this.addCurrentVertex(F,oe,ze,ze,k)}else Re==="round"&&(P&&(this.addCurrentVertex(F,N,0,0,k),this.addCurrentVertex(F,N,1,1,k,!0)),L&&(this.addCurrentVertex(F,W,-1,-1,k,!0),this.addCurrentVertex(F,W,0,0,k)));if(Ne&&J<y-1){const ze=F.dist(L);if(ze>2*E){const qe=F.add(L.sub(F)._mult(E/ze)._round());this.updateDistance(F,qe),this.addCurrentVertex(qe,W,0,0,k),F=qe}}}}addCurrentVertex(e,r,n,o,p,d=!1){const m=r.y*o-r.x,y=-r.y-r.x*o;this.addHalfVertex(e,r.x+r.y*n,r.y-r.x*n,d,!1,n,p),this.addHalfVertex(e,m,y,d,!0,-o,p),this.distance>sh/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,r,n,o,p,d))}addHalfVertex({x:e,y:r},n,o,p,d,m,y){const v=.5*(this.lineClips?this.scaledDistance*(sh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(r<<1)+(d?1:0),Math.round(63*n)+128,Math.round(63*o)+128,1+(m===0?0:m<0?-1:1)|(63&v)<<2,v>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const E=y.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),y.primitiveLength++),d?this.e2=E:this.e1=E}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}let nh,ah;Ue("LineBucket",Vu,{omit:["layers","patternFeatures"]});var oh={get paint(){return ah=ah||new _i({"line-opacity":new it(ye.paint_line["line-opacity"]),"line-color":new it(ye.paint_line["line-color"]),"line-translate":new Je(ye.paint_line["line-translate"]),"line-translate-anchor":new Je(ye.paint_line["line-translate-anchor"]),"line-width":new it(ye.paint_line["line-width"]),"line-gap-width":new it(ye.paint_line["line-gap-width"]),"line-offset":new it(ye.paint_line["line-offset"]),"line-blur":new it(ye.paint_line["line-blur"]),"line-dasharray":new Mo(ye.paint_line["line-dasharray"]),"line-pattern":new Ta(ye.paint_line["line-pattern"]),"line-gradient":new Po(ye.paint_line["line-gradient"])})},get layout(){return nh=nh||new _i({"line-cap":new Je(ye.layout_line["line-cap"]),"line-join":new it(ye.layout_line["line-join"]),"line-miter-limit":new Je(ye.layout_line["line-miter-limit"]),"line-round-limit":new Je(ye.layout_line["line-round-limit"]),"line-sort-key":new it(ye.layout_line["line-sort-key"])})}};class Dd extends it{possiblyEvaluate(e,r){return r=new Qt(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,n,o){return r=mi({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,n,o)}}let Zl;class Id extends $r{constructor(e){super(e,oh),this.gradientVersion=0,Zl||(Zl=new Dd(oh.paint.properties["line-width"].specification),Zl.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(n){return n._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof me,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,r){super.recalculate(e,r),this.paint._values["line-floorwidth"]=Zl.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Vu(e)}queryRadius(e){const r=e,n=lh(qo("line-width",this,r),qo("line-gap-width",this,r)),o=qo("line-offset",this,r);return n/2+Math.abs(o)+Ol(this.paint.get("line-translate"))}queryIntersectsFeature(e,r,n,o,p,d,m){const y=$l(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,m),v=m/2*lh(this.paint.get("line-width").evaluate(r,n),this.paint.get("line-gap-width").evaluate(r,n)),E=this.paint.get("line-offset").evaluate(r,n);return E&&(o=function(k,F){const P=[];for(let L=0;L<k.length;L++){const N=k[L],W=[];for(let J=0;J<N.length;J++){const oe=N[J-1],te=N[J],ue=N[J+1],pe=J===0?new Ee(0,0):te.sub(oe)._unit()._perp(),Ae=J===N.length-1?new Ee(0,0):ue.sub(te)._unit()._perp(),Ne=pe._add(Ae)._unit(),He=Ne.x*Ae.x+Ne.y*Ae.y;He!==0&&Ne._mult(1/He),W.push(Ne._mult(F)._add(te))}P.push(W)}return P}(o,E*m)),function(k,F,P){for(let L=0;L<F.length;L++){const N=F[L];if(k.length>=3){for(let W=0;W<N.length;W++)if(ao(k,N[W]))return!0}if(Lp(k,N,P))return!0}return!1}(y,o,v)}isTileClipped(){return!0}}function lh(i,e){return e>0?e+2*i:i}const Fd=ai([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Bd=ai([{name:"a_projected_pos",components:3,type:"Float32"}],4);ai([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const zd=ai([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);ai([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const uh=ai([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Md=ai([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Pd(i,e,r){return i.sections.forEach(n=>{n.text=function(o,p,d){const m=p.layout.get("text-transform").evaluate(d,{});return m==="uppercase"?o=o.toLocaleUpperCase():m==="lowercase"&&(o=o.toLocaleLowerCase()),Tr.applyArabicShaping&&(o=Tr.applyArabicShaping(o)),o}(n.text,e,r)}),i}ai([{name:"triangle",components:3,type:"Uint16"}]),ai([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ai([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),ai([{type:"Float32",name:"offsetX"}]),ai([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),ai([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Jo={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Ti=24,ch=Nt,hh=function(i,e,r,n,o){var p,d,m=8*o-n-1,y=(1<<m)-1,v=y>>1,E=-7,k=o-1,F=-1,P=i[e+k];for(k+=F,p=P&(1<<-E)-1,P>>=-E,E+=m;E>0;p=256*p+i[e+k],k+=F,E-=8);for(d=p&(1<<-E)-1,p>>=-E,E+=n;E>0;d=256*d+i[e+k],k+=F,E-=8);if(p===0)p=1-v;else{if(p===y)return d?NaN:1/0*(P?-1:1);d+=Math.pow(2,n),p-=v}return(P?-1:1)*d*Math.pow(2,p-n)},ph=function(i,e,r,n,o,p){var d,m,y,v=8*p-o-1,E=(1<<v)-1,k=E>>1,F=o===23?Math.pow(2,-24)-Math.pow(2,-77):0,P=0,L=1,N=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(m=isNaN(e)?1:0,d=E):(d=Math.floor(Math.log(e)/Math.LN2),e*(y=Math.pow(2,-d))<1&&(d--,y*=2),(e+=d+k>=1?F/y:F*Math.pow(2,1-k))*y>=2&&(d++,y/=2),d+k>=E?(m=0,d=E):d+k>=1?(m=(e*y-1)*Math.pow(2,o),d+=k):(m=e*Math.pow(2,k-1)*Math.pow(2,o),d=0));o>=8;i[r+P]=255&m,P+=L,m/=256,o-=8);for(d=d<<o|m,v+=o;v>0;i[r+P]=255&d,P+=L,d/=256,v-=8);i[r+P-L]|=128*N};function Nt(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Nt.Varint=0,Nt.Fixed64=1,Nt.Bytes=2,Nt.Fixed32=5;var Uu=4294967296,dh=1/Uu,fh=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function An(i){return i.type===Nt.Bytes?i.readVarint()+i.pos:i.pos+1}function co(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function mh(i,e,r){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(n);for(var o=r.pos-1;o>=i;o--)r.buf[o+n]=r.buf[o]}function Ld(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function Rd(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function Od(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function $d(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function Nd(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function Vd(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function Ud(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function qd(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function jd(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function Gl(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function ho(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function gh(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}Nt.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),o=n>>3,p=this.pos;this.type=7&n,i(o,e,this),this.pos===p&&this.skip(n)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=Gl(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=gh(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Gl(this.buf,this.pos)+Gl(this.buf,this.pos+4)*Uu;return this.pos+=8,i},readSFixed64:function(){var i=Gl(this.buf,this.pos)+gh(this.buf,this.pos+4)*Uu;return this.pos+=8,i},readFloat:function(){var i=hh(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=hh(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,n=this.buf;return e=127&(r=n[this.pos++]),r<128?e:(e|=(127&(r=n[this.pos++]))<<7,r<128?e:(e|=(127&(r=n[this.pos++]))<<14,r<128?e:(e|=(127&(r=n[this.pos++]))<<21,r<128?e:function(o,p,d){var m,y,v=d.buf;if(m=(112&(y=v[d.pos++]))>>4,y<128||(m|=(127&(y=v[d.pos++]))<<3,y<128)||(m|=(127&(y=v[d.pos++]))<<10,y<128)||(m|=(127&(y=v[d.pos++]))<<17,y<128)||(m|=(127&(y=v[d.pos++]))<<24,y<128)||(m|=(1&(y=v[d.pos++]))<<31,y<128))return co(o,m,p);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=n[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&fh?function(r,n,o){return fh.decode(r.subarray(n,o))}(this.buf,e,i):function(r,n,o){for(var p="",d=n;d<o;){var m,y,v,E=r[d],k=null,F=E>239?4:E>223?3:E>191?2:1;if(d+F>o)break;F===1?E<128&&(k=E):F===2?(192&(m=r[d+1]))==128&&(k=(31&E)<<6|63&m)<=127&&(k=null):F===3?(y=r[d+2],(192&(m=r[d+1]))==128&&(192&y)==128&&((k=(15&E)<<12|(63&m)<<6|63&y)<=2047||k>=55296&&k<=57343)&&(k=null)):F===4&&(y=r[d+2],v=r[d+3],(192&(m=r[d+1]))==128&&(192&y)==128&&(192&v)==128&&((k=(15&E)<<18|(63&m)<<12|(63&y)<<6|63&v)<=65535||k>=1114112)&&(k=null)),k===null?(k=65533,F=1):k>65535&&(k-=65536,p+=String.fromCharCode(k>>>10&1023|55296),k=56320|1023&k),p+=String.fromCharCode(k),d+=F}return p}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Nt.Bytes)return i.push(this.readVarint(e));var r=An(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Nt.Bytes)return i.push(this.readSVarint());var e=An(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Nt.Bytes)return i.push(this.readBoolean());var e=An(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Nt.Bytes)return i.push(this.readFloat());var e=An(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Nt.Bytes)return i.push(this.readDouble());var e=An(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Nt.Bytes)return i.push(this.readFixed32());var e=An(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Nt.Bytes)return i.push(this.readSFixed32());var e=An(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Nt.Bytes)return i.push(this.readFixed64());var e=An(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Nt.Bytes)return i.push(this.readSFixed64());var e=An(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Nt.Varint)for(;this.buf[this.pos++]>127;);else if(e===Nt.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Nt.Fixed32)this.pos+=4;else{if(e!==Nt.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),ho(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),ho(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),ho(this.buf,-1&i,this.pos),ho(this.buf,Math.floor(i*dh),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),ho(this.buf,-1&i,this.pos),ho(this.buf,Math.floor(i*dh),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var n,o;if(e>=0?(n=e%4294967296|0,o=e/4294967296|0):(o=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,o=o+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(p,d,m){m.buf[m.pos++]=127&p|128,p>>>=7,m.buf[m.pos++]=127&p|128,p>>>=7,m.buf[m.pos++]=127&p|128,p>>>=7,m.buf[m.pos++]=127&p|128,m.buf[m.pos]=127&(p>>>=7)}(n,0,r),function(p,d){var m=(7&p)<<4;d.buf[d.pos++]|=m|((p>>>=3)?128:0),p&&(d.buf[d.pos++]=127&p|((p>>>=7)?128:0),p&&(d.buf[d.pos++]=127&p|((p>>>=7)?128:0),p&&(d.buf[d.pos++]=127&p|((p>>>=7)?128:0),p&&(d.buf[d.pos++]=127&p|((p>>>=7)?128:0),p&&(d.buf[d.pos++]=127&p)))))}(o,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(n,o,p){for(var d,m,y=0;y<o.length;y++){if((d=o.charCodeAt(y))>55295&&d<57344){if(!m){d>56319||y+1===o.length?(n[p++]=239,n[p++]=191,n[p++]=189):m=d;continue}if(d<56320){n[p++]=239,n[p++]=191,n[p++]=189,m=d;continue}d=m-55296<<10|d-56320|65536,m=null}else m&&(n[p++]=239,n[p++]=191,n[p++]=189,m=null);d<128?n[p++]=d:(d<2048?n[p++]=d>>6|192:(d<65536?n[p++]=d>>12|224:(n[p++]=d>>18|240,n[p++]=d>>12&63|128),n[p++]=d>>6&63|128),n[p++]=63&d|128)}return p}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&mh(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),ph(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),ph(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var n=this.pos-r;n>=128&&mh(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(i,e,r){this.writeTag(i,Nt.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,Ld,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,Rd,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,Nd,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,Od,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,$d,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,Vd,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,Ud,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,qd,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,jd,e)},writeBytesField:function(i,e){this.writeTag(i,Nt.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Nt.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Nt.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Nt.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Nt.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Nt.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Nt.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Nt.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Nt.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Nt.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};var qu=ee(ch);const ju=3;function Zd(i,e,r){i===1&&r.readMessage(Gd,e)}function Gd(i,e,r){if(i===3){const{id:n,bitmap:o,width:p,height:d,left:m,top:y,advance:v}=r.readMessage(Hd,{});e.push({id:n,bitmap:new Zo({width:p+2*ju,height:d+2*ju},o),metrics:{width:p,height:d,left:m,top:y,advance:v}})}}function Hd(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}const Wd=ju;function _h(i){let e=0,r=0;for(const d of i)e+=d.w*d.h,r=Math.max(r,d.w);i.sort((d,m)=>m.h-d.h);const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let o=0,p=0;for(const d of i)for(let m=n.length-1;m>=0;m--){const y=n[m];if(!(d.w>y.w||d.h>y.h)){if(d.x=y.x,d.y=y.y,p=Math.max(p,d.y+d.h),o=Math.max(o,d.x+d.w),d.w===y.w&&d.h===y.h){const v=n.pop();m<n.length&&(n[m]=v)}else d.h===y.h?(y.x+=d.w,y.w-=d.w):d.w===y.w?(y.y+=d.h,y.h-=d.h):(n.push({x:y.x+d.w,y:y.y,w:y.w-d.w,h:d.h}),y.y+=d.h,y.h-=d.h);break}}return{w:o,h:p,fill:e/(o*p)||0}}const Ir=1;class Zu{constructor(e,{pixelRatio:r,version:n,stretchX:o,stretchY:p,content:d}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=o,this.stretchY=p,this.content=d,this.version=n}get tl(){return[this.paddedRect.x+Ir,this.paddedRect.y+Ir]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ir,this.paddedRect.y+this.paddedRect.h-Ir]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Ir)/this.pixelRatio,(this.paddedRect.h-2*Ir)/this.pixelRatio]}}class yh{constructor(e,r){const n={},o={};this.haveRenderCallbacks=[];const p=[];this.addImages(e,n,p),this.addImages(r,o,p);const{w:d,h:m}=_h(p),y=new Kr({width:d||1,height:m||1});for(const v in e){const E=e[v],k=n[v].paddedRect;Kr.copy(E.data,y,{x:0,y:0},{x:k.x+Ir,y:k.y+Ir},E.data)}for(const v in r){const E=r[v],k=o[v].paddedRect,F=k.x+Ir,P=k.y+Ir,L=E.data.width,N=E.data.height;Kr.copy(E.data,y,{x:0,y:0},{x:F,y:P},E.data),Kr.copy(E.data,y,{x:0,y:N-1},{x:F,y:P-1},{width:L,height:1}),Kr.copy(E.data,y,{x:0,y:0},{x:F,y:P+N},{width:L,height:1}),Kr.copy(E.data,y,{x:L-1,y:0},{x:F-1,y:P},{width:1,height:N}),Kr.copy(E.data,y,{x:0,y:0},{x:F+L,y:P},{width:1,height:N})}this.image=y,this.iconPositions=n,this.patternPositions=o}addImages(e,r,n){for(const o in e){const p=e[o],d={x:0,y:0,w:p.data.width+2*Ir,h:p.data.height+2*Ir};n.push(d),r[o]=new Zu(d,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(o)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const n in e.updatedImages)this.patchUpdatedImage(this.iconPositions[n],e.getImage(n),r),this.patchUpdatedImage(this.patternPositions[n],e.getImage(n),r)}patchUpdatedImage(e,r,n){if(!e||!r||e.version===r.version)return;e.version=r.version;const[o,p]=e.tl;n.update(r.data,void 0,{x:o,y:p})}}var ea;Ue("ImagePosition",Zu),Ue("ImageAtlas",yh),l.ai=void 0,(ea=l.ai||(l.ai={}))[ea.none=0]="none",ea[ea.horizontal=1]="horizontal",ea[ea.vertical=2]="vertical",ea[ea.horizontalOnly=3]="horizontalOnly";const Qo=-17;class el{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const n=new el;return n.scale=e||1,n.fontStack=r,n}static forImage(e){const r=new el;return r.imageName=e,r}}class po{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const n=new po;for(let o=0;o<e.sections.length;o++){const p=e.sections[o];p.image?n.addImageSection(p):n.addTextSection(p,r)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let n=0;n<e.length;n++){const o=e.charCodeAt(n+1)||null,p=e.charCodeAt(n-1)||null;r+=o&&kl(o)&&!Jo[e[n+1]]||p&&kl(p)&&!Jo[e[n-1]]||!Jo[e[n]]?e[n]:Jo[e[n]]}return r}(this.text)}trim(){let e=0;for(let n=0;n<this.text.length&&Wl[this.text.charCodeAt(n)];n++)e++;let r=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&Wl[this.text.charCodeAt(n)];n--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const n=new po;return n.text=this.text.substring(e,r),n.sectionIndex=this.sectionIndex.slice(e,r),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(el.forText(e.scale,e.fontStack||r));const n=this.sections.length-1;for(let o=0;o<e.text.length;++o)this.sectionIndex.push(n)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void Ai("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(el.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Ai("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Hl(i,e,r,n,o,p,d,m,y,v,E,k,F,P,L,N){const W=po.fromFeature(i,o);let J;k===l.ai.vertical&&W.verticalizePunctuation();const{processBidirectionalText:oe,processStyledBidirectionalText:te}=Tr;if(oe&&W.sections.length===1){J=[];const Ae=oe(W.toString(),Gu(W,v,p,e,n,P,L));for(const Ne of Ae){const He=new po;He.text=Ne,He.sections=W.sections;for(let Oe=0;Oe<Ne.length;Oe++)He.sectionIndex.push(0);J.push(He)}}else if(te){J=[];const Ae=te(W.text,W.sectionIndex,Gu(W,v,p,e,n,P,L));for(const Ne of Ae){const He=new po;He.text=Ne[0],He.sectionIndex=Ne[1],He.sections=W.sections,J.push(He)}}else J=function(Ae,Ne){const He=[],Oe=Ae.text;let Re=0;for(const ze of Ne)He.push(Ae.substring(Re,ze)),Re=ze;return Re<Oe.length&&He.push(Ae.substring(Re,Oe.length)),He}(W,Gu(W,v,p,e,n,P,L));const ue=[],pe={positionedLines:ue,text:W.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:k,iconsInText:!1,verticalizable:!1};return function(Ae,Ne,He,Oe,Re,ze,qe,Pe,Ie,tt,Ye,mt){let ti=0,ni=Qo,Di=0,Vr=0;const xr=Pe==="right"?1:Pe==="left"?0:.5;let wi=0;for(const Ii of Re){Ii.trim();const Fi=Ii.getMaxScale(),sr=(Fi-1)*Ti,wr={positionedGlyphs:[],lineOffset:0};Ae.positionedLines[wi]=wr;const nr=wr.positionedGlyphs;let Fr=0;if(!Ii.length()){ni+=ze,++wi;continue}for(let Bi=0;Bi<Ii.length();Bi++){const At=Ii.getSection(Bi),ar=Ii.getSectionIndex(Bi),Yi=Ii.getCharCode(Bi);let zi=0,gs=null,Rs=null,Os=null,En=Ti;const _s=!(Ie===l.ai.horizontal||!Ye&&!So(Yi)||Ye&&(Wl[Yi]||(Zi=Yi,$e.Arabic(Zi)||$e["Arabic Supplement"](Zi)||$e["Arabic Extended-A"](Zi)||$e["Arabic Presentation Forms-A"](Zi)||$e["Arabic Presentation Forms-B"](Zi))));if(At.imageName){const Jr=Oe[At.imageName];if(!Jr)continue;Os=At.imageName,Ae.iconsInText=Ae.iconsInText||!0,Rs=Jr.paddedRect;const zr=Jr.displaySize;At.scale=At.scale*Ti/mt,gs={width:zr[0],height:zr[1],left:Ir,top:-3,advance:_s?zr[1]:zr[0]},zi=sr+(Ti-zr[1]*At.scale),En=gs.advance;const Cn=_s?zr[0]*At.scale-Ti*Fi:zr[1]*At.scale-Ti*Fi;Cn>0&&Cn>Fr&&(Fr=Cn)}else{const Jr=He[At.fontStack],zr=Jr&&Jr[Yi];if(zr&&zr.rect)Rs=zr.rect,gs=zr.metrics;else{const Cn=Ne[At.fontStack],al=Cn&&Cn[Yi];if(!al)continue;gs=al.metrics}zi=(Fi-At.scale)*Ti}_s?(Ae.verticalizable=!0,nr.push({glyph:Yi,imageName:Os,x:ti,y:ni+zi,vertical:_s,scale:At.scale,fontStack:At.fontStack,sectionIndex:ar,metrics:gs,rect:Rs}),ti+=En*At.scale+tt):(nr.push({glyph:Yi,imageName:Os,x:ti,y:ni+zi,vertical:_s,scale:At.scale,fontStack:At.fontStack,sectionIndex:ar,metrics:gs,rect:Rs}),ti+=gs.advance*At.scale+tt)}nr.length!==0&&(Di=Math.max(ti-tt,Di),Yd(nr,0,nr.length-1,xr,Fr)),ti=0;const Br=ze*Fi+Fr;wr.lineOffset=Math.max(Fr,sr),ni+=Br,Vr=Math.max(Br,Vr),++wi}var Zi;const Ki=ni-Qo,{horizontalAlign:vr,verticalAlign:br}=Hu(qe);(function(Ii,Fi,sr,wr,nr,Fr,Br,Bi,At){const ar=(Fi-sr)*nr;let Yi=0;Yi=Fr!==Br?-Bi*wr-Qo:(-wr*At+.5)*Br;for(const zi of Ii)for(const gs of zi.positionedGlyphs)gs.x+=ar,gs.y+=Yi})(Ae.positionedLines,xr,vr,br,Di,Vr,ze,Ki,Re.length),Ae.top+=-br*Ki,Ae.bottom=Ae.top+Ki,Ae.left+=-vr*Di,Ae.right=Ae.left+Di}(pe,e,r,n,J,d,m,y,k,v,F,N),!function(Ae){for(const Ne of Ae)if(Ne.positionedGlyphs.length!==0)return!1;return!0}(ue)&&pe}const Wl={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Xd={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function xh(i,e,r,n,o,p){if(e.imageName){const d=n[e.imageName];return d?d.displaySize[0]*e.scale*Ti/p+o:0}{const d=r[e.fontStack],m=d&&d[i];return m?m.metrics.advance*e.scale+o:0}}function vh(i,e,r,n){const o=Math.pow(i-e,2);return n?i<e?o/2:2*o:o+Math.abs(r)*r}function Kd(i,e,r){let n=0;return i===10&&(n-=1e4),r&&(n+=150),i!==40&&i!==65288||(n+=50),e!==41&&e!==65289||(n+=50),n}function bh(i,e,r,n,o,p){let d=null,m=vh(e,r,o,p);for(const y of n){const v=vh(e-y.x,r,o,p)+y.badness;v<=m&&(d=y,m=v)}return{index:i,x:e,priorBreak:d,badness:m}}function wh(i){return i?wh(i.priorBreak).concat(i.index):[]}function Gu(i,e,r,n,o,p,d){if(p!=="point")return[];if(!i)return[];const m=[],y=function(F,P,L,N,W,J){let oe=0;for(let te=0;te<F.length();te++){const ue=F.getSection(te);oe+=xh(F.getCharCode(te),ue,N,W,P,J)}return oe/Math.max(1,Math.ceil(oe/L))}(i,e,r,n,o,d),v=i.text.indexOf("")>=0;let E=0;for(let F=0;F<i.length();F++){const P=i.getSection(F),L=i.getCharCode(F);if(Wl[L]||(E+=xh(L,P,n,o,e,d)),F<i.length()-1){const N=!((k=L)<11904||!($e["Bopomofo Extended"](k)||$e.Bopomofo(k)||$e["CJK Compatibility Forms"](k)||$e["CJK Compatibility Ideographs"](k)||$e["CJK Compatibility"](k)||$e["CJK Radicals Supplement"](k)||$e["CJK Strokes"](k)||$e["CJK Symbols and Punctuation"](k)||$e["CJK Unified Ideographs Extension A"](k)||$e["CJK Unified Ideographs"](k)||$e["Enclosed CJK Letters and Months"](k)||$e["Halfwidth and Fullwidth Forms"](k)||$e.Hiragana(k)||$e["Ideographic Description Characters"](k)||$e["Kangxi Radicals"](k)||$e["Katakana Phonetic Extensions"](k)||$e.Katakana(k)||$e["Vertical Forms"](k)||$e["Yi Radicals"](k)||$e["Yi Syllables"](k)));(Xd[L]||N||P.imageName)&&m.push(bh(F+1,E,y,m,Kd(L,i.getCharCode(F+1),N&&v),!1))}}var k;return wh(bh(i.length(),E,y,m,0,!0))}function Hu(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Yd(i,e,r,n,o){if(!n&&!o)return;const p=i[r],d=(i[r].x+p.metrics.advance*p.scale)*n;for(let m=e;m<=r;m++)i[m].x-=d,i[m].y+=o}function Jd(i,e,r){const{horizontalAlign:n,verticalAlign:o}=Hu(r),p=e[0]-i.displaySize[0]*n,d=e[1]-i.displaySize[1]*o;return{image:i,top:d,bottom:d+i.displaySize[1],left:p,right:p+i.displaySize[0]}}function Ah(i,e,r,n,o,p){const d=i.image;let m;if(d.content){const W=d.content,J=d.pixelRatio||1;m=[W[0]/J,W[1]/J,d.displaySize[0]-W[2]/J,d.displaySize[1]-W[3]/J]}const y=e.left*p,v=e.right*p;let E,k,F,P;r==="width"||r==="both"?(P=o[0]+y-n[3],k=o[0]+v+n[1]):(P=o[0]+(y+v-d.displaySize[0])/2,k=P+d.displaySize[0]);const L=e.top*p,N=e.bottom*p;return r==="height"||r==="both"?(E=o[1]+L-n[0],F=o[1]+N+n[2]):(E=o[1]+(L+N-d.displaySize[1])/2,F=E+d.displaySize[1]),{image:d,top:E,right:k,bottom:F,left:P,collisionPadding:m}}const tl=255,tn=128,ta=tl*tn;function Eh(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Qt(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:n,interpolationType:o}=r;let p=0;for(;p<n.length&&n[p]<=i;)p++;p=Math.max(0,p-1);let d=p;for(;d<n.length&&n[d]<i+1;)d++;d=Math.min(n.length-1,d);const m=n[p],y=n[d];return r.kind==="composite"?{kind:"composite",minZoom:m,maxZoom:y,interpolationType:o}:{kind:"camera",minZoom:m,maxZoom:y,minSize:r.evaluate(new Qt(m)),maxSize:r.evaluate(new Qt(y)),interpolationType:o}}}function Wu(i,e,r){let n="never";const o=i.get(e);return o?n=o:i.get(r)&&(n="always"),n}const Qd=Qn.VectorTileFeature.types,ef=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Xl(i,e,r,n,o,p,d,m,y,v,E,k,F){const P=m?Math.min(ta,Math.round(m[0])):0,L=m?Math.min(ta,Math.round(m[1])):0;i.emplaceBack(e,r,Math.round(32*n),Math.round(32*o),p,d,(P<<1)+(y?1:0),L,16*v,16*E,256*k,256*F)}function Xu(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function tf(i){for(const e of i.sections)if(bu(e.text))return!0;return!1}class Ku{constructor(e){this.layoutVertexArray=new gt,this.indexArray=new qi,this.programConfigurations=e,this.segments=new ei,this.dynamicLayoutVertexArray=new pt,this.opacityVertexArray=new xt,this.hasVisibleVertices=!1,this.placedSymbolArray=new re}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,n,o){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Fd.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Bd.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,ef,!0),this.opacityVertexBuffer.itemSize=1),(n||o)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ue("SymbolBuffers",Ku);class Yu{constructor(e,r,n){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new n,this.segments=new ei,this.collisionVertexArray=new Xt}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,zd.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ue("CollisionBuffers",Yu);class fo{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(d=>d.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Tu([]),this.placementViewportMatrix=Tu([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Eh(this.zoom,r["text-size"]),this.iconSizeData=Eh(this.zoom,r["icon-size"]);const n=this.layers[0].layout,o=n.get("symbol-sort-key"),p=n.get("symbol-z-order");this.canOverlap=Wu(n,"text-overlap","text-allow-overlap")!=="never"||Wu(n,"icon-overlap","icon-allow-overlap")!=="never"||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&!o.isConstant(),this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,n.get("symbol-placement")==="point"&&(this.writingModes=n.get("text-writing-mode").map(d=>l.ai[d])),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.sourceID=e.sourceID}createArrays(){this.text=new Ku(new Ls(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Ku(new Ls(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new ae,this.lineVertexArray=new de,this.symbolInstances=new K,this.textAnchorOffsets=new we}calculateGlyphDependencies(e,r,n,o,p){for(let d=0;d<e.length;d++)if(r[e.charCodeAt(d)]=!0,(n||o)&&p){const m=Jo[e.charAt(d)];m&&(r[m.charCodeAt(0)]=!0)}}populate(e,r,n){const o=this.layers[0],p=o.layout,d=p.get("text-font"),m=p.get("text-field"),y=p.get("icon-image"),v=(m.value.kind!=="constant"||m.value.value instanceof Oi&&!m.value.value.isEmpty()||m.value.value.toString().length>0)&&(d.value.kind!=="constant"||d.value.value.length>0),E=y.value.kind!=="constant"||!!y.value.value||Object.keys(y.parameters).length>0,k=p.get("symbol-sort-key");if(this.features=[],!v&&!E)return;const F=r.iconDependencies,P=r.glyphDependencies,L=r.availableImages,N=new Qt(this.zoom);for(const{feature:W,id:J,index:oe,sourceLayerIndex:te}of e){const ue=o._featureFilter.needGeometry,pe=Ba(W,ue);if(!o._featureFilter.filter(N,pe,n))continue;let Ae,Ne;if(ue||(pe.geometry=Fa(W)),v){const Oe=o.getValueAndResolveTokens("text-field",pe,n,L),Re=Oi.factory(Oe);tf(Re)&&(this.hasRTLText=!0),(!this.hasRTLText||Bo()==="unavailable"||this.hasRTLText&&Tr.isParsed())&&(Ae=Pd(Re,o,pe))}if(E){const Oe=o.getValueAndResolveTokens("icon-image",pe,n,L);Ne=Oe instanceof vi?Oe:vi.fromString(Oe)}if(!Ae&&!Ne)continue;const He=this.sortFeaturesByKey?k.evaluate(pe,{},n):void 0;if(this.features.push({id:J,text:Ae,icon:Ne,index:oe,sourceLayerIndex:te,geometry:pe.geometry,properties:W.properties,type:Qd[W.type],sortKey:He}),Ne&&(F[Ne.name]=!0),Ae){const Oe=d.evaluate(pe,{},n).join(","),Re=p.get("text-rotation-alignment")!=="viewport"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(l.ai.vertical)>=0;for(const ze of Ae.sections)if(ze.image)F[ze.image.name]=!0;else{const qe=Eo(Ae.toString()),Pe=ze.fontStack||Oe,Ie=P[Pe]=P[Pe]||{};this.calculateGlyphDependencies(ze.text,Ie,Re,this.allowVerticalPlacement,qe)}}}p.get("symbol-placement")==="line"&&(this.features=function(W){const J={},oe={},te=[];let ue=0;function pe(Oe){te.push(W[Oe]),ue++}function Ae(Oe,Re,ze){const qe=oe[Oe];return delete oe[Oe],oe[Re]=qe,te[qe].geometry[0].pop(),te[qe].geometry[0]=te[qe].geometry[0].concat(ze[0]),qe}function Ne(Oe,Re,ze){const qe=J[Re];return delete J[Re],J[Oe]=qe,te[qe].geometry[0].shift(),te[qe].geometry[0]=ze[0].concat(te[qe].geometry[0]),qe}function He(Oe,Re,ze){const qe=ze?Re[0][Re[0].length-1]:Re[0][0];return`${Oe}:${qe.x}:${qe.y}`}for(let Oe=0;Oe<W.length;Oe++){const Re=W[Oe],ze=Re.geometry,qe=Re.text?Re.text.toString():null;if(!qe){pe(Oe);continue}const Pe=He(qe,ze),Ie=He(qe,ze,!0);if(Pe in oe&&Ie in J&&oe[Pe]!==J[Ie]){const tt=Ne(Pe,Ie,ze),Ye=Ae(Pe,Ie,te[tt].geometry);delete J[Pe],delete oe[Ie],oe[He(qe,te[Ye].geometry,!0)]=Ye,te[tt].geometry=null}else Pe in oe?Ae(Pe,Ie,ze):Ie in J?Ne(Pe,Ie,ze):(pe(Oe),J[Pe]=ue-1,oe[Ie]=ue-1)}return te.filter(Oe=>Oe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((W,J)=>W.sortKey-J.sortKey)}update(e,r,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,n),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,n))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const n=this.lineVertexArray.length;if(e.segment!==void 0){let o=e.dist(r[e.segment+1]),p=e.dist(r[e.segment]);const d={};for(let m=e.segment+1;m<r.length;m++)d[m]={x:r[m].x,y:r[m].y,tileUnitDistanceFromAnchor:o},m<r.length-1&&(o+=r[m+1].dist(r[m]));for(let m=e.segment||0;m>=0;m--)d[m]={x:r[m].x,y:r[m].y,tileUnitDistanceFromAnchor:p},m>0&&(p+=r[m-1].dist(r[m]));for(let m=0;m<r.length;m++){const y=d[m];this.lineVertexArray.emplaceBack(y.x,y.y,y.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(e,r,n,o,p,d,m,y,v,E,k,F){const P=e.indexArray,L=e.layoutVertexArray,N=e.segments.prepareSegment(4*r.length,L,P,this.canOverlap?d.sortKey:void 0),W=this.glyphOffsetArray.length,J=N.vertexLength,oe=this.allowVerticalPlacement&&m===l.ai.vertical?Math.PI/2:0,te=d.text&&d.text.sections;for(let ue=0;ue<r.length;ue++){const{tl:pe,tr:Ae,bl:Ne,br:He,tex:Oe,pixelOffsetTL:Re,pixelOffsetBR:ze,minFontScaleX:qe,minFontScaleY:Pe,glyphOffset:Ie,isSDF:tt,sectionIndex:Ye}=r[ue],mt=N.vertexLength,ti=Ie[1];Xl(L,y.x,y.y,pe.x,ti+pe.y,Oe.x,Oe.y,n,tt,Re.x,Re.y,qe,Pe),Xl(L,y.x,y.y,Ae.x,ti+Ae.y,Oe.x+Oe.w,Oe.y,n,tt,ze.x,Re.y,qe,Pe),Xl(L,y.x,y.y,Ne.x,ti+Ne.y,Oe.x,Oe.y+Oe.h,n,tt,Re.x,ze.y,qe,Pe),Xl(L,y.x,y.y,He.x,ti+He.y,Oe.x+Oe.w,Oe.y+Oe.h,n,tt,ze.x,ze.y,qe,Pe),Xu(e.dynamicLayoutVertexArray,y,oe),P.emplaceBack(mt,mt+1,mt+2),P.emplaceBack(mt+1,mt+2,mt+3),N.vertexLength+=4,N.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ie[0]),ue!==r.length-1&&Ye===r[ue+1].sectionIndex||e.programConfigurations.populatePaintArrays(L.length,d,d.index,{},F,te&&te[Ye])}e.placedSymbolArray.emplaceBack(y.x,y.y,W,this.glyphOffsetArray.length-W,J,v,E,y.segment,n?n[0]:0,n?n[1]:0,o[0],o[1],m,0,!1,0,k)}_addCollisionDebugVertex(e,r,n,o,p,d){return r.emplaceBack(0,0),e.emplaceBack(n.x,n.y,o,p,Math.round(d.x),Math.round(d.y))}addCollisionDebugVertices(e,r,n,o,p,d,m){const y=p.segments.prepareSegment(4,p.layoutVertexArray,p.indexArray),v=y.vertexLength,E=p.layoutVertexArray,k=p.collisionVertexArray,F=m.anchorX,P=m.anchorY;this._addCollisionDebugVertex(E,k,d,F,P,new Ee(e,r)),this._addCollisionDebugVertex(E,k,d,F,P,new Ee(n,r)),this._addCollisionDebugVertex(E,k,d,F,P,new Ee(n,o)),this._addCollisionDebugVertex(E,k,d,F,P,new Ee(e,o)),y.vertexLength+=4;const L=p.indexArray;L.emplaceBack(v,v+1),L.emplaceBack(v+1,v+2),L.emplaceBack(v+2,v+3),L.emplaceBack(v+3,v),y.primitiveLength+=4}addDebugCollisionBoxes(e,r,n,o){for(let p=e;p<r;p++){const d=this.collisionBoxArray.get(p);this.addCollisionDebugVertices(d.x1,d.y1,d.x2,d.y2,o?this.textCollisionBox:this.iconCollisionBox,d.anchorPoint,n)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Yu(pi,uh.members,Si),this.iconCollisionBox=new Yu(pi,uh.members,Si);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,n,o,p,d,m,y,v){const E={};for(let k=r;k<n;k++){const F=e.get(k);E.textBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},E.textFeatureIndex=F.featureIndex;break}for(let k=o;k<p;k++){const F=e.get(k);E.verticalTextBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},E.verticalTextFeatureIndex=F.featureIndex;break}for(let k=d;k<m;k++){const F=e.get(k);E.iconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},E.iconFeatureIndex=F.featureIndex;break}for(let k=y;k<v;k++){const F=e.get(k);E.verticalIconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},E.verticalIconFeatureIndex=F.featureIndex;break}return E}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const n=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const n=e.placedSymbolArray.get(r),o=n.vertexStartIndex+4*n.numGlyphs;for(let p=n.vertexStartIndex;p<o;p+=4)e.indexArray.emplaceBack(p,p+1,p+2),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),n=Math.cos(e),o=[],p=[],d=[];for(let m=0;m<this.symbolInstances.length;++m){d.push(m);const y=this.symbolInstances.get(m);o.push(0|Math.round(r*y.anchorX+n*y.anchorY)),p.push(y.featureIndex)}return d.sort((m,y)=>o[m]-o[y]||p[y]-p[m]),d}addToSortKeyRanges(e,r){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===r?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const n=this.symbolInstances.get(r);this.featureSortOrder.push(n.featureIndex),[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach((o,p,d)=>{o>=0&&d.indexOf(o)===p&&this.addIndicesForPlacedSymbol(this.text,o)}),n.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,n.verticalPlacedTextSymbolIndex),n.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.placedIconSymbolIndex),n.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Ch,Sh;Ue("SymbolBucket",fo,{omit:["layers","collisionBoxArray","features","compareText"]}),fo.MAX_GLYPHS=65535,fo.addDynamicAttributes=Xu;var Ju={get paint(){return Sh=Sh||new _i({"icon-opacity":new it(ye.paint_symbol["icon-opacity"]),"icon-color":new it(ye.paint_symbol["icon-color"]),"icon-halo-color":new it(ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new it(ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new it(ye.paint_symbol["icon-halo-blur"]),"icon-translate":new Je(ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new Je(ye.paint_symbol["icon-translate-anchor"]),"text-opacity":new it(ye.paint_symbol["text-opacity"]),"text-color":new it(ye.paint_symbol["text-color"],{runtimeType:Vi,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new it(ye.paint_symbol["text-halo-color"]),"text-halo-width":new it(ye.paint_symbol["text-halo-width"]),"text-halo-blur":new it(ye.paint_symbol["text-halo-blur"]),"text-translate":new Je(ye.paint_symbol["text-translate"]),"text-translate-anchor":new Je(ye.paint_symbol["text-translate-anchor"])})},get layout(){return Ch=Ch||new _i({"symbol-placement":new Je(ye.layout_symbol["symbol-placement"]),"symbol-spacing":new Je(ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Je(ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new it(ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Je(ye.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Je(ye.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Je(ye.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Je(ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new Je(ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Je(ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new it(ye.layout_symbol["icon-size"]),"icon-text-fit":new Je(ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Je(ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new it(ye.layout_symbol["icon-image"]),"icon-rotate":new it(ye.layout_symbol["icon-rotate"]),"icon-padding":new it(ye.layout_symbol["icon-padding"]),"icon-keep-upright":new Je(ye.layout_symbol["icon-keep-upright"]),"icon-offset":new it(ye.layout_symbol["icon-offset"]),"icon-anchor":new it(ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Je(ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Je(ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Je(ye.layout_symbol["text-rotation-alignment"]),"text-field":new it(ye.layout_symbol["text-field"]),"text-font":new it(ye.layout_symbol["text-font"]),"text-size":new it(ye.layout_symbol["text-size"]),"text-max-width":new it(ye.layout_symbol["text-max-width"]),"text-line-height":new Je(ye.layout_symbol["text-line-height"]),"text-letter-spacing":new it(ye.layout_symbol["text-letter-spacing"]),"text-justify":new it(ye.layout_symbol["text-justify"]),"text-radial-offset":new it(ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Je(ye.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new it(ye.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new it(ye.layout_symbol["text-anchor"]),"text-max-angle":new Je(ye.layout_symbol["text-max-angle"]),"text-writing-mode":new Je(ye.layout_symbol["text-writing-mode"]),"text-rotate":new it(ye.layout_symbol["text-rotate"]),"text-padding":new Je(ye.layout_symbol["text-padding"]),"text-keep-upright":new Je(ye.layout_symbol["text-keep-upright"]),"text-transform":new it(ye.layout_symbol["text-transform"]),"text-offset":new it(ye.layout_symbol["text-offset"]),"text-allow-overlap":new Je(ye.layout_symbol["text-allow-overlap"]),"text-overlap":new Je(ye.layout_symbol["text-overlap"]),"text-ignore-placement":new Je(ye.layout_symbol["text-ignore-placement"]),"text-optional":new Je(ye.layout_symbol["text-optional"])})}};class kh{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Hr,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ue("FormatSectionOverride",kh,{omit:["defaultValue"]});class Kl extends $r{constructor(e){super(e,Ju)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const n=this.layout.get("text-writing-mode");if(n){const o=[];for(const p of n)o.indexOf(p)<0&&o.push(p);this.layout._values["text-writing-mode"]=o}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,n,o){const p=this.layout.get(e).evaluate(r,{},n,o),d=this._unevaluatedLayout._values[e];return d.isDataDriven()||hn(d.value)||!p?p:function(m,y){return y.replace(/{([^{}]+)}/g,(v,E)=>m&&E in m?String(m[E]):"")}(r.properties,p)}createBucket(e){return new fo(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Ju.paint.overridableProperties){if(!Kl.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),n=new kh(r),o=new Mt(n,r.property.specification);let p=null;p=r.value.kind==="constant"||r.value.kind==="source"?new xa("source",o):new Zn("composite",o,r.value.zoomStops),this.paint._values[e]=new ir(r.property,p,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,n){return!(!this.layout||r.isDataDriven()||n.isDataDriven())&&Kl.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const n=e.get("text-field"),o=Ju.paint.properties[r];let p=!1;const d=m=>{for(const y of m)if(o.overrides&&o.overrides.hasOverride(y))return void(p=!0)};if(n.value.kind==="constant"&&n.value.value instanceof Oi)d(n.value.value.sections);else if(n.value.kind==="source"){const m=v=>{p||(v instanceof ks&&jt(v.value)===j?d(v.value.sections):v instanceof Ks?d(v.sections):v.eachChild(m))},y=n.value;y._styleExpression&&m(y._styleExpression.expression)}return p}}let Th;var rf={get paint(){return Th=Th||new _i({"background-color":new Je(ye.paint_background["background-color"]),"background-pattern":new Mo(ye.paint_background["background-pattern"]),"background-opacity":new Je(ye.paint_background["background-opacity"])})}};class sf extends $r{constructor(e){super(e,rf)}}let Dh;var nf={get paint(){return Dh=Dh||new _i({"raster-opacity":new Je(ye.paint_raster["raster-opacity"]),"raster-hue-rotate":new Je(ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Je(ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Je(ye.paint_raster["raster-brightness-max"]),"raster-saturation":new Je(ye.paint_raster["raster-saturation"]),"raster-contrast":new Je(ye.paint_raster["raster-contrast"]),"raster-resampling":new Je(ye.paint_raster["raster-resampling"]),"raster-fade-duration":new Je(ye.paint_raster["raster-fade-duration"])})}};class af extends $r{constructor(e){super(e,nf)}}class of extends $r{constructor(e){super(e,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class lf{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Qu=63710088e-1;class ia{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ia(ts(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,n=this.lat*r,o=e.lat*r,p=Math.sin(n)*Math.sin(o)+Math.cos(n)*Math.cos(o)*Math.cos((e.lng-this.lng)*r);return Qu*Math.acos(Math.min(p,1))}static convert(e){if(e instanceof ia)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new ia(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new ia(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Ih=2*Math.PI*Qu;function Fh(i){return Ih*Math.cos(i*Math.PI/180)}function Bh(i){return(180+i)/360}function zh(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Mh(i,e){return i/Fh(e)}function Ph(i){return 360*i-180}function ec(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Yl{constructor(e,r,n=0){this.x=+e,this.y=+r,this.z=+n}static fromLngLat(e,r=0){const n=ia.convert(e);return new Yl(Bh(n.lng),zh(n.lat),Mh(r,n.lat))}toLngLat(){return new ia(Ph(this.x),ec(this.y))}toAltitude(){return this.z*Fh(ec(this.y))}meterInMercatorCoordinateUnits(){return 1/Ih*(e=ec(this.y),1/Math.cos(e*Math.PI/180));var e}}function Lh(i,e,r){var n=2*Math.PI*6378137/256/Math.pow(2,r);return[i*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}class tc{constructor(e,r,n){if(e<0||e>25||n<0||n>=Math.pow(2,e)||r<0||r>=Math.pow(2,e))throw new Error(`x=${r}, y=${n}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=n,this.key=il(0,e,e,r,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,n){const o=(d=this.y,m=this.z,y=Lh(256*(p=this.x),256*(d=Math.pow(2,m)-d-1),m),v=Lh(256*(p+1),256*(d+1),m),y[0]+","+y[1]+","+v[0]+","+v[1]);var p,d,m,y,v;const E=function(k,F,P){let L,N="";for(let W=k;W>0;W--)L=1<<W-1,N+=(F&L?1:0)+(P&L?2:0);return N}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,E).replace(/{bbox-epsg-3857}/g,o)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new Ee((e.x*r-this.x)*bi,(e.y*r-this.y)*bi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Rh{constructor(e,r){this.wrap=e,this.canonical=r,this.key=il(e,r.z,r.z,r.x,r.y)}}class Yr{constructor(e,r,n,o,p){if(e<n)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${n}`);this.overscaledZ=e,this.wrap=r,this.canonical=new tc(n,+o,+p),this.key=il(r,e,n,o,p)}clone(){return new Yr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new Yr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Yr(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-e;return e>this.canonical.z?il(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):il(this.wrap*+r,e,e,this.canonical.x>>n,this.canonical.y>>n)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Yr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,n=2*this.canonical.x,o=2*this.canonical.y;return[new Yr(r,this.wrap,r,n,o),new Yr(r,this.wrap,r,n+1,o),new Yr(r,this.wrap,r,n,o+1),new Yr(r,this.wrap,r,n+1,o+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Yr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Yr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Rh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Yl(e.x-this.wrap,e.y))}}function il(i,e,r,n,o){(i*=2)<0&&(i=-1*i-1);const p=1<<r;return(p*p*i+p*o+n).toString(36)+r.toString(36)+e.toString(36)}Ue("CanonicalTileID",tc),Ue("OverscaledTileID",Yr,{omit:["posMatrix"]});class Oh{constructor(e,r,n,o=1,p=1,d=1,m=0){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(n&&!["mapbox","terrarium","custom"].includes(n))return void Ai(`"${n}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const y=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),n){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=o,this.greenFactor=p,this.blueFactor=d,this.baseShift=m;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let v=0;v<y;v++)this.data[this._idx(-1,v)]=this.data[this._idx(0,v)],this.data[this._idx(y,v)]=this.data[this._idx(y-1,v)],this.data[this._idx(v,-1)]=this.data[this._idx(v,0)],this.data[this._idx(v,y)]=this.data[this._idx(v,y-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(y,-1)]=this.data[this._idx(y-1,0)],this.data[this._idx(-1,y)]=this.data[this._idx(0,y-1)],this.data[this._idx(y,y)]=this.data[this._idx(y-1,y-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let v=0;v<y;v++)for(let E=0;E<y;E++){const k=this.get(v,E);k>this.max&&(this.max=k),k<this.min&&(this.min=k)}}get(e,r){const n=new Uint8Array(this.data.buffer),o=4*this._idx(e,r);return this.unpack(n[o],n[o+1],n[o+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}unpack(e,r,n){return e*this.redFactor+r*this.greenFactor+n*this.blueFactor-this.baseShift}getPixels(){return new Kr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let o=r*this.dim,p=r*this.dim+this.dim,d=n*this.dim,m=n*this.dim+this.dim;switch(r){case-1:o=p-1;break;case 1:p=o+1}switch(n){case-1:d=m-1;break;case 1:m=d+1}const y=-r*this.dim,v=-n*this.dim;for(let E=d;E<m;E++)for(let k=o;k<p;k++)this.data[this._idx(k,E)]=e.data[this._idx(k+y,E+v)]}}Ue("DEMData",Oh);class $h{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const n=e[r];this._stringToNumber[n]=r,this._numberToString[r]=n}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Nh{constructor(e,r,n,o,p){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=n,e._y=o,this.properties=e.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class Vh{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Wn(bi,16,0),this.grid3D=new Wn(bi,16,0),this.featureIndexArray=new Ce,this.promoteId=r}insert(e,r,n,o,p,d){const m=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,o,p);const y=d?this.grid3D:this.grid;for(let v=0;v<r.length;v++){const E=r[v],k=[1/0,1/0,-1/0,-1/0];for(let F=0;F<E.length;F++){const P=E[F];k[0]=Math.min(k[0],P.x),k[1]=Math.min(k[1],P.y),k[2]=Math.max(k[2],P.x),k[3]=Math.max(k[3],P.y)}k[0]<bi&&k[1]<bi&&k[2]>=0&&k[3]>=0&&y.insert(m,k[0],k[1],k[2],k[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Qn.VectorTile(new qu(this.rawTileData)).layers,this.sourceLayerCoder=new $h(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,n,o){this.loadVTLayers();const p=e.params||{},d=bi/e.tileSize/e.scale,m=ba(p.filter),y=e.queryGeometry,v=e.queryPadding*d,E=qh(y),k=this.grid.query(E.minX-v,E.minY-v,E.maxX+v,E.maxY+v),F=qh(e.cameraQueryGeometry),P=this.grid3D.query(F.minX-v,F.minY-v,F.maxX+v,F.maxY+v,(W,J,oe,te)=>function(ue,pe,Ae,Ne,He){for(const Re of ue)if(pe<=Re.x&&Ae<=Re.y&&Ne>=Re.x&&He>=Re.y)return!0;const Oe=[new Ee(pe,Ae),new Ee(pe,He),new Ee(Ne,He),new Ee(Ne,Ae)];if(ue.length>2){for(const Re of Oe)if(ao(ue,Re))return!0}for(let Re=0;Re<ue.length-1;Re++)if(Op(ue[Re],ue[Re+1],Oe))return!0;return!1}(e.cameraQueryGeometry,W-v,J-v,oe+v,te+v));for(const W of P)k.push(W);k.sort(uf);const L={};let N;for(let W=0;W<k.length;W++){const J=k[W];if(J===N)continue;N=J;const oe=this.featureIndexArray.get(J);let te=null;this.loadMatchingFeature(L,oe.bucketIndex,oe.sourceLayerIndex,oe.featureIndex,m,p.layers,p.availableImages,r,n,o,(ue,pe,Ae)=>(te||(te=Fa(ue)),pe.queryIntersectsFeature(y,ue,Ae,te,this.z,e.transform,d,e.pixelPosMatrix)))}return L}loadMatchingFeature(e,r,n,o,p,d,m,y,v,E,k){const F=this.bucketLayerIDs[r];if(d&&!function(W,J){for(let oe=0;oe<W.length;oe++)if(J.indexOf(W[oe])>=0)return!0;return!1}(d,F))return;const P=this.sourceLayerCoder.decode(n),L=this.vtLayers[P].feature(o);if(p.needGeometry){const W=Ba(L,!0);if(!p.filter(new Qt(this.tileID.overscaledZ),W,this.tileID.canonical))return}else if(!p.filter(new Qt(this.tileID.overscaledZ),L))return;const N=this.getId(L,P);for(let W=0;W<F.length;W++){const J=F[W];if(d&&d.indexOf(J)<0)continue;const oe=y[J];if(!oe)continue;let te={};N&&E&&(te=E.getState(oe.sourceLayer||"_geojsonTileLayer",N));const ue=mi({},v[J]);ue.paint=Uh(ue.paint,oe.paint,L,te,m),ue.layout=Uh(ue.layout,oe.layout,L,te,m);const pe=!k||k(L,oe,te);if(!pe)continue;const Ae=new Nh(L,this.z,this.x,this.y,N);Ae.layer=ue;let Ne=e[J];Ne===void 0&&(Ne=e[J]=[]),Ne.push({featureIndex:o,feature:Ae,intersectionZ:pe})}}lookupSymbolFeatures(e,r,n,o,p,d,m,y){const v={};this.loadVTLayers();const E=ba(p);for(const k of e)this.loadMatchingFeature(v,n,o,k,E,d,m,y,r);return v}hasLayer(e){for(const r of this.bucketLayerIDs)for(const n of r)if(e===n)return!0;return!1}getId(e,r){let n=e.id;return this.promoteId&&(n=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof n=="boolean"&&(n=Number(n))),n}}function Uh(i,e,r,n,o){return Ut(i,(p,d)=>{const m=e instanceof so?e.get(d):null;return m&&m.evaluate?m.evaluate(r,n,o):m})}function qh(i){let e=1/0,r=1/0,n=-1/0,o=-1/0;for(const p of i)e=Math.min(e,p.x),r=Math.min(r,p.y),n=Math.max(n,p.x),o=Math.max(o,p.y);return{minX:e,minY:r,maxX:n,maxY:o}}function uf(i,e){return e-i}function jh(i,e,r,n,o){const p=[];for(let d=0;d<i.length;d++){const m=i[d];let y;for(let v=0;v<m.length-1;v++){let E=m[v],k=m[v+1];E.x<e&&k.x<e||(E.x<e?E=new Ee(e,E.y+(e-E.x)/(k.x-E.x)*(k.y-E.y))._round():k.x<e&&(k=new Ee(e,E.y+(e-E.x)/(k.x-E.x)*(k.y-E.y))._round()),E.y<r&&k.y<r||(E.y<r?E=new Ee(E.x+(r-E.y)/(k.y-E.y)*(k.x-E.x),r)._round():k.y<r&&(k=new Ee(E.x+(r-E.y)/(k.y-E.y)*(k.x-E.x),r)._round()),E.x>=n&&k.x>=n||(E.x>=n?E=new Ee(n,E.y+(n-E.x)/(k.x-E.x)*(k.y-E.y))._round():k.x>=n&&(k=new Ee(n,E.y+(n-E.x)/(k.x-E.x)*(k.y-E.y))._round()),E.y>=o&&k.y>=o||(E.y>=o?E=new Ee(E.x+(o-E.y)/(k.y-E.y)*(k.x-E.x),o)._round():k.y>=o&&(k=new Ee(E.x+(o-E.y)/(k.y-E.y)*(k.x-E.x),o)._round()),y&&E.equals(y[y.length-1])||(y=[E],p.push(y)),y.push(k)))))}}return p}Ue("FeatureIndex",Vh,{omit:["rawTileData","sourceLayerCoder"]});class ra extends Ee{constructor(e,r,n,o){super(e,r),this.angle=n,o!==void 0&&(this.segment=o)}clone(){return new ra(this.x,this.y,this.angle,this.segment)}}function Zh(i,e,r,n,o){if(e.segment===void 0||r===0)return!0;let p=e,d=e.segment+1,m=0;for(;m>-r/2;){if(d--,d<0)return!1;m-=i[d].dist(p),p=i[d]}m+=i[d].dist(i[d+1]),d++;const y=[];let v=0;for(;m<r/2;){const E=i[d],k=i[d+1];if(!k)return!1;let F=i[d-1].angleTo(E)-E.angleTo(k);for(F=Math.abs((F+3*Math.PI)%(2*Math.PI)-Math.PI),y.push({distance:m,angleDelta:F}),v+=F;m-y[0].distance>n;)v-=y.shift().angleDelta;if(v>o)return!1;d++,m+=E.dist(k)}return!0}function Gh(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function Hh(i,e,r){return i?.6*e*r:0}function Wh(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function cf(i,e,r,n,o,p){const d=Hh(r,o,p),m=Wh(r,n)*p;let y=0;const v=Gh(i)/2;for(let E=0;E<i.length-1;E++){const k=i[E],F=i[E+1],P=k.dist(F);if(y+P>v){const L=(v-y)/P,N=st.number(k.x,F.x,L),W=st.number(k.y,F.y,L),J=new ra(N,W,F.angleTo(k),E);return J._round(),!d||Zh(i,J,m,d,e)?J:void 0}y+=P}}function hf(i,e,r,n,o,p,d,m,y){const v=Hh(n,p,d),E=Wh(n,o),k=E*d,F=i[0].x===0||i[0].x===y||i[0].y===0||i[0].y===y;return e-k<e/4&&(e=k+e/4),Xh(i,F?e/2*m%e:(E/2+2*p)*d*m%e,e,v,r,k,F,!1,y)}function Xh(i,e,r,n,o,p,d,m,y){const v=p/2,E=Gh(i);let k=0,F=e-r,P=[];for(let L=0;L<i.length-1;L++){const N=i[L],W=i[L+1],J=N.dist(W),oe=W.angleTo(N);for(;F+r<k+J;){F+=r;const te=(F-k)/J,ue=st.number(N.x,W.x,te),pe=st.number(N.y,W.y,te);if(ue>=0&&ue<y&&pe>=0&&pe<y&&F-v>=0&&F+v<=E){const Ae=new ra(ue,pe,oe,L);Ae._round(),n&&!Zh(i,Ae,p,n,o)||P.push(Ae)}}k+=J}return m||P.length||d||(P=Xh(i,k/2,r,n,o,p,d,!0,y)),P}Ue("Anchor",ra);const rl=Ir;function Kh(i,e,r,n){const o=[],p=i.image,d=p.pixelRatio,m=p.paddedRect.w-2*rl,y=p.paddedRect.h-2*rl,v=i.right-i.left,E=i.bottom-i.top,k=p.stretchX||[[0,m]],F=p.stretchY||[[0,y]],P=(ze,qe)=>ze+qe[1]-qe[0],L=k.reduce(P,0),N=F.reduce(P,0),W=m-L,J=y-N;let oe=0,te=L,ue=0,pe=N,Ae=0,Ne=W,He=0,Oe=J;if(p.content&&n){const ze=p.content;oe=Jl(k,0,ze[0]),ue=Jl(F,0,ze[1]),te=Jl(k,ze[0],ze[2]),pe=Jl(F,ze[1],ze[3]),Ae=ze[0]-oe,He=ze[1]-ue,Ne=ze[2]-ze[0]-te,Oe=ze[3]-ze[1]-pe}const Re=(ze,qe,Pe,Ie)=>{const tt=Ql(ze.stretch-oe,te,v,i.left),Ye=eu(ze.fixed-Ae,Ne,ze.stretch,L),mt=Ql(qe.stretch-ue,pe,E,i.top),ti=eu(qe.fixed-He,Oe,qe.stretch,N),ni=Ql(Pe.stretch-oe,te,v,i.left),Di=eu(Pe.fixed-Ae,Ne,Pe.stretch,L),Vr=Ql(Ie.stretch-ue,pe,E,i.top),xr=eu(Ie.fixed-He,Oe,Ie.stretch,N),wi=new Ee(tt,mt),Zi=new Ee(ni,mt),Ki=new Ee(ni,Vr),vr=new Ee(tt,Vr),br=new Ee(Ye/d,ti/d),Ii=new Ee(Di/d,xr/d),Fi=e*Math.PI/180;if(Fi){const nr=Math.sin(Fi),Fr=Math.cos(Fi),Br=[Fr,-nr,nr,Fr];wi._matMult(Br),Zi._matMult(Br),vr._matMult(Br),Ki._matMult(Br)}const sr=ze.stretch+ze.fixed,wr=qe.stretch+qe.fixed;return{tl:wi,tr:Zi,bl:vr,br:Ki,tex:{x:p.paddedRect.x+rl+sr,y:p.paddedRect.y+rl+wr,w:Pe.stretch+Pe.fixed-sr,h:Ie.stretch+Ie.fixed-wr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:br,pixelOffsetBR:Ii,minFontScaleX:Ne/d/v,minFontScaleY:Oe/d/E,isSDF:r}};if(n&&(p.stretchX||p.stretchY)){const ze=Yh(k,W,L),qe=Yh(F,J,N);for(let Pe=0;Pe<ze.length-1;Pe++){const Ie=ze[Pe],tt=ze[Pe+1];for(let Ye=0;Ye<qe.length-1;Ye++)o.push(Re(Ie,qe[Ye],tt,qe[Ye+1]))}}else o.push(Re({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:m+1},{fixed:0,stretch:y+1}));return o}function Jl(i,e,r){let n=0;for(const o of i)n+=Math.max(e,Math.min(r,o[1]))-Math.max(e,Math.min(r,o[0]));return n}function Yh(i,e,r){const n=[{fixed:-1,stretch:0}];for(const[o,p]of i){const d=n[n.length-1];n.push({fixed:o-d.stretch,stretch:d.stretch}),n.push({fixed:o-d.stretch,stretch:d.stretch+(p-o)})}return n.push({fixed:e+rl,stretch:r}),n}function Ql(i,e,r,n){return i/e*r+n}function eu(i,e,r,n){return i-e*r/n}class tu{constructor(e,r,n,o,p,d,m,y,v,E){if(this.boxStartIndex=e.length,v){let k=d.top,F=d.bottom;const P=d.collisionPadding;P&&(k-=P[1],F+=P[3]);let L=F-k;L>0&&(L=Math.max(10,L),this.circleDiameter=L)}else{let k=d.top*m-y[0],F=d.bottom*m+y[2],P=d.left*m-y[3],L=d.right*m+y[1];const N=d.collisionPadding;if(N&&(P-=N[0]*m,k-=N[1]*m,L+=N[2]*m,F+=N[3]*m),E){const W=new Ee(P,k),J=new Ee(L,k),oe=new Ee(P,F),te=new Ee(L,F),ue=E*Math.PI/180;W._rotate(ue),J._rotate(ue),oe._rotate(ue),te._rotate(ue),P=Math.min(W.x,J.x,oe.x,te.x),L=Math.max(W.x,J.x,oe.x,te.x),k=Math.min(W.y,J.y,oe.y,te.y),F=Math.max(W.y,J.y,oe.y,te.y)}e.emplaceBack(r.x,r.y,P,k,L,F,n,o,p)}this.boxEndIndex=e.length}}class pf{constructor(e=[],r=df){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:n}=this,o=r[e];for(;e>0;){const p=e-1>>1,d=r[p];if(n(o,d)>=0)break;r[e]=d,e=p}r[e]=o}_down(e){const{data:r,compare:n}=this,o=this.length>>1,p=r[e];for(;e<o;){let d=1+(e<<1),m=r[d];const y=d+1;if(y<this.length&&n(r[y],m)<0&&(d=y,m=r[y]),n(m,p)>=0)break;r[e]=m,e=d}r[e]=p}}function df(i,e){return i<e?-1:i>e?1:0}function ff(i,e=1,r=!1){let n=1/0,o=1/0,p=-1/0,d=-1/0;const m=i[0];for(let P=0;P<m.length;P++){const L=m[P];(!P||L.x<n)&&(n=L.x),(!P||L.y<o)&&(o=L.y),(!P||L.x>p)&&(p=L.x),(!P||L.y>d)&&(d=L.y)}const y=Math.min(p-n,d-o);let v=y/2;const E=new pf([],mf);if(y===0)return new Ee(n,o);for(let P=n;P<p;P+=y)for(let L=o;L<d;L+=y)E.push(new mo(P+v,L+v,v,i));let k=function(P){let L=0,N=0,W=0;const J=P[0];for(let oe=0,te=J.length,ue=te-1;oe<te;ue=oe++){const pe=J[oe],Ae=J[ue],Ne=pe.x*Ae.y-Ae.x*pe.y;N+=(pe.x+Ae.x)*Ne,W+=(pe.y+Ae.y)*Ne,L+=3*Ne}return new mo(N/L,W/L,0,P)}(i),F=E.length;for(;E.length;){const P=E.pop();(P.d>k.d||!k.d)&&(k=P,r&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,F)),P.max-k.d<=e||(v=P.h/2,E.push(new mo(P.p.x-v,P.p.y-v,v,i)),E.push(new mo(P.p.x+v,P.p.y-v,v,i)),E.push(new mo(P.p.x-v,P.p.y+v,v,i)),E.push(new mo(P.p.x+v,P.p.y+v,v,i)),F+=4)}return r&&(console.log(`num probes: ${F}`),console.log(`best distance: ${k.d}`)),k.p}function mf(i,e){return e.max-i.max}function mo(i,e,r,n){this.p=new Ee(i,e),this.h=r,this.d=function(o,p){let d=!1,m=1/0;for(let y=0;y<p.length;y++){const v=p[y];for(let E=0,k=v.length,F=k-1;E<k;F=E++){const P=v[E],L=v[F];P.y>o.y!=L.y>o.y&&o.x<(L.x-P.x)*(o.y-P.y)/(L.y-P.y)+P.x&&(d=!d),m=Math.min(m,Mc(o,P,L))}}return(d?1:-1)*Math.sqrt(m)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}var Xi;l.aq=void 0,(Xi=l.aq||(l.aq={}))[Xi.center=1]="center",Xi[Xi.left=2]="left",Xi[Xi.right=3]="right",Xi[Xi.top=4]="top",Xi[Xi.bottom=5]="bottom",Xi[Xi["top-left"]=6]="top-left",Xi[Xi["top-right"]=7]="top-right",Xi[Xi["bottom-left"]=8]="bottom-left",Xi[Xi["bottom-right"]=9]="bottom-right";const sa=7,ic=Number.POSITIVE_INFINITY;function Jh(i,e){return e[1]!==ic?function(r,n,o){let p=0,d=0;switch(n=Math.abs(n),o=Math.abs(o),r){case"top-right":case"top-left":case"top":d=o-sa;break;case"bottom-right":case"bottom-left":case"bottom":d=-o+sa}switch(r){case"top-right":case"bottom-right":case"right":p=-n;break;case"top-left":case"bottom-left":case"left":p=n}return[p,d]}(i,e[0],e[1]):function(r,n){let o=0,p=0;n<0&&(n=0);const d=n/Math.SQRT2;switch(r){case"top-right":case"top-left":p=d-sa;break;case"bottom-right":case"bottom-left":p=-d+sa;break;case"bottom":p=-n+sa;break;case"top":p=n-sa}switch(r){case"top-right":case"bottom-right":o=-d;break;case"top-left":case"bottom-left":o=d;break;case"left":o=n;break;case"right":o=-n}return[o,p]}(i,e[0])}function Qh(i,e,r){var n;const o=i.layout,p=(n=o.get("text-variable-anchor-offset"))===null||n===void 0?void 0:n.evaluate(e,{},r);if(p){const m=p.values,y=[];for(let v=0;v<m.length;v+=2){const E=y[v]=m[v],k=m[v+1].map(F=>F*Ti);E.startsWith("top")?k[1]-=sa:E.startsWith("bottom")&&(k[1]+=sa),y[v+1]=k}return new hr(y)}const d=o.get("text-variable-anchor");if(d){let m;m=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[o.get("text-radial-offset").evaluate(e,{},r)*Ti,ic]:o.get("text-offset").evaluate(e,{},r).map(v=>v*Ti);const y=[];for(const v of d)y.push(v,Jh(v,m));return new hr(y)}return null}function rc(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function gf(i,e,r,n,o,p,d,m,y,v,E){let k=p.textMaxSize.evaluate(e,{});k===void 0&&(k=d);const F=i.layers[0].layout,P=F.get("icon-offset").evaluate(e,{},E),L=tp(r.horizontal),N=d/24,W=i.tilePixelRatio*N,J=i.tilePixelRatio*k/24,oe=i.tilePixelRatio*m,te=i.tilePixelRatio*F.get("symbol-spacing"),ue=F.get("text-padding")*i.tilePixelRatio,pe=function(Ie,tt,Ye,mt=1){const ti=Ie.get("icon-padding").evaluate(tt,{},Ye),ni=ti&&ti.values;return[ni[0]*mt,ni[1]*mt,ni[2]*mt,ni[3]*mt]}(F,e,E,i.tilePixelRatio),Ae=F.get("text-max-angle")/180*Math.PI,Ne=F.get("text-rotation-alignment")!=="viewport"&&F.get("symbol-placement")!=="point",He=F.get("icon-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",Oe=F.get("symbol-placement"),Re=te/2,ze=F.get("icon-text-fit");let qe;n&&ze!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(qe=Ah(n,r.vertical,ze,F.get("icon-text-fit-padding"),P,N)),L&&(n=Ah(n,L,ze,F.get("icon-text-fit-padding"),P,N)));const Pe=(Ie,tt)=>{tt.x<0||tt.x>=bi||tt.y<0||tt.y>=bi||function(Ye,mt,ti,ni,Di,Vr,xr,wi,Zi,Ki,vr,br,Ii,Fi,sr,wr,nr,Fr,Br,Bi,At,ar,Yi,zi,gs){const Rs=Ye.addToLineVertexArray(mt,ti);let Os,En,_s,Jr,zr=0,Cn=0,al=0,np=0,hc=-1,pc=-1;const Sn={};let ap=vn("");if(Ye.allowVerticalPlacement&&ni.vertical){const or=wi.layout.get("text-rotate").evaluate(At,{},zi)+90;_s=new tu(Zi,mt,Ki,vr,br,ni.vertical,Ii,Fi,sr,or),xr&&(Jr=new tu(Zi,mt,Ki,vr,br,xr,nr,Fr,sr,or))}if(Di){const or=wi.layout.get("icon-rotate").evaluate(At,{}),Qr=wi.layout.get("icon-text-fit")!=="none",Ma=Kh(Di,or,Yi,Qr),Ns=xr?Kh(xr,or,Yi,Qr):void 0;En=new tu(Zi,mt,Ki,vr,br,Di,nr,Fr,!1,or),zr=4*Ma.length;const Pa=Ye.iconSizeData;let rn=null;Pa.kind==="source"?(rn=[tn*wi.layout.get("icon-size").evaluate(At,{})],rn[0]>ta&&Ai(`${Ye.layerIds[0]}: Value for "icon-size" is >= ${tl}. Reduce your "icon-size".`)):Pa.kind==="composite"&&(rn=[tn*ar.compositeIconSizes[0].evaluate(At,{},zi),tn*ar.compositeIconSizes[1].evaluate(At,{},zi)],(rn[0]>ta||rn[1]>ta)&&Ai(`${Ye.layerIds[0]}: Value for "icon-size" is >= ${tl}. Reduce your "icon-size".`)),Ye.addSymbols(Ye.icon,Ma,rn,Bi,Br,At,l.ai.none,mt,Rs.lineStartIndex,Rs.lineLength,-1,zi),hc=Ye.icon.placedSymbolArray.length-1,Ns&&(Cn=4*Ns.length,Ye.addSymbols(Ye.icon,Ns,rn,Bi,Br,At,l.ai.vertical,mt,Rs.lineStartIndex,Rs.lineLength,-1,zi),pc=Ye.icon.placedSymbolArray.length-1)}const op=Object.keys(ni.horizontal);for(const or of op){const Qr=ni.horizontal[or];if(!Os){ap=vn(Qr.text);const Ns=wi.layout.get("text-rotate").evaluate(At,{},zi);Os=new tu(Zi,mt,Ki,vr,br,Qr,Ii,Fi,sr,Ns)}const Ma=Qr.positionedLines.length===1;if(al+=ep(Ye,mt,Qr,Vr,wi,sr,At,wr,Rs,ni.vertical?l.ai.horizontal:l.ai.horizontalOnly,Ma?op:[or],Sn,hc,ar,zi),Ma)break}ni.vertical&&(np+=ep(Ye,mt,ni.vertical,Vr,wi,sr,At,wr,Rs,l.ai.vertical,["vertical"],Sn,pc,ar,zi));const xf=Os?Os.boxStartIndex:Ye.collisionBoxArray.length,vf=Os?Os.boxEndIndex:Ye.collisionBoxArray.length,bf=_s?_s.boxStartIndex:Ye.collisionBoxArray.length,wf=_s?_s.boxEndIndex:Ye.collisionBoxArray.length,Af=En?En.boxStartIndex:Ye.collisionBoxArray.length,Ef=En?En.boxEndIndex:Ye.collisionBoxArray.length,Cf=Jr?Jr.boxStartIndex:Ye.collisionBoxArray.length,Sf=Jr?Jr.boxEndIndex:Ye.collisionBoxArray.length;let $s=-1;const ru=(or,Qr)=>or&&or.circleDiameter?Math.max(or.circleDiameter,Qr):Qr;$s=ru(Os,$s),$s=ru(_s,$s),$s=ru(En,$s),$s=ru(Jr,$s);const lp=$s>-1?1:0;lp&&($s*=gs/Ti),Ye.glyphOffsetArray.length>=fo.MAX_GLYPHS&&Ai("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),At.sortKey!==void 0&&Ye.addToSortKeyRanges(Ye.symbolInstances.length,At.sortKey);const kf=Qh(wi,At,zi),[Tf,Df]=function(or,Qr){const Ma=or.length,Ns=Qr==null?void 0:Qr.values;if((Ns==null?void 0:Ns.length)>0)for(let Pa=0;Pa<Ns.length;Pa+=2){const rn=Ns[Pa+1];or.emplaceBack(l.aq[Ns[Pa]],rn[0],rn[1])}return[Ma,or.length]}(Ye.textAnchorOffsets,kf);Ye.symbolInstances.emplaceBack(mt.x,mt.y,Sn.right>=0?Sn.right:-1,Sn.center>=0?Sn.center:-1,Sn.left>=0?Sn.left:-1,Sn.vertical||-1,hc,pc,ap,xf,vf,bf,wf,Af,Ef,Cf,Sf,Ki,al,np,zr,Cn,lp,0,Ii,$s,Tf,Df)}(i,tt,Ie,r,n,o,qe,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,W,[ue,ue,ue,ue],Ne,y,oe,pe,He,P,e,p,v,E,d)};if(Oe==="line")for(const Ie of jh(e.geometry,0,0,bi,bi)){const tt=hf(Ie,te,Ae,r.vertical||L,n,24,J,i.overscaling,bi);for(const Ye of tt)L&&_f(i,L.text,Re,Ye)||Pe(Ie,Ye)}else if(Oe==="line-center"){for(const Ie of e.geometry)if(Ie.length>1){const tt=cf(Ie,Ae,r.vertical||L,n,24,J);tt&&Pe(Ie,tt)}}else if(e.type==="Polygon")for(const Ie of Pu(e.geometry,0)){const tt=ff(Ie,16);Pe(Ie[0],new ra(tt.x,tt.y,0))}else if(e.type==="LineString")for(const Ie of e.geometry)Pe(Ie,new ra(Ie[0].x,Ie[0].y,0));else if(e.type==="Point")for(const Ie of e.geometry)for(const tt of Ie)Pe([tt],new ra(tt.x,tt.y,0))}function ep(i,e,r,n,o,p,d,m,y,v,E,k,F,P,L){const N=function(oe,te,ue,pe,Ae,Ne,He,Oe){const Re=pe.layout.get("text-rotate").evaluate(Ne,{})*Math.PI/180,ze=[];for(const qe of te.positionedLines)for(const Pe of qe.positionedGlyphs){if(!Pe.rect)continue;const Ie=Pe.rect||{};let tt=Wd+1,Ye=!0,mt=1,ti=0;const ni=(Ae||Oe)&&Pe.vertical,Di=Pe.metrics.advance*Pe.scale/2;if(Oe&&te.verticalizable&&(ti=qe.lineOffset/2-(Pe.imageName?-(Ti-Pe.metrics.width*Pe.scale)/2:(Pe.scale-1)*Ti)),Pe.imageName){const Bi=He[Pe.imageName];Ye=Bi.sdf,mt=Bi.pixelRatio,tt=Ir/mt}const Vr=Ae?[Pe.x+Di,Pe.y]:[0,0];let xr=Ae?[0,0]:[Pe.x+Di+ue[0],Pe.y+ue[1]-ti],wi=[0,0];ni&&(wi=xr,xr=[0,0]);const Zi=Pe.metrics.isDoubleResolution?2:1,Ki=(Pe.metrics.left-tt)*Pe.scale-Di+xr[0],vr=(-Pe.metrics.top-tt)*Pe.scale+xr[1],br=Ki+Ie.w/Zi*Pe.scale/mt,Ii=vr+Ie.h/Zi*Pe.scale/mt,Fi=new Ee(Ki,vr),sr=new Ee(br,vr),wr=new Ee(Ki,Ii),nr=new Ee(br,Ii);if(ni){const Bi=new Ee(-Di,Di-Qo),At=-Math.PI/2,ar=Ti/2-Di,Yi=new Ee(5-Qo-ar,-(Pe.imageName?ar:0)),zi=new Ee(...wi);Fi._rotateAround(At,Bi)._add(Yi)._add(zi),sr._rotateAround(At,Bi)._add(Yi)._add(zi),wr._rotateAround(At,Bi)._add(Yi)._add(zi),nr._rotateAround(At,Bi)._add(Yi)._add(zi)}if(Re){const Bi=Math.sin(Re),At=Math.cos(Re),ar=[At,-Bi,Bi,At];Fi._matMult(ar),sr._matMult(ar),wr._matMult(ar),nr._matMult(ar)}const Fr=new Ee(0,0),Br=new Ee(0,0);ze.push({tl:Fi,tr:sr,bl:wr,br:nr,tex:Ie,writingMode:te.writingMode,glyphOffset:Vr,sectionIndex:Pe.sectionIndex,isSDF:Ye,pixelOffsetTL:Fr,pixelOffsetBR:Br,minFontScaleX:0,minFontScaleY:0})}return ze}(0,r,m,o,p,d,n,i.allowVerticalPlacement),W=i.textSizeData;let J=null;W.kind==="source"?(J=[tn*o.layout.get("text-size").evaluate(d,{})],J[0]>ta&&Ai(`${i.layerIds[0]}: Value for "text-size" is >= ${tl}. Reduce your "text-size".`)):W.kind==="composite"&&(J=[tn*P.compositeTextSizes[0].evaluate(d,{},L),tn*P.compositeTextSizes[1].evaluate(d,{},L)],(J[0]>ta||J[1]>ta)&&Ai(`${i.layerIds[0]}: Value for "text-size" is >= ${tl}. Reduce your "text-size".`)),i.addSymbols(i.text,N,J,m,p,d,v,e,y.lineStartIndex,y.lineLength,F,L);for(const oe of E)k[oe]=i.text.placedSymbolArray.length-1;return 4*N.length}function tp(i){for(const e in i)return i[e];return null}function _f(i,e,r,n){const o=i.compareText;if(e in o){const p=o[e];for(let d=p.length-1;d>=0;d--)if(n.dist(p[d])<r)return!0}else o[e]=[];return o[e].push(n),!1}const ip=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class sc{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,n]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const o=n>>4;if(o!==1)throw new Error(`Got v${o} data when expected v1.`);const p=ip[15&n];if(!p)throw new Error("Unrecognized array type.");const[d]=new Uint16Array(e,2,1),[m]=new Uint32Array(e,4,1);return new sc(m,d,p,e)}constructor(e,r=64,n=Float64Array,o){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=n,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const p=ip.indexOf(this.ArrayType),d=2*e*this.ArrayType.BYTES_PER_ELEMENT,m=e*this.IndexArrayType.BYTES_PER_ELEMENT,y=(8-m%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${n}.`);o&&o instanceof ArrayBuffer?(this.data=o,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+m+y,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+d+m+y),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+m+y,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=e,this.coords[this._pos++]=r,n}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return nc(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:d,nodeSize:m}=this,y=[0,p.length-1,0],v=[];for(;y.length;){const E=y.pop()||0,k=y.pop()||0,F=y.pop()||0;if(k-F<=m){for(let W=F;W<=k;W++){const J=d[2*W],oe=d[2*W+1];J>=e&&J<=n&&oe>=r&&oe<=o&&v.push(p[W])}continue}const P=F+k>>1,L=d[2*P],N=d[2*P+1];L>=e&&L<=n&&N>=r&&N<=o&&v.push(p[P]),(E===0?e<=L:r<=N)&&(y.push(F),y.push(P-1),y.push(1-E)),(E===0?n>=L:o>=N)&&(y.push(P+1),y.push(k),y.push(1-E))}return v}within(e,r,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:o,coords:p,nodeSize:d}=this,m=[0,o.length-1,0],y=[],v=n*n;for(;m.length;){const E=m.pop()||0,k=m.pop()||0,F=m.pop()||0;if(k-F<=d){for(let W=F;W<=k;W++)sp(p[2*W],p[2*W+1],e,r)<=v&&y.push(o[W]);continue}const P=F+k>>1,L=p[2*P],N=p[2*P+1];sp(L,N,e,r)<=v&&y.push(o[P]),(E===0?e-n<=L:r-n<=N)&&(m.push(F),m.push(P-1),m.push(1-E)),(E===0?e+n>=L:r+n>=N)&&(m.push(P+1),m.push(k),m.push(1-E))}return y}}function nc(i,e,r,n,o,p){if(o-n<=r)return;const d=n+o>>1;rp(i,e,d,n,o,p),nc(i,e,r,n,d-1,1-p),nc(i,e,r,d+1,o,1-p)}function rp(i,e,r,n,o,p){for(;o>n;){if(o-n>600){const v=o-n+1,E=r-n+1,k=Math.log(v),F=.5*Math.exp(2*k/3),P=.5*Math.sqrt(k*F*(v-F)/v)*(E-v/2<0?-1:1);rp(i,e,r,Math.max(n,Math.floor(r-E*F/v+P)),Math.min(o,Math.floor(r+(v-E)*F/v+P)),p)}const d=e[2*r+p];let m=n,y=o;for(sl(i,e,n,r),e[2*o+p]>d&&sl(i,e,n,o);m<y;){for(sl(i,e,m,y),m++,y--;e[2*m+p]<d;)m++;for(;e[2*y+p]>d;)y--}e[2*n+p]===d?sl(i,e,n,y):(y++,sl(i,e,y,o)),y<=r&&(n=y+1),r<=y&&(o=y-1)}}function sl(i,e,r,n){ac(i,r,n),ac(e,2*r,2*n),ac(e,2*r+1,2*n+1)}function ac(i,e,r){const n=i[e];i[e]=i[r],i[r]=n}function sp(i,e,r,n){const o=i-r,p=e-n;return o*o+p*p}var oc;l.bh=void 0,(oc=l.bh||(l.bh={})).create="create",oc.load="load",oc.fullLoad="fullLoad";let iu=null,nl=[];const lc=1e3/60,uc="loadTime",cc="fullLoadTime",yf={mark(i){performance.mark(i)},frame(i){const e=i;iu!=null&&nl.push(e-iu),iu=e},clearMetrics(){iu=null,nl=[],performance.clearMeasures(uc),performance.clearMeasures(cc);for(const i in l.bh)performance.clearMarks(l.bh[i])},getPerformanceMetrics(){performance.measure(uc,l.bh.create,l.bh.load),performance.measure(cc,l.bh.create,l.bh.fullLoad);const i=performance.getEntriesByName(uc)[0].duration,e=performance.getEntriesByName(cc)[0].duration,r=nl.length,n=1/(nl.reduce((p,d)=>p+d,0)/r/1e3),o=nl.filter(p=>p>lc).reduce((p,d)=>p+(d-lc)/lc,0);return{loadTime:i,fullLoadTime:e,fps:n,percentDroppedFrames:o/(r+o)*100,totalFrames:r}}};l.$=function(i,e,r){var n,o,p,d,m,y,v,E,k,F,P,L,N=r[0],W=r[1],J=r[2];return e===i?(i[12]=e[0]*N+e[4]*W+e[8]*J+e[12],i[13]=e[1]*N+e[5]*W+e[9]*J+e[13],i[14]=e[2]*N+e[6]*W+e[10]*J+e[14],i[15]=e[3]*N+e[7]*W+e[11]*J+e[15]):(o=e[1],p=e[2],d=e[3],m=e[4],y=e[5],v=e[6],E=e[7],k=e[8],F=e[9],P=e[10],L=e[11],i[0]=n=e[0],i[1]=o,i[2]=p,i[3]=d,i[4]=m,i[5]=y,i[6]=v,i[7]=E,i[8]=k,i[9]=F,i[10]=P,i[11]=L,i[12]=n*N+m*W+k*J+e[12],i[13]=o*N+y*W+F*J+e[13],i[14]=p*N+v*W+P*J+e[14],i[15]=d*N+E*W+L*J+e[15]),i},l.A=oo,l.B=st,l.C=class{constructor(i,e,r){this.receive=n=>{const o=n.data,p=o.id;if(p&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){delete this.tasks[p];const d=this.cancelCallbacks[p];delete this.cancelCallbacks[p],d&&d()}else Hi()||o.mustQueue?(this.tasks[p]=o,this.taskQueue.push(p),this.invoker.trigger()):this.processTask(p,o)},this.process=()=>{if(!this.taskQueue.length)return;const n=this.taskQueue.shift(),o=this.tasks[n];delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),o&&this.processTask(n,o)},this.target=i,this.parent=e,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new lf(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Hi()?i:window}send(i,e,r,n,o=!1){const p=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[p]=r);const d=[],m={id:p,type:i,hasCallback:!!r,targetMapId:n,mustQueue:o,sourceMapId:this.mapId,data:Js(e,d)};return this.target.postMessage(m,{transfer:d}),{cancel:()=>{r&&delete this.callbacks[p],this.target.postMessage({id:p,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}processTask(i,e){if(e.type==="<response>"){const r=this.callbacks[i];delete this.callbacks[i],r&&(e.error?r(Xn(e.error)):r(null,Xn(e.data)))}else{let r=!1;const n=[],o=e.hasCallback?(m,y)=>{r=!0,delete this.cancelCallbacks[i];const v={id:i,type:"<response>",sourceMapId:this.mapId,error:m?Js(m):null,data:Js(y,n)};this.target.postMessage(v,{transfer:n})}:m=>{r=!0};let p=null;const d=Xn(e.data);if(this.parent[e.type])p=this.parent[e.type](e.sourceMapId,d,o);else if("getWorkerSource"in this.parent){const m=e.type.split(".");p=this.parent.getWorkerSource(e.sourceMapId,m[0],d.source)[m[1]](d,o)}else o(new Error(`Could not find function ${e.type}`));!r&&p&&p.cancel&&(this.cancelCallbacks[i]=p.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.D=Je,l.E=ws,l.F=function(i,e){const r={};for(let n=0;n<e.length;n++){const o=e[n];o in i&&(r[o]=i[o])}return r},l.G=Bh,l.H=zh,l.I=Zu,l.J=Mr,l.K=Ji,l.L=ia,l.M=xs,l.N=bi,l.O=Yr,l.P=Ee,l.Q=ai,l.R=Kr,l.S=ei,l.T=Fl,l.U=Yl,l.V=class extends yn{},l.W=tc,l.X=function(i,e){const r=window.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let n=0;n<i.length;n++){const o=window.document.createElement("source");Zr(i[n])||(r.crossOrigin="Anonymous"),o.src=i[n],r.appendChild(o)}return{cancel:()=>{}}},l.Y=Be,l.Z=function(){var i=new oo(16);return oo!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},l._=_e,l.a=ys,l.a$=class extends z{},l.a0=function(i,e,r){var n=r[0],o=r[1],p=r[2];return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i[4]=e[4]*o,i[5]=e[5]*o,i[6]=e[6]*o,i[7]=e[7]*o,i[8]=e[8]*p,i[9]=e[9]*p,i[10]=e[10]*p,i[11]=e[11]*p,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},l.a1=Oc,l.a2=function(){return qs++},l.a3=G,l.a4=fo,l.a5=function(){Tr.isLoading()||Tr.isLoaded()||Bo()!=="deferred"||Il()},l.a6=ba,l.a7=Ba,l.a8=Qt,l.a9=Nh,l.aA=Sa,l.aB=function(i){i=i.slice();const e=Object.create(null);for(let r=0;r<i.length;r++)e[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=ur(i[r],e[i[r].ref]));return i},l.aC=function(i){if(i.type==="custom")return new of(i);switch(i.type){case"background":return new sf(i);case"circle":return new Vp(i);case"fill":return new od(i);case"fill-extrusion":return new wd(i);case"heatmap":return new qp(i);case"hillshade":return new Zp(i);case"line":return new Id(i);case"raster":return new af(i);case"symbol":return new Kl(i)}},l.aD=$i,l.aE=function(i,e){if(!i)return[{command:St.setStyle,args:[e]}];let r=[];try{if(!Rt(i.version,e.version))return[{command:St.setStyle,args:[e]}];Rt(i.center,e.center)||r.push({command:St.setCenter,args:[e.center]}),Rt(i.zoom,e.zoom)||r.push({command:St.setZoom,args:[e.zoom]}),Rt(i.bearing,e.bearing)||r.push({command:St.setBearing,args:[e.bearing]}),Rt(i.pitch,e.pitch)||r.push({command:St.setPitch,args:[e.pitch]}),Rt(i.sprite,e.sprite)||r.push({command:St.setSprite,args:[e.sprite]}),Rt(i.glyphs,e.glyphs)||r.push({command:St.setGlyphs,args:[e.glyphs]}),Rt(i.transition,e.transition)||r.push({command:St.setTransition,args:[e.transition]}),Rt(i.light,e.light)||r.push({command:St.setLight,args:[e.light]});const n={},o=[];(function(d,m,y,v){let E;for(E in m=m||{},d=d||{})Object.prototype.hasOwnProperty.call(d,E)&&(Object.prototype.hasOwnProperty.call(m,E)||Gs(E,y,v));for(E in m)Object.prototype.hasOwnProperty.call(m,E)&&(Object.prototype.hasOwnProperty.call(d,E)?Rt(d[E],m[E])||(d[E].type==="geojson"&&m[E].type==="geojson"&&Tn(d,m,E)?y.push({command:St.setGeoJSONSourceData,args:[E,m[E].data]}):Gr(E,m,y,v)):Ar(E,m,y))})(i.sources,e.sources,o,n);const p=[];i.layers&&i.layers.forEach(d=>{n[d.source]?r.push({command:St.removeLayer,args:[d.id]}):p.push(d)}),r=r.concat(o),function(d,m,y){m=m||[];const v=(d=d||[]).map(ss),E=m.map(ss),k=d.reduce(Es,{}),F=m.reduce(Es,{}),P=v.slice(),L=Object.create(null);let N,W,J,oe,te,ue,pe;for(N=0,W=0;N<v.length;N++)J=v[N],Object.prototype.hasOwnProperty.call(F,J)?W++:(y.push({command:St.removeLayer,args:[J]}),P.splice(P.indexOf(J,W),1));for(N=0,W=0;N<E.length;N++)J=E[E.length-1-N],P[P.length-1-N]!==J&&(Object.prototype.hasOwnProperty.call(k,J)?(y.push({command:St.removeLayer,args:[J]}),P.splice(P.lastIndexOf(J,P.length-W),1)):W++,ue=P[P.length-N],y.push({command:St.addLayer,args:[F[J],ue]}),P.splice(P.length-N,0,J),L[J]=!0);for(N=0;N<E.length;N++)if(J=E[N],oe=k[J],te=F[J],!L[J]&&!Rt(oe,te))if(Rt(oe.source,te.source)&&Rt(oe["source-layer"],te["source-layer"])&&Rt(oe.type,te.type)){for(pe in As(oe.layout,te.layout,y,J,null,St.setLayoutProperty),As(oe.paint,te.paint,y,J,null,St.setPaintProperty),Rt(oe.filter,te.filter)||y.push({command:St.setFilter,args:[J,te.filter]}),Rt(oe.minzoom,te.minzoom)&&Rt(oe.maxzoom,te.maxzoom)||y.push({command:St.setLayerZoomRange,args:[J,te.minzoom,te.maxzoom]}),oe)Object.prototype.hasOwnProperty.call(oe,pe)&&pe!=="layout"&&pe!=="paint"&&pe!=="filter"&&pe!=="metadata"&&pe!=="minzoom"&&pe!=="maxzoom"&&(pe.indexOf("paint.")===0?As(oe[pe],te[pe],y,J,pe.slice(6),St.setPaintProperty):Rt(oe[pe],te[pe])||y.push({command:St.setLayerProperty,args:[J,pe,te[pe]]}));for(pe in te)Object.prototype.hasOwnProperty.call(te,pe)&&!Object.prototype.hasOwnProperty.call(oe,pe)&&pe!=="layout"&&pe!=="paint"&&pe!=="filter"&&pe!=="metadata"&&pe!=="minzoom"&&pe!=="maxzoom"&&(pe.indexOf("paint.")===0?As(oe[pe],te[pe],y,J,pe.slice(6),St.setPaintProperty):Rt(oe[pe],te[pe])||y.push({command:St.setLayerProperty,args:[J,pe,te[pe]]}))}else y.push({command:St.removeLayer,args:[J]}),ue=P[P.lastIndexOf(J)+1],y.push({command:St.addLayer,args:[te,ue]})}(p,e.layers,r)}catch(n){console.warn("Unable to compute style diff:",n),r=[{command:St.setStyle,args:[e]}]}return r},l.aF=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},l.aG=function i(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(let n=0;n<e.length;n++)if(!i(e[n],r[n]))return!1;return!0}if(typeof e=="object"&&e!==null&&r!==null){if(typeof r!="object"||Object.keys(e).length!==Object.keys(r).length)return!1;for(const n in e)if(!i(e[n],r[n]))return!1;return!0}return e===r},l.aH=Ut,l.aI=Ur,l.aJ=ka,l.aK=function(i){return i({pluginStatus:gr,pluginURL:Qs}),ka.on("pluginStateChange",i),i},l.aL=class extends bn{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},l.aM=no,l.aN=class extends bn{constructor(i,e){super(i,e),this.current=Au}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},l.aO=Pl,l.aP=class extends bn{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},l.aQ=class extends bn{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},l.aR=Ll,l.aS=function(i,e,r,n,o,p,d){var m=1/(e-r),y=1/(n-o),v=1/(p-d);return i[0]=-2*m,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*v,i[11]=0,i[12]=(e+r)*m,i[13]=(o+n)*y,i[14]=(d+p)*v,i[15]=1,i},l.aT=zt,l.aU=Np,l.aV=class extends a{},l.aW=Md,l.aX=class extends h{},l.aY=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},l.aZ=qc,l.a_=Fe,l.aa=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,n,o,p)=>{const d=o||p;return e[n]=!d||d.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e},l.ab=function(i,e){const r=[];for(const n in i)n in e||r.push(n);return r},l.ac=function(i){if(jr==null){const e=i.navigator?i.navigator.userAgent:null;jr=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return jr},l.ad=oi,l.ae=function(i,e,r){var n=Math.sin(r),o=Math.cos(r),p=e[0],d=e[1],m=e[2],y=e[3],v=e[4],E=e[5],k=e[6],F=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=p*o+v*n,i[1]=d*o+E*n,i[2]=m*o+k*n,i[3]=y*o+F*n,i[4]=v*o-p*n,i[5]=E*o-d*n,i[6]=k*o-m*n,i[7]=F*o-y*n,i},l.af=function(i){var e=new oo(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},l.ag=Nl,l.ah=function(i,e){let r=0,n=0;if(i.kind==="constant")n=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:o,minZoom:p,maxZoom:d}=i,m=o?oi(Yt.interpolationFactor(o,e,p,d),0,1):0;i.kind==="camera"?n=st.number(i.minSize,i.maxSize,m):r=m}return{uSizeT:r,uSize:n}},l.aj=function(i,{uSize:e,uSizeT:r},{lowerSize:n,upperSize:o}){return i.kind==="source"?n/tn:i.kind==="composite"?st.number(n/tn,o/tn,r):e},l.ak=Xu,l.al=function(i,e,r,n){const o=e.y-i.y,p=e.x-i.x,d=n.y-r.y,m=n.x-r.x,y=d*p-m*o;if(y===0)return null;const v=(m*(i.y-r.y)-d*(i.x-r.x))/y;return new Ee(i.x+v*p,i.y+v*o)},l.am=jh,l.an=Bc,l.ao=Tu,l.ap=Ti,l.ar=Wu,l.as=function(i,e){var r=e[0],n=e[1],o=e[2],p=e[3],d=e[4],m=e[5],y=e[6],v=e[7],E=e[8],k=e[9],F=e[10],P=e[11],L=e[12],N=e[13],W=e[14],J=e[15],oe=r*m-n*d,te=r*y-o*d,ue=r*v-p*d,pe=n*y-o*m,Ae=n*v-p*m,Ne=o*v-p*y,He=E*N-k*L,Oe=E*W-F*L,Re=E*J-P*L,ze=k*W-F*N,qe=k*J-P*N,Pe=F*J-P*W,Ie=oe*Pe-te*qe+ue*ze+pe*Re-Ae*Oe+Ne*He;return Ie?(i[0]=(m*Pe-y*qe+v*ze)*(Ie=1/Ie),i[1]=(o*qe-n*Pe-p*ze)*Ie,i[2]=(N*Ne-W*Ae+J*pe)*Ie,i[3]=(F*Ae-k*Ne-P*pe)*Ie,i[4]=(y*Re-d*Pe-v*Oe)*Ie,i[5]=(r*Pe-o*Re+p*Oe)*Ie,i[6]=(W*ue-L*Ne-J*te)*Ie,i[7]=(E*Ne-F*ue+P*te)*Ie,i[8]=(d*qe-m*Re+v*He)*Ie,i[9]=(n*Re-r*qe-p*He)*Ie,i[10]=(L*Ae-N*ue+J*oe)*Ie,i[11]=(k*ue-E*Ae-P*oe)*Ie,i[12]=(m*Oe-d*ze-y*He)*Ie,i[13]=(r*ze-n*Oe+o*He)*Ie,i[14]=(N*te-L*pe-W*oe)*Ie,i[15]=(E*pe-k*te+F*oe)*Ie,i):null},l.at=rc,l.au=Hu,l.av=sc,l.aw=function(){const i={},e=ye.$version;for(const r in ye.$root){const n=ye.$root[r];if(n.required){let o=null;o=r==="version"?e:n.type==="array"?[]:{},o!=null&&(i[r]=o)}}return i},l.ax=St,l.ay=Sl,l.az=Tt,l.b=function(i,e){const r=new Blob([new Uint8Array(i)],{type:"image/png"});createImageBitmap(r).then(n=>{e(null,n)}).catch(n=>{e(new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},l.b0=qi,l.b1=function(i,e){var r=i[0],n=i[1],o=i[2],p=i[3],d=i[4],m=i[5],y=i[6],v=i[7],E=i[8],k=i[9],F=i[10],P=i[11],L=i[12],N=i[13],W=i[14],J=i[15],oe=e[0],te=e[1],ue=e[2],pe=e[3],Ae=e[4],Ne=e[5],He=e[6],Oe=e[7],Re=e[8],ze=e[9],qe=e[10],Pe=e[11],Ie=e[12],tt=e[13],Ye=e[14],mt=e[15];return Math.abs(r-oe)<=yr*Math.max(1,Math.abs(r),Math.abs(oe))&&Math.abs(n-te)<=yr*Math.max(1,Math.abs(n),Math.abs(te))&&Math.abs(o-ue)<=yr*Math.max(1,Math.abs(o),Math.abs(ue))&&Math.abs(p-pe)<=yr*Math.max(1,Math.abs(p),Math.abs(pe))&&Math.abs(d-Ae)<=yr*Math.max(1,Math.abs(d),Math.abs(Ae))&&Math.abs(m-Ne)<=yr*Math.max(1,Math.abs(m),Math.abs(Ne))&&Math.abs(y-He)<=yr*Math.max(1,Math.abs(y),Math.abs(He))&&Math.abs(v-Oe)<=yr*Math.max(1,Math.abs(v),Math.abs(Oe))&&Math.abs(E-Re)<=yr*Math.max(1,Math.abs(E),Math.abs(Re))&&Math.abs(k-ze)<=yr*Math.max(1,Math.abs(k),Math.abs(ze))&&Math.abs(F-qe)<=yr*Math.max(1,Math.abs(F),Math.abs(qe))&&Math.abs(P-Pe)<=yr*Math.max(1,Math.abs(P),Math.abs(Pe))&&Math.abs(L-Ie)<=yr*Math.max(1,Math.abs(L),Math.abs(Ie))&&Math.abs(N-tt)<=yr*Math.max(1,Math.abs(N),Math.abs(tt))&&Math.abs(W-Ye)<=yr*Math.max(1,Math.abs(W),Math.abs(Ye))&&Math.abs(J-mt)<=yr*Math.max(1,Math.abs(J),Math.abs(mt))},l.b2=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},l.b3=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},l.b4=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},l.b5=ts,l.b6=Rh,l.b7=Mh,l.b8=function(i,e,r,n,o){var p,d=1/Math.tan(e/2);return i[0]=d/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=d,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,o!=null&&o!==1/0?(i[10]=(o+n)*(p=1/(n-o)),i[14]=2*o*n*p):(i[10]=-1,i[14]=-2*n),i},l.b9=function(i,e,r){var n=Math.sin(r),o=Math.cos(r),p=e[4],d=e[5],m=e[6],y=e[7],v=e[8],E=e[9],k=e[10],F=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=p*o+v*n,i[5]=d*o+E*n,i[6]=m*o+k*n,i[7]=y*o+F*n,i[8]=v*o-p*n,i[9]=E*o-d*n,i[10]=k*o-m*n,i[11]=F*o-y*n,i},l.bA=Te,l.bB=ch,l.bC=pn,l.bD=Tr,l.ba=lr,l.bb=Mi,l.bc=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},l.bd=class extends Ia{},l.be=Qu,l.bf=Ph,l.bg=yf,l.bi=ct,l.bj=function(i,e,r=!1){if(gr===ko||gr===To||gr===Do)throw new Error("setRTLTextPlugin cannot be called multiple times.");Qs=je.resolveURL(i),gr=ko,Io=e,Fo(),r||Il()},l.bk=Bo,l.bl=function(i,e){const r={};for(let o=0;o<i.length;o++){const p=e&&e[i[o].id]||Gt(i[o]);e&&(e[i[o].id]=p);let d=r[p];d||(d=r[p]=[]),d.push(i[o])}const n=[];for(const o in r)n.push(r[o]);return n},l.bm=Ue,l.bn=$h,l.bo=Vh,l.bp=yh,l.bq=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=bi/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],r=e.layout,n=e._unevaluatedLayout._values,o={layoutIconSize:n["icon-size"].possiblyEvaluate(new Qt(i.bucket.zoom+1),i.canonical),layoutTextSize:n["text-size"].possiblyEvaluate(new Qt(i.bucket.zoom+1),i.canonical),textMaxSize:n["text-size"].possiblyEvaluate(new Qt(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:v,maxZoom:E}=i.bucket.textSizeData;o.compositeTextSizes=[n["text-size"].possiblyEvaluate(new Qt(v),i.canonical),n["text-size"].possiblyEvaluate(new Qt(E),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:v,maxZoom:E}=i.bucket.iconSizeData;o.compositeIconSizes=[n["icon-size"].possiblyEvaluate(new Qt(v),i.canonical),n["icon-size"].possiblyEvaluate(new Qt(E),i.canonical)]}const p=r.get("text-line-height")*Ti,d=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",m=r.get("text-keep-upright"),y=r.get("text-size");for(const v of i.bucket.features){const E=r.get("text-font").evaluate(v,{},i.canonical).join(","),k=y.evaluate(v,{},i.canonical),F=o.layoutTextSize.evaluate(v,{},i.canonical),P=o.layoutIconSize.evaluate(v,{},i.canonical),L={horizontal:{},vertical:void 0},N=v.text;let W,J=[0,0];if(N){const ue=N.toString(),pe=r.get("text-letter-spacing").evaluate(v,{},i.canonical)*Ti,Ae=Co(ue)?pe:0,Ne=r.get("text-anchor").evaluate(v,{},i.canonical),He=Qh(e,v,i.canonical);if(!He){const Pe=r.get("text-radial-offset").evaluate(v,{},i.canonical);J=Pe?Jh(Ne,[Pe*Ti,ic]):r.get("text-offset").evaluate(v,{},i.canonical).map(Ie=>Ie*Ti)}let Oe=d?"center":r.get("text-justify").evaluate(v,{},i.canonical);const Re=r.get("symbol-placement"),ze=Re==="point"?r.get("text-max-width").evaluate(v,{},i.canonical)*Ti:0,qe=()=>{i.bucket.allowVerticalPlacement&&Eo(ue)&&(L.vertical=Hl(N,i.glyphMap,i.glyphPositions,i.imagePositions,E,ze,p,Ne,"left",Ae,J,l.ai.vertical,!0,Re,F,k))};if(!d&&He){const Pe=new Set;if(Oe==="auto")for(let tt=0;tt<He.values.length;tt+=2)Pe.add(rc(He.values[tt]));else Pe.add(Oe);let Ie=!1;for(const tt of Pe)if(!L.horizontal[tt])if(Ie)L.horizontal[tt]=L.horizontal[0];else{const Ye=Hl(N,i.glyphMap,i.glyphPositions,i.imagePositions,E,ze,p,"center",tt,Ae,J,l.ai.horizontal,!1,Re,F,k);Ye&&(L.horizontal[tt]=Ye,Ie=Ye.positionedLines.length===1)}qe()}else{Oe==="auto"&&(Oe=rc(Ne));const Pe=Hl(N,i.glyphMap,i.glyphPositions,i.imagePositions,E,ze,p,Ne,Oe,Ae,J,l.ai.horizontal,!1,Re,F,k);Pe&&(L.horizontal[Oe]=Pe),qe(),Eo(ue)&&d&&m&&(L.vertical=Hl(N,i.glyphMap,i.glyphPositions,i.imagePositions,E,ze,p,Ne,Oe,Ae,J,l.ai.vertical,!1,Re,F,k))}}let oe=!1;if(v.icon&&v.icon.name){const ue=i.imageMap[v.icon.name];ue&&(W=Jd(i.imagePositions[v.icon.name],r.get("icon-offset").evaluate(v,{},i.canonical),r.get("icon-anchor").evaluate(v,{},i.canonical)),oe=!!ue.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=oe:i.bucket.sdfIcons!==oe&&Ai("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ue.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const te=tp(L.horizontal)||L.vertical;i.bucket.iconsInText=!!te&&te.iconsInText,(te||W)&&gf(i.bucket,v,L,W,i.imageMap,o,F,P,J,oe,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},l.br=Vu,l.bs=Ou,l.bt=Nu,l.bu=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},l.bv=qu,l.bw=Qn,l.bx=function(i,e,r,n,o){return _e(this,void 0,void 0,function*(){if(Ji())try{return yield xs(i,e,r,n,o)}catch{}return function(p,d,m,y,v){const E=p.width,k=p.height;Li&&Lt||(Li=new OffscreenCanvas(E,k),Lt=Li.getContext("2d",{willReadFrequently:!0})),Li.width=E,Li.height=k,Lt.drawImage(p,0,0,E,k);const F=Lt.getImageData(d,m,y,v);return Lt.clearRect(0,0,E,k),F.data}(i,e,r,n,o)})},l.by=Oh,l.bz=ee,l.c=et,l.d=function(i,e){const r=new Image;r.onload=()=>{e(null,r),URL.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame(()=>{r.src=js})},r.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const n=new Blob([new Uint8Array(i)],{type:"image/png"});r.src=i.byteLength?URL.createObjectURL(n):js},l.e=mi,l.f=function(i,e){return gi(mi(i,{type:"json"}),e)},l.g=Pt,l.h=je,l.i=Hi,l.j=rs,l.k=is,l.l=vs,l.m=gi,l.n=function(i){return new qu(i).readFields(Zd,[])},l.o=function(i,e,r){if(!i.length)return r(null,[]);let n=i.length;const o=new Array(i.length);let p=null;i.forEach((d,m)=>{e(d,(y,v)=>{y&&(p=y),o[m]=v,--n==0&&r(p,o)})})},l.p=_h,l.q=Zo,l.r=_i,l.s=Zr,l.t=xu,l.u=$e,l.v=ye,l.w=Ai,l.x=to,l.y=Ms,l.z=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}}}),H(["./shared"],function(l){class _e{constructor(D){this.keyCache={},D&&this.replace(D)}replace(D){this._layerConfigs={},this._layers={},this.update(D,[])}update(D,B){for(const Z of D){this._layerConfigs[Z.id]=Z;const X=this._layers[Z.id]=l.aC(Z);X._featureFilter=l.a6(X.filter),this.keyCache[Z.id]&&delete this.keyCache[Z.id]}for(const Z of B)delete this.keyCache[Z],delete this._layerConfigs[Z],delete this._layers[Z];this.familiesBySource={};const R=l.bl(Object.values(this._layerConfigs),this.keyCache);for(const Z of R){const X=Z.map(be=>this._layers[be.id]),le=X[0];if(le.visibility==="none")continue;const ie=le.source||"";let Y=this.familiesBySource[ie];Y||(Y=this.familiesBySource[ie]={});const se=le.sourceLayer||"_geojsonTileLayer";let xe=Y[se];xe||(xe=Y[se]=[]),xe.push(X)}}}class ee{constructor(D){const B={},R=[];for(const ie in D){const Y=D[ie],se=B[ie]={};for(const xe in Y){const be=Y[+xe];if(!be||be.bitmap.width===0||be.bitmap.height===0)continue;const ve={x:0,y:0,w:be.bitmap.width+2,h:be.bitmap.height+2};R.push(ve),se[xe]={rect:ve,metrics:be.metrics}}}const{w:Z,h:X}=l.p(R),le=new l.q({width:Z||1,height:X||1});for(const ie in D){const Y=D[ie];for(const se in Y){const xe=Y[+se];if(!xe||xe.bitmap.width===0||xe.bitmap.height===0)continue;const be=B[ie][se].rect;l.q.copy(xe.bitmap,le,{x:0,y:0},{x:be.x+1,y:be.y+1},xe.bitmap)}}this.image=le,this.positions=B}}l.bm("GlyphAtlas",ee);class Te{constructor(D){this.tileID=new l.O(D.tileID.overscaledZ,D.tileID.wrap,D.tileID.canonical.z,D.tileID.canonical.x,D.tileID.canonical.y),this.uid=D.uid,this.zoom=D.zoom,this.pixelRatio=D.pixelRatio,this.tileSize=D.tileSize,this.source=D.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=D.showCollisionBoxes,this.collectResourceTiming=!!D.collectResourceTiming,this.returnDependencies=!!D.returnDependencies,this.promoteId=D.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(D,B,R,Z,X){this.status="parsing",this.data=D,this.collisionBoxArray=new l.a3;const le=new l.bn(Object.keys(D.layers).sort()),ie=new l.bo(this.tileID,this.promoteId);ie.bucketLayerIDs=[];const Y={},se={featureIndex:ie,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:R},xe=B.familiesBySource[this.source];for(const bt in xe){const wt=D.layers[bt];if(!wt)continue;wt.version===1&&l.w(`Vector tile source "${this.source}" layer "${bt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ri=le.encode(bt),$t=[];for(let hi=0;hi<wt.length;hi++){const Ci=wt.feature(hi),cr=ie.getId(Ci,bt);$t.push({feature:Ci,id:cr,index:hi,sourceLayerIndex:Ri})}for(const hi of xe[bt]){const Ci=hi[0];Ci.source!==this.source&&l.w(`layer.source = ${Ci.source} does not equal this.source = ${this.source}`),Ci.minzoom&&this.zoom<Math.floor(Ci.minzoom)||Ci.maxzoom&&this.zoom>=Ci.maxzoom||Ci.visibility!=="none"&&(Ve(hi,this.zoom,R),(Y[Ci.id]=Ci.createBucket({index:ie.bucketLayerIDs.length,layers:hi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ri,sourceID:this.source})).populate($t,se,this.tileID.canonical),ie.bucketLayerIDs.push(hi.map(cr=>cr.id)))}}let be,ve,We,nt;const Ze=l.aH(se.glyphDependencies,bt=>Object.keys(bt).map(Number));this.inFlightDependencies.forEach(bt=>bt==null?void 0:bt.cancel()),this.inFlightDependencies=[];const Qe=++this.dependencySentinel;Object.keys(Ze).length?this.inFlightDependencies.push(Z.send("getGlyphs",{uid:this.uid,stacks:Ze,source:this.source,tileID:this.tileID,type:"glyphs"},(bt,wt)=>{Qe===this.dependencySentinel&&(be||(be=bt,ve=wt,Bt.call(this)))})):ve={};const ot=Object.keys(se.iconDependencies);ot.length?this.inFlightDependencies.push(Z.send("getImages",{icons:ot,source:this.source,tileID:this.tileID,type:"icons"},(bt,wt)=>{Qe===this.dependencySentinel&&(be||(be=bt,We=wt,Bt.call(this)))})):We={};const It=Object.keys(se.patternDependencies);function Bt(){if(be)return X(be);if(ve&&We&&nt){const bt=new ee(ve),wt=new l.bp(We,nt);for(const Ri in Y){const $t=Y[Ri];$t instanceof l.a4?(Ve($t.layers,this.zoom,R),l.bq({bucket:$t,glyphMap:ve,glyphPositions:bt.positions,imageMap:We,imagePositions:wt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):$t.hasPattern&&($t instanceof l.br||$t instanceof l.bs||$t instanceof l.bt)&&(Ve($t.layers,this.zoom,R),$t.addFeatures(se,this.tileID.canonical,wt.patternPositions))}this.status="done",X(null,{buckets:Object.values(Y).filter(Ri=>!Ri.isEmpty()),featureIndex:ie,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:bt.image,imageAtlas:wt,glyphMap:this.returnDependencies?ve:null,iconMap:this.returnDependencies?We:null,glyphPositions:this.returnDependencies?bt.positions:null})}}It.length?this.inFlightDependencies.push(Z.send("getImages",{icons:It,source:this.source,tileID:this.tileID,type:"patterns"},(bt,wt)=>{Qe===this.dependencySentinel&&(be||(be=bt,nt=wt,Bt.call(this)))})):nt={},Bt.call(this)}}function Ve(j,D,B){const R=new l.a8(D);for(const Z of j)Z.recalculate(R,B)}function Ee(j,D){const B=l.l(j.request,(R,Z,X,le)=>{if(R)D(R);else if(Z)try{const ie=new l.bw.VectorTile(new l.bv(Z));D(null,{vectorTile:ie,rawData:Z,cacheControl:X,expires:le})}catch(ie){const Y=new Uint8Array(Z);let se=`Unable to parse the tile at ${j.request.url}, `;se+=Y[0]===31&&Y[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ie.messge}`,D(new Error(se))}});return()=>{B.cancel(),D()}}class ft{constructor(D,B,R,Z){this.actor=D,this.layerIndex=B,this.availableImages=R,this.loadVectorData=Z||Ee,this.fetching={},this.loading={},this.loaded={}}loadTile(D,B){const R=D.uid;this.loading||(this.loading={});const Z=!!(D&&D.request&&D.request.collectResourceTiming)&&new l.bu(D.request),X=this.loading[R]=new Te(D);X.abort=this.loadVectorData(D,(le,ie)=>{if(delete this.loading[R],le||!ie)return X.status="done",this.loaded[R]=X,B(le);const Y=ie.rawData,se={};ie.expires&&(se.expires=ie.expires),ie.cacheControl&&(se.cacheControl=ie.cacheControl);const xe={};if(Z){const be=Z.finish();be&&(xe.resourceTiming=JSON.parse(JSON.stringify(be)))}X.vectorTile=ie.vectorTile,X.parse(ie.vectorTile,this.layerIndex,this.availableImages,this.actor,(be,ve)=>{if(delete this.fetching[R],be||!ve)return B(be);B(null,l.e({rawTileData:Y.slice(0)},ve,se,xe))}),this.loaded=this.loaded||{},this.loaded[R]=X,this.fetching[R]={rawTileData:Y,cacheControl:se,resourceTiming:xe}})}reloadTile(D,B){const R=this.loaded,Z=D.uid;if(R&&R[Z]){const X=R[Z];X.showCollisionBoxes=D.showCollisionBoxes,X.status==="parsing"?X.parse(X.vectorTile,this.layerIndex,this.availableImages,this.actor,(le,ie)=>{if(le||!ie)return B(le,ie);let Y;if(this.fetching[Z]){const{rawTileData:se,cacheControl:xe,resourceTiming:be}=this.fetching[Z];delete this.fetching[Z],Y=l.e({rawTileData:se.slice(0)},ie,xe,be)}else Y=ie;B(null,Y)}):X.status==="done"&&(X.vectorTile?X.parse(X.vectorTile,this.layerIndex,this.availableImages,this.actor,B):B())}}abortTile(D,B){const R=this.loading,Z=D.uid;R&&R[Z]&&R[Z].abort&&(R[Z].abort(),delete R[Z]),B()}removeTile(D,B){const R=this.loaded,Z=D.uid;R&&R[Z]&&delete R[Z],B()}}class ci{constructor(){this.loaded={}}loadTile(D,B){return l._(this,void 0,void 0,function*(){const{uid:R,encoding:Z,rawImageData:X,redFactor:le,greenFactor:ie,blueFactor:Y,baseShift:se}=D,xe=X.width+2,be=X.height+2,ve=l.a(X)?new l.R({width:xe,height:be},yield l.bx(X,-1,-1,xe,be)):X,We=new l.by(R,ve,Z,le,ie,Y,se);this.loaded=this.loaded||{},this.loaded[R]=We,B(null,We)})}removeTile(D){const B=this.loaded,R=D.uid;B&&B[R]&&delete B[R]}}function Vt(j,D){if(j.length!==0){Ct(j[0],D);for(var B=1;B<j.length;B++)Ct(j[B],!D)}}function Ct(j,D){for(var B=0,R=0,Z=0,X=j.length,le=X-1;Z<X;le=Z++){var ie=(j[Z][0]-j[le][0])*(j[le][1]+j[Z][1]),Y=B+ie;R+=Math.abs(B)>=Math.abs(ie)?B-Y+ie:ie-Y+B,B=Y}B+R>=0!=!!D&&j.reverse()}var vt=l.bz(function j(D,B){var R,Z=D&&D.type;if(Z==="FeatureCollection")for(R=0;R<D.features.length;R++)j(D.features[R],B);else if(Z==="GeometryCollection")for(R=0;R<D.geometries.length;R++)j(D.geometries[R],B);else if(Z==="Feature")j(D.geometry,B);else if(Z==="Polygon")Vt(D.coordinates,B);else if(Z==="MultiPolygon")for(R=0;R<D.coordinates.length;R++)Vt(D.coordinates[R],B);return D});const Mr=l.bw.VectorTileFeature.prototype.toGeoJSON;var Ji={exports:{}},lr=l.bA,Mi=l.bw.VectorTileFeature,oi=ts;function ts(j,D){this.options=D||{},this.features=j,this.length=j.length}function mi(j,D){this.id=typeof j.id=="number"?j.id:void 0,this.type=j.type,this.rawGeometry=j.type===1?[j.geometry]:j.geometry,this.properties=j.tags,this.extent=D||4096}ts.prototype.feature=function(j){return new mi(this.features[j],this.options.extent)},mi.prototype.loadGeometry=function(){var j=this.rawGeometry;this.geometry=[];for(var D=0;D<j.length;D++){for(var B=j[D],R=[],Z=0;Z<B.length;Z++)R.push(new lr(B[Z][0],B[Z][1]));this.geometry.push(R)}return this.geometry},mi.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var j=this.geometry,D=1/0,B=-1/0,R=1/0,Z=-1/0,X=0;X<j.length;X++)for(var le=j[X],ie=0;ie<le.length;ie++){var Y=le[ie];D=Math.min(D,Y.x),B=Math.max(B,Y.x),R=Math.min(R,Y.y),Z=Math.max(Z,Y.y)}return[D,R,B,Z]},mi.prototype.toGeoJSON=Mi.prototype.toGeoJSON;var qs=l.bB,Ut=oi;function Ur(j){var D=new qs;return function(B,R){for(var Z in B.layers)R.writeMessage(3,$i,B.layers[Z])}(j,D),D.finish()}function $i(j,D){var B;D.writeVarintField(15,j.version||1),D.writeStringField(1,j.name||""),D.writeVarintField(5,j.extent||4096);var R={keys:[],values:[],keycache:{},valuecache:{}};for(B=0;B<j.length;B++)R.feature=j.feature(B),D.writeMessage(2,qr,R);var Z=R.keys;for(B=0;B<Z.length;B++)D.writeStringField(3,Z[B]);var X=R.values;for(B=0;B<X.length;B++)D.writeMessage(4,jr,X[B])}function qr(j,D){var B=j.feature;B.id!==void 0&&D.writeVarintField(1,B.id),D.writeMessage(2,Ai,j),D.writeVarintField(3,B.type),D.writeMessage(4,Hi,B)}function Ai(j,D){var B=j.feature,R=j.keys,Z=j.values,X=j.keycache,le=j.valuecache;for(var ie in B.properties){var Y=B.properties[ie],se=X[ie];if(Y!==null){se===void 0&&(R.push(ie),X[ie]=se=R.length-1),D.writeVarint(se);var xe=typeof Y;xe!=="string"&&xe!=="boolean"&&xe!=="number"&&(Y=JSON.stringify(Y));var be=xe+":"+Y,ve=le[be];ve===void 0&&(Z.push(Y),le[be]=ve=Z.length-1),D.writeVarint(ve)}}}function Pi(j,D){return(D<<3)+(7&j)}function Gi(j){return j<<1^j>>31}function Hi(j,D){for(var B=j.loadGeometry(),R=j.type,Z=0,X=0,le=B.length,ie=0;ie<le;ie++){var Y=B[ie],se=1;R===1&&(se=Y.length),D.writeVarint(Pi(1,se));for(var xe=R===3?Y.length-1:Y.length,be=0;be<xe;be++){be===1&&R!==1&&D.writeVarint(Pi(2,xe-1));var ve=Y[be].x-Z,We=Y[be].y-X;D.writeVarint(Gi(ve)),D.writeVarint(Gi(We)),Z+=ve,X+=We}R===3&&D.writeVarint(Pi(7,1))}}function jr(j,D){var B=typeof j;B==="string"?D.writeStringField(1,j):B==="boolean"?D.writeBooleanField(7,j):B==="number"&&(j%1!=0?D.writeDoubleField(3,j):j<0?D.writeSVarintField(6,j):D.writeVarintField(5,j))}Ji.exports=Ur,Ji.exports.fromVectorTileJs=Ur,Ji.exports.fromGeojsonVt=function(j,D){D=D||{};var B={};for(var R in j)B[R]=new Ut(j[R].features,D),B[R].name=R,B[R].version=D.version,B[R].extent=D.extent;return Ur({layers:B})},Ji.exports.GeoJSONWrapper=Ut;var ys=l.bz(Ji.exports);const js={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:j=>j},xs=Math.fround||(Li=new Float32Array(1),j=>(Li[0]=+j,Li[0]));var Li;const Lt=3,Ei=5,Pr=6;class je{constructor(D){this.options=Object.assign(Object.create(js),D),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(D){const{log:B,minZoom:R,maxZoom:Z}=this.options;B&&console.time("total time");const X=`prepare ${D.length} points`;B&&console.time(X),this.points=D;const le=[];for(let Y=0;Y<D.length;Y++){const se=D[Y];if(!se.geometry)continue;const[xe,be]=se.geometry.coordinates,ve=xs(Tt(xe)),We=xs(Pt(be));le.push(ve,We,1/0,Y,-1,1),this.options.reduce&&le.push(0)}let ie=this.trees[Z+1]=this._createTree(le);B&&console.timeEnd(X);for(let Y=Z;Y>=R;Y--){const se=+Date.now();ie=this.trees[Y]=this._createTree(this._cluster(ie,Y)),B&&console.log("z%d: %d clusters in %dms",Y,ie.numItems,+Date.now()-se)}return B&&console.timeEnd("total time"),this}getClusters(D,B){let R=((D[0]+180)%360+360)%360-180;const Z=Math.max(-90,Math.min(90,D[1]));let X=D[2]===180?180:((D[2]+180)%360+360)%360-180;const le=Math.max(-90,Math.min(90,D[3]));if(D[2]-D[0]>=360)R=-180,X=180;else if(R>X){const be=this.getClusters([R,Z,180,le],B),ve=this.getClusters([-180,Z,X,le],B);return be.concat(ve)}const ie=this.trees[this._limitZoom(B)],Y=ie.range(Tt(R),Pt(le),Tt(X),Pt(Z)),se=ie.data,xe=[];for(const be of Y){const ve=this.stride*be;xe.push(se[ve+Ei]>1?et(se,ve,this.clusterProps):this.points[se[ve+Lt]])}return xe}getChildren(D){const B=this._getOriginId(D),R=this._getOriginZoom(D),Z="No cluster with the specified id.",X=this.trees[R];if(!X)throw new Error(Z);const le=X.data;if(B*this.stride>=le.length)throw new Error(Z);const ie=this.options.radius/(this.options.extent*Math.pow(2,R-1)),Y=X.within(le[B*this.stride],le[B*this.stride+1],ie),se=[];for(const xe of Y){const be=xe*this.stride;le[be+4]===D&&se.push(le[be+Ei]>1?et(le,be,this.clusterProps):this.points[le[be+Lt]])}if(se.length===0)throw new Error(Z);return se}getLeaves(D,B,R){const Z=[];return this._appendLeaves(Z,D,B=B||10,R=R||0,0),Z}getTile(D,B,R){const Z=this.trees[this._limitZoom(D)],X=Math.pow(2,D),{extent:le,radius:ie}=this.options,Y=ie/le,se=(R-Y)/X,xe=(R+1+Y)/X,be={features:[]};return this._addTileFeatures(Z.range((B-Y)/X,se,(B+1+Y)/X,xe),Z.data,B,R,X,be),B===0&&this._addTileFeatures(Z.range(1-Y/X,se,1,xe),Z.data,X,R,X,be),B===X-1&&this._addTileFeatures(Z.range(0,se,Y/X,xe),Z.data,-1,R,X,be),be.features.length?be:null}getClusterExpansionZoom(D){let B=this._getOriginZoom(D)-1;for(;B<=this.options.maxZoom;){const R=this.getChildren(D);if(B++,R.length!==1)break;D=R[0].properties.cluster_id}return B}_appendLeaves(D,B,R,Z,X){const le=this.getChildren(B);for(const ie of le){const Y=ie.properties;if(Y&&Y.cluster?X+Y.point_count<=Z?X+=Y.point_count:X=this._appendLeaves(D,Y.cluster_id,R,Z,X):X<Z?X++:D.push(ie),D.length===R)break}return X}_createTree(D){const B=new l.av(D.length/this.stride|0,this.options.nodeSize,Float32Array);for(let R=0;R<D.length;R+=this.stride)B.add(D[R],D[R+1]);return B.finish(),B.data=D,B}_addTileFeatures(D,B,R,Z,X,le){for(const ie of D){const Y=ie*this.stride,se=B[Y+Ei]>1;let xe,be,ve;if(se)xe=ct(B,Y,this.clusterProps),be=B[Y],ve=B[Y+1];else{const Ze=this.points[B[Y+Lt]];xe=Ze.properties;const[Qe,ot]=Ze.geometry.coordinates;be=Tt(Qe),ve=Pt(ot)}const We={type:1,geometry:[[Math.round(this.options.extent*(be*X-R)),Math.round(this.options.extent*(ve*X-Z))]],tags:xe};let nt;nt=se||this.options.generateId?B[Y+Lt]:this.points[B[Y+Lt]].id,nt!==void 0&&(We.id=nt),le.features.push(We)}}_limitZoom(D){return Math.max(this.options.minZoom,Math.min(Math.floor(+D),this.options.maxZoom+1))}_cluster(D,B){const{radius:R,extent:Z,reduce:X,minPoints:le}=this.options,ie=R/(Z*Math.pow(2,B)),Y=D.data,se=[],xe=this.stride;for(let be=0;be<Y.length;be+=xe){if(Y[be+2]<=B)continue;Y[be+2]=B;const ve=Y[be],We=Y[be+1],nt=D.within(Y[be],Y[be+1],ie),Ze=Y[be+Ei];let Qe=Ze;for(const ot of nt){const It=ot*xe;Y[It+2]>B&&(Qe+=Y[It+Ei])}if(Qe>Ze&&Qe>=le){let ot,It=ve*Ze,Bt=We*Ze,bt=-1;const wt=((be/xe|0)<<5)+(B+1)+this.points.length;for(const Ri of nt){const $t=Ri*xe;if(Y[$t+2]<=B)continue;Y[$t+2]=B;const hi=Y[$t+Ei];It+=Y[$t]*hi,Bt+=Y[$t+1]*hi,Y[$t+4]=wt,X&&(ot||(ot=this._map(Y,be,!0),bt=this.clusterProps.length,this.clusterProps.push(ot)),X(ot,this._map(Y,$t)))}Y[be+4]=wt,se.push(It/Qe,Bt/Qe,1/0,wt,-1,Qe),X&&se.push(bt)}else{for(let ot=0;ot<xe;ot++)se.push(Y[be+ot]);if(Qe>1)for(const ot of nt){const It=ot*xe;if(!(Y[It+2]<=B)){Y[It+2]=B;for(let Bt=0;Bt<xe;Bt++)se.push(Y[It+Bt])}}}}return se}_getOriginId(D){return D-this.points.length>>5}_getOriginZoom(D){return(D-this.points.length)%32}_map(D,B,R){if(D[B+Ei]>1){const le=this.clusterProps[D[B+Pr]];return R?Object.assign({},le):le}const Z=this.points[D[B+Lt]].properties,X=this.options.map(Z);return R&&X===Z?Object.assign({},X):X}}function et(j,D,B){return{type:"Feature",id:j[D+Lt],properties:ct(j,D,B),geometry:{type:"Point",coordinates:[(R=j[D],360*(R-.5)),qt(j[D+1])]}};var R}function ct(j,D,B){const R=j[D+Ei],Z=R>=1e4?`${Math.round(R/1e3)}k`:R>=1e3?Math.round(R/100)/10+"k":R,X=j[D+Pr],le=X===-1?{}:Object.assign({},B[X]);return Object.assign(le,{cluster:!0,cluster_id:j[D+Lt],point_count:R,point_count_abbreviated:Z})}function Tt(j){return j/360+.5}function Pt(j){const D=Math.sin(j*Math.PI/180),B=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return B<0?0:B>1?1:B}function qt(j){const D=(180-360*j)*Math.PI/180;return 360*Math.atan(Math.exp(D))/Math.PI-90}function gi(j,D,B,R){for(var Z,X=R,le=B-D>>1,ie=B-D,Y=j[D],se=j[D+1],xe=j[B],be=j[B+1],ve=D+3;ve<B;ve+=3){var We=vs(j[ve],j[ve+1],Y,se,xe,be);if(We>X)Z=ve,X=We;else if(We===X){var nt=Math.abs(ve-le);nt<ie&&(Z=ve,ie=nt)}}X>R&&(Z-D>3&&gi(j,D,Z,R),j[Z+2]=X,B-Z>3&&gi(j,Z,B,R))}function vs(j,D,B,R,Z,X){var le=Z-B,ie=X-R;if(le!==0||ie!==0){var Y=((j-B)*le+(D-R)*ie)/(le*le+ie*ie);Y>1?(B=Z,R=X):Y>0&&(B+=le*Y,R+=ie*Y)}return(le=j-B)*le+(ie=D-R)*ie}function Zr(j,D,B,R){var Z={id:j===void 0?null:j,type:D,geometry:B,tags:R,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(X){var le=X.geometry,ie=X.type;if(ie==="Point"||ie==="MultiPoint"||ie==="LineString")Zs(X,le);else if(ie==="Polygon"||ie==="MultiLineString")for(var Y=0;Y<le.length;Y++)Zs(X,le[Y]);else if(ie==="MultiPolygon")for(Y=0;Y<le.length;Y++)for(var se=0;se<le[Y].length;se++)Zs(X,le[Y][se])}(Z),Z}function Zs(j,D){for(var B=0;B<D.length;B+=3)j.minX=Math.min(j.minX,D[B]),j.minY=Math.min(j.minY,D[B+1]),j.maxX=Math.max(j.maxX,D[B]),j.maxY=Math.max(j.maxY,D[B+1])}function bs(j,D,B,R){if(D.geometry){var Z=D.geometry.coordinates,X=D.geometry.type,le=Math.pow(B.tolerance/((1<<B.maxZoom)*B.extent),2),ie=[],Y=D.id;if(B.promoteId?Y=D.properties[B.promoteId]:B.generateId&&(Y=R||0),X==="Point")is(Z,ie);else if(X==="MultiPoint")for(var se=0;se<Z.length;se++)is(Z[se],ie);else if(X==="LineString")rs(Z,ie,le,!1);else if(X==="MultiLineString"){if(B.lineMetrics){for(se=0;se<Z.length;se++)rs(Z[se],ie=[],le,!1),j.push(Zr(Y,"LineString",ie,D.properties));return}ws(Z,ie,le,!1)}else if(X==="Polygon")ws(Z,ie,le,!0);else{if(X!=="MultiPolygon"){if(X==="GeometryCollection"){for(se=0;se<D.geometry.geometries.length;se++)bs(j,{id:Y,geometry:D.geometry.geometries[se],properties:D.properties},B,R);return}throw new Error("Input data is not a valid GeoJSON object.")}for(se=0;se<Z.length;se++){var xe=[];ws(Z[se],xe,le,!0),ie.push(xe)}}j.push(Zr(Y,X,ie,D.properties))}}function is(j,D){D.push(ye(j[0])),D.push(Ni(j[1])),D.push(0)}function rs(j,D,B,R){for(var Z,X,le=0,ie=0;ie<j.length;ie++){var Y=ye(j[ie][0]),se=Ni(j[ie][1]);D.push(Y),D.push(se),D.push(0),ie>0&&(le+=R?(Z*se-Y*X)/2:Math.sqrt(Math.pow(Y-Z,2)+Math.pow(se-X,2))),Z=Y,X=se}var xe=D.length-3;D[2]=1,gi(D,0,xe,B),D[xe+2]=1,D.size=Math.abs(le),D.start=0,D.end=D.size}function ws(j,D,B,R){for(var Z=0;Z<j.length;Z++){var X=[];rs(j[Z],X,B,R),D.push(X)}}function ye(j){return j/360+.5}function Ni(j){var D=Math.sin(j*Math.PI/180),B=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return B<0?0:B>1?1:B}function ur(j,D,B,R,Z,X,le,ie){if(R/=D,X>=(B/=D)&&le<R)return j;if(le<B||X>=R)return null;for(var Y=[],se=0;se<j.length;se++){var xe=j[se],be=xe.geometry,ve=xe.type,We=Z===0?xe.minX:xe.minY,nt=Z===0?xe.maxX:xe.maxY;if(We>=B&&nt<R)Y.push(xe);else if(!(nt<B||We>=R)){var Ze=[];if(ve==="Point"||ve==="MultiPoint")Rt(be,Ze,B,R,Z);else if(ve==="LineString")St(be,Ze,B,R,Z,!1,ie.lineMetrics);else if(ve==="MultiLineString")Gs(be,Ze,B,R,Z,!1);else if(ve==="Polygon")Gs(be,Ze,B,R,Z,!0);else if(ve==="MultiPolygon")for(var Qe=0;Qe<be.length;Qe++){var ot=[];Gs(be[Qe],ot,B,R,Z,!0),ot.length&&Ze.push(ot)}if(Ze.length){if(ie.lineMetrics&&ve==="LineString"){for(Qe=0;Qe<Ze.length;Qe++)Y.push(Zr(xe.id,ve,Ze[Qe],xe.tags));continue}ve!=="LineString"&&ve!=="MultiLineString"||(Ze.length===1?(ve="LineString",Ze=Ze[0]):ve="MultiLineString"),ve!=="Point"&&ve!=="MultiPoint"||(ve=Ze.length===3?"Point":"MultiPoint"),Y.push(Zr(xe.id,ve,Ze,xe.tags))}}}return Y.length?Y:null}function Rt(j,D,B,R,Z){for(var X=0;X<j.length;X+=3){var le=j[X+Z];le>=B&&le<=R&&(D.push(j[X]),D.push(j[X+1]),D.push(j[X+2]))}}function St(j,D,B,R,Z,X,le){for(var ie,Y,se=Ar(j),xe=Z===0?Tn:As,be=j.start,ve=0;ve<j.length-3;ve+=3){var We=j[ve],nt=j[ve+1],Ze=j[ve+2],Qe=j[ve+3],ot=j[ve+4],It=Z===0?We:nt,Bt=Z===0?Qe:ot,bt=!1;le&&(ie=Math.sqrt(Math.pow(We-Qe,2)+Math.pow(nt-ot,2))),It<B?Bt>B&&(Y=xe(se,We,nt,Qe,ot,B),le&&(se.start=be+ie*Y)):It>R?Bt<R&&(Y=xe(se,We,nt,Qe,ot,R),le&&(se.start=be+ie*Y)):Gr(se,We,nt,Ze),Bt<B&&It>=B&&(Y=xe(se,We,nt,Qe,ot,B),bt=!0),Bt>R&&It<=R&&(Y=xe(se,We,nt,Qe,ot,R),bt=!0),!X&&bt&&(le&&(se.end=be+ie*Y),D.push(se),se=Ar(j)),le&&(be+=ie)}var wt=j.length-3;We=j[wt],nt=j[wt+1],Ze=j[wt+2],(It=Z===0?We:nt)>=B&&It<=R&&Gr(se,We,nt,Ze),wt=se.length-3,X&&wt>=3&&(se[wt]!==se[0]||se[wt+1]!==se[1])&&Gr(se,se[0],se[1],se[2]),se.length&&D.push(se)}function Ar(j){var D=[];return D.size=j.size,D.start=j.start,D.end=j.end,D}function Gs(j,D,B,R,Z,X){for(var le=0;le<j.length;le++)St(j[le],D,B,R,Z,X,!1)}function Gr(j,D,B,R){j.push(D),j.push(B),j.push(R)}function Tn(j,D,B,R,Z,X){var le=(X-D)/(R-D);return j.push(X),j.push(B+(Z-B)*le),j.push(1),le}function As(j,D,B,R,Z,X){var le=(X-B)/(Z-B);return j.push(D+(R-D)*le),j.push(X),j.push(1),le}function ss(j,D){for(var B=[],R=0;R<j.length;R++){var Z,X=j[R],le=X.type;if(le==="Point"||le==="MultiPoint"||le==="LineString")Z=Es(X.geometry,D);else if(le==="MultiLineString"||le==="Polygon"){Z=[];for(var ie=0;ie<X.geometry.length;ie++)Z.push(Es(X.geometry[ie],D))}else if(le==="MultiPolygon")for(Z=[],ie=0;ie<X.geometry.length;ie++){for(var Y=[],se=0;se<X.geometry[ie].length;se++)Y.push(Es(X.geometry[ie][se],D));Z.push(Y)}B.push(Zr(X.id,le,Z,X.tags))}return B}function Es(j,D){var B=[];B.size=j.size,j.start!==void 0&&(B.start=j.start,B.end=j.end);for(var R=0;R<j.length;R+=3)B.push(j[R]+D,j[R+1],j[R+2]);return B}function Be(j,D){if(j.transformed)return j;var B,R,Z,X=1<<j.z,le=j.x,ie=j.y;for(B=0;B<j.features.length;B++){var Y=j.features[B],se=Y.geometry,xe=Y.type;if(Y.geometry=[],xe===1)for(R=0;R<se.length;R+=2)Y.geometry.push(Er(se[R],se[R+1],D,X,le,ie));else for(R=0;R<se.length;R++){var be=[];for(Z=0;Z<se[R].length;Z+=2)be.push(Er(se[R][Z],se[R][Z+1],D,X,le,ie));Y.geometry.push(be)}}return j.transformed=!0,j}function Er(j,D,B,R,Z,X){return[Math.round(B*(j*R-Z)),Math.round(B*(D*R-X))]}function ri(j,D,B,R,Z){for(var X=D===Z.maxZoom?0:Z.tolerance/((1<<D)*Z.extent),le={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:B,y:R,z:D,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ie=0;ie<j.length;ie++){le.numFeatures++,Cs(le,j[ie],X,Z);var Y=j[ie].minX,se=j[ie].minY,xe=j[ie].maxX,be=j[ie].maxY;Y<le.minX&&(le.minX=Y),se<le.minY&&(le.minY=se),xe>le.maxX&&(le.maxX=xe),be>le.maxY&&(le.maxY=be)}return le}function Cs(j,D,B,R){var Z=D.geometry,X=D.type,le=[];if(X==="Point"||X==="MultiPoint")for(var ie=0;ie<Z.length;ie+=3)le.push(Z[ie]),le.push(Z[ie+1]),j.numPoints++,j.numSimplified++;else if(X==="LineString")Hr(le,Z,j,B,!1,!1);else if(X==="MultiLineString"||X==="Polygon")for(ie=0;ie<Z.length;ie++)Hr(le,Z[ie],j,B,X==="Polygon",ie===0);else if(X==="MultiPolygon")for(var Y=0;Y<Z.length;Y++){var se=Z[Y];for(ie=0;ie<se.length;ie++)Hr(le,se[ie],j,B,!0,ie===0)}if(le.length){var xe=D.tags||null;if(X==="LineString"&&R.lineMetrics){for(var be in xe={},D.tags)xe[be]=D.tags[be];xe.mapbox_clip_start=Z.start/Z.size,xe.mapbox_clip_end=Z.end/Z.size}var ve={geometry:le,type:X==="Polygon"||X==="MultiPolygon"?3:X==="LineString"||X==="MultiLineString"?2:1,tags:xe};D.id!==null&&(ve.id=D.id),j.features.push(ve)}}function Hr(j,D,B,R,Z,X){var le=R*R;if(R>0&&D.size<(Z?le:R))B.numPoints+=D.length/3;else{for(var ie=[],Y=0;Y<D.length;Y+=3)(R===0||D[Y+2]>le)&&(B.numSimplified++,ie.push(D[Y]),ie.push(D[Y+1])),B.numPoints++;Z&&function(se,xe){for(var be=0,ve=0,We=se.length,nt=We-2;ve<We;nt=ve,ve+=2)be+=(se[ve]-se[nt])*(se[ve+1]+se[nt+1]);if(be>0===xe)for(ve=0,We=se.length;ve<We/2;ve+=2){var Ze=se[ve],Qe=se[ve+1];se[ve]=se[We-2-ve],se[ve+1]=se[We-1-ve],se[We-2-ve]=Ze,se[We-1-ve]=Qe}}(ie,X),j.push(ie)}}function Me(j,D){var B=(D=this.options=function(Z,X){for(var le in X)Z[le]=X[le];return Z}(Object.create(this.options),D)).debug;if(B&&console.time("preprocess data"),D.maxZoom<0||D.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(D.promoteId&&D.generateId)throw new Error("promoteId and generateId cannot be used together.");var R=function(Z,X){var le=[];if(Z.type==="FeatureCollection")for(var ie=0;ie<Z.features.length;ie++)bs(le,Z.features[ie],X,ie);else bs(le,Z.type==="Feature"?Z:{geometry:Z},X);return le}(j,D);this.tiles={},this.tileCoords=[],B&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",D.indexMaxZoom,D.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),R=function(Z,X){var le=X.buffer/X.extent,ie=Z,Y=ur(Z,1,-1-le,le,0,-1,2,X),se=ur(Z,1,1-le,2+le,0,-1,2,X);return(Y||se)&&(ie=ur(Z,1,-le,1+le,0,-1,2,X)||[],Y&&(ie=ss(Y,1).concat(ie)),se&&(ie=ie.concat(ss(se,-1)))),ie}(R,D),R.length&&this.splitTile(R,0,0,0),B&&(R.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ut(j,D,B){return 32*((1<<j)*B+D)+j}function at(j,D){return D?j.properties[D]:j.id}function Vi(j,D){if(j==null)return!0;if(j.type==="Feature")return at(j,D)!=null;if(j.type==="FeatureCollection"){const B=new Set;for(const R of j.features){const Z=at(R,D);if(Z==null||B.has(Z))return!1;B.add(Z)}return!0}return!1}function Lr(j,D){const B=new Map;if(j!=null)if(j.type==="Feature")B.set(at(j,D),j);else for(const R of j.features)B.set(at(R,D),R);return B}Me.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Me.prototype.splitTile=function(j,D,B,R,Z,X,le){for(var ie=[j,D,B,R],Y=this.options,se=Y.debug;ie.length;){R=ie.pop(),B=ie.pop(),D=ie.pop(),j=ie.pop();var xe=1<<D,be=ut(D,B,R),ve=this.tiles[be];if(!ve&&(se>1&&console.time("creation"),ve=this.tiles[be]=ri(j,D,B,R,Y),this.tileCoords.push({z:D,x:B,y:R}),se)){se>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",D,B,R,ve.numFeatures,ve.numPoints,ve.numSimplified),console.timeEnd("creation"));var We="z"+D;this.stats[We]=(this.stats[We]||0)+1,this.total++}if(ve.source=j,Z){if(D===Y.maxZoom||D===Z)continue;var nt=1<<Z-D;if(B!==Math.floor(X/nt)||R!==Math.floor(le/nt))continue}else if(D===Y.indexMaxZoom||ve.numPoints<=Y.indexMaxPoints)continue;if(ve.source=null,j.length!==0){se>1&&console.time("clipping");var Ze,Qe,ot,It,Bt,bt,wt=.5*Y.buffer/Y.extent,Ri=.5-wt,$t=.5+wt,hi=1+wt;Ze=Qe=ot=It=null,Bt=ur(j,xe,B-wt,B+$t,0,ve.minX,ve.maxX,Y),bt=ur(j,xe,B+Ri,B+hi,0,ve.minX,ve.maxX,Y),j=null,Bt&&(Ze=ur(Bt,xe,R-wt,R+$t,1,ve.minY,ve.maxY,Y),Qe=ur(Bt,xe,R+Ri,R+hi,1,ve.minY,ve.maxY,Y),Bt=null),bt&&(ot=ur(bt,xe,R-wt,R+$t,1,ve.minY,ve.maxY,Y),It=ur(bt,xe,R+Ri,R+hi,1,ve.minY,ve.maxY,Y),bt=null),se>1&&console.timeEnd("clipping"),ie.push(Ze||[],D+1,2*B,2*R),ie.push(Qe||[],D+1,2*B,2*R+1),ie.push(ot||[],D+1,2*B+1,2*R),ie.push(It||[],D+1,2*B+1,2*R+1)}}},Me.prototype.getTile=function(j,D,B){var R=this.options,Z=R.extent,X=R.debug;if(j<0||j>24)return null;var le=1<<j,ie=ut(j,D=(D%le+le)%le,B);if(this.tiles[ie])return Be(this.tiles[ie],Z);X>1&&console.log("drilling down to z%d-%d-%d",j,D,B);for(var Y,se=j,xe=D,be=B;!Y&&se>0;)se--,xe=Math.floor(xe/2),be=Math.floor(be/2),Y=this.tiles[ut(se,xe,be)];return Y&&Y.source?(X>1&&console.log("found parent tile z%d-%d-%d",se,xe,be),X>1&&console.time("drilling down"),this.splitTile(Y.source,se,xe,be,j,D,B),X>1&&console.timeEnd("drilling down"),this.tiles[ie]?Be(this.tiles[ie],Z):null):null};class lt extends ft{constructor(D,B,R,Z){super(D,B,R),this._dataUpdateable=new Map,this.loadGeoJSON=(X,le)=>{const{promoteId:ie}=X;if(X.request)return l.f(X.request,(Y,se,xe,be)=>{this._dataUpdateable=Vi(se,ie)?Lr(se,ie):void 0,le(Y,se,xe,be)});if(typeof X.data=="string")try{const Y=JSON.parse(X.data);this._dataUpdateable=Vi(Y,ie)?Lr(Y,ie):void 0,le(null,Y)}catch{le(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`))}else X.dataDiff?this._dataUpdateable?(function(Y,se,xe){var be,ve,We,nt;if(se.removeAll&&Y.clear(),se.remove)for(const Ze of se.remove)Y.delete(Ze);if(se.add)for(const Ze of se.add){const Qe=at(Ze,xe);Qe!=null&&Y.set(Qe,Ze)}if(se.update)for(const Ze of se.update){let Qe=Y.get(Ze.id);if(Qe==null)continue;const ot=!Ze.removeAllProperties&&(((be=Ze.removeProperties)===null||be===void 0?void 0:be.length)>0||((ve=Ze.addOrUpdateProperties)===null||ve===void 0?void 0:ve.length)>0);if((Ze.newGeometry||Ze.removeAllProperties||ot)&&(Qe=Object.assign({},Qe),Y.set(Ze.id,Qe),ot&&(Qe.properties=Object.assign({},Qe.properties))),Ze.newGeometry&&(Qe.geometry=Ze.newGeometry),Ze.removeAllProperties)Qe.properties={};else if(((We=Ze.removeProperties)===null||We===void 0?void 0:We.length)>0)for(const It of Ze.removeProperties)Object.prototype.hasOwnProperty.call(Qe.properties,It)&&delete Qe.properties[It];if(((nt=Ze.addOrUpdateProperties)===null||nt===void 0?void 0:nt.length)>0)for(const{key:It,value:Bt}of Ze.addOrUpdateProperties)Qe.properties[It]=Bt}}(this._dataUpdateable,X.dataDiff,ie),le(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):le(new Error(`Cannot update existing geojson data in ${X.source}`)):le(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,Z&&(this.loadGeoJSON=Z)}loadGeoJSONTile(D,B){const R=D.tileID.canonical;if(!this._geoJSONIndex)return B(null,null);const Z=this._geoJSONIndex.getTile(R.z,R.x,R.y);if(!Z)return B(null,null);const X=new class{constructor(ie){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.N,this.length=ie.length,this._features=ie}feature(ie){return new class{constructor(Y){this._feature=Y,this.extent=l.N,this.type=Y.type,this.properties=Y.tags,"id"in Y&&!isNaN(Y.id)&&(this.id=parseInt(Y.id,10))}loadGeometry(){if(this._feature.type===1){const Y=[];for(const se of this._feature.geometry)Y.push([new l.P(se[0],se[1])]);return Y}{const Y=[];for(const se of this._feature.geometry){const xe=[];for(const be of se)xe.push(new l.P(be[0],be[1]));Y.push(xe)}return Y}}toGeoJSON(Y,se,xe){return Mr.call(this,Y,se,xe)}}(this._features[ie])}}(Z.features);let le=ys(X);le.byteOffset===0&&le.byteLength===le.buffer.byteLength||(le=new Uint8Array(le)),B(null,{vectorTile:X,rawData:le.buffer})}loadData(D,B){var R;(R=this._pendingRequest)===null||R===void 0||R.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const Z=!!(D&&D.request&&D.request.collectResourceTiming)&&new l.bu(D.request);this._pendingCallback=B,this._pendingRequest=this.loadGeoJSON(D,(X,le)=>{if(delete this._pendingCallback,delete this._pendingRequest,X||!le)return B(X);if(typeof le!="object")return B(new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`));{vt(le,!0);try{if(D.filter){const Y=l.bC(D.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Y.result==="error")throw new Error(Y.value.map(xe=>`${xe.key}: ${xe.message}`).join(", "));le={type:"FeatureCollection",features:le.features.filter(xe=>Y.value.evaluate({zoom:0},xe))}}this._geoJSONIndex=D.cluster?new je(function({superclusterOptions:Y,clusterProperties:se}){if(!se||!Y)return Y;const xe={},be={},ve={accumulated:null,zoom:0},We={properties:null},nt=Object.keys(se);for(const Ze of nt){const[Qe,ot]=se[Ze],It=l.bC(ot),Bt=l.bC(typeof Qe=="string"?[Qe,["accumulated"],["get",Ze]]:Qe);xe[Ze]=It.value,be[Ze]=Bt.value}return Y.map=Ze=>{We.properties=Ze;const Qe={};for(const ot of nt)Qe[ot]=xe[ot].evaluate(ve,We);return Qe},Y.reduce=(Ze,Qe)=>{We.properties=Qe;for(const ot of nt)ve.accumulated=Ze[ot],Ze[ot]=be[ot].evaluate(ve,We)},Y}(D)).load(le.features):function(Y,se){return new Me(Y,se)}(le,D.geojsonVtOptions)}catch(Y){return B(Y)}this.loaded={};const ie={};if(Z){const Y=Z.finish();Y&&(ie.resourceTiming={},ie.resourceTiming[D.source]=JSON.parse(JSON.stringify(Y)))}B(null,ie)}})}reloadTile(D,B){const R=this.loaded;return R&&R[D.uid]?super.reloadTile(D,B):this.loadTile(D,B)}removeSource(D,B){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),B()}getClusterExpansionZoom(D,B){try{B(null,this._geoJSONIndex.getClusterExpansionZoom(D.clusterId))}catch(R){B(R)}}getClusterChildren(D,B){try{B(null,this._geoJSONIndex.getChildren(D.clusterId))}catch(R){B(R)}}getClusterLeaves(D,B){try{B(null,this._geoJSONIndex.getLeaves(D.clusterId,D.limit,D.offset))}catch(R){B(R)}}}class Wr{constructor(D){this.self=D,this.actor=new l.C(D,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:ft,geojson:lt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(B,R)=>{if(this.workerSourceTypes[B])throw new Error(`Worker source with name "${B}" already registered.`);this.workerSourceTypes[B]=R},this.self.registerRTLTextPlugin=B=>{if(l.bD.isParsed())throw new Error("RTL text plugin already registered.");l.bD.applyArabicShaping=B.applyArabicShaping,l.bD.processBidirectionalText=B.processBidirectionalText,l.bD.processStyledBidirectionalText=B.processStyledBidirectionalText}}setReferrer(D,B){this.referrer=B}setImages(D,B,R){this.availableImages[D]=B;for(const Z in this.workerSources[D]){const X=this.workerSources[D][Z];for(const le in X)X[le].availableImages=B}R()}setLayers(D,B,R){this.getLayerIndex(D).replace(B),R()}updateLayers(D,B,R){this.getLayerIndex(D).update(B.layers,B.removedIds),R()}loadTile(D,B,R){this.getWorkerSource(D,B.type,B.source).loadTile(B,R)}loadDEMTile(D,B,R){this.getDEMWorkerSource(D,B.source).loadTile(B,R)}reloadTile(D,B,R){this.getWorkerSource(D,B.type,B.source).reloadTile(B,R)}abortTile(D,B,R){this.getWorkerSource(D,B.type,B.source).abortTile(B,R)}removeTile(D,B,R){this.getWorkerSource(D,B.type,B.source).removeTile(B,R)}removeDEMTile(D,B){this.getDEMWorkerSource(D,B.source).removeTile(B)}removeSource(D,B,R){if(!this.workerSources[D]||!this.workerSources[D][B.type]||!this.workerSources[D][B.type][B.source])return;const Z=this.workerSources[D][B.type][B.source];delete this.workerSources[D][B.type][B.source],Z.removeSource!==void 0?Z.removeSource(B,R):R()}loadWorkerSource(D,B,R){try{this.self.importScripts(B.url),R()}catch(Z){R(Z.toString())}}syncRTLPluginState(D,B,R){try{l.bD.setState(B);const Z=l.bD.getPluginURL();if(l.bD.isLoaded()&&!l.bD.isParsed()&&Z!=null){this.self.importScripts(Z);const X=l.bD.isParsed();R(X?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Z}`),X)}}catch(Z){R(Z.toString())}}getAvailableImages(D){let B=this.availableImages[D];return B||(B=[]),B}getLayerIndex(D){let B=this.layerIndexes[D];return B||(B=this.layerIndexes[D]=new _e),B}getWorkerSource(D,B,R){return this.workerSources[D]||(this.workerSources[D]={}),this.workerSources[D][B]||(this.workerSources[D][B]={}),this.workerSources[D][B][R]||(this.workerSources[D][B][R]=new this.workerSourceTypes[B]({send:(Z,X,le)=>{this.actor.send(Z,X,le,D)}},this.getLayerIndex(D),this.getAvailableImages(D))),this.workerSources[D][B][R]}getDEMWorkerSource(D,B){return this.demWorkerSources[D]||(this.demWorkerSources[D]={}),this.demWorkerSources[D][B]||(this.demWorkerSources[D][B]=new ci),this.demWorkerSources[D][B]}}return l.i()&&(self.worker=new Wr(self)),Wr}),H(["./shared"],function(l){var _e="3.6.2";class ee{static testProp(t){if(!ee.docStyle)return t[0];for(let s=0;s<t.length;s++)if(t[s]in ee.docStyle)return t[s];return t[0]}static create(t,s,a){const u=window.document.createElement(t);return s!==void 0&&(u.className=s),a&&a.appendChild(u),u}static createNS(t,s){return window.document.createElementNS(t,s)}static disableDrag(){ee.docStyle&&ee.selectProp&&(ee.userSelect=ee.docStyle[ee.selectProp],ee.docStyle[ee.selectProp]="none")}static enableDrag(){ee.docStyle&&ee.selectProp&&(ee.docStyle[ee.selectProp]=ee.userSelect)}static setTransform(t,s){t.style[ee.transformProp]=s}static addEventListener(t,s,a,u={}){t.addEventListener(s,a,"passive"in u?u:u.capture)}static removeEventListener(t,s,a,u={}){t.removeEventListener(s,a,"passive"in u?u:u.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",ee.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",ee.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",ee.suppressClickInternal,!0)},0)}static mousePos(t,s){const a=t.getBoundingClientRect();return new l.P(s.clientX-a.left-t.clientLeft,s.clientY-a.top-t.clientTop)}static touchPos(t,s){const a=t.getBoundingClientRect(),u=[];for(let h=0;h<s.length;h++)u.push(new l.P(s[h].clientX-a.left-t.clientLeft,s[h].clientY-a.top-t.clientTop));return u}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}ee.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,ee.selectProp=ee.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),ee.transformProp=ee.testProp(["transform","WebkitTransform"]);const Te={supported:!1,testSupport:function(c){!ft&&Ee&&(ci?Vt(c):Ve=c)}};let Ve,Ee,ft=!1,ci=!1;function Vt(c){const t=c.createTexture();c.bindTexture(c.TEXTURE_2D,t);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,Ee),c.isContextLost())return;Te.supported=!0}catch{}c.deleteTexture(t),ft=!0}var Ct,vt;typeof document<"u"&&(Ee=document.createElement("img"),Ee.onload=function(){Ve&&Vt(Ve),Ve=null,ci=!0},Ee.onerror=function(){ft=!0,Ve=null},Ee.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(c){let t,s,a,u;c.resetRequestQueue=()=>{t=[],s=0,a=0,u={}},c.addThrottleControl=b=>{const C=a++;return u[C]=b,C},c.removeThrottleControl=b=>{delete u[b],_()},c.getImage=(b,C,S=!0)=>{Te.supported&&(b.headers||(b.headers={}),b.headers.accept="image/webp,*/*");const z={requestParameters:b,supportImageRefresh:S,callback:C,cancelled:!1,completed:!1,cancel:()=>{z.completed||z.cancelled||(z.cancelled=!0,z.innerRequest&&(z.innerRequest.cancel(),s--),_())}};return t.push(z),_(),z};const h=b=>{const{requestParameters:C,supportImageRefresh:S,callback:z}=b;return l.e(C,{type:"image"}),(S!==!1||l.i()||l.g(C.url)||C.headers&&!Object.keys(C.headers).reduce((U,V)=>U&&V==="accept",!0)?l.m:x)(C,(U,V,G,O)=>{g(b,z,U,V,G,O)})},g=(b,C,S,z,U,V)=>{S?C(S):z instanceof HTMLImageElement||l.a(z)?C(null,z):z&&((G,O)=>{typeof createImageBitmap=="function"?l.b(G,O):l.d(G,O)})(z,(G,O)=>{G!=null?C(G):O!=null&&C(null,O,{cacheControl:U,expires:V})}),b.cancelled||(b.completed=!0,s--,_())},_=()=>{const b=(()=>{const C=Object.keys(u);let S=!1;if(C.length>0){for(const z of C)if(S=u[z](),S)break}return S})()?l.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let C=s;C<b&&t.length>0;C++){const S=t.shift();if(S.cancelled){C--;continue}const z=h(S);s++,S.innerRequest=z}},x=(b,C)=>{const S=new Image,z=b.url;let U=!1;const V=b.credentials;return V&&V==="include"?S.crossOrigin="use-credentials":(V&&V==="same-origin"||!l.s(z))&&(S.crossOrigin="anonymous"),S.fetchPriority="high",S.onload=()=>{C(null,S),S.onerror=S.onload=null},S.onerror=()=>{U||C(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),S.onerror=S.onload=null},S.src=z,{cancel:()=>{U=!0,S.src=""}}}}(Ct||(Ct={})),Ct.resetRequestQueue(),function(c){c.Glyphs="Glyphs",c.Image="Image",c.Source="Source",c.SpriteImage="SpriteImage",c.SpriteJSON="SpriteJSON",c.Style="Style",c.Tile="Tile",c.Unknown="Unknown"}(vt||(vt={}));class Mr{constructor(t){this._transformRequestFn=t}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}normalizeSpriteURL(t,s,a){const u=function(h){const g=h.match(Ji);if(!g)throw new Error(`Unable to parse URL "${h}"`);return{protocol:g[1],authority:g[2],path:g[3]||"/",params:g[4]?g[4].split("&"):[]}}(t);return u.path+=`${s}${a}`,function(h){const g=h.params.length?`?${h.params.join("&")}`:"";return`${h.protocol}://${h.authority}${h.path}${g}`}(u)}setTransformRequest(t){this._transformRequestFn=t}}const Ji=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function lr(c){var t=new l.A(3);return t[0]=c[0],t[1]=c[1],t[2]=c[2],t}var Mi,oi=function(c,t,s){return c[0]=t[0]-s[0],c[1]=t[1]-s[1],c[2]=t[2]-s[2],c};Mi=new l.A(3),l.A!=Float32Array&&(Mi[0]=0,Mi[1]=0,Mi[2]=0);var ts=function(c){var t=c[0],s=c[1];return t*t+s*s};function mi(c){const t=[];if(typeof c=="string")t.push({id:"default",url:c});else if(c&&c.length>0){const s=[];for(const{id:a,url:u}of c){const h=`${a}${u}`;s.indexOf(h)===-1&&(s.push(h),t.push({id:a,url:u}))}}return t}function qs(c,t,s,a,u){if(a)return void c(a);if(u!==Object.values(t).length||u!==Object.values(s).length)return;const h={};for(const g in t){h[g]={};const _=l.h.getImageCanvasContext(s[g]),x=t[g];for(const b in x){const{width:C,height:S,x:z,y:U,sdf:V,pixelRatio:G,stretchX:O,stretchY:re,content:he}=x[b];h[g][b]={data:null,pixelRatio:G,sdf:V,stretchX:O,stretchY:re,content:he,spriteData:{width:C,height:S,x:z,y:U,context:_}}}}c(null,h)}(function(){var c=new l.A(2);l.A!=Float32Array&&(c[0]=0,c[1]=0)})();class Ut{constructor(t,s,a,u){this.context=t,this.format=a,this.texture=t.gl.createTexture(),this.update(s,u)}update(t,s,a){const{width:u,height:h}=t,g=!(this.size&&this.size[0]===u&&this.size[1]===h||a),{context:_}=this,{gl:x}=_;if(this.useMipmap=!!(s&&s.useMipmap),x.bindTexture(x.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!s||s.premultiply!==!1)),g)this.size=[u,h],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||l.a(t)?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,t):x.texImage2D(x.TEXTURE_2D,0,this.format,u,h,0,this.format,x.UNSIGNED_BYTE,t.data);else{const{x:b,y:C}=a||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||l.a(t)?x.texSubImage2D(x.TEXTURE_2D,0,b,C,x.RGBA,x.UNSIGNED_BYTE,t):x.texSubImage2D(x.TEXTURE_2D,0,b,C,u,h,x.RGBA,x.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&x.generateMipmap(x.TEXTURE_2D)}bind(t,s,a){const{context:u}=this,{gl:h}=u;h.bindTexture(h.TEXTURE_2D,this.texture),a!==h.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=h.LINEAR),t!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,a||t),this.filter=t),s!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,s),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function Ur(c){const{userImage:t}=c;return!!(t&&t.render&&t.render())&&(c.data.replace(new Uint8Array(t.data.buffer)),!0)}class $i extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:s,callback:a}of this.requestors)this._notify(s,a);this.requestors=[]}}getImage(t){const s=this.images[t];if(s&&!s.data&&s.spriteData){const a=s.spriteData;s.data=new l.R({width:a.width,height:a.height},a.context.getImageData(a.x,a.y,a.width,a.height).data),s.spriteData=null}return s}addImage(t,s){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,s)&&(this.images[t]=s)}_validate(t,s){let a=!0;const u=s.data||s.spriteData;return this._validateStretch(s.stretchX,u&&u.width)||(this.fire(new l.j(new Error(`Image "${t}" has invalid "stretchX" value`))),a=!1),this._validateStretch(s.stretchY,u&&u.height)||(this.fire(new l.j(new Error(`Image "${t}" has invalid "stretchY" value`))),a=!1),this._validateContent(s.content,s)||(this.fire(new l.j(new Error(`Image "${t}" has invalid "content" value`))),a=!1),a}_validateStretch(t,s){if(!t)return!0;let a=0;for(const u of t){if(u[0]<a||u[1]<u[0]||s<u[1])return!1;a=u[1]}return!0}_validateContent(t,s){if(!t)return!0;if(t.length!==4)return!1;const a=s.spriteData,u=a&&a.width||s.data.width,h=a&&a.height||s.data.height;return!(t[0]<0||u<t[0]||t[1]<0||h<t[1]||t[2]<0||u<t[2]||t[3]<0||h<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,s,a=!0){const u=this.getImage(t);if(a&&(u.data.width!==s.data.width||u.data.height!==s.data.height))throw new Error(`size mismatch between old image (${u.data.width}x${u.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=u.version+1,this.images[t]=s,this.updatedImages[t]=!0}removeImage(t){const s=this.images[t];delete this.images[t],delete this.patterns[t],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,s){let a=!0;if(!this.isLoaded())for(const u of t)this.images[u]||(a=!1);this.isLoaded()||a?this._notify(t,s):this.requestors.push({ids:t,callback:s})}_notify(t,s){const a={};for(const u of t){let h=this.getImage(u);h||(this.fire(new l.k("styleimagemissing",{id:u})),h=this.getImage(u)),h?a[u]={data:h.data.clone(),pixelRatio:h.pixelRatio,sdf:h.sdf,version:h.version,stretchX:h.stretchX,stretchY:h.stretchY,content:h.content,hasRenderCallback:!!(h.userImage&&h.userImage.render)}:l.w(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}s(null,a)}getPixelSize(){const{width:t,height:s}=this.atlasImage;return{width:t,height:s}}getPattern(t){const s=this.patterns[t],a=this.getImage(t);if(!a)return null;if(s&&s.position.version===a.version)return s.position;if(s)s.position.version=a.version;else{const u={w:a.data.width+2,h:a.data.height+2,x:0,y:0},h=new l.I(u,a);this.patterns[t]={bin:u,position:h}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const s=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Ut(t,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const h in this.patterns)t.push(this.patterns[h].bin);const{w:s,h:a}=l.p(t),u=this.atlasImage;u.resize({width:s||1,height:a||1});for(const h in this.patterns){const{bin:g}=this.patterns[h],_=g.x+1,x=g.y+1,b=this.getImage(h).data,C=b.width,S=b.height;l.R.copy(b,u,{x:0,y:0},{x:_,y:x},{width:C,height:S}),l.R.copy(b,u,{x:0,y:S-1},{x:_,y:x-1},{width:C,height:1}),l.R.copy(b,u,{x:0,y:0},{x:_,y:x+S},{width:C,height:1}),l.R.copy(b,u,{x:C-1,y:0},{x:_-1,y:x},{width:1,height:S}),l.R.copy(b,u,{x:0,y:0},{x:_+C,y:x},{width:1,height:S})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const s of t){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const a=this.getImage(s);a||l.w(`Image with ID: "${s}" was not found`),Ur(a)&&this.updateImage(s,a)}}}const qr=1e20;function Ai(c,t,s,a,u,h,g,_,x){for(let b=t;b<t+a;b++)Pi(c,s*h+b,h,u,g,_,x);for(let b=s;b<s+u;b++)Pi(c,b*h+t,1,a,g,_,x)}function Pi(c,t,s,a,u,h,g){h[0]=0,g[0]=-1e20,g[1]=qr,u[0]=c[t];for(let _=1,x=0,b=0;_<a;_++){u[_]=c[t+_*s];const C=_*_;do{const S=h[x];b=(u[_]-u[S]+C-S*S)/(_-S)/2}while(b<=g[x]&&--x>-1);x++,h[x]=_,g[x]=b,g[x+1]=qr}for(let _=0,x=0;_<a;_++){for(;g[x+1]<_;)x++;const b=h[x],C=_-b;c[t+_*s]=u[b]+C*C}}class Gi{constructor(t,s){this.requestManager=t,this.localIdeographFontFamily=s,this.entries={}}setURL(t){this.url=t}getGlyphs(t,s){const a=[];for(const u in t)for(const h of t[u])a.push({stack:u,id:h});l.o(a,({stack:u,id:h},g)=>{let _=this.entries[u];_||(_=this.entries[u]={glyphs:{},requests:{},ranges:{}});let x=_.glyphs[h];if(x!==void 0)return void g(null,{stack:u,id:h,glyph:x});if(x=this._tinySDF(_,u,h),x)return _.glyphs[h]=x,void g(null,{stack:u,id:h,glyph:x});const b=Math.floor(h/256);if(256*b>65535)return void g(new Error("glyphs > 65535 not supported"));if(_.ranges[b])return void g(null,{stack:u,id:h,glyph:x});if(!this.url)return void g(new Error("glyphsUrl is not set"));let C=_.requests[b];C||(C=_.requests[b]=[],Gi.loadGlyphRange(u,b,this.url,this.requestManager,(S,z)=>{if(z){for(const U in z)this._doesCharSupportLocalGlyph(+U)||(_.glyphs[+U]=z[+U]);_.ranges[b]=!0}for(const U of C)U(S,z);delete _.requests[b]})),C.push((S,z)=>{S?g(S):z&&g(null,{stack:u,id:h,glyph:z[h]||null})})},(u,h)=>{if(u)s(u);else if(h){const g={};for(const{stack:_,id:x,glyph:b}of h)(g[_]||(g[_]={}))[x]=b&&{id:b.id,bitmap:b.bitmap.clone(),metrics:b.metrics};s(null,g)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(l.u["CJK Unified Ideographs"](t)||l.u["Hangul Syllables"](t)||l.u.Hiragana(t)||l.u.Katakana(t))}_tinySDF(t,s,a){const u=this.localIdeographFontFamily;if(!u||!this._doesCharSupportLocalGlyph(a))return;let h=t.tinySDF;if(!h){let _="400";/bold/i.test(s)?_="900":/medium/i.test(s)?_="500":/light/i.test(s)&&(_="200"),h=t.tinySDF=new Gi.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:u,fontWeight:_})}const g=h.draw(String.fromCharCode(a));return{id:a,bitmap:new l.q({width:g.width||60,height:g.height||60},g.data),metrics:{width:g.glyphWidth/2||24,height:g.glyphHeight/2||24,left:g.glyphLeft/2+.5||0,top:g.glyphTop/2-27.5||-8,advance:g.glyphAdvance/2||24,isDoubleResolution:!0}}}}Gi.loadGlyphRange=function(c,t,s,a,u){const h=256*t,g=h+255,_=a.transformRequest(s.replace("{fontstack}",c).replace("{range}",`${h}-${g}`),vt.Glyphs);l.l(_,(x,b)=>{if(x)u(x);else if(b){const C={};for(const S of l.n(b))C[S.id]=S;u(null,C)}})},Gi.TinySDF=class{constructor({fontSize:c=24,buffer:t=3,radius:s=8,cutoff:a=.25,fontFamily:u="sans-serif",fontWeight:h="normal",fontStyle:g="normal"}={}){this.buffer=t,this.cutoff=a,this.radius=s;const _=this.size=c+4*t,x=this._createCanvas(_),b=this.ctx=x.getContext("2d",{willReadFrequently:!0});b.font=`${g} ${h} ${c}px ${u}`,b.textBaseline="alphabetic",b.textAlign="left",b.fillStyle="black",this.gridOuter=new Float64Array(_*_),this.gridInner=new Float64Array(_*_),this.f=new Float64Array(_),this.z=new Float64Array(_+1),this.v=new Uint16Array(_)}_createCanvas(c){const t=document.createElement("canvas");return t.width=t.height=c,t}draw(c){const{width:t,actualBoundingBoxAscent:s,actualBoundingBoxDescent:a,actualBoundingBoxLeft:u,actualBoundingBoxRight:h}=this.ctx.measureText(c),g=Math.ceil(s),_=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-u))),x=Math.min(this.size-this.buffer,g+Math.ceil(a)),b=_+2*this.buffer,C=x+2*this.buffer,S=Math.max(b*C,0),z=new Uint8ClampedArray(S),U={data:z,width:b,height:C,glyphWidth:_,glyphHeight:x,glyphTop:g,glyphLeft:0,glyphAdvance:t};if(_===0||x===0)return U;const{ctx:V,buffer:G,gridInner:O,gridOuter:re}=this;V.clearRect(G,G,_,x),V.fillText(c,G,G+g);const he=V.getImageData(G,G,_,x);re.fill(qr,0,S),O.fill(0,0,S);for(let K=0;K<x;K++)for(let ae=0;ae<_;ae++){const de=he.data[4*(K*_+ae)+3]/255;if(de===0)continue;const fe=(K+G)*b+ae+G;if(de===1)re[fe]=0,O[fe]=qr;else{const we=.5-de;re[fe]=we>0?we*we:0,O[fe]=we<0?we*we:0}}Ai(re,0,0,b,C,b,this.f,this.v,this.z),Ai(O,G,G,_,x,b,this.f,this.v,this.z);for(let K=0;K<S;K++){const ae=Math.sqrt(re[K])-Math.sqrt(O[K]);z[K]=Math.round(255-255*(ae/this.radius+this.cutoff))}return U}};class Hi{constructor(){this.specification=l.v.light.position}possiblyEvaluate(t,s){return l.z(t.expression.evaluate(s))}interpolate(t,s,a){return{x:l.B.number(t.x,s.x,a),y:l.B.number(t.y,s.y,a),z:l.B.number(t.z,s.z,a)}}}let jr;class ys extends l.E{constructor(t){super(),jr=jr||new l.r({anchor:new l.D(l.v.light.anchor),position:new Hi,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.T(jr),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s={}){if(!this._validate(l.t,t,s))for(const a in t){const u=t[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),u):this._transitionable.setValue(a,u)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,a){return(!a||a.validate!==!1)&&l.x(this,t.call(l.y,l.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:l.v})))}}class js{constructor(t,s){this.width=t,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,s){const a=t.join(",")+String(s);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(t,s)),this.dashEntry[a]}getDashRanges(t,s,a){const u=[];let h=t.length%2==1?-t[t.length-1]*a:0,g=t[0]*a,_=!0;u.push({left:h,right:g,isDash:_,zeroLength:t[0]===0});let x=t[0];for(let b=1;b<t.length;b++){_=!_;const C=t[b];h=x*a,x+=C,g=x*a,u.push({left:h,right:g,isDash:_,zeroLength:C===0})}return u}addRoundDash(t,s,a){const u=s/2;for(let h=-a;h<=a;h++){const g=this.width*(this.nextRow+a+h);let _=0,x=t[_];for(let b=0;b<this.width;b++){b/x.right>1&&(x=t[++_]);const C=Math.abs(b-x.left),S=Math.abs(b-x.right),z=Math.min(C,S);let U;const V=h/a*(u+1);if(x.isDash){const G=u-Math.abs(V);U=Math.sqrt(z*z+G*G)}else U=u-Math.sqrt(z*z+V*V);this.data[g+b]=Math.max(0,Math.min(255,U+128))}}}addRegularDash(t){for(let _=t.length-1;_>=0;--_){const x=t[_],b=t[_+1];x.zeroLength?t.splice(_,1):b&&b.isDash===x.isDash&&(b.left=x.left,t.splice(_,1))}const s=t[0],a=t[t.length-1];s.isDash===a.isDash&&(s.left=a.left-this.width,a.right=s.right+this.width);const u=this.width*this.nextRow;let h=0,g=t[h];for(let _=0;_<this.width;_++){_/g.right>1&&(g=t[++h]);const x=Math.abs(_-g.left),b=Math.abs(_-g.right),C=Math.min(x,b);this.data[u+_]=Math.max(0,Math.min(255,(g.isDash?C:-C)+128))}}addDash(t,s){const a=s?7:0,u=2*a+1;if(this.nextRow+u>this.height)return l.w("LineAtlas out of space"),null;let h=0;for(let _=0;_<t.length;_++)h+=t[_];if(h!==0){const _=this.width/h,x=this.getDashRanges(t,this.width,_);s?this.addRoundDash(x,_,a):this.addRegularDash(x)}const g={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:h};return this.nextRow+=u,this.dirty=!0,g}bind(t){const s=t.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}class xs{constructor(t,s,a){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=a;const u=this.workerPool.acquire(a);for(let h=0;h<u.length;h++){const g=new l.C(u[h],s,a);g.name=`Worker ${h}`,this.actors.push(g)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,s,a){l.o(this.actors,(u,h)=>{u.send(t,s,h)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(s=>{s.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}}function Li(c,t,s){const a=function(u,h){if(u)return s(u);if(h){const g=l.F(l.e(h,c),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);h.vector_layers&&(g.vectorLayers=h.vector_layers,g.vectorLayerIds=g.vectorLayers.map(_=>_.id)),s(null,g)}};return c.url?l.f(t.transformRequest(c.url,vt.Source),a):l.h.frame(()=>a(null,c))}class Lt{constructor(t,s){t&&(s?this.setSouthWest(t).setNorthEast(s):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof l.L?new l.L(t.lng,t.lat):l.L.convert(t),this}setSouthWest(t){return this._sw=t instanceof l.L?new l.L(t.lng,t.lat):l.L.convert(t),this}extend(t){const s=this._sw,a=this._ne;let u,h;if(t instanceof l.L)u=t,h=t;else{if(!(t instanceof Lt))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Lt.convert(t)):this.extend(l.L.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(l.L.convert(t)):this;if(u=t._sw,h=t._ne,!u||!h)return this}return s||a?(s.lng=Math.min(u.lng,s.lng),s.lat=Math.min(u.lat,s.lat),a.lng=Math.max(h.lng,a.lng),a.lat=Math.max(h.lat,a.lat)):(this._sw=new l.L(u.lng,u.lat),this._ne=new l.L(h.lng,h.lat)),this}getCenter(){return new l.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.L(this.getWest(),this.getNorth())}getSouthEast(){return new l.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:s,lat:a}=l.L.convert(t);let u=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&u}static convert(t){return t instanceof Lt?t:t&&new Lt(t)}static fromLngLat(t,s=0){const a=360*s/40075017,u=a/Math.cos(Math.PI/180*t.lat);return new Lt(new l.L(t.lng-u,t.lat-a),new l.L(t.lng+u,t.lat+a))}}class Ei{constructor(t,s,a){this.bounds=Lt.convert(this.validateBounds(t)),this.minzoom=s||0,this.maxzoom=a||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const s=Math.pow(2,t.z),a=Math.floor(l.G(this.bounds.getWest())*s),u=Math.floor(l.H(this.bounds.getNorth())*s),h=Math.ceil(l.G(this.bounds.getEast())*s),g=Math.ceil(l.H(this.bounds.getSouth())*s);return t.x>=a&&t.x<h&&t.y>=u&&t.y<g}}class Pr extends l.E{constructor(t,s,a,u){if(super(),this.load=()=>{this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Li(this._options,this.map._requestManager,(h,g)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),h?this.fire(new l.j(h)):g&&(l.e(this,g),g.bounds&&(this.tileBounds=new Ei(g.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>l.e({},this._options),this.id=t,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.F(s,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(u)}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(t,s){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(a,vt.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function h(g,_){return delete t.request,t.aborted?s(null):g&&g.status!==404?s(g):(_&&_.resourceTiming&&(t.resourceTiming=_.resourceTiming),this.map._refreshExpiredTiles&&_&&t.setExpiryData(_),t.loadVectorData(_,this.map.painter),s(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}u.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=s:t.request=t.actor.send("reloadTile",u,h.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",u,h.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class je extends l.E{constructor(t,s,a,u){super(),this.id=t,this.dispatcher=a,this.setEventedParent(u),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},s),l.e(this,l.F(s,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Li(this._options,this.map._requestManager,(t,s)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new l.j(t)):s&&(l.e(this,s),s.bounds&&(this.tileBounds=new Ei(s.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}serialize(){return l.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,s){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=Ct.getImage(this.map._requestManager.transformRequest(a,vt.Tile),(u,h,g)=>{if(delete t.request,t.aborted)t.state="unloaded",s(null);else if(u)t.state="errored",s(u);else if(h){this.map._refreshExpiredTiles&&g&&t.setExpiryData(g);const _=this.map.painter.context,x=_.gl;t.texture=this.map.painter.getTileTexture(h.width),t.texture?t.texture.update(h,{useMipmap:!0}):(t.texture=new Ut(_,h,x.RGBA,{useMipmap:!0}),t.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST),_.extTextureFilterAnisotropic&&x.texParameterf(x.TEXTURE_2D,_.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,_.extTextureFilterAnisotropicMax)),t.state="loaded",s(null)}},this.map._refreshExpiredTiles)}abortTile(t,s){t.request&&(t.request.cancel(),delete t.request),s()}unloadTile(t,s){t.texture&&this.map.painter.saveTileTexture(t.texture),s()}hasTransition(){return!1}}class et extends je{constructor(t,s,a,u){super(t,s,a,u),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox",this.redFactor=s.redFactor,this.greenFactor=s.greenFactor,this.blueFactor=s.blueFactor,this.baseShift=s.baseShift}loadTile(t,s){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u=this.map._requestManager.transformRequest(a,vt.Tile);function h(g,_){g&&(t.state="errored",s(g)),_&&(t.dem=_,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",s(null))}t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.request=Ct.getImage(u,(g,_,x)=>l._(this,void 0,void 0,function*(){if(delete t.request,t.aborted)t.state="unloaded",s(null);else if(g)t.state="errored",s(g);else if(_){this.map._refreshExpiredTiles&&t.setExpiryData(x);const b=l.a(_)&&l.J()?_:yield function(S){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.K()){const z=S.width+2,U=S.height+2;try{return new l.R({width:z,height:U},yield l.M(S,-1,-1,z,U))}catch{}}return l.h.getImageData(S,1)})}(_),C={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:b,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",C,h))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(t){const s=t.canonical,a=Math.pow(2,s.z),u=(s.x-1+a)%a,h=s.x===0?t.wrap-1:t.wrap,g=(s.x+1+a)%a,_=s.x+1===a?t.wrap+1:t.wrap,x={};return x[new l.O(t.overscaledZ,h,s.z,u,s.y).key]={backfilled:!1},x[new l.O(t.overscaledZ,_,s.z,g,s.y).key]={backfilled:!1},s.y>0&&(x[new l.O(t.overscaledZ,h,s.z,u,s.y-1).key]={backfilled:!1},x[new l.O(t.overscaledZ,t.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},x[new l.O(t.overscaledZ,_,s.z,g,s.y-1).key]={backfilled:!1}),s.y+1<a&&(x[new l.O(t.overscaledZ,h,s.z,u,s.y+1).key]={backfilled:!1},x[new l.O(t.overscaledZ,t.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},x[new l.O(t.overscaledZ,_,s.z,g,s.y+1).key]={backfilled:!1}),x}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class ct extends l.E{constructor(t,s,a,u){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>l.e({},this._options,{type:this.type,data:this._data}),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=a.getActor(),this.setEventedParent(u),this._data=s.data,this._options=l.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const h=l.N/this.tileSize;this.workerOptions=l.e({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*h,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*h,extent:l.N,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:l.N,radius:(s.clusterRadius||50)*h,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},s),this}getClusterChildren(t,s){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},s),this}getClusterLeaves(t,s,a,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:s,offset:a},u),this}_updateWorkerData(t){const s=l.e({},this.workerOptions);t?s.dataDiff=t:typeof this._data=="string"?(s.request=this.map._requestManager.transformRequest(l.h.resolveURL(this._data),vt.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,s,(a,u)=>{if(this._pendingLoads--,this._removed||u&&u.abandoned)return void this.fire(new l.k("dataabort",{dataType:"source"}));let h=null;if(u&&u.resourceTiming&&u.resourceTiming[this.id]&&(h=u.resourceTiming[this.id].slice(0)),a)return void this.fire(new l.j(a));const g={dataType:"source"};this._collectResourceTiming&&h&&h.length>0&&l.e(g,{resourceTiming:h}),this.fire(new l.k("data",Object.assign(Object.assign({},g),{sourceDataType:"metadata"}))),this.fire(new l.k("data",Object.assign(Object.assign({},g),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(t,s){const a=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const u={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(a,u,(h,g)=>(delete t.request,t.unloadVectorData(),t.aborted?s(null):h?s(h):(t.loadVectorData(g,this.map.painter,a==="reloadTile"),s(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var Tt=l.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Pt extends l.E{constructor(t,s,a,u){super(),this.load=(h,g)=>{this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=Ct.getImage(this.map._requestManager.transformRequest(this.url,vt.Image),(_,x)=>{this._request=null,this._loaded=!0,_?this.fire(new l.j(_)):x&&(this.image=x,h&&(this.coordinates=h),g&&g(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const h=this.map.painter.context,g=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,Tt.members)),this.boundsSegments||(this.boundsSegments=l.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Ut(h,this.image,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE));let _=!1;for(const x in this.tiles){const b=this.tiles[x];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,_=!0)}_&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=t,this.dispatcher=a,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(u),this.options=s}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(t){this.coordinates=t;const s=t.map(l.U.fromLngLat);this.tileID=function(u){let h=1/0,g=1/0,_=-1/0,x=-1/0;for(const z of u)h=Math.min(h,z.x),g=Math.min(g,z.y),_=Math.max(_,z.x),x=Math.max(x,z.y);const b=Math.max(_-h,x-g),C=Math.max(0,Math.floor(-Math.log(b)/Math.LN2)),S=Math.pow(2,C);return new l.W(C,Math.floor((h+_)/2*S),Math.floor((g+x)/2*S))}(s),this.minzoom=this.maxzoom=this.tileID.z;const a=s.map(u=>this.tileID.getTilePoint(u)._round());return this._boundsArray=new l.V,this._boundsArray.emplaceBack(a[0].x,a[0].y,0,0),this._boundsArray.emplaceBack(a[1].x,a[1].y,l.N,0),this._boundsArray.emplaceBack(a[3].x,a[3].y,0,l.N),this._boundsArray.emplaceBack(a[2].x,a[2].y,l.N,l.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(t,s){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},s(null)):(t.state="errored",s(null))}hasTransition(){return!1}}class qt extends Pt{constructor(t,s,a,u){super(t,s,a,u),this.load=()=>{this._loaded=!1;const h=this.options;this.urls=[];for(const g of h.urls)this.urls.push(this.map._requestManager.transformRequest(g,vt.Source).url);l.X(this.urls,(g,_)=>{this._loaded=!0,g?this.fire(new l.j(g)):_&&(this.video=_,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const h=this.map.painter.context,g=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,Tt.members)),this.boundsSegments||(this.boundsSegments=l.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE),g.texSubImage2D(g.TEXTURE_2D,0,0,0,g.RGBA,g.UNSIGNED_BYTE,this.video)):(this.texture=new Ut(h,this.video,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE));let _=!1;for(const x in this.tiles){const b=this.tiles[x];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,_=!0)}_&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=s}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const s=this.video.seekable;t<s.start(0)||t>s.end(0)?this.fire(new l.j(new l.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class gi extends Pt{constructor(t,s,a,u){super(t,s,a,u),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const g=this.map.painter.context,_=g.gl;this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,Tt.members)),this.boundsSegments||(this.boundsSegments=l.S.simpleSegment(0,0,4,2)),this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Ut(g,this.canvas,_.RGBA,{premultiply:!0});let x=!1;for(const b in this.tiles){const C=this.tiles[b];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,x=!0)}x&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(h=>!Array.isArray(h)||h.length!==2||h.some(g=>typeof g!="number"))||this.fire(new l.j(new l.Y(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.j(new l.Y(`sources.${t}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new l.j(new l.Y(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new l.j(new l.Y(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.j(new l.Y(`sources.${t}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const vs={},Zr=c=>{switch(c){case"geojson":return ct;case"image":return Pt;case"raster":return je;case"raster-dem":return et;case"vector":return Pr;case"video":return qt;case"canvas":return gi}return vs[c]};function Zs(c,t){const s=l.Z();return l.$(s,s,[1,1,0]),l.a0(s,s,[.5*c.width,.5*c.height,1]),l.a1(s,s,c.calculatePosMatrix(t.toUnwrapped()))}function bs(c,t,s,a,u,h){const g=function(S,z,U){if(S)for(const V of S){const G=z[V];if(G&&G.source===U&&G.type==="fill-extrusion")return!0}else for(const V in z){const G=z[V];if(G.source===U&&G.type==="fill-extrusion")return!0}return!1}(u&&u.layers,t,c.id),_=h.maxPitchScaleFactor(),x=c.tilesIn(a,_,g);x.sort(is);const b=[];for(const S of x)b.push({wrappedTileID:S.tileID.wrapped().key,queryResults:S.tile.queryRenderedFeatures(t,s,c._state,S.queryGeometry,S.cameraQueryGeometry,S.scale,u,h,_,Zs(c.transform,S.tileID))});const C=function(S){const z={},U={};for(const V of S){const G=V.queryResults,O=V.wrappedTileID,re=U[O]=U[O]||{};for(const he in G){const K=G[he],ae=re[he]=re[he]||{},de=z[he]=z[he]||[];for(const fe of K)ae[fe.featureIndex]||(ae[fe.featureIndex]=!0,de.push(fe))}}return z}(b);for(const S in C)C[S].forEach(z=>{const U=z.feature,V=c.getFeatureState(U.layer["source-layer"],U.id);U.source=U.layer.source,U.layer["source-layer"]&&(U.sourceLayer=U.layer["source-layer"]),U.state=V});return C}function is(c,t){const s=c.tileID,a=t.tileID;return s.overscaledZ-a.overscaledZ||s.canonical.y-a.canonical.y||s.wrap-a.wrap||s.canonical.x-a.canonical.x}class rs{constructor(t,s){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=l.a2(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const s=t+this.timeAdded;s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,s,a){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(u,h){const g={};if(!h)return g;for(const _ of u){const x=_.layerIds.map(b=>h.getLayer(b)).filter(Boolean);if(x.length!==0){_.layers=x,_.stateDependentLayerIds&&(_.stateDependentLayers=_.stateDependentLayerIds.map(b=>x.filter(C=>C.id===b)[0]));for(const b of x)g[b.id]=_}}return g}(t.buckets,s.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const h=this.buckets[u];if(h instanceof l.a4){if(this.hasSymbolBuckets=!0,!a)break;h.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const h=this.buckets[u];if(h instanceof l.a4&&h.hasRTLText){this.hasRTLText=!0,l.a5();break}}this.queryPadding=0;for(const u in this.buckets){const h=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(u).queryRadius(h))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new l.a3}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const a in this.buckets){const u=this.buckets[a];u.uploadPending()&&u.upload(t)}const s=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ut(t,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ut(t,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,s,a,u,h,g,_,x,b,C){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:u,cameraQueryGeometry:h,scale:g,tileSize:this.tileSize,pixelPosMatrix:C,transform:x,params:_,queryPadding:this.queryPadding*b},t,s,a):{}}querySourceFeatures(t,s){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const u=a.loadVTLayers(),h=s&&s.sourceLayer?s.sourceLayer:"",g=u._geojsonTileLayer||u[h];if(!g)return;const _=l.a6(s&&s.filter),{z:x,x:b,y:C}=this.tileID.canonical,S={z:x,x:b,y:C};for(let z=0;z<g.length;z++){const U=g.feature(z);if(_.needGeometry){const O=l.a7(U,!0);if(!_.filter(new l.a8(this.tileID.overscaledZ),O,this.tileID.canonical))continue}else if(!_.filter(new l.a8(this.tileID.overscaledZ),U))continue;const V=a.getId(U,h),G=new l.a9(U,x,b,C,V);G.tile=S,t.push(G)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const a=l.aa(t.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const a=Date.now();let u=!1;if(this.expirationTime>a)u=!1;else if(s)if(this.expirationTime<s)u=!0;else{const h=this.expirationTime-s;h?this.expirationTime=a+Math.max(h,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const a=this.latestFeatureIndex.loadVTLayers();for(const u in this.buckets){if(!s.style.hasLayer(u))continue;const h=this.buckets[u],g=h.layers[0].sourceLayer||"_geojsonTileLayer",_=a[g],x=t[g];if(!_||!x||Object.keys(x).length===0)continue;h.update(x,_,this.imageAtlas&&this.imageAtlas.patternPositions||{});const b=s&&s.style&&s.style.getLayer(u);b&&(this.queryPadding=Math.max(this.queryPadding,b.queryRadius(h)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<l.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=l.h.now()+t}setDependencies(t,s){const a={};for(const u of s)a[u]=!0;this.dependencies[t]=a}hasDependency(t,s){for(const a of t){const u=this.dependencies[a];if(u){for(const h of s)if(u[h])return!0}}return!1}}class ws{constructor(t,s){this.max=t,this.onRemove=s,this.reset()}reset(){for(const t in this.data)for(const s of this.data[t])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(t,s,a){const u=t.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const h={value:s,timeout:void 0};if(a!==void 0&&(h.timeout=setTimeout(()=>{this.remove(t,h)},a)),this.data[u].push(h),this.order.push(u),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const s=this.data[t].shift();return s.timeout&&clearTimeout(s.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),s.value}getByKey(t){const s=this.data[t];return s?s[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,s){if(!this.has(t))return this;const a=t.wrapped().key,u=s===void 0?0:this.data[a].indexOf(s),h=this.data[a][u];return this.data[a].splice(u,1),h.timeout&&clearTimeout(h.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(h.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(t){const s=[];for(const a in this.data)for(const u of this.data[a])t(u.value)||s.push(u);for(const a of s)this.remove(a.value.tileID,a)}}class ye{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,a){const u=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][u]=this.stateChanges[t][u]||{},l.e(this.stateChanges[t][u],a),this.deletedStates[t]===null){this.deletedStates[t]={};for(const h in this.state[t])h!==u&&(this.deletedStates[t][h]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][u]===null){this.deletedStates[t][u]={};for(const h in this.state[t][u])a[h]||(this.deletedStates[t][u][h]=null)}else for(const h in a)this.deletedStates[t]&&this.deletedStates[t][u]&&this.deletedStates[t][u][h]===null&&delete this.deletedStates[t][u][h]}removeFeatureState(t,s,a){if(this.deletedStates[t]===null)return;const u=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},a&&s!==void 0)this.deletedStates[t][u]!==null&&(this.deletedStates[t][u]=this.deletedStates[t][u]||{},this.deletedStates[t][u][a]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][u])for(a in this.deletedStates[t][u]={},this.stateChanges[t][u])this.deletedStates[t][u][a]=null;else this.deletedStates[t][u]=null;else this.deletedStates[t]=null}getState(t,s){const a=String(s),u=l.e({},(this.state[t]||{})[a],(this.stateChanges[t]||{})[a]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const h=this.deletedStates[t][s];if(h===null)return{};for(const g in h)delete u[g]}return u}initializeTileState(t,s){t.setFeatureState(this.state,s)}coalesceChanges(t,s){const a={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const h={};for(const g in this.stateChanges[u])this.state[u][g]||(this.state[u][g]={}),l.e(this.state[u][g],this.stateChanges[u][g]),h[g]=this.state[u][g];a[u]=h}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const h={};if(this.deletedStates[u]===null)for(const g in this.state[u])h[g]={},this.state[u][g]={};else for(const g in this.deletedStates[u]){if(this.deletedStates[u][g]===null)this.state[u][g]={};else for(const _ of Object.keys(this.deletedStates[u][g]))delete this.state[u][g][_];h[g]=this.state[u][g]}a[u]=a[u]||{},l.e(a[u],h)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const u in t)t[u].setFeatureState(a,s)}}class Ni extends l.E{constructor(t,s,a){super(),this.id=t,this.dispatcher=a,this.on("data",u=>{u.dataType==="source"&&u.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&u.dataType==="source"&&u.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((u,h,g,_)=>{const x=new(Zr(h.type))(u,h,g,_);if(x.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${x.id}`);return x})(t,s,a,this),this._tiles={},this._cache=new ws(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ye,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const s=this._tiles[t];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,s){return this._source.loadTile(t,s)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new l.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const a=this._tiles[s];a.upload(t),a.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(ur).map(t=>t.key)}getRenderableIds(t){const s=[];for(const a in this._tiles)this._isIdRenderable(a,t)&&s.push(this._tiles[a]);return t?s.sort((a,u)=>{const h=a.tileID,g=u.tileID,_=new l.P(h.canonical.x,h.canonical.y)._rotate(this.transform.angle),x=new l.P(g.canonical.x,g.canonical.y)._rotate(this.transform.angle);return h.overscaledZ-g.overscaledZ||x.y-_.y||x.x-_.x}).map(a=>a.tileID.key):s.map(a=>a.tileID).sort(ur).map(a=>a.key)}hasRenderableParent(t){const s=this.findLoadedParent(t,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(t,s){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(s||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,s){const a=this._tiles[t];a&&(a.state!=="loading"&&(a.state=s),this._loadTile(a,this._tileLoaded.bind(this,a,t,s)))}_tileLoaded(t,s,a,u){if(u)return t.state="errored",void(u.status!==404?this._source.fire(new l.j(u,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=l.h.now(),a==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new l.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const s=this.getRenderableIds();for(let u=0;u<s.length;u++){const h=s[u];if(t.neighboringTiles&&t.neighboringTiles[h]){const g=this.getTileByID(h);a(t,g),a(g,t)}}function a(u,h){u.needsHillshadePrepare=!0,u.needsTerrainPrepare=!0;let g=h.tileID.canonical.x-u.tileID.canonical.x;const _=h.tileID.canonical.y-u.tileID.canonical.y,x=Math.pow(2,u.tileID.canonical.z),b=h.tileID.key;g===0&&_===0||Math.abs(_)>1||(Math.abs(g)>1&&(Math.abs(g+x)===1?g+=x:Math.abs(g-x)===1&&(g-=x)),h.dem&&u.dem&&(u.dem.backfillBorder(h.dem,g,_),u.neighboringTiles&&u.neighboringTiles[b]&&(u.neighboringTiles[b].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,s,a,u){for(const h in this._tiles){let g=this._tiles[h];if(u[h]||!g.hasData()||g.tileID.overscaledZ<=s||g.tileID.overscaledZ>a)continue;let _=g.tileID;for(;g&&g.tileID.overscaledZ>s+1;){const b=g.tileID.scaledTo(g.tileID.overscaledZ-1);g=this._tiles[b.key],g&&g.hasData()&&(_=b)}let x=_;for(;x.overscaledZ>s;)if(x=x.scaledTo(x.overscaledZ-1),t[x.key]){u[_.key]=_;break}}}findLoadedParent(t,s){if(t.key in this._loadedParentTiles){const a=this._loadedParentTiles[t.key];return a&&a.tileID.overscaledZ>=s?a:null}for(let a=t.overscaledZ-1;a>=s;a--){const u=t.scaledTo(a),h=this._getLoadedTile(u);if(h)return h}}_getLoadedTile(t){const s=this._tiles[t.key];return s&&s.hasData()?s:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const s=Math.ceil(t.width/this._source.tileSize)+1,a=Math.ceil(t.height/this._source.tileSize)+1,u=Math.floor(s*a*(this._maxTileCacheZoomLevels===null?l.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),h=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,u):u;this._cache.setMaxSize(h)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,s){const a={};for(const u in this._tiles){const h=this._tiles[u];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+s),a[h.tileID.key]=h}this._tiles=a;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(u,this._tiles[u])}}update(t,s){if(this.transform=t,this.terrain=s,!this._sourceLoaded||this._paused)return;let a;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(C=>new l.O(C.canonical.z,C.wrap,C.canonical.z,C.canonical.x,C.canonical.y)):(a=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(a=a.filter(C=>this._source.hasTile(C)))):a=[];const u=t.coveringZoomLevel(this._source),h=Math.max(u-Ni.maxOverzooming,this._source.minzoom),g=Math.max(u+Ni.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const C={};for(const S of a)if(S.canonical.z>this._source.minzoom){const z=S.scaledTo(S.canonical.z-1);C[z.key]=z;const U=S.scaledTo(Math.max(this._source.minzoom,Math.min(S.canonical.z,5)));C[U.key]=U}a=a.concat(Object.values(C))}const _=a.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,_&&this.fire(new l.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const x=this._updateRetainedTiles(a,u);if(Rt(this._source.type)){const C={},S={},z=Object.keys(x),U=l.h.now();for(const V of z){const G=x[V],O=this._tiles[V];if(!O||O.fadeEndTime!==0&&O.fadeEndTime<=U)continue;const re=this.findLoadedParent(G,h);re&&(this._addTile(re.tileID),C[re.tileID.key]=re.tileID),S[V]=G}this._retainLoadedChildren(S,u,g,x);for(const V in C)x[V]||(this._coveredTiles[V]=!0,x[V]=C[V]);if(s){const V={},G={};for(const O of a)this._tiles[O.key].hasData()?V[O.key]=O:G[O.key]=O;for(const O in G){const re=G[O].children(this._source.maxzoom);this._tiles[re[0].key]&&this._tiles[re[1].key]&&this._tiles[re[2].key]&&this._tiles[re[3].key]&&(V[re[0].key]=x[re[0].key]=re[0],V[re[1].key]=x[re[1].key]=re[1],V[re[2].key]=x[re[2].key]=re[2],V[re[3].key]=x[re[3].key]=re[3],delete G[O])}for(const O in G){const re=this.findLoadedParent(G[O],this._source.minzoom);if(re){V[re.tileID.key]=x[re.tileID.key]=re.tileID;for(const he in V)V[he].isChildOf(re.tileID)&&delete V[he]}}for(const O in this._tiles)V[O]||(this._coveredTiles[O]=!0)}}for(const C in x)this._tiles[C].clearFadeHold();const b=l.ab(this._tiles,x);for(const C of b){const S=this._tiles[C];S.hasSymbolBuckets&&!S.holdingForFade()?S.setHoldDuration(this.map._fadeDuration):S.hasSymbolBuckets&&!S.symbolFadeFinished()||this._removeTile(C)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,s){const a={},u={},h=Math.max(s-Ni.maxOverzooming,this._source.minzoom),g=Math.max(s+Ni.maxUnderzooming,this._source.minzoom),_={};for(const x of t){const b=this._addTile(x);a[x.key]=x,b.hasData()||s<this._source.maxzoom&&(_[x.key]=x)}this._retainLoadedChildren(_,s,g,a);for(const x of t){let b=this._tiles[x.key];if(b.hasData())continue;if(s+1>this._source.maxzoom){const S=x.children(this._source.maxzoom)[0],z=this.getTile(S);if(z&&z.hasData()){a[S.key]=S;continue}}else{const S=x.children(this._source.maxzoom);if(a[S[0].key]&&a[S[1].key]&&a[S[2].key]&&a[S[3].key])continue}let C=b.wasRequested();for(let S=x.overscaledZ-1;S>=h;--S){const z=x.scaledTo(S);if(u[z.key])break;if(u[z.key]=!0,b=this.getTile(z),!b&&C&&(b=this._addTile(z)),b){const U=b.hasData();if((C||U)&&(a[z.key]=z),C=b.wasRequested(),U)break}}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const s=[];let a,u=this._tiles[t].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){a=this._loadedParentTiles[u.key];break}s.push(u.key);const h=u.scaledTo(u.overscaledZ-1);if(a=this._getLoadedTile(h),a)break;u=h}for(const h of s)this._loadedParentTiles[h]=a}}_addTile(t){let s=this._tiles[t.key];if(s)return s;s=this._cache.getAndRemove(t),s&&(this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,s)));const a=s;return s||(s=new rs(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(s,this._tileLoaded.bind(this,s,t.key,s.state))),s.uses++,this._tiles[t.key]=s,a||this._source.fire(new l.k("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(t,s){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const a=s.getExpiryTimeout();a&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},a))}_removeTile(t){const s=this._tiles[t];s&&(s.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,s,a){const u=[],h=this.transform;if(!h)return u;const g=a?h.getCameraQueryGeometry(t):t,_=t.map(V=>h.pointCoordinate(V,this.terrain)),x=g.map(V=>h.pointCoordinate(V,this.terrain)),b=this.getIds();let C=1/0,S=1/0,z=-1/0,U=-1/0;for(const V of x)C=Math.min(C,V.x),S=Math.min(S,V.y),z=Math.max(z,V.x),U=Math.max(U,V.y);for(let V=0;V<b.length;V++){const G=this._tiles[b[V]];if(G.holdingForFade())continue;const O=G.tileID,re=Math.pow(2,h.zoom-G.tileID.overscaledZ),he=s*G.queryPadding*l.N/G.tileSize/re,K=[O.getTilePoint(new l.U(C,S)),O.getTilePoint(new l.U(z,U))];if(K[0].x-he<l.N&&K[0].y-he<l.N&&K[1].x+he>=0&&K[1].y+he>=0){const ae=_.map(fe=>O.getTilePoint(fe)),de=x.map(fe=>O.getTilePoint(fe));u.push({tile:G,tileID:O,queryGeometry:ae,cameraQueryGeometry:de,scale:re})}}return u}getVisibleCoordinates(t){const s=this.getRenderableIds(t).map(a=>this._tiles[a].tileID);for(const a of s)a.posMatrix=this.transform.calculatePosMatrix(a.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(Rt(this._source.type)){const t=l.h.now();for(const s in this._tiles)if(this._tiles[s].fadeEndTime>=t)return!0}return!1}setFeatureState(t,s,a){this._state.updateState(t=t||"_geojsonTileLayer",s,a)}removeFeatureState(t,s,a){this._state.removeFeatureState(t=t||"_geojsonTileLayer",s,a)}getFeatureState(t,s){return this._state.getState(t=t||"_geojsonTileLayer",s)}setDependencies(t,s,a){const u=this._tiles[t];u&&u.setDependencies(s,a)}reloadTilesForDependencies(t,s){for(const a in this._tiles)this._tiles[a].hasDependency(t,s)&&this._reloadTile(a,"reloading");this._cache.filter(a=>!a.hasDependency(t,s))}}function ur(c,t){const s=Math.abs(2*c.wrap)-+(c.wrap<0),a=Math.abs(2*t.wrap)-+(t.wrap<0);return c.overscaledZ-t.overscaledZ||a-s||t.canonical.y-c.canonical.y||t.canonical.x-c.canonical.x}function Rt(c){return c==="raster"||c==="image"||c==="video"}Ni.maxOverzooming=10,Ni.maxUnderzooming=3;const St="mapboxgl_preloaded_worker_pool";class Ar{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Ar.workerCount;)this.workers.push(new Worker(l.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[St]}numActive(){return Object.keys(this.active).length}}const Gs=Math.floor(l.h.hardwareConcurrency/2);let Gr;function Tn(){return Gr||(Gr=new Ar),Gr}Ar.workerCount=l.ac(globalThis)?Math.max(Math.min(Gs,3),1):1;class As{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=l.ad(t,0,1);let s=1,a=this._distances[s];const u=t*this.paddedLength+this.padding;for(;a<u&&s<this._distances.length;)a=this._distances[++s];const h=s-1,g=this._distances[h],_=a-g,x=_>0?(u-g)/_:0;return this.points[h].mult(1-x).add(this.points[s].mult(x))}}function ss(c,t){let s=!0;return c==="always"||c!=="never"&&t!=="never"||(s=!1),s}class Es{constructor(t,s,a){const u=this.boxCells=[],h=this.circleCells=[];this.xCellCount=Math.ceil(t/a),this.yCellCount=Math.ceil(s/a);for(let g=0;g<this.xCellCount*this.yCellCount;g++)u.push([]),h.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,a,u,h){this._forEachCell(s,a,u,h,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(h)}insertCircle(t,s,a,u){this._forEachCell(s-u,a-u,s+u,a+u,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(a),this.circles.push(u)}_insertBoxCell(t,s,a,u,h,g){this.boxCells[h].push(g)}_insertCircleCell(t,s,a,u,h,g){this.circleCells[h].push(g)}_query(t,s,a,u,h,g,_){if(a<0||t>this.width||u<0||s>this.height)return[];const x=[];if(t<=0&&s<=0&&this.width<=a&&this.height<=u){if(h)return[{key:null,x1:t,y1:s,x2:a,y2:u}];for(let b=0;b<this.boxKeys.length;b++)x.push({key:this.boxKeys[b],x1:this.bboxes[4*b],y1:this.bboxes[4*b+1],x2:this.bboxes[4*b+2],y2:this.bboxes[4*b+3]});for(let b=0;b<this.circleKeys.length;b++){const C=this.circles[3*b],S=this.circles[3*b+1],z=this.circles[3*b+2];x.push({key:this.circleKeys[b],x1:C-z,y1:S-z,x2:C+z,y2:S+z})}}else this._forEachCell(t,s,a,u,this._queryCell,x,{hitTest:h,overlapMode:g,seenUids:{box:{},circle:{}}},_);return x}query(t,s,a,u){return this._query(t,s,a,u,!1,null)}hitTest(t,s,a,u,h,g){return this._query(t,s,a,u,!0,h,g).length>0}hitTestCircle(t,s,a,u,h){const g=t-a,_=t+a,x=s-a,b=s+a;if(_<0||g>this.width||b<0||x>this.height)return!1;const C=[];return this._forEachCell(g,x,_,b,this._queryCellCircle,C,{hitTest:!0,overlapMode:u,circle:{x:t,y:s,radius:a},seenUids:{box:{},circle:{}}},h),C.length>0}_queryCell(t,s,a,u,h,g,_,x){const{seenUids:b,hitTest:C,overlapMode:S}=_,z=this.boxCells[h];if(z!==null){const V=this.bboxes;for(const G of z)if(!b.box[G]){b.box[G]=!0;const O=4*G,re=this.boxKeys[G];if(t<=V[O+2]&&s<=V[O+3]&&a>=V[O+0]&&u>=V[O+1]&&(!x||x(re))&&(!C||!ss(S,re.overlapMode))&&(g.push({key:re,x1:V[O],y1:V[O+1],x2:V[O+2],y2:V[O+3]}),C))return!0}}const U=this.circleCells[h];if(U!==null){const V=this.circles;for(const G of U)if(!b.circle[G]){b.circle[G]=!0;const O=3*G,re=this.circleKeys[G];if(this._circleAndRectCollide(V[O],V[O+1],V[O+2],t,s,a,u)&&(!x||x(re))&&(!C||!ss(S,re.overlapMode))){const he=V[O],K=V[O+1],ae=V[O+2];if(g.push({key:re,x1:he-ae,y1:K-ae,x2:he+ae,y2:K+ae}),C)return!0}}}return!1}_queryCellCircle(t,s,a,u,h,g,_,x){const{circle:b,seenUids:C,overlapMode:S}=_,z=this.boxCells[h];if(z!==null){const V=this.bboxes;for(const G of z)if(!C.box[G]){C.box[G]=!0;const O=4*G,re=this.boxKeys[G];if(this._circleAndRectCollide(b.x,b.y,b.radius,V[O+0],V[O+1],V[O+2],V[O+3])&&(!x||x(re))&&!ss(S,re.overlapMode))return g.push(!0),!0}}const U=this.circleCells[h];if(U!==null){const V=this.circles;for(const G of U)if(!C.circle[G]){C.circle[G]=!0;const O=3*G,re=this.circleKeys[G];if(this._circlesCollide(V[O],V[O+1],V[O+2],b.x,b.y,b.radius)&&(!x||x(re))&&!ss(S,re.overlapMode))return g.push(!0),!0}}}_forEachCell(t,s,a,u,h,g,_,x){const b=this._convertToXCellCoord(t),C=this._convertToYCellCoord(s),S=this._convertToXCellCoord(a),z=this._convertToYCellCoord(u);for(let U=b;U<=S;U++)for(let V=C;V<=z;V++)if(h.call(this,t,s,a,u,this.xCellCount*V+U,g,_,x))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,a,u,h,g){const _=u-t,x=h-s,b=a+g;return b*b>_*_+x*x}_circleAndRectCollide(t,s,a,u,h,g,_){const x=(g-u)/2,b=Math.abs(t-(u+x));if(b>x+a)return!1;const C=(_-h)/2,S=Math.abs(s-(h+C));if(S>C+a)return!1;if(b<=x||S<=C)return!0;const z=b-x,U=S-C;return z*z+U*U<=a*a}}function Be(c,t,s,a,u){const h=l.Z();return t?(l.a0(h,h,[1/u,1/u,1]),s||l.ae(h,h,a.angle)):l.a1(h,a.labelPlaneMatrix,c),h}function Er(c,t,s,a,u){if(t){const h=l.af(c);return l.a0(h,h,[u,u,1]),s||l.ae(h,h,-a.angle),h}return a.glCoordMatrix}function ri(c,t,s){let a;s?(a=[c.x,c.y,s(c.x,c.y),1],l.ag(a,a,t)):(a=[c.x,c.y,0,1],Z(a,a,t));const u=a[3];return{point:new l.P(a[0]/u,a[1]/u),signedDistanceFromCamera:u}}function Cs(c,t){return .5+c/t*.5}function Hr(c,t){const s=c[0]/c[3],a=c[1]/c[3];return s>=-t[0]&&s<=t[0]&&a>=-t[1]&&a<=t[1]}function Me(c,t,s,a,u,h,g,_,x,b){const C=a?c.textSizeData:c.iconSizeData,S=l.ah(C,s.transform.zoom),z=[256/s.width*2+1,256/s.height*2+1],U=a?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;U.clear();const V=c.lineVertexArray,G=a?c.text.placedSymbolArray:c.icon.placedSymbolArray,O=s.transform.width/s.transform.height;let re=!1;for(let he=0;he<G.length;he++){const K=G.get(he);if(K.hidden||K.writingMode===l.ai.vertical&&!re){R(K.numGlyphs,U);continue}let ae;if(re=!1,b?(ae=[K.anchorX,K.anchorY,b(K.anchorX,K.anchorY),1],l.ag(ae,ae,t)):(ae=[K.anchorX,K.anchorY,0,1],Z(ae,ae,t)),!Hr(ae,z)){R(K.numGlyphs,U);continue}const de=Cs(s.transform.cameraToCenterDistance,ae[3]),fe=l.aj(C,S,K),we=g?fe/de:fe*de,De=new l.P(K.anchorX,K.anchorY),Ce=ri(De,u,b).point,Fe={projections:{},offsets:{}},Ge=Vi(K,we,!1,_,t,u,h,c.glyphOffsetArray,V,U,Ce,De,Fe,O,x,b);re=Ge.useVertical,(Ge.notEnoughRoom||re||Ge.needsFlipping&&Vi(K,we,!0,_,t,u,h,c.glyphOffsetArray,V,U,Ce,De,Fe,O,x,b).notEnoughRoom)&&R(K.numGlyphs,U)}a?c.text.dynamicLayoutVertexBuffer.updateData(U):c.icon.dynamicLayoutVertexBuffer.updateData(U)}function ut(c,t,s,a,u,h,g,_,x,b,C,S,z){const U=_.glyphStartIndex+_.numGlyphs,V=_.lineStartIndex,G=_.lineStartIndex+_.lineLength,O=t.getoffsetX(_.glyphStartIndex),re=t.getoffsetX(U-1),he=D(c*O,s,a,u,h,g,_.segment,V,G,x,b,C,S,z);if(!he)return null;const K=D(c*re,s,a,u,h,g,_.segment,V,G,x,b,C,S,z);return K?{first:he,last:K}:null}function at(c,t,s,a){return c===l.ai.horizontal&&Math.abs(s.y-t.y)>Math.abs(s.x-t.x)*a?{useVertical:!0}:(c===l.ai.vertical?t.y<s.y:t.x>s.x)?{needsFlipping:!0}:null}function Vi(c,t,s,a,u,h,g,_,x,b,C,S,z,U,V,G){const O=t/24,re=c.lineOffsetX*O,he=c.lineOffsetY*O;let K;if(c.numGlyphs>1){const ae=c.glyphStartIndex+c.numGlyphs,de=c.lineStartIndex,fe=c.lineStartIndex+c.lineLength,we=ut(O,_,re,he,s,C,S,c,x,h,z,V,G);if(!we)return{notEnoughRoom:!0};const De=ri(we.first.point,g,G).point,Ce=ri(we.last.point,g,G).point;if(a&&!s){const Fe=at(c.writingMode,De,Ce,U);if(Fe)return Fe}K=[we.first];for(let Fe=c.glyphStartIndex+1;Fe<ae-1;Fe++)K.push(D(O*_.getoffsetX(Fe),re,he,s,C,S,c.segment,de,fe,x,h,z,V,G));K.push(we.last)}else{if(a&&!s){const de=ri(S,u,G).point,fe=c.lineStartIndex+c.segment+1,we=new l.P(x.getx(fe),x.gety(fe)),De=ri(we,u,G),Ce=De.signedDistanceFromCamera>0?De.point:Lr(S,we,de,1,u,G),Fe=at(c.writingMode,de,Ce,U);if(Fe)return Fe}const ae=D(O*_.getoffsetX(c.glyphStartIndex),re,he,s,C,S,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,x,h,z,V,G);if(!ae)return{notEnoughRoom:!0};K=[ae]}for(const ae of K)l.ak(b,ae.point,ae.angle);return{}}function Lr(c,t,s,a,u,h){const g=ri(c.add(c.sub(t)._unit()),u,h).point,_=s.sub(g);return s.add(_._mult(a/_.mag()))}function lt(c,t){const{projectionCache:s,lineVertexArray:a,labelPlaneMatrix:u,tileAnchorPoint:h,distanceFromAnchor:g,getElevation:_,previousVertex:x,direction:b,absOffsetX:C}=t;if(s.projections[c])return s.projections[c];const S=new l.P(a.getx(c),a.gety(c)),z=ri(S,u,_);if(z.signedDistanceFromCamera>0)return s.projections[c]=z.point,z.point;const U=c-b;return Lr(g===0?h:new l.P(a.getx(U),a.gety(U)),S,x,C-g+1,u,_)}function Wr(c,t,s){return c._unit()._perp()._mult(t*s)}function j(c,t,s,a,u,h,g,_){const{projectionCache:x,direction:b}=_;if(x.offsets[c])return x.offsets[c];const C=s.add(t);if(c+b<a||c+b>=u)return x.offsets[c]=C,C;const S=lt(c+b,_),z=Wr(S.sub(s),g,b),U=s.add(z),V=S.add(z);return x.offsets[c]=l.al(h,C,U,V)||C,x.offsets[c]}function D(c,t,s,a,u,h,g,_,x,b,C,S,z,U){const V=a?c-t:c+t;let G=V>0?1:-1,O=0;a&&(G*=-1,O=Math.PI),G<0&&(O+=Math.PI);let re,he,K=G>0?_+g:_+g+1,ae=u,de=u,fe=0,we=0;const De=Math.abs(V),Ce=[];let Fe;for(;fe+we<=De;){if(K+=G,K<_||K>=x)return null;fe+=we,de=ae,he=re;const Le={projectionCache:S,lineVertexArray:b,labelPlaneMatrix:C,tileAnchorPoint:h,distanceFromAnchor:fe,getElevation:U,previousVertex:de,direction:G,absOffsetX:De};if(ae=lt(K,Le),s===0)Ce.push(de),Fe=ae.sub(de);else{let rt;const Ke=ae.sub(de);rt=Ke.mag()===0?Wr(lt(K+G,Le).sub(ae),s,G):Wr(Ke,s,G),he||(he=de.add(rt)),re=j(K,rt,ae,_,x,he,s,Le),Ce.push(he),Fe=re.sub(he)}we=Fe.mag()}const Ge=Fe._mult((De-fe)/we)._add(he||de),yt=O+Math.atan2(ae.y-de.y,ae.x-de.x);return Ce.push(Ge),{point:Ge,angle:z?yt:0,path:Ce}}const B=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function R(c,t){for(let s=0;s<c;s++){const a=t.length;t.resize(a+4),t.float32.set(B,3*a)}}function Z(c,t,s){const a=t[0],u=t[1];return c[0]=s[0]*a+s[4]*u+s[12],c[1]=s[1]*a+s[5]*u+s[13],c[3]=s[3]*a+s[7]*u+s[15],c}const X=100;class le{constructor(t,s=new Es(t.width+200,t.height+200,25),a=new Es(t.width+200,t.height+200,25)){this.transform=t,this.grid=s,this.ignoredGrid=a,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+X,this.screenBottomBoundary=t.height+X,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,s,a,u,h,g){const _=this.projectAndGetPerspectiveRatio(u,t.anchorPointX,t.anchorPointY,g),x=a*_.perspectiveRatio,b=t.x1*x+_.point.x,C=t.y1*x+_.point.y,S=t.x2*x+_.point.x,z=t.y2*x+_.point.y;return!this.isInsideGrid(b,C,S,z)||s!=="always"&&this.grid.hitTest(b,C,S,z,s,h)||_.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[b,C,S,z],offscreen:this.isOffscreen(b,C,S,z)}}placeCollisionCircles(t,s,a,u,h,g,_,x,b,C,S,z,U,V){const G=[],O=new l.P(s.anchorX,s.anchorY),re=ri(O,g,V),he=Cs(this.transform.cameraToCenterDistance,re.signedDistanceFromCamera),K=(C?h/he:h*he)/l.ap,ae=ri(O,_,V).point,de=ut(K,u,s.lineOffsetX*K,s.lineOffsetY*K,!1,ae,O,s,a,_,{projections:{},offsets:{}},!1,V);let fe=!1,we=!1,De=!0;if(de){const Ce=.5*z*he+U,Fe=new l.P(-100,-100),Ge=new l.P(this.screenRightBoundary,this.screenBottomBoundary),yt=new As,Le=de.first,rt=de.last;let Ke=[];for(let pt=Le.path.length-1;pt>=1;pt--)Ke.push(Le.path[pt]);for(let pt=1;pt<rt.path.length;pt++)Ke.push(rt.path[pt]);const Ot=2.5*Ce;if(x){const pt=Ke.map(xt=>ri(xt,x,V));Ke=pt.some(xt=>xt.signedDistanceFromCamera<=0)?[]:pt.map(xt=>xt.point)}let gt=[];if(Ke.length>0){const pt=Ke[0].clone(),xt=Ke[0].clone();for(let pi=1;pi<Ke.length;pi++)pt.x=Math.min(pt.x,Ke[pi].x),pt.y=Math.min(pt.y,Ke[pi].y),xt.x=Math.max(xt.x,Ke[pi].x),xt.y=Math.max(xt.y,Ke[pi].y);gt=pt.x>=Fe.x&&xt.x<=Ge.x&&pt.y>=Fe.y&&xt.y<=Ge.y?[Ke]:xt.x<Fe.x||pt.x>Ge.x||xt.y<Fe.y||pt.y>Ge.y?[]:l.am([Ke],Fe.x,Fe.y,Ge.x,Ge.y)}for(const pt of gt){yt.reset(pt,.25*Ce);let xt=0;xt=yt.length<=.5*Ce?1:Math.ceil(yt.paddedLength/Ot)+1;for(let pi=0;pi<xt;pi++){const Xt=pi/Math.max(xt-1,1),qi=yt.lerp(Xt),Si=qi.x+X,yi=qi.y+X;G.push(Si,yi,Ce,0);const Dr=Si-Ce,ei=yi-Ce,hs=Si+Ce,ps=yi+Ce;if(De=De&&this.isOffscreen(Dr,ei,hs,ps),we=we||this.isInsideGrid(Dr,ei,hs,ps),t!=="always"&&this.grid.hitTestCircle(Si,yi,Ce,t,S)&&(fe=!0,!b))return{circles:[],offscreen:!1,collisionDetected:fe}}}}return{circles:!b&&fe||!we||he<this.perspectiveRatioCutoff?[]:G,offscreen:De,collisionDetected:fe}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let a=1/0,u=1/0,h=-1/0,g=-1/0;for(const C of t){const S=new l.P(C.x+X,C.y+X);a=Math.min(a,S.x),u=Math.min(u,S.y),h=Math.max(h,S.x),g=Math.max(g,S.y),s.push(S)}const _=this.grid.query(a,u,h,g).concat(this.ignoredGrid.query(a,u,h,g)),x={},b={};for(const C of _){const S=C.key;if(x[S.bucketInstanceId]===void 0&&(x[S.bucketInstanceId]={}),x[S.bucketInstanceId][S.featureIndex])continue;const z=[new l.P(C.x1,C.y1),new l.P(C.x2,C.y1),new l.P(C.x2,C.y2),new l.P(C.x1,C.y2)];l.an(s,z)&&(x[S.bucketInstanceId][S.featureIndex]=!0,b[S.bucketInstanceId]===void 0&&(b[S.bucketInstanceId]=[]),b[S.bucketInstanceId].push(S.featureIndex))}return b}insertCollisionBox(t,s,a,u,h,g){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:h,collisionGroupID:g,overlapMode:s},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,a,u,h,g){const _=a?this.ignoredGrid:this.grid,x={bucketInstanceId:u,featureIndex:h,collisionGroupID:g,overlapMode:s};for(let b=0;b<t.length;b+=4)_.insertCircle(x,t[b],t[b+1],t[b+2])}projectAndGetPerspectiveRatio(t,s,a,u){let h;return u?(h=[s,a,u(s,a),1],l.ag(h,h,t)):(h=[s,a,0,1],Z(h,h,t)),{point:new l.P((h[0]/h[3]+1)/2*this.transform.width+X,(-h[1]/h[3]+1)/2*this.transform.height+X),perspectiveRatio:.5+this.transform.cameraToCenterDistance/h[3]*.5}}isOffscreen(t,s,a,u){return a<X||t>=this.screenRightBoundary||u<X||s>this.screenBottomBoundary}isInsideGrid(t,s,a,u){return a>=0&&t<this.gridRightBoundary&&u>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=l.ao([]);return l.$(t,t,[-100,-100,0]),t}}function ie(c,t,s){return t*(l.N/(c.tileSize*Math.pow(2,s-c.tileID.overscaledZ)))}class Y{constructor(t,s,a,u){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):u&&a?1:0,this.placed=a}isHidden(){return this.opacity===0&&!this.placed}}class se{constructor(t,s,a,u,h){this.text=new Y(t?t.text:null,s,a,h),this.icon=new Y(t?t.icon:null,s,u,h)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class xe{constructor(t,s,a){this.text=t,this.icon=s,this.skipFade=a}}class be{constructor(){this.invProjMatrix=l.Z(),this.viewportMatrix=l.Z(),this.circles=[]}}class ve{constructor(t,s,a,u,h){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=a,this.bucketIndex=u,this.tileID=h}}class We{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:a=>a.collisionGroupID===s}}return this.collisionGroups[t]}}function nt(c,t,s,a,u){const{horizontalAlign:h,verticalAlign:g}=l.au(c);return new l.P(-(h-.5)*t+a[0]*u,-(g-.5)*s+a[1]*u)}function Ze(c,t,s,a,u,h){const{x1:g,x2:_,y1:x,y2:b,anchorPointX:C,anchorPointY:S}=c,z=new l.P(t,s);return a&&z._rotate(u?h:-h),{x1:g+z.x,y1:x+z.y,x2:_+z.x,y2:b+z.y,anchorPointX:C,anchorPointY:S}}class Qe{constructor(t,s,a,u,h){this.transform=t.clone(),this.terrain=s,this.collisionIndex=new le(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new We(u),this.collisionCircleArrays={},this.prevPlacement=h,h&&(h.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,s,a,u){const h=a.getBucket(s),g=a.latestFeatureIndex;if(!h||!g||s.id!==h.layerIds[0])return;const _=a.collisionBoxArray,x=h.layers[0].layout,b=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),C=a.tileSize/l.N,S=this.transform.calculatePosMatrix(a.tileID.toUnwrapped()),z=x.get("text-pitch-alignment")==="map",U=x.get("text-rotation-alignment")==="map",V=ie(a,1,this.transform.zoom),G=Be(S,z,U,this.transform,V);let O=null;if(z){const he=Er(S,z,U,this.transform,V);O=l.a1([],this.transform.labelPlaneMatrix,he)}this.retainedQueryData[h.bucketInstanceId]=new ve(h.bucketInstanceId,g,h.sourceLayerIndex,h.index,a.tileID);const re={bucket:h,layout:x,posMatrix:S,textLabelPlaneMatrix:G,labelToScreenMatrix:O,scale:b,textPixelRatio:C,holdingForFade:a.holdingForFade(),collisionBoxArray:_,partiallyEvaluatedTextSize:l.ah(h.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(h.sourceID)};if(u)for(const he of h.sortKeyRanges){const{sortKey:K,symbolInstanceStart:ae,symbolInstanceEnd:de}=he;t.push({sortKey:K,symbolInstanceStart:ae,symbolInstanceEnd:de,parameters:re})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:h.symbolInstances.length,parameters:re})}attemptAnchorPlacement(t,s,a,u,h,g,_,x,b,C,S,z,U,V,G,O){const re=l.aq[t.textAnchor],he=[t.textOffset0,t.textOffset1],K=nt(re,a,u,he,h),ae=this.collisionIndex.placeCollisionBox(Ze(s,K.x,K.y,g,_,this.transform.angle),S,x,b,C.predicate,O);if((!G||this.collisionIndex.placeCollisionBox(Ze(G,K.x,K.y,g,_,this.transform.angle),S,x,b,C.predicate,O).box.length!==0)&&ae.box.length>0){let de;if(this.prevPlacement&&this.prevPlacement.variableOffsets[z.crossTileID]&&this.prevPlacement.placements[z.crossTileID]&&this.prevPlacement.placements[z.crossTileID].text&&(de=this.prevPlacement.variableOffsets[z.crossTileID].anchor),z.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[z.crossTileID]={textOffset:he,width:a,height:u,anchor:re,textBoxScale:h,prevAnchor:de},this.markUsedJustification(U,re,z,V),U.allowVerticalPlacement&&(this.markUsedOrientation(U,V,z),this.placedOrientations[z.crossTileID]=V),{shift:K,placedGlyphBoxes:ae}}}placeLayerBucketPart(t,s,a){const{bucket:u,layout:h,posMatrix:g,textLabelPlaneMatrix:_,labelToScreenMatrix:x,textPixelRatio:b,holdingForFade:C,collisionBoxArray:S,partiallyEvaluatedTextSize:z,collisionGroup:U}=t.parameters,V=h.get("text-optional"),G=h.get("icon-optional"),O=l.ar(h,"text-overlap","text-allow-overlap"),re=O==="always",he=l.ar(h,"icon-overlap","icon-allow-overlap"),K=he==="always",ae=h.get("text-rotation-alignment")==="map",de=h.get("text-pitch-alignment")==="map",fe=h.get("icon-text-fit")!=="none",we=h.get("symbol-z-order")==="viewport-y",De=re&&(K||!u.hasIconData()||G),Ce=K&&(re||!u.hasTextData()||V);!u.collisionArrays&&S&&u.deserializeCollisionBoxes(S);const Fe=this.retainedQueryData[u.bucketInstanceId].tileID,Ge=this.terrain?(Le,rt)=>this.terrain.getElevation(Fe,Le,rt):null,yt=(Le,rt)=>{var Ke,Ot;if(s[Le.crossTileID])return;if(C)return void(this.placements[Le.crossTileID]=new xe(!1,!1,!1));let gt=!1,pt=!1,xt=!0,pi=null,Xt={box:null,offscreen:null},qi={box:null},Si=null,yi=null,Dr=null,ei=0,hs=0,ps=0;rt.textFeatureIndex?ei=rt.textFeatureIndex:Le.useRuntimeCollisionCircles&&(ei=Le.featureIndex),rt.verticalTextFeatureIndex&&(hs=rt.verticalTextFeatureIndex);const en=rt.textBox;if(en){const Wi=di=>{let ki=l.ai.horizontal;if(u.allowVerticalPlacement&&!di&&this.prevPlacement){const _r=this.prevPlacement.placedOrientations[Le.crossTileID];_r&&(this.placedOrientations[Le.crossTileID]=_r,ki=_r,this.markUsedOrientation(u,ki,Le))}return ki},ji=(di,ki)=>{if(u.allowVerticalPlacement&&Le.numVerticalGlyphVertices>0&&rt.verticalTextBox){for(const _r of u.writingModes)if(_r===l.ai.vertical?(Xt=ki(),qi=Xt):Xt=di(),Xt&&Xt.box&&Xt.box.length)break}else Xt=di()},rr=Le.textAnchorOffsetStartIndex,vn=Le.textAnchorOffsetEndIndex;if(vn===rr){const di=(ki,_r)=>{const fi=this.collisionIndex.placeCollisionBox(ki,O,b,g,U.predicate,Ge);return fi&&fi.box&&fi.box.length&&(this.markUsedOrientation(u,_r,Le),this.placedOrientations[Le.crossTileID]=_r),fi};ji(()=>di(en,l.ai.horizontal),()=>{const ki=rt.verticalTextBox;return u.allowVerticalPlacement&&Le.numVerticalGlyphVertices>0&&ki?di(ki,l.ai.vertical):{box:null,offscreen:null}}),Wi(Xt&&Xt.box&&Xt.box.length)}else{let di=l.aq[(Ot=(Ke=this.prevPlacement)===null||Ke===void 0?void 0:Ke.variableOffsets[Le.crossTileID])===null||Ot===void 0?void 0:Ot.anchor];const ki=(fi,bn,no)=>{const Pl=fi.x2-fi.x1,Ll=fi.y2-fi.y1,Au=Le.textBoxScale,Vo=fe&&he==="never"?bn:null;let ds={box:[],offscreen:!1},wn=O==="never"?1:2,fs="never";di&&wn++;for(let Nr=0;Nr<wn;Nr++){for(let ms=rr;ms<vn;ms++){const Uo=u.textAnchorOffsets.get(ms);if(di&&Uo.textAnchor!==di)continue;const Ls=this.attemptAnchorPlacement(Uo,fi,Pl,Ll,Au,ae,de,b,g,U,fs,Le,u,no,Vo,Ge);if(Ls&&(ds=Ls.placedGlyphBoxes,ds&&ds.box&&ds.box.length))return gt=!0,pi=Ls.shift,ds}di?di=null:fs=O}return ds};ji(()=>ki(en,rt.iconBox,l.ai.horizontal),()=>{const fi=rt.verticalTextBox;return u.allowVerticalPlacement&&!(Xt&&Xt.box&&Xt.box.length)&&Le.numVerticalGlyphVertices>0&&fi?ki(fi,rt.verticalIconBox,l.ai.vertical):{box:null,offscreen:null}}),Xt&&(gt=Xt.box,xt=Xt.offscreen);const _r=Wi(Xt&&Xt.box);if(!gt&&this.prevPlacement){const fi=this.prevPlacement.variableOffsets[Le.crossTileID];fi&&(this.variableOffsets[Le.crossTileID]=fi,this.markUsedJustification(u,fi.anchor,Le,_r))}}}if(Si=Xt,gt=Si&&Si.box&&Si.box.length>0,xt=Si&&Si.offscreen,Le.useRuntimeCollisionCircles){const Wi=u.text.placedSymbolArray.get(Le.centerJustifiedTextSymbolIndex),ji=l.aj(u.textSizeData,z,Wi),rr=h.get("text-padding");yi=this.collisionIndex.placeCollisionCircles(O,Wi,u.lineVertexArray,u.glyphOffsetArray,ji,g,_,x,a,de,U.predicate,Le.collisionCircleDiameter,rr,Ge),yi.circles.length&&yi.collisionDetected&&!a&&l.w("Collisions detected, but collision boxes are not shown"),gt=re||yi.circles.length>0&&!yi.collisionDetected,xt=xt&&yi.offscreen}if(rt.iconFeatureIndex&&(ps=rt.iconFeatureIndex),rt.iconBox){const Wi=ji=>{const rr=fe&&pi?Ze(ji,pi.x,pi.y,ae,de,this.transform.angle):ji;return this.collisionIndex.placeCollisionBox(rr,he,b,g,U.predicate,Ge)};qi&&qi.box&&qi.box.length&&rt.verticalIconBox?(Dr=Wi(rt.verticalIconBox),pt=Dr.box.length>0):(Dr=Wi(rt.iconBox),pt=Dr.box.length>0),xt=xt&&Dr.offscreen}const xn=V||Le.numHorizontalGlyphVertices===0&&Le.numVerticalGlyphVertices===0,Jn=G||Le.numIconVertices===0;if(xn||Jn?Jn?xn||(pt=pt&&gt):gt=pt&&gt:pt=gt=pt&&gt,gt&&Si&&Si.box&&this.collisionIndex.insertCollisionBox(Si.box,O,h.get("text-ignore-placement"),u.bucketInstanceId,qi&&qi.box&&hs?hs:ei,U.ID),pt&&Dr&&this.collisionIndex.insertCollisionBox(Dr.box,he,h.get("icon-ignore-placement"),u.bucketInstanceId,ps,U.ID),yi&&(gt&&this.collisionIndex.insertCollisionCircles(yi.circles,O,h.get("text-ignore-placement"),u.bucketInstanceId,ei,U.ID),a)){const Wi=u.bucketInstanceId;let ji=this.collisionCircleArrays[Wi];ji===void 0&&(ji=this.collisionCircleArrays[Wi]=new be);for(let rr=0;rr<yi.circles.length;rr+=4)ji.circles.push(yi.circles[rr+0]),ji.circles.push(yi.circles[rr+1]),ji.circles.push(yi.circles[rr+2]),ji.circles.push(yi.collisionDetected?1:0)}if(Le.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(u.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Le.crossTileID]=new xe(gt||De,pt||Ce,xt||u.justReloaded),s[Le.crossTileID]=!0};if(we){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Le=u.getSortedSymbolIndexes(this.transform.angle);for(let rt=Le.length-1;rt>=0;--rt){const Ke=Le[rt];yt(u.symbolInstances.get(Ke),u.collisionArrays[Ke])}}else for(let Le=t.symbolInstanceStart;Le<t.symbolInstanceEnd;Le++)yt(u.symbolInstances.get(Le),u.collisionArrays[Le]);if(a&&u.bucketInstanceId in this.collisionCircleArrays){const Le=this.collisionCircleArrays[u.bucketInstanceId];l.as(Le.invProjMatrix,g),Le.viewportMatrix=this.collisionIndex.getViewportMatrix()}u.justReloaded=!1}markUsedJustification(t,s,a,u){let h;h=u===l.ai.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[l.at(s)];const g=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];for(const _ of g)_>=0&&(t.text.placedSymbolArray.get(_).crossTileID=h>=0&&_!==h?0:a.crossTileID)}markUsedOrientation(t,s,a){const u=s===l.ai.horizontal||s===l.ai.horizontalOnly?s:0,h=s===l.ai.vertical?s:0,g=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];for(const _ of g)t.text.placedSymbolArray.get(_).placedOrientation=u;a.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=h)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let a=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const u=s?s.symbolFadeChange(t):1,h=s?s.opacities:{},g=s?s.variableOffsets:{},_=s?s.placedOrientations:{};for(const x in this.placements){const b=this.placements[x],C=h[x];C?(this.opacities[x]=new se(C,u,b.text,b.icon),a=a||b.text!==C.text.placed||b.icon!==C.icon.placed):(this.opacities[x]=new se(null,u,b.text,b.icon,b.skipFade),a=a||b.text||b.icon)}for(const x in h){const b=h[x];if(!this.opacities[x]){const C=new se(b,u,!1,!1);C.isHidden()||(this.opacities[x]=C,a=a||b.text.placed||b.icon.placed)}}for(const x in g)this.variableOffsets[x]||!this.opacities[x]||this.opacities[x].isHidden()||(this.variableOffsets[x]=g[x]);for(const x in _)this.placedOrientations[x]||!this.opacities[x]||this.opacities[x].isHidden()||(this.placedOrientations[x]=_[x]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");a?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s){const a={};for(const u of s){const h=u.getBucket(t);h&&u.latestFeatureIndex&&t.id===h.layerIds[0]&&this.updateBucketOpacities(h,a,u.collisionBoxArray)}}updateBucketOpacities(t,s,a){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const u=t.layers[0],h=u.layout,g=new se(null,0,!1,!1,!0),_=h.get("text-allow-overlap"),x=h.get("icon-allow-overlap"),b=u._unevaluatedLayout.hasValue("text-variable-anchor")||u._unevaluatedLayout.hasValue("text-variable-anchor-offset"),C=h.get("text-rotation-alignment")==="map",S=h.get("text-pitch-alignment")==="map",z=h.get("icon-text-fit")!=="none",U=new se(null,0,_&&(x||!t.hasIconData()||h.get("icon-optional")),x&&(_||!t.hasTextData()||h.get("text-optional")),!0);!t.collisionArrays&&a&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(a);const V=(G,O,re)=>{for(let he=0;he<O/4;he++)G.opacityVertexArray.emplaceBack(re);G.hasVisibleVertices=G.hasVisibleVertices||re!==cr};for(let G=0;G<t.symbolInstances.length;G++){const O=t.symbolInstances.get(G),{numHorizontalGlyphVertices:re,numVerticalGlyphVertices:he,crossTileID:K}=O;let ae=this.opacities[K];s[K]?ae=g:ae||(ae=U,this.opacities[K]=ae),s[K]=!0;const de=O.numIconVertices>0,fe=this.placedOrientations[O.crossTileID],we=fe===l.ai.vertical,De=fe===l.ai.horizontal||fe===l.ai.horizontalOnly;if(re>0||he>0){const Ce=Ci(ae.text);V(t.text,re,we?cr:Ce),V(t.text,he,De?cr:Ce);const Fe=ae.text.isHidden();[O.rightJustifiedTextSymbolIndex,O.centerJustifiedTextSymbolIndex,O.leftJustifiedTextSymbolIndex].forEach(Le=>{Le>=0&&(t.text.placedSymbolArray.get(Le).hidden=Fe||we?1:0)}),O.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(O.verticalPlacedTextSymbolIndex).hidden=Fe||De?1:0);const Ge=this.variableOffsets[O.crossTileID];Ge&&this.markUsedJustification(t,Ge.anchor,O,fe);const yt=this.placedOrientations[O.crossTileID];yt&&(this.markUsedJustification(t,"left",O,yt),this.markUsedOrientation(t,yt,O))}if(de){const Ce=Ci(ae.icon),Fe=!(z&&O.verticalPlacedIconSymbolIndex&&we);O.placedIconSymbolIndex>=0&&(V(t.icon,O.numIconVertices,Fe?Ce:cr),t.icon.placedSymbolArray.get(O.placedIconSymbolIndex).hidden=ae.icon.isHidden()),O.verticalPlacedIconSymbolIndex>=0&&(V(t.icon,O.numVerticalIconVertices,Fe?cr:Ce),t.icon.placedSymbolArray.get(O.verticalPlacedIconSymbolIndex).hidden=ae.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ce=t.collisionArrays[G];if(Ce){let Fe=new l.P(0,0);if(Ce.textBox||Ce.verticalTextBox){let yt=!0;if(b){const Le=this.variableOffsets[K];Le?(Fe=nt(Le.anchor,Le.width,Le.height,Le.textOffset,Le.textBoxScale),C&&Fe._rotate(S?this.transform.angle:-this.transform.angle)):yt=!1}Ce.textBox&&ot(t.textCollisionBox.collisionVertexArray,ae.text.placed,!yt||we,Fe.x,Fe.y),Ce.verticalTextBox&&ot(t.textCollisionBox.collisionVertexArray,ae.text.placed,!yt||De,Fe.x,Fe.y)}const Ge=!!(!De&&Ce.verticalIconBox);Ce.iconBox&&ot(t.iconCollisionBox.collisionVertexArray,ae.icon.placed,Ge,z?Fe.x:0,z?Fe.y:0),Ce.verticalIconBox&&ot(t.iconCollisionBox.collisionVertexArray,ae.icon.placed,!Ge,z?Fe.x:0,z?Fe.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const G=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=G.invProjMatrix,t.placementViewportMatrix=G.viewportMatrix,t.collisionCircleArray=G.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const a=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*a>t}setStale(){this.stale=!0}}function ot(c,t,s,a,u){c.emplaceBack(t?1:0,s?1:0,a||0,u||0),c.emplaceBack(t?1:0,s?1:0,a||0,u||0),c.emplaceBack(t?1:0,s?1:0,a||0,u||0),c.emplaceBack(t?1:0,s?1:0,a||0,u||0)}const It=Math.pow(2,25),Bt=Math.pow(2,24),bt=Math.pow(2,17),wt=Math.pow(2,16),Ri=Math.pow(2,9),$t=Math.pow(2,8),hi=Math.pow(2,1);function Ci(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;const t=c.placed?1:0,s=Math.floor(127*c.opacity);return s*It+t*Bt+s*bt+t*wt+s*Ri+t*$t+s*hi+t}const cr=0;class Na{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,s,a,u,h){const g=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(g,u,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,h())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,g.sort((_,x)=>_.sortKey-x.sortKey));this._currentPartIndex<g.length;)if(s.placeLayerBucketPart(g[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,h())return!0;return!1}}class Ss{constructor(t,s,a,u,h,g,_,x){this.placement=new Qe(t,s,g,_,x),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=h,this._done=!1}isDone(){return this._done}continuePlacement(t,s,a){const u=l.h.now(),h=()=>!this._forceFullPlacement&&l.h.now()-u>2;for(;this._currentPlacementIndex>=0;){const g=s[t[this._currentPlacementIndex]],_=this.placement.collisionIndex.transform.zoom;if(g.type==="symbol"&&(!g.minzoom||g.minzoom<=_)&&(!g.maxzoom||g.maxzoom>_)){if(this._inProgressLayer||(this._inProgressLayer=new Na(g)),this._inProgressLayer.continuePlacement(a[g.source],this.placement,this._showCollisionBoxes,g,h))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Hs=512/l.N/2;class go{constructor(t,s,a){this.tileID=t,this.bucketInstanceId=a,this._symbolsByKey={};const u=new Map;for(let h=0;h<s.length;h++){const g=s.get(h),_=g.key,x=u.get(_);x?x.push(g):u.set(_,[g])}for(const[h,g]of u){const _={positions:g.map(x=>({x:Math.floor(x.anchorX*Hs),y:Math.floor(x.anchorY*Hs)})),crossTileIDs:g.map(x=>x.crossTileID)};if(_.positions.length>128){const x=new l.av(_.positions.length,16,Uint16Array);for(const{x:b,y:C}of _.positions)x.add(b,C);x.finish(),delete _.positions,_.index=x}this._symbolsByKey[h]=_}}getScaledCoordinates(t,s){const{x:a,y:u,z:h}=this.tileID.canonical,{x:g,y:_,z:x}=s.canonical,b=Hs/Math.pow(2,x-h),C=(_*l.N+t.anchorY)*b,S=u*l.N*Hs;return{x:Math.floor((g*l.N+t.anchorX)*b-a*l.N*Hs),y:Math.floor(C-S)}}findMatches(t,s,a){const u=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let h=0;h<t.length;h++){const g=t.get(h);if(g.crossTileID)continue;const _=this._symbolsByKey[g.key];if(!_)continue;const x=this.getScaledCoordinates(g,s);if(_.index){const b=_.index.range(x.x-u,x.y-u,x.x+u,x.y+u).sort();for(const C of b){const S=_.crossTileIDs[C];if(!a[S]){a[S]=!0,g.crossTileID=S;break}}}else if(_.positions)for(let b=0;b<_.positions.length;b++){const C=_.positions[b],S=_.crossTileIDs[b];if(Math.abs(C.x-x.x)<=u&&Math.abs(C.y-x.y)<=u&&!a[S]){a[S]=!0,g.crossTileID=S;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class zt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class na{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const a in this.indexes){const u=this.indexes[a],h={};for(const g in u){const _=u[g];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+s),h[_.tileID.key]=_}this.indexes[a]=h}this.lng=t}addBucket(t,s,a){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let h=0;h<s.symbolInstances.length;h++)s.symbolInstances.get(h).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const u=this.usedCrossTileIDs[t.overscaledZ];for(const h in this.indexes){const g=this.indexes[h];if(Number(h)>t.overscaledZ)for(const _ in g){const x=g[_];x.tileID.isChildOf(t)&&x.findMatches(s.symbolInstances,t,u)}else{const _=g[t.scaledTo(Number(h)).key];_&&_.findMatches(s.symbolInstances,t,u)}}for(let h=0;h<s.symbolInstances.length;h++){const g=s.symbolInstances.get(h);g.crossTileID||(g.crossTileID=a.generate(),u[g.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new go(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const a of s.getCrossTileIDsLists())for(const u of a)delete this.usedCrossTileIDs[t][u]}removeStaleBuckets(t){let s=!1;for(const a in this.indexes){const u=this.indexes[a];for(const h in u)t[u[h].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,u[h]),delete u[h],s=!0)}return s}}class Dn{constructor(){this.layerIndexes={},this.crossTileIDs=new zt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,a){let u=this.layerIndexes[t.id];u===void 0&&(u=this.layerIndexes[t.id]=new na);let h=!1;const g={};u.handleWrapJump(a);for(const _ of s){const x=_.getBucket(t);x&&t.id===x.layerIds[0]&&(x.bucketInstanceId||(x.bucketInstanceId=++this.maxBucketInstanceId),u.addBucket(_.tileID,x,this.crossTileIDs)&&(h=!0),g[x.bucketInstanceId]=!0)}return u.removeStaleBuckets(g)&&(h=!0),h}pruneUnusedLayers(t){const s={};t.forEach(a=>{s[a]=!0});for(const a in this.layerIndexes)s[a]||delete this.layerIndexes[a]}}const Oi=(c,t)=>l.x(c,t&&t.filter(s=>s.identifier!=="source.canvas")),Qi=l.F(l.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),_o=l.F(l.ax,["setCenter","setZoom","setBearing","setPitch"]),hr=l.aw();class vi extends l.E{constructor(t,s={}){super(),this.map=t,this.dispatcher=new xs(Tn(),this,t._getMapId()),this.imageManager=new $i,this.imageManager.setEventedParent(this),this.glyphManager=new Gi(t._requestManager,s.localIdeographFontFamily),this.lineAtlas=new js(256,512),this.crossTileSymbolIndex=new Dn,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.az());const a=this;this._rtlTextPluginCallback=vi.registerForPluginStateChange(u=>{a.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:u.pluginStatus,pluginURL:u.pluginURL},(h,g)=>{if(l.aA(h),g&&g.every(_=>_))for(const _ in a.sourceCaches){const x=a.sourceCaches[_].getSource().type;x!=="vector"&&x!=="geojson"||a.sourceCaches[_].reload()}})}),this.on("data",u=>{if(u.dataType!=="source"||u.sourceDataType!=="metadata")return;const h=this.sourceCaches[u.sourceId];if(!h)return;const g=h.getSource();if(g&&g.vectorLayerIds)for(const _ in this._layers){const x=this._layers[_];x.source===g.id&&this._validateLayer(x)}})}loadURL(t,s={},a){this.fire(new l.k("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const u=this.map._requestManager.transformRequest(t,vt.Style);this._request=l.f(u,(h,g)=>{this._request=null,h?this.fire(new l.j(h)):g&&this._load(g,s,a)})}loadJSON(t,s={},a){this.fire(new l.k("dataloading",{dataType:"style"})),this._request=l.h.frame(()=>{this._request=null,s.validate=s.validate!==!1,this._load(t,s,a)})}loadEmpty(){this.fire(new l.k("dataloading",{dataType:"style"})),this._load(hr,{validate:!1})}_load(t,s,a){var u;const h=s.transformStyle?s.transformStyle(a,t):t;if(!s.validate||!Oi(this,l.y(h))){this._loaded=!0,this.stylesheet=h;for(const g in h.sources)this.addSource(g,h.sources[g],{validate:!1});h.sprite?this._loadSprite(h.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(h.glyphs),this._createLayers(),this.light=new ys(this.stylesheet.light),this.map.setTerrain((u=this.stylesheet.terrain)!==null&&u!==void 0?u:null),this.fire(new l.k("data",{dataType:"style"})),this.fire(new l.k("style.load"))}}_createLayers(){const t=l.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",t),this._order=t.map(s=>s.id),this._layers={},this._serializedLayers=null;for(const s of t){const a=l.aC(s);a.setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=a}}_loadSprite(t,s=!1,a=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(u,h,g,_){const x=mi(u),b=x.length,C=g>1?"@2x":"",S={},z={},U={};for(const{id:V,url:G}of x){const O=h.transformRequest(h.normalizeSpriteURL(G,C,".json"),vt.SpriteJSON),re=`${V}_${O.url}`;S[re]=l.f(O,(ae,de)=>{delete S[re],z[V]=de,qs(_,z,U,ae,b)});const he=h.transformRequest(h.normalizeSpriteURL(G,C,".png"),vt.SpriteImage),K=`${V}_${he.url}`;S[K]=Ct.getImage(he,(ae,de)=>{delete S[K],U[V]=de,qs(_,z,U,ae,b)})}return{cancel(){for(const V of Object.values(S))V.cancel()}}}(t,this.map._requestManager,this.map.getPixelRatio(),(u,h)=>{if(this._spriteRequest=null,u)this.fire(new l.j(u));else if(h)for(const g in h){this._spritesImagesIds[g]=[];const _=this._spritesImagesIds[g]?this._spritesImagesIds[g].filter(x=>!(x in h)):[];for(const x of _)this.imageManager.removeImage(x),this._changedImages[x]=!0;for(const x in h[g]){const b=g==="default"?x:`${g}:${x}`;this._spritesImagesIds[g].push(b),b in this.imageManager.images?this.imageManager.updateImage(b,h[g][x],!1):this.imageManager.addImage(b,h[g][x]),s&&(this._changedImages[b]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"})),a&&a(u)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}_validateLayer(t){const s=this.sourceCaches[t.source];if(!s)return;const a=t.sourceLayer;if(!a)return;const u=s.getSource();(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(a)===-1)&&this.fire(new l.j(new Error(`Source layer "${a}" does not exist on source "${u.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const s=this._serializedAllLayers();if(!t||t.length===0)return Object.values(s);const a=[];for(const u of t)s[u]&&a.push(s[u]);return a}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const s=Object.keys(this._layers);for(const a of s){const u=this._layers[a];u.type!=="custom"&&(t[a]=u.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const s=this._changed;if(this._changed){const u=Object.keys(this._updatedLayers),h=Object.keys(this._removedLayers);(u.length||h.length)&&this._updateWorkerLayers(u,h);for(const g in this._updatedSources){const _=this._updatedSources[g];if(_==="reload")this._reloadSource(g);else{if(_!=="clear")throw new Error(`Invalid action ${_}`);this._clearSource(g)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const g in this._updatedPaintProps)this._layers[g].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const a={};for(const u in this.sourceCaches){const h=this.sourceCaches[u];a[u]=h.used,h.used=!1}for(const u of this._order){const h=this._layers[u];h.recalculate(t,this._availableImages),!h.isHidden(t.zoom)&&h.source&&(this.sourceCaches[h.source].used=!0)}for(const u in a){const h=this.sourceCaches[u];a[u]!==h.used&&h.fire(new l.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:u}))}this.light.recalculate(t),this.z=t.zoom,s&&this.fire(new l.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,s){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(t),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,s={}){this._checkLoaded();const a=this.serialize();if(t=s.transformStyle?s.transformStyle(a,t):t,Oi(this,l.y(t)))return!1;(t=l.aD(t)).layers=l.aB(t.layers);const u=l.aE(a,t).filter(g=>!(g.command in _o));if(u.length===0)return!1;const h=u.filter(g=>!(g.command in Qi));if(h.length>0)throw new Error(`Unimplemented: ${h.map(g=>g.command).join(", ")}.`);for(const g of u)g.command!=="setTransition"&&this[g.command].apply(this,g.args);return this.stylesheet=t,this._serializedLayers=null,!0}addImage(t,s){if(this.getImage(t))return this.fire(new l.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,s),this._afterImageUpdated(t)}updateImage(t,s){this.imageManager.updateImage(t,s)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new l.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,s,a={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(l.y.source,`sources.${t}`,s,null,a))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const u=this.sourceCaches[t]=new Ni(t,s,this.dispatcher);u.style=this,u.setEventedParent(this,()=>({isSourceLoaded:u.loaded(),source:u.serialize(),sourceId:t})),u.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const a in this._layers)if(this._layers[a].source===t)return this.fire(new l.j(new Error(`Source "${t}" cannot be removed while layer "${a}" is using it.`)));const s=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],s.fire(new l.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,s){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const a=this.sourceCaches[t].getSource();if(a.type!=="geojson")throw new Error(`geojsonSource.type is ${a.type}, which is !== 'geojson`);a.setData(s),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,s,a={}){this._checkLoaded();const u=t.id;if(this.getLayer(u))return void this.fire(new l.j(new Error(`Layer "${u}" already exists on this map.`)));let h;if(t.type==="custom"){if(Oi(this,l.aF(t)))return;h=l.aC(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(u,t.source),t=l.aD(t),t=l.e(t,{source:u})),this._validate(l.y.layer,`layers.${u}`,t,{arrayIndex:-1},a))return;h=l.aC(t),this._validateLayer(h),h.setEventedParent(this,{layer:{id:u}})}const g=s?this._order.indexOf(s):this._order.length;if(s&&g===-1)this.fire(new l.j(new Error(`Cannot add layer "${u}" before non-existing layer "${s}".`)));else{if(this._order.splice(g,0,u),this._layerOrderChanged=!0,this._layers[u]=h,this._removedLayers[u]&&h.source&&h.type!=="custom"){const _=this._removedLayers[u];delete this._removedLayers[u],_.type!==h.type?this._updatedSources[h.source]="clear":(this._updatedSources[h.source]="reload",this.sourceCaches[h.source].pause())}this._updateLayer(h),h.onAdd&&h.onAdd(this.map)}}moveLayer(t,s){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new l.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===s)return;const a=this._order.indexOf(t);this._order.splice(a,1);const u=s?this._order.indexOf(s):this._order.length;s&&u===-1?this.fire(new l.j(new Error(`Cannot move layer "${t}" before non-existing layer "${s}".`))):(this._order.splice(u,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const s=this._layers[t];if(!s)return void this.fire(new l.j(new Error(`Cannot remove non-existing layer "${t}".`)));s.setEventedParent(null);const a=this._order.indexOf(t);this._order.splice(a,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=s,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],s.onRemove&&s.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,s,a){this._checkLoaded();const u=this.getLayer(t);u?u.minzoom===s&&u.maxzoom===a||(s!=null&&(u.minzoom=s),a!=null&&(u.maxzoom=a),this._updateLayer(u)):this.fire(new l.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,s,a={}){this._checkLoaded();const u=this.getLayer(t);if(u){if(!l.aG(u.filter,s))return s==null?(u.filter=void 0,void this._updateLayer(u)):void(this._validate(l.y.filter,`layers.${u.id}.filter`,s,null,a)||(u.filter=l.aD(s),this._updateLayer(u)))}else this.fire(new l.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return l.aD(this.getLayer(t).filter)}setLayoutProperty(t,s,a,u={}){this._checkLoaded();const h=this.getLayer(t);h?l.aG(h.getLayoutProperty(s),a)||(h.setLayoutProperty(s,a,u),this._updateLayer(h)):this.fire(new l.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,s){const a=this.getLayer(t);if(a)return a.getLayoutProperty(s);this.fire(new l.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,s,a,u={}){this._checkLoaded();const h=this.getLayer(t);h?l.aG(h.getPaintProperty(s),a)||(h.setPaintProperty(s,a,u)&&this._updateLayer(h),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new l.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,s){return this.getLayer(t).getPaintProperty(s)}setFeatureState(t,s){this._checkLoaded();const a=t.source,u=t.sourceLayer,h=this.sourceCaches[a];if(h===void 0)return void this.fire(new l.j(new Error(`The source '${a}' does not exist in the map's style.`)));const g=h.getSource().type;g==="geojson"&&u?this.fire(new l.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):g!=="vector"||u?(t.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),h.setFeatureState(u,t.id,s)):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,s){this._checkLoaded();const a=t.source,u=this.sourceCaches[a];if(u===void 0)return void this.fire(new l.j(new Error(`The source '${a}' does not exist in the map's style.`)));const h=u.getSource().type,g=h==="vector"?t.sourceLayer:void 0;h!=="vector"||g?s&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new l.j(new Error("A feature id is required to remove its specific state property."))):u.removeFeatureState(g,t.id,s):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const s=t.source,a=t.sourceLayer,u=this.sourceCaches[s];if(u!==void 0)return u.getSource().type!=="vector"||a?(t.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),u.getFeatureState(a,t.id)):void this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.j(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=l.aH(this.sourceCaches,h=>h.serialize()),s=this._serializeByIds(this._order),a=this.map.getTerrain()||void 0,u=this.stylesheet;return l.aI({version:u.version,name:u.name,metadata:u.metadata,light:u.light,center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,sprite:u.sprite,glyphs:u.glyphs,transition:u.transition,sources:t,layers:s,terrain:a},h=>h!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const s=g=>this._layers[g].type==="fill-extrusion",a={},u=[];for(let g=this._order.length-1;g>=0;g--){const _=this._order[g];if(s(_)){a[_]=g;for(const x of t){const b=x[_];if(b)for(const C of b)u.push(C)}}}u.sort((g,_)=>_.intersectionZ-g.intersectionZ);const h=[];for(let g=this._order.length-1;g>=0;g--){const _=this._order[g];if(s(_))for(let x=u.length-1;x>=0;x--){const b=u[x].feature;if(a[b.layer.id]<g)break;h.push(b),u.pop()}else for(const x of t){const b=x[_];if(b)for(const C of b)h.push(C.feature)}}return h}queryRenderedFeatures(t,s,a){s&&s.filter&&this._validate(l.y.filter,"queryRenderedFeatures.filter",s.filter,null,s);const u={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new l.j(new Error("parameters.layers must be an Array."))),[];for(const _ of s.layers){const x=this._layers[_];if(!x)return this.fire(new l.j(new Error(`The layer '${_}' does not exist in the map's style and cannot be queried for features.`))),[];u[x.source]=!0}}const h=[];s.availableImages=this._availableImages;const g=this._serializedAllLayers();for(const _ in this.sourceCaches)s.layers&&!u[_]||h.push(bs(this.sourceCaches[_],this._layers,g,t,s,a));return this.placement&&h.push(function(_,x,b,C,S,z,U){const V={},G=z.queryRenderedSymbols(C),O=[];for(const re of Object.keys(G).map(Number))O.push(U[re]);O.sort(is);for(const re of O){const he=re.featureIndex.lookupSymbolFeatures(G[re.bucketInstanceId],x,re.bucketIndex,re.sourceLayerIndex,S.filter,S.layers,S.availableImages,_);for(const K in he){const ae=V[K]=V[K]||[],de=he[K];de.sort((fe,we)=>{const De=re.featureSortOrder;if(De){const Ce=De.indexOf(fe.featureIndex);return De.indexOf(we.featureIndex)-Ce}return we.featureIndex-fe.featureIndex});for(const fe of de)ae.push(fe)}}for(const re in V)V[re].forEach(he=>{const K=he.feature,ae=b[_[re].source].getFeatureState(K.layer["source-layer"],K.id);K.source=K.layer.source,K.layer["source-layer"]&&(K.sourceLayer=K.layer["source-layer"]),K.state=ae});return V}(this._layers,g,this.sourceCaches,t,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(h)}querySourceFeatures(t,s){s&&s.filter&&this._validate(l.y.filter,"querySourceFeatures.filter",s.filter,null,s);const a=this.sourceCaches[t];return a?function(u,h){const g=u.getRenderableIds().map(b=>u.getTileByID(b)),_=[],x={};for(let b=0;b<g.length;b++){const C=g[b],S=C.tileID.canonical.key;x[S]||(x[S]=!0,C.querySourceFeatures(_,h))}return _}(a,s):[]}addSourceType(t,s,a){return Zr(t)?a(new Error(`A source type called "${t}" already exists.`)):(((u,h)=>{vs[u]=h})(t,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:s.workerSourceURL},a):a(null,null))}getLight(){return this.light.getLight()}setLight(t,s={}){this._checkLoaded();const a=this.light.getLight();let u=!1;for(const g in t)if(!l.aG(t[g],a[g])){u=!0;break}if(!u)return;const h={now:l.h.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,s),this.light.updateTransitions(h)}_validate(t,s,a,u,h={}){return(!h||h.validate!==!1)&&Oi(this,t.call(l.y,l.e({key:s,style:this.serialize(),value:a,styleSpec:l.v},u)))}_remove(t=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const a=this.sourceCaches[s];a.setEventedParent(null),a.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const s in this.sourceCaches)this.sourceCaches[s].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,s,a,u,h=!1){let g=!1,_=!1;const x={};for(const b of this._order){const C=this._layers[b];if(C.type!=="symbol")continue;if(!x[C.source]){const z=this.sourceCaches[C.source];x[C.source]=z.getRenderableIds(!0).map(U=>z.getTileByID(U)).sort((U,V)=>V.tileID.overscaledZ-U.tileID.overscaledZ||(U.tileID.isLessThan(V.tileID)?-1:1))}const S=this.crossTileSymbolIndex.addLayer(C,x[C.source],t.center.lng);g=g||S}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((h=h||this._layerOrderChanged||a===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.h.now(),t.zoom))&&(this.pauseablePlacement=new Ss(t,this.map.terrain,this._order,h,s,a,u,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,x),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.h.now()),_=!0),g&&this.pauseablePlacement.placement.setStale()),_||g)for(const b of this._order){const C=this._layers[b];C.type==="symbol"&&this.placement.updateLayerOpacities(C,x[C.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.h.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,s,a){this.imageManager.getImages(s.icons,a),this._updateTilesForChangedImages();const u=this.sourceCaches[s.source];u&&u.setDependencies(s.tileID.key,s.type,s.icons)}getGlyphs(t,s,a){this.glyphManager.getGlyphs(s.stacks,a);const u=this.sourceCaches[s.source];u&&u.setDependencies(s.tileID.key,s.type,[""])}getResource(t,s,a){return l.m(s,a)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,s={}){this._checkLoaded(),t&&this._validate(l.y.glyphs,"glyphs",t,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,s,a={},u){this._checkLoaded();const h=[{id:t,url:s}],g=[...mi(this.stylesheet.sprite),...h];this._validate(l.y.sprite,"sprite",g,null,a)||(this.stylesheet.sprite=g,this._loadSprite(h,!0,u))}removeSprite(t){this._checkLoaded();const s=mi(this.stylesheet.sprite);if(s.find(a=>a.id===t)){if(this._spritesImagesIds[t])for(const a of this._spritesImagesIds[t])this.imageManager.removeImage(a),this._changedImages[a]=!0;s.splice(s.findIndex(a=>a.id===t),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}else this.fire(new l.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return mi(this.stylesheet.sprite)}setSprite(t,s={},a){this._checkLoaded(),t&&this._validate(l.y.sprite,"sprite",t,null,s)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,a):(this._unloadSprite(),a&&a(null)))}}vi.registerForPluginStateChange=l.aK;var In=l.Q([{name:"a_pos",type:"Int16",components:2}]),Cr="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const jt={prelude:kt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:kt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:kt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:kt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:kt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:kt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:kt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:kt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:kt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:kt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:kt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:kt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:kt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:kt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:kt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:kt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:kt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:kt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:kt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:kt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:kt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:kt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:kt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:kt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:kt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:kt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:kt("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Cr),terrainDepth:kt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Cr),terrainCoords:kt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Cr)};function kt(c,t){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,a=t.match(/attribute ([\w]+) ([\w]+)/g),u=c.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),h=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=h?h.concat(u):u,_={};return{fragmentSource:c=c.replace(s,(x,b,C,S,z)=>(_[z]=!0,b==="define"?`
#ifndef HAS_UNIFORM_u_${z}
varying ${C} ${S} ${z};
#else
uniform ${C} ${S} u_${z};
#endif
`:`
#ifdef HAS_UNIFORM_u_${z}
    ${C} ${S} ${z} = u_${z};
#endif
`)),vertexSource:t=t.replace(s,(x,b,C,S,z)=>{const U=S==="float"?"vec2":"vec4",V=z.match(/color/)?"color":U;return _[z]?b==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
attribute ${C} ${U} a_${z};
varying ${C} ${S} ${z};
#else
uniform ${C} ${S} u_${z};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = a_${z};
#else
    ${C} ${S} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = unpack_mix_${V}(a_${z}, u_${z}_t);
#else
    ${C} ${S} ${z} = u_${z};
#endif
`:b==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
attribute ${C} ${U} a_${z};
#else
uniform ${C} ${S} u_${z};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${C} ${S} ${z} = a_${z};
#else
    ${C} ${S} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${C} ${S} ${z} = unpack_mix_${V}(a_${z}, u_${z}_t);
#else
    ${C} ${S} ${z} = u_${z};
#endif
`}),staticAttributes:a,staticUniforms:g}}class ks{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,s,a,u,h,g,_,x,b){this.context=t;let C=this.boundPaintVertexBuffers.length!==u.length;for(let S=0;!C&&S<u.length;S++)this.boundPaintVertexBuffers[S]!==u[S]&&(C=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==a||C||this.boundIndexBuffer!==h||this.boundVertexOffset!==g||this.boundDynamicVertexBuffer!==_||this.boundDynamicVertexBuffer2!==x||this.boundDynamicVertexBuffer3!==b?this.freshBind(s,a,u,h,g,_,x,b):(t.bindVertexArray.set(this.vao),_&&_.bind(),h&&h.dynamicDraw&&h.bind(),x&&x.bind(),b&&b.bind())}freshBind(t,s,a,u,h,g,_,x){const b=t.numAttributes,C=this.context,S=C.gl;this.vao&&this.destroy(),this.vao=C.createVertexArray(),C.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=u,this.boundVertexOffset=h,this.boundDynamicVertexBuffer=g,this.boundDynamicVertexBuffer2=_,this.boundDynamicVertexBuffer3=x,s.enableAttributes(S,t);for(const z of a)z.enableAttributes(S,t);g&&g.enableAttributes(S,t),_&&_.enableAttributes(S,t),x&&x.enableAttributes(S,t),s.bind(),s.setVertexAttribPointers(S,t,h);for(const z of a)z.bind(),z.setVertexAttribPointers(S,t,h);g&&(g.bind(),g.setVertexAttribPointers(S,t,h)),u&&u.bind(),_&&(_.bind(),_.setVertexAttribPointers(S,t,h)),x&&(x.bind(),x.setVertexAttribPointers(S,t,h)),C.currentNumAttributes=b}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function si(c){const t=[];for(let s=0;s<c.length;s++){if(c[s]===null)continue;const a=c[s].split(" ");t.push(a.pop())}return t}class on{constructor(t,s,a,u,h,g){const _=t.gl;this.program=_.createProgram();const x=si(s.staticAttributes),b=a?a.getBinderAttributes():[],C=x.concat(b),S=jt.prelude.staticUniforms?si(jt.prelude.staticUniforms):[],z=s.staticUniforms?si(s.staticUniforms):[],U=a?a.getBinderUniforms():[],V=S.concat(z).concat(U),G=[];for(const fe of V)G.indexOf(fe)<0&&G.push(fe);const O=a?a.defines():[];h&&O.push("#define OVERDRAW_INSPECTOR;"),g&&O.push("#define TERRAIN3D;");const re=O.concat(jt.prelude.fragmentSource,s.fragmentSource).join(`
`),he=O.concat(jt.prelude.vertexSource,s.vertexSource).join(`
`),K=_.createShader(_.FRAGMENT_SHADER);if(_.isContextLost())return void(this.failedToCreate=!0);if(_.shaderSource(K,re),_.compileShader(K),!_.getShaderParameter(K,_.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${_.getShaderInfoLog(K)}`);_.attachShader(this.program,K);const ae=_.createShader(_.VERTEX_SHADER);if(_.isContextLost())return void(this.failedToCreate=!0);if(_.shaderSource(ae,he),_.compileShader(ae),!_.getShaderParameter(ae,_.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${_.getShaderInfoLog(ae)}`);_.attachShader(this.program,ae),this.attributes={};const de={};this.numAttributes=C.length;for(let fe=0;fe<this.numAttributes;fe++)C[fe]&&(_.bindAttribLocation(this.program,fe,C[fe]),this.attributes[C[fe]]=fe);if(_.linkProgram(this.program),!_.getProgramParameter(this.program,_.LINK_STATUS))throw new Error(`Program failed to link: ${_.getProgramInfoLog(this.program)}`);_.deleteShader(ae),_.deleteShader(K);for(let fe=0;fe<G.length;fe++){const we=G[fe];if(we&&!de[we]){const De=_.getUniformLocation(this.program,we);De&&(de[we]=De)}}this.fixedUniforms=u(t,de),this.terrainUniforms=((fe,we)=>({u_depth:new l.aL(fe,we.u_depth),u_terrain:new l.aL(fe,we.u_terrain),u_terrain_dim:new l.aM(fe,we.u_terrain_dim),u_terrain_matrix:new l.aN(fe,we.u_terrain_matrix),u_terrain_unpack:new l.aO(fe,we.u_terrain_unpack),u_terrain_exaggeration:new l.aM(fe,we.u_terrain_exaggeration)}))(t,de),this.binderUniforms=a?a.getUniforms(t,de):[]}draw(t,s,a,u,h,g,_,x,b,C,S,z,U,V,G,O,re,he){const K=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(a),t.setStencilMode(u),t.setColorMode(h),t.setCullFace(g),x){t.activeTexture.set(K.TEXTURE2),K.bindTexture(K.TEXTURE_2D,x.depthTexture),t.activeTexture.set(K.TEXTURE3),K.bindTexture(K.TEXTURE_2D,x.texture);for(const de in this.terrainUniforms)this.terrainUniforms[de].set(x[de])}for(const de in this.fixedUniforms)this.fixedUniforms[de].set(_[de]);G&&G.setUniforms(t,this.binderUniforms,U,{zoom:V});let ae=0;switch(s){case K.LINES:ae=2;break;case K.TRIANGLES:ae=3;break;case K.LINE_STRIP:ae=1}for(const de of z.get()){const fe=de.vaos||(de.vaos={});(fe[b]||(fe[b]=new ks)).bind(t,this,C,G?G.getPaintVertexBuffers():[],S,de.vertexOffset,O,re,he),K.drawElements(s,de.primitiveLength*ae,K.UNSIGNED_SHORT,de.primitiveOffset*ae*2)}}}function pr(c,t,s){const a=1/ie(s,1,t.transform.tileZoom),u=Math.pow(2,s.tileID.overscaledZ),h=s.tileSize*Math.pow(2,t.transform.tileZoom)/u,g=h*(s.tileID.canonical.x+s.tileID.wrap*u),_=h*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[a,c.fromScale,c.toScale],u_fade:c.t,u_pixel_coord_upper:[g>>16,_>>16],u_pixel_coord_lower:[65535&g,65535&_]}}const ns=(c,t,s,a)=>{const u=t.style.light,h=u.properties.get("position"),g=[h.x,h.y,h.z],_=function(){var b=new l.A(9);return l.A!=Float32Array&&(b[1]=0,b[2]=0,b[3]=0,b[5]=0,b[6]=0,b[7]=0),b[0]=1,b[4]=1,b[8]=1,b}();u.properties.get("anchor")==="viewport"&&function(b,C){var S=Math.sin(C),z=Math.cos(C);b[0]=z,b[1]=S,b[2]=0,b[3]=-S,b[4]=z,b[5]=0,b[6]=0,b[7]=0,b[8]=1}(_,-t.transform.angle),function(b,C,S){var z=C[0],U=C[1],V=C[2];b[0]=z*S[0]+U*S[3]+V*S[6],b[1]=z*S[1]+U*S[4]+V*S[7],b[2]=z*S[2]+U*S[5]+V*S[8]}(g,g,_);const x=u.properties.get("color");return{u_matrix:c,u_lightpos:g,u_lightintensity:u.properties.get("intensity"),u_lightcolor:[x.r,x.g,x.b],u_vertical_gradient:+s,u_opacity:a}},er=(c,t,s,a,u,h,g)=>l.e(ns(c,t,s,a),pr(h,t,g),{u_height_factor:-Math.pow(2,u.overscaledZ)/g.tileSize/8}),aa=c=>({u_matrix:c}),oa=(c,t,s,a)=>l.e(aa(c),pr(s,t,a)),Fn=(c,t)=>({u_matrix:c,u_world:t}),Bn=(c,t,s,a,u)=>l.e(oa(c,t,s,a),{u_world:u}),as=(c,t,s,a)=>{const u=c.transform;let h,g;if(a.paint.get("circle-pitch-alignment")==="map"){const _=ie(s,1,u.zoom);h=!0,g=[_,_]}else h=!1,g=u.pixelsToGLUnits;return{u_camera_to_center_distance:u.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_matrix:c.translatePosMatrix(t.posMatrix,s,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")),u_pitch_with_map:+h,u_device_pixel_ratio:c.pixelRatio,u_extrude_scale:g}},zn=(c,t,s)=>{const a=ie(s,1,t.zoom),u=Math.pow(2,t.zoom-s.tileID.overscaledZ),h=s.tileID.overscaleFactor();return{u_matrix:c,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:a,u_extrude_scale:[t.pixelsToGLUnits[0]/(a*u),t.pixelsToGLUnits[1]/(a*u)],u_overscale_factor:h}},Ws=(c,t,s=1)=>({u_matrix:c,u_color:t,u_overlay:0,u_overlay_scale:s}),la=c=>({u_matrix:c}),Va=(c,t,s,a)=>({u_matrix:c,u_extrude_scale:ie(t,1,s),u_intensity:a});function ua(c,t){const s=Math.pow(2,t.canonical.z),a=t.canonical.y;return[new l.U(0,a/s).toLngLat().lat,new l.U(0,(a+1)/s).toLngLat().lat]}const ca=(c,t,s,a)=>{const u=c.transform;return{u_matrix:Mn(c,t,s,a),u_ratio:1/ie(t,1,u.zoom),u_device_pixel_ratio:c.pixelRatio,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]]}},Ua=(c,t,s,a,u)=>l.e(ca(c,t,s,u),{u_image:0,u_image_height:a}),yo=(c,t,s,a,u)=>{const h=c.transform,g=ja(t,h);return{u_matrix:Mn(c,t,s,u),u_texsize:t.imageAtlasTexture.size,u_ratio:1/ie(t,1,h.zoom),u_device_pixel_ratio:c.pixelRatio,u_image:0,u_scale:[g,a.fromScale,a.toScale],u_fade:a.t,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},qa=(c,t,s,a,u,h)=>{const g=c.lineAtlas,_=ja(t,c.transform),x=s.layout.get("line-cap")==="round",b=g.getDash(a.from,x),C=g.getDash(a.to,x),S=b.width*u.fromScale,z=C.width*u.toScale;return l.e(ca(c,t,s,h),{u_patternscale_a:[_/S,-b.height/2],u_patternscale_b:[_/z,-C.height/2],u_sdfgamma:g.width/(256*Math.min(S,z)*c.pixelRatio)/2,u_image:0,u_tex_y_a:b.y,u_tex_y_b:C.y,u_mix:u.t})};function ja(c,t){return 1/ie(c,1,t.tileZoom)}function Mn(c,t,s,a){return c.translatePosMatrix(a?a.posMatrix:t.tileID.posMatrix,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const Za=(c,t,s,a,u)=>{return{u_matrix:c,u_tl_parent:t,u_scale_parent:s,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(g=u.paint.get("raster-saturation"),g>0?1-1/(1.001-g):-g),u_contrast_factor:(h=u.paint.get("raster-contrast"),h>0?1/(1-h):1+h),u_spin_weights:Ga(u.paint.get("raster-hue-rotate"))};var h,g};function Ga(c){c*=Math.PI/180;const t=Math.sin(c),s=Math.cos(c);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const ha=(c,t,s,a,u,h,g,_,x,b)=>{const C=u.transform;return{u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:C.cameraToCenterDistance,u_pitch:C.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:C.width/C.height,u_fade_change:u.options.fadeDuration?u.symbolFadeChange:1,u_matrix:h,u_label_plane_matrix:g,u_coord_matrix:_,u_is_text:+x,u_pitch_with_map:+a,u_texsize:b,u_texture:0}},pa=(c,t,s,a,u,h,g,_,x,b,C)=>{const S=u.transform;return l.e(ha(c,t,s,a,u,h,g,_,x,b),{u_gamma_scale:a?Math.cos(S._pitch)*S.cameraToCenterDistance:1,u_device_pixel_ratio:u.pixelRatio,u_is_halo:1})},Ts=(c,t,s,a,u,h,g,_,x,b)=>l.e(pa(c,t,s,a,u,h,g,_,!0,x),{u_texsize_icon:b,u_texture_icon:1}),Pn=(c,t,s)=>({u_matrix:c,u_opacity:t,u_color:s}),dr=(c,t,s,a,u,h)=>l.e(function(g,_,x,b){const C=x.imageManager.getPattern(g.from.toString()),S=x.imageManager.getPattern(g.to.toString()),{width:z,height:U}=x.imageManager.getPixelSize(),V=Math.pow(2,b.tileID.overscaledZ),G=b.tileSize*Math.pow(2,x.transform.tileZoom)/V,O=G*(b.tileID.canonical.x+b.tileID.wrap*V),re=G*b.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:C.tl,u_pattern_br_a:C.br,u_pattern_tl_b:S.tl,u_pattern_br_b:S.br,u_texsize:[z,U],u_mix:_.t,u_pattern_size_a:C.displaySize,u_pattern_size_b:S.displaySize,u_scale_a:_.fromScale,u_scale_b:_.toScale,u_tile_units_to_pixels:1/ie(b,1,x.transform.tileZoom),u_pixel_coord_upper:[O>>16,re>>16],u_pixel_coord_lower:[65535&O,65535&re]}}(a,h,s,u),{u_matrix:c,u_opacity:t}),I={fillExtrusion:(c,t)=>({u_matrix:new l.aN(c,t.u_matrix),u_lightpos:new l.aP(c,t.u_lightpos),u_lightintensity:new l.aM(c,t.u_lightintensity),u_lightcolor:new l.aP(c,t.u_lightcolor),u_vertical_gradient:new l.aM(c,t.u_vertical_gradient),u_opacity:new l.aM(c,t.u_opacity)}),fillExtrusionPattern:(c,t)=>({u_matrix:new l.aN(c,t.u_matrix),u_lightpos:new l.aP(c,t.u_lightpos),u_lightintensity:new l.aM(c,t.u_lightintensity),u_lightcolor:new l.aP(c,t.u_lightcolor),u_vertical_gradient:new l.aM(c,t.u_vertical_gradient),u_height_factor:new l.aM(c,t.u_height_factor),u_image:new l.aL(c,t.u_image),u_texsize:new l.aQ(c,t.u_texsize),u_pixel_coord_upper:new l.aQ(c,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.aQ(c,t.u_pixel_coord_lower),u_scale:new l.aP(c,t.u_scale),u_fade:new l.aM(c,t.u_fade),u_opacity:new l.aM(c,t.u_opacity)}),fill:(c,t)=>({u_matrix:new l.aN(c,t.u_matrix)}),fillPattern:(c,t)=>({u_matrix:new l.aN(c,t.u_matrix),u_image:new l.aL(c,t.u_image),u_texsize:new l.aQ(c,t.u_texsize),u_pixel_coord_upper:new l.aQ(c,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.aQ(c,t.u_pixel_coord_lower),u_scale:new l.aP(c,t.u_scale),u_fade:new l.aM(c,t.u_fade)}),fillOutline:(c,t)=>({u_matrix:new l.aN(c,t.u_matrix),u_world:new l.aQ(c,t.u_world)}),fillOutlinePattern:(c,t)=>({u_matrix:new l.aN(c,t.u_matrix),u_world:new l.aQ(c,t.u_world),u_image:new l.aL(c,t.u_image),u_texsize:new l.aQ(c,t.u_texsize),u_pixel_coord_upper:new l.aQ(c,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.aQ(c,t.u_pixel_coord_lower),u_scale:new l.aP(c,t.u_scale),u_fade:new l.aM(c,t.u_fade)}),circle:(c,t)=>({u_camera_to_center_distance:new l.aM(c,t.u_camera_to_center_distance),u_scale_with_map:new l.aL(c,t.u_scale_with_map),u_pitch_with_map:new l.aL(c,t.u_pitch_with_map),u_extrude_scale:new l.aQ(c,t.u_extrude_scale),u_device_pixel_ratio:new l.aM(c,t.u_device_pixel_ratio),u_matrix:new l.aN(c,t.u_matrix)}),collisionBox:(c,t)=>({u_matrix:new l.aN(c,t.u_matrix),u_camera_to_center_distance:new l.aM(c,t.u_camera_to_center_distance),u_pixels_to_tile_units:new l.aM(c,t.u_pixels_to_tile_units),u_extrude_scale:new l.aQ(c,t.u_extrude_scale),u_overscale_factor:new l.aM(c,t.u_overscale_factor)}),collisionCircle:(c,t)=>({u_matrix:new l.aN(c,t.u_matrix),u_inv_matrix:new l.aN(c,t.u_inv_matrix),u_camera_to_center_distance:new l.aM(c,t.u_camera_to_center_distance),u_viewport_size:new l.aQ(c,t.u_viewport_size)}),debug:(c,t)=>({u_color:new l.aR(c,t.u_color),u_matrix:new l.aN(c,t.u_matrix),u_overlay:new l.aL(c,t.u_overlay),u_overlay_scale:new l.aM(c,t.u_overlay_scale)}),clippingMask:(c,t)=>({u_matrix:new l.aN(c,t.u_matrix)}),heatmap:(c,t)=>({u_extrude_scale:new l.aM(c,t.u_extrude_scale),u_intensity:new l.aM(c,t.u_intensity),u_matrix:new l.aN(c,t.u_matrix)}),heatmapTexture:(c,t)=>({u_matrix:new l.aN(c,t.u_matrix),u_world:new l.aQ(c,t.u_world),u_image:new l.aL(c,t.u_image),u_color_ramp:new l.aL(c,t.u_color_ramp),u_opacity:new l.aM(c,t.u_opacity)}),hillshade:(c,t)=>({u_matrix:new l.aN(c,t.u_matrix),u_image:new l.aL(c,t.u_image),u_latrange:new l.aQ(c,t.u_latrange),u_light:new l.aQ(c,t.u_light),u_shadow:new l.aR(c,t.u_shadow),u_highlight:new l.aR(c,t.u_highlight),u_accent:new l.aR(c,t.u_accent)}),hillshadePrepare:(c,t)=>({u_matrix:new l.aN(c,t.u_matrix),u_image:new l.aL(c,t.u_image),u_dimension:new l.aQ(c,t.u_dimension),u_zoom:new l.aM(c,t.u_zoom),u_unpack:new l.aO(c,t.u_unpack)}),line:(c,t)=>({u_matrix:new l.aN(c,t.u_matrix),u_ratio:new l.aM(c,t.u_ratio),u_device_pixel_ratio:new l.aM(c,t.u_device_pixel_ratio),u_units_to_pixels:new l.aQ(c,t.u_units_to_pixels)}),lineGradient:(c,t)=>({u_matrix:new l.aN(c,t.u_matrix),u_ratio:new l.aM(c,t.u_ratio),u_device_pixel_ratio:new l.aM(c,t.u_device_pixel_ratio),u_units_to_pixels:new l.aQ(c,t.u_units_to_pixels),u_image:new l.aL(c,t.u_image),u_image_height:new l.aM(c,t.u_image_height)}),linePattern:(c,t)=>({u_matrix:new l.aN(c,t.u_matrix),u_texsize:new l.aQ(c,t.u_texsize),u_ratio:new l.aM(c,t.u_ratio),u_device_pixel_ratio:new l.aM(c,t.u_device_pixel_ratio),u_image:new l.aL(c,t.u_image),u_units_to_pixels:new l.aQ(c,t.u_units_to_pixels),u_scale:new l.aP(c,t.u_scale),u_fade:new l.aM(c,t.u_fade)}),lineSDF:(c,t)=>({u_matrix:new l.aN(c,t.u_matrix),u_ratio:new l.aM(c,t.u_ratio),u_device_pixel_ratio:new l.aM(c,t.u_device_pixel_ratio),u_units_to_pixels:new l.aQ(c,t.u_units_to_pixels),u_patternscale_a:new l.aQ(c,t.u_patternscale_a),u_patternscale_b:new l.aQ(c,t.u_patternscale_b),u_sdfgamma:new l.aM(c,t.u_sdfgamma),u_image:new l.aL(c,t.u_image),u_tex_y_a:new l.aM(c,t.u_tex_y_a),u_tex_y_b:new l.aM(c,t.u_tex_y_b),u_mix:new l.aM(c,t.u_mix)}),raster:(c,t)=>({u_matrix:new l.aN(c,t.u_matrix),u_tl_parent:new l.aQ(c,t.u_tl_parent),u_scale_parent:new l.aM(c,t.u_scale_parent),u_buffer_scale:new l.aM(c,t.u_buffer_scale),u_fade_t:new l.aM(c,t.u_fade_t),u_opacity:new l.aM(c,t.u_opacity),u_image0:new l.aL(c,t.u_image0),u_image1:new l.aL(c,t.u_image1),u_brightness_low:new l.aM(c,t.u_brightness_low),u_brightness_high:new l.aM(c,t.u_brightness_high),u_saturation_factor:new l.aM(c,t.u_saturation_factor),u_contrast_factor:new l.aM(c,t.u_contrast_factor),u_spin_weights:new l.aP(c,t.u_spin_weights)}),symbolIcon:(c,t)=>({u_is_size_zoom_constant:new l.aL(c,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aL(c,t.u_is_size_feature_constant),u_size_t:new l.aM(c,t.u_size_t),u_size:new l.aM(c,t.u_size),u_camera_to_center_distance:new l.aM(c,t.u_camera_to_center_distance),u_pitch:new l.aM(c,t.u_pitch),u_rotate_symbol:new l.aL(c,t.u_rotate_symbol),u_aspect_ratio:new l.aM(c,t.u_aspect_ratio),u_fade_change:new l.aM(c,t.u_fade_change),u_matrix:new l.aN(c,t.u_matrix),u_label_plane_matrix:new l.aN(c,t.u_label_plane_matrix),u_coord_matrix:new l.aN(c,t.u_coord_matrix),u_is_text:new l.aL(c,t.u_is_text),u_pitch_with_map:new l.aL(c,t.u_pitch_with_map),u_texsize:new l.aQ(c,t.u_texsize),u_texture:new l.aL(c,t.u_texture)}),symbolSDF:(c,t)=>({u_is_size_zoom_constant:new l.aL(c,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aL(c,t.u_is_size_feature_constant),u_size_t:new l.aM(c,t.u_size_t),u_size:new l.aM(c,t.u_size),u_camera_to_center_distance:new l.aM(c,t.u_camera_to_center_distance),u_pitch:new l.aM(c,t.u_pitch),u_rotate_symbol:new l.aL(c,t.u_rotate_symbol),u_aspect_ratio:new l.aM(c,t.u_aspect_ratio),u_fade_change:new l.aM(c,t.u_fade_change),u_matrix:new l.aN(c,t.u_matrix),u_label_plane_matrix:new l.aN(c,t.u_label_plane_matrix),u_coord_matrix:new l.aN(c,t.u_coord_matrix),u_is_text:new l.aL(c,t.u_is_text),u_pitch_with_map:new l.aL(c,t.u_pitch_with_map),u_texsize:new l.aQ(c,t.u_texsize),u_texture:new l.aL(c,t.u_texture),u_gamma_scale:new l.aM(c,t.u_gamma_scale),u_device_pixel_ratio:new l.aM(c,t.u_device_pixel_ratio),u_is_halo:new l.aL(c,t.u_is_halo)}),symbolTextAndIcon:(c,t)=>({u_is_size_zoom_constant:new l.aL(c,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aL(c,t.u_is_size_feature_constant),u_size_t:new l.aM(c,t.u_size_t),u_size:new l.aM(c,t.u_size),u_camera_to_center_distance:new l.aM(c,t.u_camera_to_center_distance),u_pitch:new l.aM(c,t.u_pitch),u_rotate_symbol:new l.aL(c,t.u_rotate_symbol),u_aspect_ratio:new l.aM(c,t.u_aspect_ratio),u_fade_change:new l.aM(c,t.u_fade_change),u_matrix:new l.aN(c,t.u_matrix),u_label_plane_matrix:new l.aN(c,t.u_label_plane_matrix),u_coord_matrix:new l.aN(c,t.u_coord_matrix),u_is_text:new l.aL(c,t.u_is_text),u_pitch_with_map:new l.aL(c,t.u_pitch_with_map),u_texsize:new l.aQ(c,t.u_texsize),u_texsize_icon:new l.aQ(c,t.u_texsize_icon),u_texture:new l.aL(c,t.u_texture),u_texture_icon:new l.aL(c,t.u_texture_icon),u_gamma_scale:new l.aM(c,t.u_gamma_scale),u_device_pixel_ratio:new l.aM(c,t.u_device_pixel_ratio),u_is_halo:new l.aL(c,t.u_is_halo)}),background:(c,t)=>({u_matrix:new l.aN(c,t.u_matrix),u_opacity:new l.aM(c,t.u_opacity),u_color:new l.aR(c,t.u_color)}),backgroundPattern:(c,t)=>({u_matrix:new l.aN(c,t.u_matrix),u_opacity:new l.aM(c,t.u_opacity),u_image:new l.aL(c,t.u_image),u_pattern_tl_a:new l.aQ(c,t.u_pattern_tl_a),u_pattern_br_a:new l.aQ(c,t.u_pattern_br_a),u_pattern_tl_b:new l.aQ(c,t.u_pattern_tl_b),u_pattern_br_b:new l.aQ(c,t.u_pattern_br_b),u_texsize:new l.aQ(c,t.u_texsize),u_mix:new l.aM(c,t.u_mix),u_pattern_size_a:new l.aQ(c,t.u_pattern_size_a),u_pattern_size_b:new l.aQ(c,t.u_pattern_size_b),u_scale_a:new l.aM(c,t.u_scale_a),u_scale_b:new l.aM(c,t.u_scale_b),u_pixel_coord_upper:new l.aQ(c,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.aQ(c,t.u_pixel_coord_lower),u_tile_units_to_pixels:new l.aM(c,t.u_tile_units_to_pixels)}),terrain:(c,t)=>({u_matrix:new l.aN(c,t.u_matrix),u_texture:new l.aL(c,t.u_texture),u_ele_delta:new l.aM(c,t.u_ele_delta)}),terrainDepth:(c,t)=>({u_matrix:new l.aN(c,t.u_matrix),u_ele_delta:new l.aM(c,t.u_ele_delta)}),terrainCoords:(c,t)=>({u_matrix:new l.aN(c,t.u_matrix),u_texture:new l.aL(c,t.u_texture),u_terrain_coords_id:new l.aM(c,t.u_terrain_coords_id),u_ele_delta:new l.aM(c,t.u_ele_delta)})};class ht{constructor(t,s,a){this.context=t;const u=t.gl;this.buffer=u.createBuffer(),this.dynamicDraw=!!a,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const os={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class tr{constructor(t,s,a,u){this.length=s.length,this.attributes=a,this.itemSize=s.bytesPerElement,this.dynamicDraw=u,this.context=t;const h=t.gl;this.buffer=h.createBuffer(),t.bindVertexBuffer.set(this.buffer),h.bufferData(h.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let a=0;a<this.attributes.length;a++){const u=s.attributes[this.attributes[a].name];u!==void 0&&t.enableVertexAttribArray(u)}}setVertexAttribPointers(t,s,a){for(let u=0;u<this.attributes.length;u++){const h=this.attributes[u],g=s.attributes[h.name];g!==void 0&&t.vertexAttribPointer(g,h.components,t[os[h.type]],!1,this.itemSize,h.offset+this.itemSize*(a||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ls=new WeakMap;function me(c){var t;if(ls.has(c))return ls.get(c);{const s=(t=c.getParameter(c.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return ls.set(c,s),s}}class dt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ln extends dt{getDefault(){return l.aT.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class st extends dt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Yt extends dt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class da extends dt{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Ln extends dt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class fr extends dt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Rn extends dt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class On extends dt{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Se extends dt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class fa extends dt{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class $n extends dt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class un extends dt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class ma extends dt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class Nn extends dt{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Xs extends dt{getDefault(){return l.aT.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Vn extends dt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Ha extends dt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class xo extends dt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Wa extends dt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class vo extends dt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class ga extends dt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class _a extends dt{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Ks extends dt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Un extends dt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class mr extends dt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Ds extends dt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Xa extends dt{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ya extends dt{getDefault(){return null}set(t){var s;if(t===this.current&&!this.dirty)return;const a=this.gl;me(a)?a.bindVertexArray(t):(s=a.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class qn extends dt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class us extends dt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Ka extends dt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Rr extends dt{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class Is extends Rr{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Ya extends Rr{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class jn extends Rr{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Dt{constructor(t,s,a,u,h){this.context=t,this.width=s,this.height=a;const g=t.gl,_=this.framebuffer=g.createFramebuffer();if(this.colorAttachment=new Is(t,_),u)this.depthAttachment=h?new jn(t,_):new Ya(t,_);else if(h)throw new Error("Stencil cannot be setted without depth");if(g.checkFramebufferStatus(g.FRAMEBUFFER)!==g.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,s=this.colorAttachment.get();if(s&&t.deleteTexture(s),this.depthAttachment){const a=this.depthAttachment.get();a&&t.deleteRenderbuffer(a)}t.deleteFramebuffer(this.framebuffer)}}class Jt{constructor(t,s,a){this.blendFunction=t,this.blendColor=s,this.mask=a}}Jt.Replace=[1,0],Jt.disabled=new Jt(Jt.Replace,l.aT.transparent,[!1,!1,!1,!1]),Jt.unblended=new Jt(Jt.Replace,l.aT.transparent,[!0,!0,!0,!0]),Jt.alphaBlended=new Jt([1,771],l.aT.transparent,[!0,!0,!0,!0]);class bo{constructor(t){var s,a;if(this.gl=t,this.clearColor=new ln(this),this.clearDepth=new st(this),this.clearStencil=new Yt(this),this.colorMask=new da(this),this.depthMask=new Ln(this),this.stencilMask=new fr(this),this.stencilFunc=new Rn(this),this.stencilOp=new On(this),this.stencilTest=new Se(this),this.depthRange=new fa(this),this.depthTest=new $n(this),this.depthFunc=new un(this),this.blend=new ma(this),this.blendFunc=new Nn(this),this.blendColor=new Xs(this),this.blendEquation=new Vn(this),this.cullFace=new Ha(this),this.cullFaceSide=new xo(this),this.frontFace=new Wa(this),this.program=new vo(this),this.activeTexture=new ga(this),this.viewport=new _a(this),this.bindFramebuffer=new Ks(this),this.bindRenderbuffer=new Un(this),this.bindTexture=new mr(this),this.bindVertexBuffer=new Ds(this),this.bindElementBuffer=new Xa(this),this.bindVertexArray=new ya(this),this.pixelStoreUnpack=new qn(this),this.pixelStoreUnpackPremultiplyAlpha=new us(this),this.pixelStoreUnpackFlipY=new Ka(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),me(t)){this.HALF_FLOAT=t.HALF_FLOAT;const u=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=t.RGBA16F)!==null&&s!==void 0?s:u==null?void 0:u.RGBA16F_EXT,this.RGB16F=(a=t.RGB16F)!==null&&a!==void 0?a:u==null?void 0:u.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const u=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=u==null?void 0:u.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s){return new ht(this,t,s)}createVertexBuffer(t,s,a){return new tr(this,t,s,a)}createRenderbuffer(t,s,a){const u=this.gl,h=u.createRenderbuffer();return this.bindRenderbuffer.set(h),u.renderbufferStorage(u.RENDERBUFFER,t,s,a),this.bindRenderbuffer.set(null),h}createFramebuffer(t,s,a,u){return new Dt(this,t,s,a,u)}clear({color:t,depth:s,stencil:a}){const u=this.gl;let h=0;t&&(h|=u.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(h|=u.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),a!==void 0&&(h|=u.STENCIL_BUFFER_BIT,this.clearStencil.set(a),this.stencilMask.set(255)),u.clear(h)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){l.aG(t.blendFunction,Jt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return me(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var s;return me(this.gl)?this.gl.deleteVertexArray(t):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class _t{constructor(t,s,a){this.func=t,this.mask=s,this.range=a}}_t.ReadOnly=!1,_t.ReadWrite=!0,_t.disabled=new _t(519,_t.ReadOnly,[0,1]);const Fs=7680;class Ht{constructor(t,s,a,u,h,g){this.test=t,this.ref=s,this.mask=a,this.fail=u,this.depthFail=h,this.pass=g}}Ht.disabled=new Ht({func:519,mask:0},0,0,Fs,Fs,Fs);class Wt{constructor(t,s,a){this.enable=t,this.mode=s,this.frontFace=a}}let cn;function Ja(c,t,s,a,u,h,g){const _=c.context,x=_.gl,b=c.useProgram("collisionBox"),C=[];let S=0,z=0;for(let K=0;K<a.length;K++){const ae=a[K],de=t.getTile(ae),fe=de.getBucket(s);if(!fe)continue;let we=ae.posMatrix;u[0]===0&&u[1]===0||(we=c.translatePosMatrix(ae.posMatrix,de,u,h));const De=g?fe.textCollisionBox:fe.iconCollisionBox,Ce=fe.collisionCircleArray;if(Ce.length>0){const Fe=l.Z(),Ge=we;l.aU(Fe,fe.placementInvProjMatrix,c.transform.glCoordMatrix),l.aU(Fe,Fe,fe.placementViewportMatrix),C.push({circleArray:Ce,circleOffset:z,transform:Ge,invTransform:Fe,coord:ae}),S+=Ce.length/4,z=S}De&&b.draw(_,x.LINES,_t.disabled,Ht.disabled,c.colorModeForRenderPass(),Wt.disabled,zn(we,c.transform,de),c.style.map.terrain&&c.style.map.terrain.getTerrainData(ae),s.id,De.layoutVertexBuffer,De.indexBuffer,De.segments,null,c.transform.zoom,null,null,De.collisionVertexBuffer)}if(!g||!C.length)return;const U=c.useProgram("collisionCircle"),V=new l.aV;V.resize(4*S),V._trim();let G=0;for(const K of C)for(let ae=0;ae<K.circleArray.length/4;ae++){const de=4*ae,fe=K.circleArray[de+0],we=K.circleArray[de+1],De=K.circleArray[de+2],Ce=K.circleArray[de+3];V.emplace(G++,fe,we,De,Ce,0),V.emplace(G++,fe,we,De,Ce,1),V.emplace(G++,fe,we,De,Ce,2),V.emplace(G++,fe,we,De,Ce,3)}(!cn||cn.length<2*S)&&(cn=function(K){const ae=2*K,de=new l.aX;de.resize(ae),de._trim();for(let fe=0;fe<ae;fe++){const we=6*fe;de.uint16[we+0]=4*fe+0,de.uint16[we+1]=4*fe+1,de.uint16[we+2]=4*fe+2,de.uint16[we+3]=4*fe+2,de.uint16[we+4]=4*fe+3,de.uint16[we+5]=4*fe+0}return de}(S));const O=_.createIndexBuffer(cn,!0),re=_.createVertexBuffer(V,l.aW.members,!0);for(const K of C){const ae={u_matrix:K.transform,u_inv_matrix:K.invTransform,u_camera_to_center_distance:(he=c.transform).cameraToCenterDistance,u_viewport_size:[he.width,he.height]};U.draw(_,x.TRIANGLES,_t.disabled,Ht.disabled,c.colorModeForRenderPass(),Wt.disabled,ae,c.style.map.terrain&&c.style.map.terrain.getTerrainData(K.coord),s.id,re,O,l.S.simpleSegment(0,2*K.circleOffset,K.circleArray.length,K.circleArray.length/2),null,c.transform.zoom,null,null,null)}var he;re.destroy(),O.destroy()}Wt.disabled=new Wt(!1,1029,2305),Wt.backCCW=new Wt(!0,1029,2305);const Mt=l.ao(new Float32Array(16));function hn(c,t,s,a,u,h){const{horizontalAlign:g,verticalAlign:_}=l.au(c);return new l.P((-(g-.5)*t/u+a[0])*h,(-(_-.5)*s/u+a[1])*h)}function pn(c,t,s,a,u,h,g,_,x,b,C){const S=c.text.placedSymbolArray,z=c.text.dynamicLayoutVertexArray,U=c.icon.dynamicLayoutVertexArray,V={};z.clear();for(let G=0;G<S.length;G++){const O=S.get(G),re=O.hidden||!O.crossTileID||c.allowVerticalPlacement&&!O.placedOrientation?null:a[O.crossTileID];if(re){const he=new l.P(O.anchorX,O.anchorY),K=ri(he,s?g:h,C),ae=Cs(u.cameraToCenterDistance,K.signedDistanceFromCamera);let de=l.aj(c.textSizeData,x,O)*ae/l.ap;s&&(de*=c.tilePixelRatio/_);const{width:fe,height:we,anchor:De,textOffset:Ce,textBoxScale:Fe}=re,Ge=hn(De,fe,we,Ce,Fe,de),yt=s?ri(he.add(Ge),h,C).point:K.point.add(t?Ge.rotate(-u.angle):Ge),Le=c.allowVerticalPlacement&&O.placedOrientation===l.ai.vertical?Math.PI/2:0;for(let rt=0;rt<O.numGlyphs;rt++)l.ak(z,yt,Le);b&&O.associatedIconIndex>=0&&(V[O.associatedIconIndex]={shiftedAnchor:yt,angle:Le})}else R(O.numGlyphs,z)}if(b){U.clear();const G=c.icon.placedSymbolArray;for(let O=0;O<G.length;O++){const re=G.get(O);if(re.hidden)R(re.numGlyphs,U);else{const he=V[O];if(he)for(let K=0;K<re.numGlyphs;K++)l.ak(U,he.shiftedAnchor,he.angle);else R(re.numGlyphs,U)}}c.icon.dynamicLayoutVertexBuffer.updateData(U)}c.text.dynamicLayoutVertexBuffer.updateData(z)}function xa(c,t,s){return s.iconsInText&&t?"symbolTextAndIcon":c?"symbolSDF":"symbolIcon"}function Zn(c,t,s,a,u,h,g,_,x,b,C,S){const z=c.context,U=z.gl,V=c.transform,G=_==="map",O=x==="map",re=_!=="viewport"&&s.layout.get("symbol-placement")!=="point",he=G&&!O&&!re,K=!s.layout.get("symbol-sort-key").isConstant();let ae=!1;const de=c.depthModeForSublayer(0,_t.ReadOnly),fe=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),we=[];for(const De of a){const Ce=t.getTile(De),Fe=Ce.getBucket(s);if(!Fe)continue;const Ge=u?Fe.text:Fe.icon;if(!Ge||!Ge.segments.get().length||!Ge.hasVisibleVertices)continue;const yt=Ge.programConfigurations.get(s.id),Le=u||Fe.sdfIcons,rt=u?Fe.textSizeData:Fe.iconSizeData,Ke=O||V.pitch!==0,Ot=c.useProgram(xa(Le,u,Fe),yt),gt=l.ah(rt,V.zoom),pt=c.style.map.terrain&&c.style.map.terrain.getTerrainData(De);let xt,pi,Xt,qi,Si=[0,0],yi=null;if(u)pi=Ce.glyphAtlasTexture,Xt=U.LINEAR,xt=Ce.glyphAtlasTexture.size,Fe.iconsInText&&(Si=Ce.imageAtlasTexture.size,yi=Ce.imageAtlasTexture,qi=Ke||c.options.rotating||c.options.zooming||rt.kind==="composite"||rt.kind==="camera"?U.LINEAR:U.NEAREST);else{const di=s.layout.get("icon-size").constantOr(0)!==1||Fe.iconsNeedLinear;pi=Ce.imageAtlasTexture,Xt=Le||c.options.rotating||c.options.zooming||di||Ke?U.LINEAR:U.NEAREST,xt=Ce.imageAtlasTexture.size}const Dr=ie(Ce,1,c.transform.zoom),ei=Be(De.posMatrix,O,G,c.transform,Dr),hs=Er(De.posMatrix,O,G,c.transform,Dr),ps=fe&&Fe.hasTextData(),en=s.layout.get("icon-text-fit")!=="none"&&ps&&Fe.hasIconData();if(re){const di=c.style.map.terrain?(_r,fi)=>c.style.map.terrain.getElevation(De,_r,fi):null,ki=s.layout.get("text-rotation-alignment")==="map";Me(Fe,De.posMatrix,c,u,ei,hs,O,b,ki,di)}const xn=c.translatePosMatrix(De.posMatrix,Ce,h,g),Jn=re||u&&fe||en?Mt:ei,Wi=c.translatePosMatrix(hs,Ce,h,g,!0),ji=Le&&s.paint.get(u?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let rr;rr=Le?Fe.iconsInText?Ts(rt.kind,gt,he,O,c,xn,Jn,Wi,xt,Si):pa(rt.kind,gt,he,O,c,xn,Jn,Wi,u,xt):ha(rt.kind,gt,he,O,c,xn,Jn,Wi,u,xt);const vn={program:Ot,buffers:Ge,uniformValues:rr,atlasTexture:pi,atlasTextureIcon:yi,atlasInterpolation:Xt,atlasInterpolationIcon:qi,isSDF:Le,hasHalo:ji};if(K&&Fe.canOverlap){ae=!0;const di=Ge.segments.get();for(const ki of di)we.push({segments:new l.S([ki]),sortKey:ki.sortKey,state:vn,terrainData:pt})}else we.push({segments:Ge.segments,sortKey:0,state:vn,terrainData:pt})}ae&&we.sort((De,Ce)=>De.sortKey-Ce.sortKey);for(const De of we){const Ce=De.state;if(z.activeTexture.set(U.TEXTURE0),Ce.atlasTexture.bind(Ce.atlasInterpolation,U.CLAMP_TO_EDGE),Ce.atlasTextureIcon&&(z.activeTexture.set(U.TEXTURE1),Ce.atlasTextureIcon&&Ce.atlasTextureIcon.bind(Ce.atlasInterpolationIcon,U.CLAMP_TO_EDGE)),Ce.isSDF){const Fe=Ce.uniformValues;Ce.hasHalo&&(Fe.u_is_halo=1,va(Ce.buffers,De.segments,s,c,Ce.program,de,C,S,Fe,De.terrainData)),Fe.u_is_halo=0}va(Ce.buffers,De.segments,s,c,Ce.program,de,C,S,Ce.uniformValues,De.terrainData)}}function va(c,t,s,a,u,h,g,_,x,b){const C=a.context;u.draw(C,C.gl.TRIANGLES,h,g,_,Wt.disabled,x,b,s.id,c.layoutVertexBuffer,c.indexBuffer,t,s.paint,a.transform.zoom,c.programConfigurations.get(s.id),c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer)}function dn(c,t,s,a,u){if(!s||!a||!a.imageAtlas)return;const h=a.imageAtlas.patternPositions;let g=h[s.to.toString()],_=h[s.from.toString()];if(!g&&_&&(g=_),!_&&g&&(_=g),!g||!_){const x=u.getPaintProperty(t);g=h[x],_=h[x]}g&&_&&c.setConstantPatternPositions(g,_)}function fn(c,t,s,a,u,h,g){const _=c.context.gl,x="fill-pattern",b=s.paint.get(x),C=b&&b.constantOr(1),S=s.getCrossfadeParameters();let z,U,V,G,O;g?(U=C&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=_.LINES):(U=C?"fillPattern":"fill",z=_.TRIANGLES);const re=b.constantOr(null);for(const he of a){const K=t.getTile(he);if(C&&!K.patternsLoaded())continue;const ae=K.getBucket(s);if(!ae)continue;const de=ae.programConfigurations.get(s.id),fe=c.useProgram(U,de),we=c.style.map.terrain&&c.style.map.terrain.getTerrainData(he);C&&(c.context.activeTexture.set(_.TEXTURE0),K.imageAtlasTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),de.updatePaintBuffers(S)),dn(de,x,re,K,s);const De=we?he:null,Ce=c.translatePosMatrix(De?De.posMatrix:he.posMatrix,K,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(g){G=ae.indexBuffer2,O=ae.segments2;const Fe=[_.drawingBufferWidth,_.drawingBufferHeight];V=U==="fillOutlinePattern"&&C?Bn(Ce,c,S,K,Fe):Fn(Ce,Fe)}else G=ae.indexBuffer,O=ae.segments,V=C?oa(Ce,c,S,K):aa(Ce);fe.draw(c.context,z,u,c.stencilModeForClipping(he),h,Wt.disabled,V,we,s.id,ae.layoutVertexBuffer,G,O,s.paint,c.transform.zoom,de)}}function mn(c,t,s,a,u,h,g){const _=c.context,x=_.gl,b="fill-extrusion-pattern",C=s.paint.get(b),S=C.constantOr(1),z=s.getCrossfadeParameters(),U=s.paint.get("fill-extrusion-opacity"),V=C.constantOr(null);for(const G of a){const O=t.getTile(G),re=O.getBucket(s);if(!re)continue;const he=c.style.map.terrain&&c.style.map.terrain.getTerrainData(G),K=re.programConfigurations.get(s.id),ae=c.useProgram(S?"fillExtrusionPattern":"fillExtrusion",K);S&&(c.context.activeTexture.set(x.TEXTURE0),O.imageAtlasTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),K.updatePaintBuffers(z)),dn(K,b,V,O,s);const de=c.translatePosMatrix(G.posMatrix,O,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),fe=s.paint.get("fill-extrusion-vertical-gradient"),we=S?er(de,c,fe,U,G,z,O):ns(de,c,fe,U);ae.draw(_,_.gl.TRIANGLES,u,h,g,Wt.backCCW,we,he,s.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,s.paint,c.transform.zoom,K,c.style.map.terrain&&re.centroidVertexBuffer)}}function wo(c,t,s,a,u,h,g){const _=c.context,x=_.gl,b=s.fbo;if(!b)return;const C=c.useProgram("hillshade"),S=c.style.map.terrain&&c.style.map.terrain.getTerrainData(t);_.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,b.colorAttachment.get()),C.draw(_,x.TRIANGLES,u,h,g,Wt.disabled,((z,U,V,G)=>{const O=V.paint.get("hillshade-shadow-color"),re=V.paint.get("hillshade-highlight-color"),he=V.paint.get("hillshade-accent-color");let K=V.paint.get("hillshade-illumination-direction")*(Math.PI/180);V.paint.get("hillshade-illumination-anchor")==="viewport"&&(K-=z.transform.angle);const ae=!z.options.moving;return{u_matrix:G?G.posMatrix:z.transform.calculatePosMatrix(U.tileID.toUnwrapped(),ae),u_image:0,u_latrange:ua(0,U.tileID),u_light:[V.paint.get("hillshade-exaggeration"),K],u_shadow:O,u_highlight:re,u_accent:he}})(c,s,a,S?t:null),S,a.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}function ba(c,t,s,a,u,h){const g=c.context,_=g.gl,x=t.dem;if(x&&x.data){const b=x.dim,C=x.stride,S=x.getPixels();if(g.activeTexture.set(_.TEXTURE1),g.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||c.getTileTexture(C),t.demTexture){const U=t.demTexture;U.update(S,{premultiply:!1}),U.bind(_.NEAREST,_.CLAMP_TO_EDGE)}else t.demTexture=new Ut(g,S,_.RGBA,{premultiply:!1}),t.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);g.activeTexture.set(_.TEXTURE0);let z=t.fbo;if(!z){const U=new Ut(g,{width:b,height:b,data:null},_.RGBA);U.bind(_.LINEAR,_.CLAMP_TO_EDGE),z=t.fbo=g.createFramebuffer(b,b,!0,!1),z.colorAttachment.set(U.texture)}g.bindFramebuffer.set(z.framebuffer),g.viewport.set([0,0,b,b]),c.useProgram("hillshadePrepare").draw(g,_.TRIANGLES,a,u,h,Wt.disabled,((U,V)=>{const G=V.stride,O=l.Z();return l.aS(O,0,l.N,-l.N,0,0,1),l.$(O,O,[0,-l.N,0]),{u_matrix:O,u_image:1,u_dimension:[G,G],u_zoom:U.overscaledZ,u_unpack:V.getUnpackVector()}})(t.tileID,x),null,s.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function A(c,t,s,a,u,h){const g=a.paint.get("raster-fade-duration");if(!h&&g>0){const _=l.h.now(),x=(_-c.timeAdded)/g,b=t?(_-t.timeAdded)/g:-1,C=s.getSource(),S=u.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),z=!t||Math.abs(t.tileID.overscaledZ-S)>Math.abs(c.tileID.overscaledZ-S),U=z&&c.refreshedUponExpiration?1:l.ad(z?x:1-b,0,1);return c.refreshedUponExpiration&&x>=1&&(c.refreshedUponExpiration=!1),t?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}const q=new l.aT(1,0,0,1),ce=new l.aT(0,1,0,1),ne=new l.aT(0,0,1,1),ge=new l.aT(1,0,1,1),ke=new l.aT(0,1,1,1);function Xe(c,t,s,a){Gt(c,0,t+s/2,c.transform.width,s,a)}function Zt(c,t,s,a){Gt(c,t-s/2,0,s,c.transform.height,a)}function Gt(c,t,s,a,u,h){const g=c.context,_=g.gl;_.enable(_.SCISSOR_TEST),_.scissor(t*c.pixelRatio,s*c.pixelRatio,a*c.pixelRatio,u*c.pixelRatio),g.clear({color:h}),_.disable(_.SCISSOR_TEST)}function Sr(c,t,s){const a=c.context,u=a.gl,h=s.posMatrix,g=c.useProgram("debug"),_=_t.disabled,x=Ht.disabled,b=c.colorModeForRenderPass(),C="$debug",S=c.style.map.terrain&&c.style.map.terrain.getTerrainData(s);a.activeTexture.set(u.TEXTURE0);const z=t.getTileByID(s.key).latestRawTileData,U=Math.floor((z&&z.byteLength||0)/1024),V=t.getTile(s).tileSize,G=512/Math.min(V,512)*(s.overscaledZ/c.transform.zoom)*.5;let O=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(O+=` => ${s.overscaledZ}`),function(re,he){re.initDebugOverlayCanvas();const K=re.debugOverlayCanvas,ae=re.context.gl,de=re.debugOverlayCanvas.getContext("2d");de.clearRect(0,0,K.width,K.height),de.shadowColor="white",de.shadowBlur=2,de.lineWidth=1.5,de.strokeStyle="white",de.textBaseline="top",de.font="bold 36px Open Sans, sans-serif",de.fillText(he,5,5),de.strokeText(he,5,5),re.debugOverlayTexture.update(K),re.debugOverlayTexture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE)}(c,`${O} ${U}kB`),g.draw(a,u.TRIANGLES,_,x,Jt.alphaBlended,Wt.disabled,Ws(h,l.aT.transparent,G),null,C,c.debugBuffer,c.quadTriangleIndexBuffer,c.debugSegments),g.draw(a,u.LINE_STRIP,_,x,b,Wt.disabled,Ws(h,l.aT.red),S,C,c.debugBuffer,c.tileBorderIndexBuffer,c.debugSegments)}function Et(c,t,s){const a=c.context,u=a.gl,h=c.colorModeForRenderPass(),g=new _t(u.LEQUAL,_t.ReadWrite,c.depthRangeFor3D),_=c.useProgram("terrain"),x=t.getTerrainMesh();a.bindFramebuffer.set(null),a.viewport.set([0,0,c.width,c.height]);for(const b of s){const C=c.renderToTexture.getTexture(b),S=t.getTerrainData(b.tileID);a.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,C.texture);const z={u_matrix:c.transform.calculatePosMatrix(b.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(c.transform.zoom)};_.draw(a,u.TRIANGLES,g,Ht.disabled,h,Wt.backCCW,z,S,"terrain",x.vertexBuffer,x.indexBuffer,x.segments)}}class Xr{constructor(t,s){this.context=new bo(t),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.Z(),renderTime:0},this.setup(),this.numSublayers=Ni.maxUnderzooming+Ni.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Dn}resize(t,s,a){if(this.width=Math.floor(t*a),this.height=Math.floor(s*a),this.pixelRatio=a,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style._order)this.style._layers[u].resize()}setup(){const t=this.context,s=new l.a_;s.emplaceBack(0,0),s.emplaceBack(l.N,0),s.emplaceBack(0,l.N),s.emplaceBack(l.N,l.N),this.tileExtentBuffer=t.createVertexBuffer(s,In.members),this.tileExtentSegments=l.S.simpleSegment(0,0,4,2);const a=new l.a_;a.emplaceBack(0,0),a.emplaceBack(l.N,0),a.emplaceBack(0,l.N),a.emplaceBack(l.N,l.N),this.debugBuffer=t.createVertexBuffer(a,In.members),this.debugSegments=l.S.simpleSegment(0,0,4,5);const u=new l.V;u.emplaceBack(0,0,0,0),u.emplaceBack(l.N,0,l.N,0),u.emplaceBack(0,l.N,0,l.N),u.emplaceBack(l.N,l.N,l.N,l.N),this.rasterBoundsBuffer=t.createVertexBuffer(u,Tt.members),this.rasterBoundsSegments=l.S.simpleSegment(0,0,4,2);const h=new l.a_;h.emplaceBack(0,0),h.emplaceBack(1,0),h.emplaceBack(0,1),h.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(h,In.members),this.viewportSegments=l.S.simpleSegment(0,0,4,2);const g=new l.a$;g.emplaceBack(0),g.emplaceBack(1),g.emplaceBack(3),g.emplaceBack(2),g.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(g);const _=new l.b0;_.emplaceBack(0,1,2),_.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(_);const x=this.context.gl;this.stencilClearMode=new Ht({func:x.ALWAYS,mask:0},0,255,x.ZERO,x.ZERO,x.ZERO)}clearStencil(){const t=this.context,s=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const a=l.Z();l.aS(a,0,this.width,this.height,0,0,1),l.a0(a,a,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,s.TRIANGLES,_t.disabled,this.stencilClearMode,Jt.disabled,Wt.disabled,la(a),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,s){if(this.currentStencilSource===t.source||!t.isTileClipped()||!s||!s.length)return;this.currentStencilSource=t.source;const a=this.context,u=a.gl;this.nextStencilID+s.length>256&&this.clearStencil(),a.setColorMode(Jt.disabled),a.setDepthMode(_t.disabled);const h=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const g of s){const _=this._tileClippingMaskIDs[g.key]=this.nextStencilID++,x=this.style.map.terrain&&this.style.map.terrain.getTerrainData(g);h.draw(a,u.TRIANGLES,_t.disabled,new Ht({func:u.ALWAYS,mask:0},_,255,u.KEEP,u.KEEP,u.REPLACE),Jt.disabled,Wt.disabled,la(g.posMatrix),x,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new Ht({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){const s=this.context.gl;return new Ht({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){const s=this.context.gl,a=t.sort((g,_)=>_.overscaledZ-g.overscaledZ),u=a[a.length-1].overscaledZ,h=a[0].overscaledZ-u+1;if(h>1){this.currentStencilSource=void 0,this.nextStencilID+h>256&&this.clearStencil();const g={};for(let _=0;_<h;_++)g[_+u]=new Ht({func:s.GEQUAL,mask:255},_+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=h,[g,a]}return[{[u]:Ht.disabled},a]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Jt([t.CONSTANT_COLOR,t.ONE],new l.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Jt.unblended:Jt.alphaBlended}depthModeForSublayer(t,s,a){if(!this.opaquePassEnabledForLayer())return _t.disabled;const u=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new _t(a||this.context.gl.LEQUAL,s,[u,u])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,s){this.style=t,this.options=s,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(l.h.now()),this.imageManager.beginFrame();const a=this.style._order,u=this.style.sourceCaches,h={},g={},_={};for(const x in u){const b=u[x];b.used&&b.prepare(this.context),h[x]=b.getVisibleCoordinates(),g[x]=h[x].slice().reverse(),_[x]=b.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let x=0;x<a.length;x++)if(this.style._layers[a[x]].is3D()){this.opaquePassCutoff=x;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const x=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!l.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||x.length)&&(l.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(b,C){const S=b.context,z=S.gl,U=Jt.unblended,V=new _t(z.LEQUAL,_t.ReadWrite,[0,1]),G=C.getTerrainMesh(),O=C.sourceCache.getRenderableTiles(),re=b.useProgram("terrainDepth");S.bindFramebuffer.set(C.getFramebuffer("depth").framebuffer),S.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),S.clear({color:l.aT.transparent,depth:1});for(const he of O){const K=C.getTerrainData(he.tileID),ae={u_matrix:b.transform.calculatePosMatrix(he.tileID.toUnwrapped()),u_ele_delta:C.getMeshFrameDelta(b.transform.zoom)};re.draw(S,z.TRIANGLES,V,Ht.disabled,U,Wt.backCCW,ae,K,"terrain",G.vertexBuffer,G.indexBuffer,G.segments)}S.bindFramebuffer.set(null),S.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain),function(b,C){const S=b.context,z=S.gl,U=Jt.unblended,V=new _t(z.LEQUAL,_t.ReadWrite,[0,1]),G=C.getTerrainMesh(),O=C.getCoordsTexture(),re=C.sourceCache.getRenderableTiles(),he=b.useProgram("terrainCoords");S.bindFramebuffer.set(C.getFramebuffer("coords").framebuffer),S.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),S.clear({color:l.aT.transparent,depth:1}),C.coordsIndex=[];for(const K of re){const ae=C.getTerrainData(K.tileID);S.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,O.texture);const de={u_matrix:b.transform.calculatePosMatrix(K.tileID.toUnwrapped()),u_terrain_coords_id:(255-C.coordsIndex.length)/255,u_texture:0,u_ele_delta:C.getMeshFrameDelta(b.transform.zoom)};he.draw(S,z.TRIANGLES,V,Ht.disabled,U,Wt.backCCW,de,ae,"terrain",G.vertexBuffer,G.indexBuffer,G.segments),C.coordsIndex.push(K.tileID.key)}S.bindFramebuffer.set(null),S.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const x of a){const b=this.style._layers[x];if(!b.hasOffscreenPass()||b.isHidden(this.transform.zoom))continue;const C=g[b.source];(b.type==="custom"||C.length)&&this.renderLayer(this,u[b.source],b,C)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?l.aT.black:l.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const x=this.style._layers[a[this.currentLayer]],b=u[x.source],C=h[x.source];this._renderTileClippingMasks(x,C),this.renderLayer(this,b,x,C)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const x=this.style._layers[a[this.currentLayer]],b=u[x.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(x))continue;const C=(x.type==="symbol"?_:g)[x.source];this._renderTileClippingMasks(x,h[x.source]),this.renderLayer(this,b,x,C)}if(this.options.showTileBoundaries){const x=function(b,C){let S=null;const z=Object.values(b._layers).flatMap(O=>O.source&&!O.isHidden(C)?[b.sourceCaches[O.source]]:[]),U=z.filter(O=>O.getSource().type==="vector"),V=z.filter(O=>O.getSource().type!=="vector"),G=O=>{(!S||S.getSource().maxzoom<O.getSource().maxzoom)&&(S=O)};return U.forEach(O=>G(O)),S||V.forEach(O=>G(O)),S}(this.style,this.transform.zoom);x&&function(b,C,S){for(let z=0;z<S.length;z++)Sr(b,C,S[z])}(this,x,x.getVisibleCoordinates())}this.options.showPadding&&function(x){const b=x.transform.padding;Xe(x,x.transform.height-(b.top||0),3,q),Xe(x,b.bottom||0,3,ce),Zt(x,b.left||0,3,ne),Zt(x,x.transform.width-(b.right||0),3,ge);const C=x.transform.centerPoint;(function(S,z,U,V){Gt(S,z-1,U-10,2,20,V),Gt(S,z-10,U-1,20,2,V)})(x,C.x,x.transform.height-C.y,ke)}(this),this.context.setDefault()}renderLayer(t,s,a,u){if(!a.isHidden(this.transform.zoom)&&(a.type==="background"||a.type==="custom"||(u||[]).length))switch(this.id=a.id,a.type){case"symbol":(function(h,g,_,x,b){if(h.renderPass!=="translucent")return;const C=Ht.disabled,S=h.colorModeForRenderPass();(_._unevaluatedLayout.hasValue("text-variable-anchor")||_._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(z,U,V,G,O,re,he){const K=U.transform,ae=O==="map",de=re==="map";for(const fe of z){const we=G.getTile(fe),De=we.getBucket(V);if(!De||!De.text||!De.text.segments.get().length)continue;const Ce=l.ah(De.textSizeData,K.zoom),Fe=ie(we,1,U.transform.zoom),Ge=Be(fe.posMatrix,de,ae,U.transform,Fe),yt=V.layout.get("icon-text-fit")!=="none"&&De.hasIconData();if(Ce){const Le=Math.pow(2,K.zoom-we.tileID.overscaledZ);pn(De,ae,de,he,K,Ge,fe.posMatrix,Le,Ce,yt,U.style.map.terrain?(rt,Ke)=>U.style.map.terrain.getElevation(fe,rt,Ke):null)}}}(x,h,_,g,_.layout.get("text-rotation-alignment"),_.layout.get("text-pitch-alignment"),b),_.paint.get("icon-opacity").constantOr(1)!==0&&Zn(h,g,_,x,!1,_.paint.get("icon-translate"),_.paint.get("icon-translate-anchor"),_.layout.get("icon-rotation-alignment"),_.layout.get("icon-pitch-alignment"),_.layout.get("icon-keep-upright"),C,S),_.paint.get("text-opacity").constantOr(1)!==0&&Zn(h,g,_,x,!0,_.paint.get("text-translate"),_.paint.get("text-translate-anchor"),_.layout.get("text-rotation-alignment"),_.layout.get("text-pitch-alignment"),_.layout.get("text-keep-upright"),C,S),g.map.showCollisionBoxes&&(Ja(h,g,_,x,_.paint.get("text-translate"),_.paint.get("text-translate-anchor"),!0),Ja(h,g,_,x,_.paint.get("icon-translate"),_.paint.get("icon-translate-anchor"),!1))})(t,s,a,u,this.style.placement.variableOffsets);break;case"circle":(function(h,g,_,x){if(h.renderPass!=="translucent")return;const b=_.paint.get("circle-opacity"),C=_.paint.get("circle-stroke-width"),S=_.paint.get("circle-stroke-opacity"),z=!_.layout.get("circle-sort-key").isConstant();if(b.constantOr(1)===0&&(C.constantOr(1)===0||S.constantOr(1)===0))return;const U=h.context,V=U.gl,G=h.depthModeForSublayer(0,_t.ReadOnly),O=Ht.disabled,re=h.colorModeForRenderPass(),he=[];for(let K=0;K<x.length;K++){const ae=x[K],de=g.getTile(ae),fe=de.getBucket(_);if(!fe)continue;const we=fe.programConfigurations.get(_.id),De=h.useProgram("circle",we),Ce=fe.layoutVertexBuffer,Fe=fe.indexBuffer,Ge=h.style.map.terrain&&h.style.map.terrain.getTerrainData(ae),yt={programConfiguration:we,program:De,layoutVertexBuffer:Ce,indexBuffer:Fe,uniformValues:as(h,ae,de,_),terrainData:Ge};if(z){const Le=fe.segments.get();for(const rt of Le)he.push({segments:new l.S([rt]),sortKey:rt.sortKey,state:yt})}else he.push({segments:fe.segments,sortKey:0,state:yt})}z&&he.sort((K,ae)=>K.sortKey-ae.sortKey);for(const K of he){const{programConfiguration:ae,program:de,layoutVertexBuffer:fe,indexBuffer:we,uniformValues:De,terrainData:Ce}=K.state;de.draw(U,V.TRIANGLES,G,O,re,Wt.disabled,De,Ce,_.id,fe,we,K.segments,_.paint,h.transform.zoom,ae)}})(t,s,a,u);break;case"heatmap":(function(h,g,_,x){if(_.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const b=h.context,C=b.gl,S=Ht.disabled,z=new Jt([C.ONE,C.ONE],l.aT.transparent,[!0,!0,!0,!0]);(function(U,V,G){const O=U.gl;U.activeTexture.set(O.TEXTURE1),U.viewport.set([0,0,V.width/4,V.height/4]);let re=G.heatmapFbo;if(re)O.bindTexture(O.TEXTURE_2D,re.colorAttachment.get()),U.bindFramebuffer.set(re.framebuffer);else{const he=O.createTexture();O.bindTexture(O.TEXTURE_2D,he),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_S,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_T,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MIN_FILTER,O.LINEAR),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MAG_FILTER,O.LINEAR),re=G.heatmapFbo=U.createFramebuffer(V.width/4,V.height/4,!1,!1),function(K,ae,de,fe){var we,De;const Ce=K.gl,Fe=(we=K.HALF_FLOAT)!==null&&we!==void 0?we:Ce.UNSIGNED_BYTE,Ge=(De=K.RGBA16F)!==null&&De!==void 0?De:Ce.RGBA;Ce.texImage2D(Ce.TEXTURE_2D,0,Ge,ae.width/4,ae.height/4,0,Ce.RGBA,Fe,null),fe.colorAttachment.set(de)}(U,V,he,re)}})(b,h,_),b.clear({color:l.aT.transparent});for(let U=0;U<x.length;U++){const V=x[U];if(g.hasRenderableParent(V))continue;const G=g.getTile(V),O=G.getBucket(_);if(!O)continue;const re=O.programConfigurations.get(_.id),he=h.useProgram("heatmap",re),{zoom:K}=h.transform;he.draw(b,C.TRIANGLES,_t.disabled,S,z,Wt.disabled,Va(V.posMatrix,G,K,_.paint.get("heatmap-intensity")),null,_.id,O.layoutVertexBuffer,O.indexBuffer,O.segments,_.paint,h.transform.zoom,re)}b.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(b,C){const S=b.context,z=S.gl,U=C.heatmapFbo;if(!U)return;S.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,U.colorAttachment.get()),S.activeTexture.set(z.TEXTURE1);let V=C.colorRampTexture;V||(V=C.colorRampTexture=new Ut(S,C.colorRamp,z.RGBA)),V.bind(z.LINEAR,z.CLAMP_TO_EDGE),b.useProgram("heatmapTexture").draw(S,z.TRIANGLES,_t.disabled,Ht.disabled,b.colorModeForRenderPass(),Wt.disabled,((G,O,re,he)=>{const K=l.Z();l.aS(K,0,G.width,G.height,0,0,1);const ae=G.context.gl;return{u_matrix:K,u_world:[ae.drawingBufferWidth,ae.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:O.paint.get("heatmap-opacity")}})(b,C),null,C.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,C.paint,b.transform.zoom)}(h,_))})(t,s,a,u);break;case"line":(function(h,g,_,x){if(h.renderPass!=="translucent")return;const b=_.paint.get("line-opacity"),C=_.paint.get("line-width");if(b.constantOr(1)===0||C.constantOr(1)===0)return;const S=h.depthModeForSublayer(0,_t.ReadOnly),z=h.colorModeForRenderPass(),U=_.paint.get("line-dasharray"),V=_.paint.get("line-pattern"),G=V.constantOr(1),O=_.paint.get("line-gradient"),re=_.getCrossfadeParameters(),he=G?"linePattern":U?"lineSDF":O?"lineGradient":"line",K=h.context,ae=K.gl;let de=!0;for(const fe of x){const we=g.getTile(fe);if(G&&!we.patternsLoaded())continue;const De=we.getBucket(_);if(!De)continue;const Ce=De.programConfigurations.get(_.id),Fe=h.context.program.get(),Ge=h.useProgram(he,Ce),yt=de||Ge.program!==Fe,Le=h.style.map.terrain&&h.style.map.terrain.getTerrainData(fe),rt=V.constantOr(null);if(rt&&we.imageAtlas){const gt=we.imageAtlas,pt=gt.patternPositions[rt.to.toString()],xt=gt.patternPositions[rt.from.toString()];pt&&xt&&Ce.setConstantPatternPositions(pt,xt)}const Ke=Le?fe:null,Ot=G?yo(h,we,_,re,Ke):U?qa(h,we,_,U,re,Ke):O?Ua(h,we,_,De.lineClipsArray.length,Ke):ca(h,we,_,Ke);if(G)K.activeTexture.set(ae.TEXTURE0),we.imageAtlasTexture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE),Ce.updatePaintBuffers(re);else if(U&&(yt||h.lineAtlas.dirty))K.activeTexture.set(ae.TEXTURE0),h.lineAtlas.bind(K);else if(O){const gt=De.gradients[_.id];let pt=gt.texture;if(_.gradientVersion!==gt.version){let xt=256;if(_.stepInterpolant){const pi=g.getSource().maxzoom,Xt=fe.canonical.z===pi?Math.ceil(1<<h.transform.maxZoom-fe.canonical.z):1;xt=l.ad(l.aY(De.maxLineLength/l.N*1024*Xt),256,K.maxTextureSize)}gt.gradient=l.aZ({expression:_.gradientExpression(),evaluationKey:"lineProgress",resolution:xt,image:gt.gradient||void 0,clips:De.lineClipsArray}),gt.texture?gt.texture.update(gt.gradient):gt.texture=new Ut(K,gt.gradient,ae.RGBA),gt.version=_.gradientVersion,pt=gt.texture}K.activeTexture.set(ae.TEXTURE0),pt.bind(_.stepInterpolant?ae.NEAREST:ae.LINEAR,ae.CLAMP_TO_EDGE)}Ge.draw(K,ae.TRIANGLES,S,h.stencilModeForClipping(fe),z,Wt.disabled,Ot,Le,_.id,De.layoutVertexBuffer,De.indexBuffer,De.segments,_.paint,h.transform.zoom,Ce,De.layoutVertexBuffer2),de=!1}})(t,s,a,u);break;case"fill":(function(h,g,_,x){const b=_.paint.get("fill-color"),C=_.paint.get("fill-opacity");if(C.constantOr(1)===0)return;const S=h.colorModeForRenderPass(),z=_.paint.get("fill-pattern"),U=h.opaquePassEnabledForLayer()&&!z.constantOr(1)&&b.constantOr(l.aT.transparent).a===1&&C.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===U){const V=h.depthModeForSublayer(1,h.renderPass==="opaque"?_t.ReadWrite:_t.ReadOnly);fn(h,g,_,x,V,S,!1)}if(h.renderPass==="translucent"&&_.paint.get("fill-antialias")){const V=h.depthModeForSublayer(_.getPaintProperty("fill-outline-color")?2:0,_t.ReadOnly);fn(h,g,_,x,V,S,!0)}})(t,s,a,u);break;case"fill-extrusion":(function(h,g,_,x){const b=_.paint.get("fill-extrusion-opacity");if(b!==0&&h.renderPass==="translucent"){const C=new _t(h.context.gl.LEQUAL,_t.ReadWrite,h.depthRangeFor3D);if(b!==1||_.paint.get("fill-extrusion-pattern").constantOr(1))mn(h,g,_,x,C,Ht.disabled,Jt.disabled),mn(h,g,_,x,C,h.stencilModeFor3D(),h.colorModeForRenderPass());else{const S=h.colorModeForRenderPass();mn(h,g,_,x,C,Ht.disabled,S)}}})(t,s,a,u);break;case"hillshade":(function(h,g,_,x){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent")return;const b=h.context,C=h.depthModeForSublayer(0,_t.ReadOnly),S=h.colorModeForRenderPass(),[z,U]=h.renderPass==="translucent"?h.stencilConfigForOverlap(x):[{},x];for(const V of U){const G=g.getTile(V);G.needsHillshadePrepare!==void 0&&G.needsHillshadePrepare&&h.renderPass==="offscreen"?ba(h,G,_,C,Ht.disabled,S):h.renderPass==="translucent"&&wo(h,V,G,_,C,z[V.overscaledZ],S)}b.viewport.set([0,0,h.width,h.height])})(t,s,a,u);break;case"raster":(function(h,g,_,x){if(h.renderPass!=="translucent"||_.paint.get("raster-opacity")===0||!x.length)return;const b=h.context,C=b.gl,S=g.getSource(),z=h.useProgram("raster"),U=h.colorModeForRenderPass(),[V,G]=S instanceof Pt?[{},x]:h.stencilConfigForOverlap(x),O=G[G.length-1].overscaledZ,re=!h.options.moving;for(const he of G){const K=h.depthModeForSublayer(he.overscaledZ-O,_.paint.get("raster-opacity")===1?_t.ReadWrite:_t.ReadOnly,C.LESS),ae=g.getTile(he);ae.registerFadeDuration(_.paint.get("raster-fade-duration"));const de=g.findLoadedParent(he,0),fe=A(ae,de,g,_,h.transform,h.style.map.terrain);let we,De;const Ce=_.paint.get("raster-resampling")==="nearest"?C.NEAREST:C.LINEAR;b.activeTexture.set(C.TEXTURE0),ae.texture.bind(Ce,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),b.activeTexture.set(C.TEXTURE1),de?(de.texture.bind(Ce,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),we=Math.pow(2,de.tileID.overscaledZ-ae.tileID.overscaledZ),De=[ae.tileID.canonical.x*we%1,ae.tileID.canonical.y*we%1]):ae.texture.bind(Ce,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST);const Fe=h.style.map.terrain&&h.style.map.terrain.getTerrainData(he),Ge=Fe?he:null,yt=Ge?Ge.posMatrix:h.transform.calculatePosMatrix(he.toUnwrapped(),re),Le=Za(yt,De||[0,0],we||1,fe,_);S instanceof Pt?z.draw(b,C.TRIANGLES,K,Ht.disabled,U,Wt.disabled,Le,Fe,_.id,S.boundsBuffer,h.quadTriangleIndexBuffer,S.boundsSegments):z.draw(b,C.TRIANGLES,K,V[he.overscaledZ],U,Wt.disabled,Le,Fe,_.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}})(t,s,a,u);break;case"background":(function(h,g,_,x){const b=_.paint.get("background-color"),C=_.paint.get("background-opacity");if(C===0)return;const S=h.context,z=S.gl,U=h.transform,V=U.tileSize,G=_.paint.get("background-pattern");if(h.isPatternMissing(G))return;const O=!G&&b.a===1&&C===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==O)return;const re=Ht.disabled,he=h.depthModeForSublayer(0,O==="opaque"?_t.ReadWrite:_t.ReadOnly),K=h.colorModeForRenderPass(),ae=h.useProgram(G?"backgroundPattern":"background"),de=x||U.coveringTiles({tileSize:V,terrain:h.style.map.terrain});G&&(S.activeTexture.set(z.TEXTURE0),h.imageManager.bind(h.context));const fe=_.getCrossfadeParameters();for(const we of de){const De=x?we.posMatrix:h.transform.calculatePosMatrix(we.toUnwrapped()),Ce=G?dr(De,C,h,G,{tileID:we,tileSize:V},fe):Pn(De,C,b),Fe=h.style.map.terrain&&h.style.map.terrain.getTerrainData(we);ae.draw(S,z.TRIANGLES,he,re,K,Wt.disabled,Ce,Fe,_.id,h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}})(t,0,a,u);break;case"custom":(function(h,g,_){const x=h.context,b=_.implementation;if(h.renderPass==="offscreen"){const C=b.prerender;C&&(h.setCustomLayerDefaults(),x.setColorMode(h.colorModeForRenderPass()),C.call(b,x.gl,h.transform.customLayerMatrix()),x.setDirty(),h.setBaseState())}else if(h.renderPass==="translucent"){h.setCustomLayerDefaults(),x.setColorMode(h.colorModeForRenderPass()),x.setStencilMode(Ht.disabled);const C=b.renderingMode==="3d"?new _t(h.context.gl.LEQUAL,_t.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,_t.ReadOnly);x.setDepthMode(C),b.render(x.gl,h.transform.customLayerMatrix()),x.setDirty(),h.setBaseState(),x.bindFramebuffer.set(null)}})(t,0,a)}}translatePosMatrix(t,s,a,u,h){if(!a[0]&&!a[1])return t;const g=h?u==="map"?this.transform.angle:0:u==="viewport"?-this.transform.angle:0;if(g){const b=Math.sin(g),C=Math.cos(g);a=[a[0]*C-a[1]*b,a[0]*b+a[1]*C]}const _=[h?a[0]:ie(s,a[0],this.transform.zoom),h?a[1]:ie(s,a[1],this.transform.zoom),0],x=new Float32Array(16);return l.$(x,t,_),x}saveTileTexture(t){const s=this._tileTextures[t.size[0]];s?s.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const s=this.imageManager.getPattern(t.from.toString()),a=this.imageManager.getPattern(t.to.toString());return!s||!a}useProgram(t,s){this.cache=this.cache||{};const a=t+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[a]||(this.cache[a]=new on(this.context,jt[t],s,I[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[a]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Ut(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:s}=this.context.gl;return this.width!==t||this.height!==s}}class Ui{constructor(t,s){this.points=t,this.planes=s}static fromInvProjectionMatrix(t,s,a){const u=Math.pow(2,a),h=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(_=>{const x=1/(_=l.ag([],_,t))[3]/s*u;return l.b3(_,_,[x,x,1/_[3],x])}),g=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(_=>{const x=function(z,U){var V=U[0],G=U[1],O=U[2],re=V*V+G*G+O*O;return re>0&&(re=1/Math.sqrt(re)),z[0]=U[0]*re,z[1]=U[1]*re,z[2]=U[2]*re,z}([],function(z,U,V){var G=U[0],O=U[1],re=U[2],he=V[0],K=V[1],ae=V[2];return z[0]=O*ae-re*K,z[1]=re*he-G*ae,z[2]=G*K-O*he,z}([],oi([],h[_[0]],h[_[1]]),oi([],h[_[2]],h[_[1]]))),b=-((C=x)[0]*(S=h[_[1]])[0]+C[1]*S[1]+C[2]*S[2]);var C,S;return x.concat(b)});return new Ui(h,g)}}class Gn{constructor(t,s){this.min=t,this.max=s,this.center=function(a,u,h){return a[0]=.5*u[0],a[1]=.5*u[1],a[2]=.5*u[2],a}([],function(a,u,h){return a[0]=u[0]+h[0],a[1]=u[1]+h[1],a[2]=u[2]+h[2],a}([],this.min,this.max))}quadrant(t){const s=[t%2==0,t<2],a=lr(this.min),u=lr(this.max);for(let h=0;h<s.length;h++)a[h]=s[h]?this.min[h]:this.center[h],u[h]=s[h]?this.center[h]:this.max[h];return u[2]=this.max[2],new Gn(a,u)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let a=!0;for(let u=0;u<t.planes.length;u++){const h=t.planes[u];let g=0;for(let _=0;_<s.length;_++)l.b4(h,s[_])>=0&&g++;if(g===0)return 0;g!==s.length&&(a=!1)}if(a)return 2;for(let u=0;u<3;u++){let h=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let _=0;_<t.points.length;_++){const x=t.points[_][u]-this.min[u];h=Math.min(h,x),g=Math.max(g,x)}if(g<0||h>this.max[u]-this.min[u])return 0}return 1}}class wa{constructor(t=0,s=0,a=0,u=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(a)||a<0||isNaN(u)||u<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=a,this.right=u}interpolate(t,s,a){return s.top!=null&&t.top!=null&&(this.top=l.B.number(t.top,s.top,a)),s.bottom!=null&&t.bottom!=null&&(this.bottom=l.B.number(t.bottom,s.bottom,a)),s.left!=null&&t.left!=null&&(this.left=l.B.number(t.left,s.left,a)),s.right!=null&&t.right!=null&&(this.right=l.B.number(t.right,s.right,a)),this}getCenter(t,s){const a=l.ad((this.left+t-this.right)/2,0,t),u=l.ad((this.top+s-this.bottom)/2,0,s);return new l.P(a,u)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new wa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Qa{constructor(t,s,a,u,h){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=h===void 0||!!h,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=a??0,this._maxPitch=u??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new wa,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const t=new Qa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this._minEleveationForCurrentTile=t._minEleveationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const s=-l.b5(t,-180,180)*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=function(){var a=new l.A(4);return l.A!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a}(),function(a,u,h){var g=u[0],_=u[1],x=u[2],b=u[3],C=Math.sin(h),S=Math.cos(h);a[0]=g*S+x*C,a[1]=_*S+b*C,a[2]=g*-C+x*S,a[3]=_*-C+b*S}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const s=l.ad(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.tileZoom=Math.max(0,Math.floor(s)),this.scale=this.zoomScale(s),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,a){this._unmodified=!1,this._edgeInsets.interpolate(t,s,a),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){const s=[new l.b6(0,t)];if(this._renderWorldCopies){const a=this.pointCoordinate(new l.P(0,0)),u=this.pointCoordinate(new l.P(this.width,0)),h=this.pointCoordinate(new l.P(this.width,this.height)),g=this.pointCoordinate(new l.P(0,this.height)),_=Math.floor(Math.min(a.x,u.x,h.x,g.x)),x=Math.floor(Math.max(a.x,u.x,h.x,g.x)),b=1;for(let C=_-b;C<=x+b;C++)C!==0&&s.push(new l.b6(C,t))}return s}coveringTiles(t){var s,a;let u=this.coveringZoomLevel(t);const h=u;if(t.minzoom!==void 0&&u<t.minzoom)return[];t.maxzoom!==void 0&&u>t.maxzoom&&(u=t.maxzoom);const g=this.pointCoordinate(this.getCameraPoint()),_=l.U.fromLngLat(this.center),x=Math.pow(2,u),b=[x*g.x,x*g.y,0],C=[x*_.x,x*_.y,0],S=Ui.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u);let z=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(z=u);const U=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,V=K=>({aabb:new Gn([K*x,0,0],[(K+1)*x,x,0]),zoom:0,x:0,y:0,wrap:K,fullyVisible:!1}),G=[],O=[],re=u,he=t.reparseOverscaled?h:u;if(this._renderWorldCopies)for(let K=1;K<=3;K++)G.push(V(-K)),G.push(V(K));for(G.push(V(0));G.length>0;){const K=G.pop(),ae=K.x,de=K.y;let fe=K.fullyVisible;if(!fe){const Ge=K.aabb.intersects(S);if(Ge===0)continue;fe=Ge===2}const we=t.terrain?b:C,De=K.aabb.distanceX(we),Ce=K.aabb.distanceY(we),Fe=Math.max(Math.abs(De),Math.abs(Ce));if(K.zoom===re||Fe>U+(1<<re-K.zoom)-2&&K.zoom>=z){const Ge=re-K.zoom,yt=b[0]-.5-(ae<<Ge),Le=b[1]-.5-(de<<Ge);O.push({tileID:new l.O(K.zoom===re?he:K.zoom,K.wrap,K.zoom,ae,de),distanceSq:ts([C[0]-.5-ae,C[1]-.5-de]),tileDistanceToCamera:Math.sqrt(yt*yt+Le*Le)})}else for(let Ge=0;Ge<4;Ge++){const yt=(ae<<1)+Ge%2,Le=(de<<1)+(Ge>>1),rt=K.zoom+1;let Ke=K.aabb.quadrant(Ge);if(t.terrain){const Ot=new l.O(rt,K.wrap,rt,yt,Le),gt=t.terrain.getMinMaxElevation(Ot),pt=(s=gt.minElevation)!==null&&s!==void 0?s:this.elevation,xt=(a=gt.maxElevation)!==null&&a!==void 0?a:this.elevation;Ke=new Gn([Ke.min[0],Ke.min[1],pt],[Ke.max[0],Ke.max[1],xt])}G.push({aabb:Ke,zoom:rt,x:yt,y:Le,wrap:K.wrap,fullyVisible:fe})}}return O.sort((K,ae)=>K.distanceSq-ae.distanceSq).map(K=>K.tileID)}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const s=l.ad(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new l.P(l.G(t.lng)*this.worldSize,l.H(s)*this.worldSize)}unproject(t){return new l.U(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const s=this.pointLocation(this.centerPoint,t),a=t.getElevationForLngLatZoom(s,this.tileZoom);if(!(this.elevation-a))return;const u=this.getCameraPosition(),h=l.U.fromLngLat(u.lngLat,u.altitude),g=l.U.fromLngLat(s,a),_=h.x-g.x,x=h.y-g.y,b=h.z-g.z,C=Math.sqrt(_*_+x*x+b*b),S=this.scaleZoom(this.cameraToCenterDistance/C/this.tileSize);this._elevation=a,this._center=s,this.zoom=S}setLocationAtPoint(t,s){const a=this.pointCoordinate(s),u=this.pointCoordinate(this.centerPoint),h=this.locationCoordinate(t),g=new l.U(h.x-(a.x-u.x),h.y-(a.y-u.y));this.center=this.coordinateLocation(g),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,s){return s?this.coordinatePoint(this.locationCoordinate(t),s.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,s){return this.coordinateLocation(this.pointCoordinate(t,s))}locationCoordinate(t){return l.U.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,s){if(s){const z=s.pointCoordinate(t);if(z!=null)return z}const a=[t.x,t.y,0,1],u=[t.x,t.y,1,1];l.ag(a,a,this.pixelMatrixInverse),l.ag(u,u,this.pixelMatrixInverse);const h=a[3],g=u[3],_=a[1]/h,x=u[1]/g,b=a[2]/h,C=u[2]/g,S=b===C?0:(0-b)/(C-b);return new l.U(l.B.number(a[0]/h,u[0]/g,S)/this.worldSize,l.B.number(_,x,S)/this.worldSize)}coordinatePoint(t,s=0,a=this.pixelMatrix){const u=[t.x*this.worldSize,t.y*this.worldSize,s,1];return l.ag(u,u,a),new l.P(u[0]/u[3],u[1]/u[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new Lt().extend(this.pointLocation(new l.P(0,t))).extend(this.pointLocation(new l.P(this.width,t))).extend(this.pointLocation(new l.P(this.width,this.height))).extend(this.pointLocation(new l.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Lt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,s=!1){const a=t.key,u=s?this._alignedPosMatrixCache:this._posMatrixCache;if(u[a])return u[a];const h=t.canonical,g=this.worldSize/this.zoomScale(h.z),_=h.x+Math.pow(2,h.z)*t.wrap,x=l.ao(new Float64Array(16));return l.$(x,x,[_*g,h.y*g,0]),l.a0(x,x,[g/l.N,g/l.N,1]),l.a1(x,s?this.alignedProjMatrix:this.projMatrix,x),u[a]=new Float32Array(x),u[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,s,a,u,h=-90,g=90,_=-180,x=180;const b=this.size,C=this._unmodified;if(this.latRange){const U=this.latRange;h=l.H(U[1])*this.worldSize,g=l.H(U[0])*this.worldSize,t=g-h<b.y?b.y/(g-h):0}if(this.lngRange){const U=this.lngRange;_=l.b5(l.G(U[0])*this.worldSize,0,this.worldSize),x=l.b5(l.G(U[1])*this.worldSize,0,this.worldSize),x<_&&(x+=this.worldSize),s=x-_<b.x?b.x/(x-_):0}const S=this.point,z=Math.max(s||0,t||0);if(z)return this.center=this.unproject(new l.P(s?(x+_)/2:S.x,t?(g+h)/2:S.y)),this.zoom+=this.scaleZoom(z),this._unmodified=C,void(this._constraining=!1);if(this.latRange){const U=S.y,V=b.y/2;U-V<h&&(u=h+V),U+V>g&&(u=g-V)}if(this.lngRange){const U=(_+x)/2,V=l.b5(S.x,U-this.worldSize/2,U+this.worldSize/2),G=b.x/2;V-G<_&&(a=_+G),V+G>x&&(a=x-G)}a===void 0&&u===void 0||(this.center=this.unproject(new l.P(a!==void 0?a:S.x,u!==void 0?u:S.y)).wrap()),this._unmodified=C,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,s=this.point.x,a=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.b7(1,this.center.lat)*this.worldSize;let u=l.ao(new Float64Array(16));l.a0(u,u,[this.width/2,-this.height/2,1]),l.$(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=l.ao(new Float64Array(16)),l.a0(u,u,[1,-1,1]),l.$(u,u,[-1,-1,0]),l.a0(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u;const h=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),g=Math.min(this.elevation,this._minEleveationForCurrentTile),_=h-g*this._pixelPerMeter/Math.cos(this._pitch),x=g<0?_:h,b=Math.PI/2+this._pitch,C=this._fov*(.5+t.y/this.height),S=Math.sin(C)*x/Math.sin(l.ad(Math.PI-b-C,.01,Math.PI-.01)),z=this.getHorizon(),U=2*Math.atan(z/this.cameraToCenterDistance)*(.5+t.y/(2*z)),V=Math.sin(U)*x/Math.sin(l.ad(Math.PI-b-U,.01,Math.PI-.01)),G=Math.min(S,V),O=1.01*(Math.cos(Math.PI/2-this._pitch)*G+x),re=this.height/50;u=new Float64Array(16),l.b8(u,this._fov,this.width/this.height,re,O),u[8]=2*-t.x/this.width,u[9]=2*t.y/this.height,l.a0(u,u,[1,-1,1]),l.$(u,u,[0,0,-this.cameraToCenterDistance]),l.b9(u,u,this._pitch),l.ae(u,u,this.angle),l.$(u,u,[-s,-a,0]),this.mercatorMatrix=l.a0([],u,[this.worldSize,this.worldSize,this.worldSize]),l.a0(u,u,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.a1(new Float64Array(16),this.labelPlaneMatrix,u),l.$(u,u,[0,0,-this.elevation]),this.projMatrix=u,this.invProjMatrix=l.as([],u),this.pixelMatrix3D=l.a1(new Float64Array(16),this.labelPlaneMatrix,u);const he=this.width%2/2,K=this.height%2/2,ae=Math.cos(this.angle),de=Math.sin(this.angle),fe=s-Math.round(s)+ae*he+de*K,we=a-Math.round(a)+ae*K+de*he,De=new Float64Array(u);if(l.$(De,De,[fe>.5?fe-1:fe,we>.5?we-1:we,0]),this.alignedProjMatrix=De,u=l.as(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");this.pixelMatrixInverse=u,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new l.P(0,0)),s=[t.x*this.worldSize,t.y*this.worldSize,0,1];return l.ag(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(0,t))}getCameraQueryGeometry(t){const s=this.getCameraPoint();if(t.length===1)return[t[0],s];{let a=s.x,u=s.y,h=s.x,g=s.y;for(const _ of t)a=Math.min(a,_.x),u=Math.min(u,_.y),h=Math.max(h,_.x),g=Math.max(g,_.y);return[new l.P(a,u),new l.P(h,u),new l.P(h,g),new l.P(a,g),new l.P(a,u)]}}}function gn(c,t){let s,a=!1,u=null,h=null;const g=()=>{u=null,a&&(c.apply(h,s),u=setTimeout(g,t),a=!1)};return(..._)=>(a=!0,h=this,s=_,u||g(),u)}class Aa{constructor(t){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let a;return s.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(a=u)}),(a&&a[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(s.length>=3&&!s.some(a=>isNaN(a))){const a=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:a,pitch:+(s[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,s)}catch{}},this._updateHash=gn(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const s=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,u=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),h=Math.pow(10,u),g=Math.round(s.lng*h)/h,_=Math.round(s.lat*h)/h,x=this._map.getBearing(),b=this._map.getPitch();let C="";if(C+=t?`/${g}/${_}/${a}`:`${a}/${_}/${g}`,(x||b)&&(C+="/"+Math.round(10*x)/10),b&&(C+=`/${Math.round(b)}`),this._hashName){const S=this._hashName;let z=!1;const U=window.location.hash.slice(1).split("&").map(V=>{const G=V.split("=")[0];return G===S?(z=!0,`${G}=${C}`):V}).filter(V=>V);return z||U.push(`${S}=${C}`),`#${U.join("&")}`}return`#${C}`}}const Hn={linearity:.3,easing:l.ba(0,0,.3,1)},gl=l.e({deceleration:2500,maxSpeed:1400},Hn),_l=l.e({deceleration:20,maxSpeed:1400},Hn),yl=l.e({deceleration:1e3,maxSpeed:360},Hn),xl=l.e({deceleration:1e3,maxSpeed:90},Hn);class vl{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.h.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=l.h.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:h}of this._inertiaBuffer)s.zoom+=h.zoomDelta||0,s.bearing+=h.bearingDelta||0,s.pitch+=h.pitchDelta||0,h.panDelta&&s.pan._add(h.panDelta),h.around&&(s.around=h.around),h.pinchAround&&(s.pinchAround=h.pinchAround);const a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,u={};if(s.pan.mag()){const h=Ea(s.pan.mag(),a,l.e({},gl,t||{}));u.offset=s.pan.mult(h.amount/s.pan.mag()),u.center=this._map.transform.center,cs(u,h)}if(s.zoom){const h=Ea(s.zoom,a,_l);u.zoom=this._map.transform.zoom+h.amount,cs(u,h)}if(s.bearing){const h=Ea(s.bearing,a,yl);u.bearing=this._map.transform.bearing+l.ad(h.amount,-179,179),cs(u,h)}if(s.pitch){const h=Ea(s.pitch,a,xl);u.pitch=this._map.transform.pitch+h.amount,cs(u,h)}if(u.zoom||u.bearing){const h=s.pinchAround===void 0?s.around:s.pinchAround;u.around=h?this._map.unproject(h):this._map.getCenter()}return this.clear(),l.e(u,{noMoveStart:!0})}}function cs(c,t){(!c.duration||c.duration<t.duration)&&(c.duration=t.duration,c.easing=t.easing)}function Ea(c,t,s){const{maxSpeed:a,linearity:u,deceleration:h}=s,g=l.ad(c*u/(t/1e3),-a,a),_=Math.abs(g)/(h*u);return{easing:s.easing,duration:1e3*_,amount:g*(_/2)}}class kr extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,a,u={}){const h=ee.mousePos(s.getCanvasContainer(),a),g=s.unproject(h);super(t,l.e({point:h,lngLat:g,originalEvent:a},u)),this._defaultPrevented=!1,this.target=s}}class Ca extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,a){const u=t==="touchend"?a.changedTouches:a.touches,h=ee.touchPos(s.getCanvasContainer(),u),g=h.map(x=>s.unproject(x)),_=h.reduce((x,b,C,S)=>x.add(b.div(S.length)),new l.P(0,0));super(t,{points:h,point:_,lngLats:g,lngLat:s.unproject(_),originalEvent:a}),this._defaultPrevented=!1}}class bl extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,a){super(t,{originalEvent:a}),this._defaultPrevented=!1}}class wl{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new bl(t.type,this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new kr(t.type,this._map,t))}mouseup(t){this._map.fire(new kr(t.type,this._map,t))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new kr(t.type,this._map,t))}dblclick(t){return this._firePreventable(new kr(t.type,this._map,t))}mouseover(t){this._map.fire(new kr(t.type,this._map,t))}mouseout(t){this._map.fire(new kr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Ca(t.type,this._map,t))}touchmove(t){this._map.fire(new Ca(t.type,this._map,t))}touchend(t){this._map.fire(new Ca(t.type,this._map,t))}touchcancel(t){this._map.fire(new Ca(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Al{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new kr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new kr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new kr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ys{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(l.P.convert(t),this._map.terrain)}}class El{constructor(t,s){this._map=t,this._tr=new Ys(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(ee.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const a=s;if(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)return;const u=this._startPos;this._lastPos=a,this._box||(this._box=ee.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const h=Math.min(u.x,a.x),g=Math.max(u.x,a.x),_=Math.min(u.y,a.y),x=Math.max(u.y,a.y);ee.setTransform(this._box,`translate(${h}px,${_}px)`),this._box.style.width=g-h+"px",this._box.style.height=x-_+"px"}mouseupWindow(t,s){if(!this._active||t.button!==0)return;const a=this._startPos,u=s;if(this.reset(),ee.suppressClick(),a.x!==u.x||a.y!==u.y)return this._map.fire(new l.k("boxzoomend",{originalEvent:t})),{cameraAnimation:h=>h.fitScreenCoordinates(a,u,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(ee.remove(this._box),this._box=null),ee.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new l.k(t,{originalEvent:s}))}}function Or(c,t){if(c.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${c.length}, points ${t.length}`);const s={};for(let a=0;a<c.length;a++)s[c[a].identifier]=t[a];return s}class Bs{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,s,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),a.length===this.numTouches&&(this.centroid=function(u){const h=new l.P(0,0);for(const g of u)h._add(g);return h.div(u.length)}(s),this.touches=Or(a,s)))}touchmove(t,s,a){if(this.aborted||!this.centroid)return;const u=Or(a,s);for(const h in this.touches){const g=u[h];(!g||g.dist(this.touches[h])>30)&&(this.aborted=!0)}}touchend(t,s,a){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){const u=!this.aborted&&this.centroid;if(this.reset(),u)return u}}}class eo{constructor(t){this.singleTap=new Bs(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,s,a){this.singleTap.touchstart(t,s,a)}touchmove(t,s,a){this.singleTap.touchmove(t,s,a)}touchend(t,s,a){const u=this.singleTap.touchend(t,s,a);if(u){const h=t.timeStamp-this.lastTime<500,g=!this.lastTap||this.lastTap.dist(u)<30;if(h&&g||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=u,this.count===this.numTaps)return this.reset(),u}}}class zs{constructor(t){this._tr=new Ys(t),this._zoomIn=new eo({numTouches:1,numTaps:2}),this._zoomOut=new eo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,a){this._zoomIn.touchstart(t,s,a),this._zoomOut.touchstart(t,s,a)}touchmove(t,s,a){this._zoomIn.touchmove(t,s,a),this._zoomOut.touchmove(t,s,a)}touchend(t,s,a){const u=this._zoomIn.touchend(t,s,a),h=this._zoomOut.touchend(t,s,a),g=this._tr;return u?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:_=>_.easeTo({duration:300,zoom:g.zoom+1,around:g.unproject(u)},{originalEvent:t})}):h?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:_=>_.easeTo({duration:300,zoom:g.zoom-1,around:g.unproject(h)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ms{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const s=this._moveFunction(...t);if(s.bearingDelta||s.pitchDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(t,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=s.length?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,s){if(!this.isEnabled())return;const a=this._lastPoint;if(!a)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const u=s.length?s[0]:s;return!this._moved&&u.dist(a)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=u,this._move(a,u))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&ee.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const xu={0:1,2:2};class Ao{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const s=ee.mouseButton(t);this._eventButton=s}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(s,a){const u=xu[a];return s.buttons===void 0||(s.buttons&u)!==u}(t,this._eventButton)}isValidEndEvent(t){return ee.mouseButton(t)===this._eventButton}}class Cl{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const to=c=>{c.mousedown=c.dragStart,c.mousemoveWindow=c.dragMove,c.mouseup=c.dragEnd,c.contextmenu=function(t){t.preventDefault()}},Wn=({enable:c,clickTolerance:t,bearingDegreesPerPixelMoved:s=.8})=>{const a=new Ao({checkCorrectEvent:u=>ee.mouseButton(u)===0&&u.ctrlKey||ee.mouseButton(u)===2});return new Ms({clickTolerance:t,move:(u,h)=>({bearingDelta:(h.x-u.x)*s}),moveStateManager:a,enable:c,assignEvents:to})},Ps=({enable:c,clickTolerance:t,pitchDegreesPerPixelMoved:s=-.5})=>{const a=new Ao({checkCorrectEvent:u=>ee.mouseButton(u)===0&&u.ctrlKey||ee.mouseButton(u)===2});return new Ms({clickTolerance:t,move:(u,h)=>({pitchDelta:(h.y-u.y)*s}),moveStateManager:a,enable:c,assignEvents:to})};class Ue{constructor(t,s){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,s,a){return this._calculateTransform(t,s,a)}touchmove(t,s,a){if(this._map._cooperativeGestures&&(this._minTouches===2&&a.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,a.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(a.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,s,a)}touchend(t,s,a){this._calculateTransform(t,s,a),this._active&&a.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,a){a.length>0&&(this._active=!0);const u=Or(a,s),h=new l.P(0,0),g=new l.P(0,0);let _=0;for(const b in u){const C=u[b],S=this._touches[b];S&&(h._add(C),g._add(C.sub(S)),_++,u[b]=C)}if(this._touches=u,_<this._minTouches||!g.mag())return;const x=g.div(_);return this._sum._add(x),this._sum.mag()<this._clickTolerance?void 0:{around:h.div(_),panDelta:x}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class io{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,s,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,a){if(!this._firstTwoTouches)return;t.preventDefault();const[u,h]=this._firstTwoTouches,g=Js(a,s,u),_=Js(a,s,h);if(!g||!_)return;const x=this._aroundCenter?null:g.add(_).div(2);return this._move([g,_],x,t)}touchend(t,s,a){if(!this._firstTwoTouches)return;const[u,h]=this._firstTwoTouches,g=Js(a,s,u),_=Js(a,s,h);g&&_||(this._active&&ee.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Js(c,t,s){for(let a=0;a<c.length;a++)if(c[a].identifier===s)return t[a]}function Xn(c,t){return Math.log(c/t)/Math.LN2}class Sl extends io{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const a=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Xn(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Xn(this._distance,a),pinchAround:s}}}function $e(c,t){return 180*c.angleWith(t)/Math.PI}class Eo extends io{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s){const a=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:$e(this._vector,a),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,a=$e(t,this._startVector);return Math.abs(a)<s}}function Co(c){return Math.abs(c.y)>Math.abs(c.x)}class vu extends io{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,s,a){super.touchstart(t,s,a),this._currentTouchCount=a.length}_start(t){this._lastPoints=t,Co(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,a){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const u=t[0].sub(this._lastPoints[0]),h=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(u,h,a.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(u.y+h.y)/2*-.5}):void 0}gestureBeginsVertically(t,s,a){if(this._valid!==void 0)return this._valid;const u=t.mag()>=2,h=s.mag()>=2;if(!u&&!h)return;if(!u||!h)return this._firstMove===void 0&&(this._firstMove=a),a-this._firstMove<100&&void 0;const g=t.y>0==s.y>0;return Co(t)&&Co(s)&&g}}const So={panStep:100,bearingStep:15,pitchStep:10};class kl{constructor(t){this._tr=new Ys(t);const s=So;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,a=0,u=0,h=0,g=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?a=-1:(t.preventDefault(),h=-1);break;case 39:t.shiftKey?a=1:(t.preventDefault(),h=1);break;case 38:t.shiftKey?u=1:(t.preventDefault(),g=-1);break;case 40:t.shiftKey?u=-1:(t.preventDefault(),g=1);break;default:return}return this._rotationDisabled&&(a=0,u=0),{cameraAnimation:_=>{const x=this._tr;_.easeTo({duration:300,easeId:"keyboardHandler",easing:Tl,zoom:s?Math.round(x.zoom)+s*(t.shiftKey?2:1):x.zoom,bearing:x.bearing+a*this._bearingStep,pitch:x.pitch+u*this._pitchStep,offset:[-h*this._panStep,-g*this._panStep],center:x.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Tl(c){return c*(2-c)}const Dl=4.000244140625;class bu{constructor(t,s){this._onTimeout=a=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)},this._map=t,this._tr=new Ys(t),this._el=t.getCanvasContainer(),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!t[this._map._metaKey])return;t.preventDefault()}let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const a=l.h.now(),u=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,s!==0&&s%Dl==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":u>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(u*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=ee.mousePos(this._el,t),a=this._tr;this._around=l.L.convert(this._aroundCenter?a.center:a.unproject(s)),this._aroundPoint=a.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const _=this._type==="wheel"&&Math.abs(this._delta)>Dl?this._wheelZoomRate:this._defaultZoomRate;let x=2/(1+Math.exp(-Math.abs(this._delta*_)));this._delta<0&&x!==0&&(x=1/x);const b=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(b*x))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,a=this._startZoom,u=this._easing;let h,g=!1;if(this._type==="wheel"&&a&&u){const _=Math.min((l.h.now()-this._lastWheelEventTime)/200,1),x=u(_);h=l.B.number(a,s,x),_<1?this._frameId||(this._frameId=!0):g=!0}else h=s,g=!0;return this._active=!0,g&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!g,zoomDelta:h-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=l.bb;if(this._prevEase){const a=this._prevEase,u=(l.h.now()-a.start)/a.duration,h=a.easing(u+.01)-a.easing(u),g=.27/Math.sqrt(h*h+1e-4)*.01,_=Math.sqrt(.0729-g*g);s=l.ba(g,_,.25,1)}return this._prevEase={start:l.h.now(),duration:t,easing:s},s}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ko{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class To{constructor(t){this._tr=new Ys(t),this.reset()}reset(){this._active=!1}dblclick(t,s){return t.preventDefault(),{cameraAnimation:a=>{a.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Do{constructor(){this._tap=new eo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,s,a){if(!this._swipePoint)if(this._tapTime){const u=s[0],h=t.timeStamp-this._tapTime<500,g=this._tapPoint.dist(u)<30;h&&g?a.length>0&&(this._swipePoint=u,this._swipeTouch=a[0].identifier):this.reset()}else this._tap.touchstart(t,s,a)}touchmove(t,s,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;const u=s[0],h=u.y-this._swipePoint.y;return this._swipePoint=u,t.preventDefault(),this._active=!0,{zoomDelta:h/128}}}else this._tap.touchmove(t,s,a)}touchend(t,s,a){if(this._tapTime)this._swipePoint&&a.length===0&&this.reset();else{const u=this._tap.touchend(t,s,a);u&&(this._tapTime=t.timeStamp,this._tapPoint=u)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Io{constructor(t,s,a){this._el=t,this._mousePan=s,this._touchPan=a}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class gr{constructor(t,s,a){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=a}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Qs{constructor(t,s,a,u){this._el=t,this._touchZoom=s,this._touchRotate=a,this._tapDragZoom=u,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Sa=c=>c.zoom||c.drag||c.pitch||c.rotate;class Fo extends l.k{}function ka(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class Bo{constructor(t,s){this.handleWindowEvent=u=>{this.handleEvent(u,`${u.type}Window`)},this.handleEvent=(u,h)=>{if(u.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const g=u.type==="renderFrame"?void 0:u,_={needsRenderFrame:!1},x={},b={},C=u.touches,S=C?this._getMapTouches(C):void 0,z=S?ee.touchPos(this._el,S):ee.mousePos(this._el,u);for(const{handlerName:G,handler:O,allowed:re}of this._handlers){if(!O.isEnabled())continue;let he;this._blockedByActive(b,re,G)?O.reset():O[h||u.type]&&(he=O[h||u.type](u,z,S),this.mergeHandlerResult(_,x,he,G,g),he&&he.needsRenderFrame&&this._triggerRenderFrame()),(he||O.isActive())&&(b[G]=O)}const U={};for(const G in this._previousActiveHandlers)b[G]||(U[G]=g);this._previousActiveHandlers=b,(Object.keys(U).length||ka(_))&&(this._changes.push([_,x,U]),this._triggerRenderFrame()),(Object.keys(b).length||ka(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:V}=_;V&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],V(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new vl(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[window,"blur",void 0]];for(const[u,h,g]of this._listeners)ee.addEventListener(u,h,u===document?this.handleWindowEvent:this.handleEvent,g)}destroy(){for(const[t,s,a]of this._listeners)ee.removeEventListener(t,s,t===document?this.handleWindowEvent:this.handleEvent,a)}_addDefaultHandlers(t){const s=this._map,a=s.getCanvasContainer();this._add("mapEvent",new wl(s,t));const u=s.boxZoom=new El(s,t);this._add("boxZoom",u),t.interactive&&t.boxZoom&&u.enable();const h=new zs(s),g=new To(s);s.doubleClickZoom=new ko(g,h),this._add("tapZoom",h),this._add("clickZoom",g),t.interactive&&t.doubleClickZoom&&s.doubleClickZoom.enable();const _=new Do;this._add("tapDragZoom",_);const x=s.touchPitch=new vu(s);this._add("touchPitch",x),t.interactive&&t.touchPitch&&s.touchPitch.enable(t.touchPitch);const b=Wn(t),C=Ps(t);s.dragRotate=new gr(t,b,C),this._add("mouseRotate",b,["mousePitch"]),this._add("mousePitch",C,["mouseRotate"]),t.interactive&&t.dragRotate&&s.dragRotate.enable();const S=(({enable:re,clickTolerance:he})=>{const K=new Ao({checkCorrectEvent:ae=>ee.mouseButton(ae)===0&&!ae.ctrlKey});return new Ms({clickTolerance:he,move:(ae,de)=>({around:de,panDelta:de.sub(ae)}),activateOnStart:!0,moveStateManager:K,enable:re,assignEvents:to})})(t),z=new Ue(t,s);s.dragPan=new Io(a,S,z),this._add("mousePan",S),this._add("touchPan",z,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&s.dragPan.enable(t.dragPan);const U=new Eo,V=new Sl;s.touchZoomRotate=new Qs(a,V,U,_),this._add("touchRotate",U,["touchPan","touchZoom"]),this._add("touchZoom",V,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&s.touchZoomRotate.enable(t.touchZoomRotate);const G=s.scrollZoom=new bu(s,()=>this._triggerRenderFrame());this._add("scrollZoom",G,["mousePan"]),t.interactive&&t.scrollZoom&&s.scrollZoom.enable(t.scrollZoom);const O=s.keyboard=new kl(s);this._add("keyboard",O),t.interactive&&t.keyboard&&s.keyboard.enable(),this._add("blockableMapEvent",new Al(s))}_add(t,s,a){this._handlers.push({handlerName:t,handler:s,allowed:a}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Sa(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,s,a){for(const u in t)if(u!==a&&(!s||s.indexOf(u)<0))return!0;return!1}_getMapTouches(t){const s=[];for(const a of t)this._el.contains(a.target)&&s.push(a);return s}mergeHandlerResult(t,s,a,u,h){if(!a)return;l.e(t,a);const g={handlerName:u,originalEvent:a.originalEvent||h};a.zoomDelta!==void 0&&(s.zoom=g),a.panDelta!==void 0&&(s.drag=g),a.pitchDelta!==void 0&&(s.pitch=g),a.bearingDelta!==void 0&&(s.rotate=g)}_applyChanges(){const t={},s={},a={};for(const[u,h,g]of this._changes)u.panDelta&&(t.panDelta=(t.panDelta||new l.P(0,0))._add(u.panDelta)),u.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+u.zoomDelta),u.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+u.bearingDelta),u.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+u.pitchDelta),u.around!==void 0&&(t.around=u.around),u.pinchAround!==void 0&&(t.pinchAround=u.pinchAround),u.noInertia&&(t.noInertia=u.noInertia),l.e(s,h),l.e(a,g);this._updateMapTransform(t,s,a),this._changes=[]}_updateMapTransform(t,s,a){const u=this._map,h=u._getTransformForUpdate(),g=u.terrain;if(!(ka(t)||g&&this._terrainMovement))return this._fireEvents(s,a,!0);let{panDelta:_,zoomDelta:x,bearingDelta:b,pitchDelta:C,around:S,pinchAround:z}=t;z!==void 0&&(S=z),u._stop(!0),S=S||u.transform.centerPoint;const U=h.pointLocation(_?S.sub(_):S);b&&(h.bearing+=b),C&&(h.pitch+=C),x&&(h.zoom+=x),g?this._terrainMovement||!s.drag&&!s.zoom?s.drag&&this._terrainMovement?h.center=h.pointLocation(h.centerPoint.sub(_)):h.setLocationAtPoint(U,S):(this._terrainMovement=!0,this._map._elevationFreeze=!0,h.setLocationAtPoint(U,S),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,h.recalculateZoom(u.terrain)})):h.setLocationAtPoint(U,S),u._applyUpdatedTransform(h),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,a,!0)}_fireEvents(t,s,a){const u=Sa(this._eventsInProgress),h=Sa(t),g={};for(const C in t){const{originalEvent:S}=t[C];this._eventsInProgress[C]||(g[`${C}start`]=S),this._eventsInProgress[C]=t[C]}!u&&h&&this._fireEvent("movestart",h.originalEvent);for(const C in g)this._fireEvent(C,g[C]);h&&this._fireEvent("move",h.originalEvent);for(const C in t){const{originalEvent:S}=t[C];this._fireEvent(C,S)}const _={};let x;for(const C in this._eventsInProgress){const{handlerName:S,originalEvent:z}=this._eventsInProgress[C];this._handlersById[S].isActive()||(delete this._eventsInProgress[C],x=s[S]||z,_[`${C}end`]=x)}for(const C in _)this._fireEvent(C,_[C]);const b=Sa(this._eventsInProgress);if(a&&(u||h)&&!b){this._updatingCamera=!0;const C=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),S=z=>z!==0&&-this._bearingSnap<z&&z<this._bearingSnap;!C||!C.essential&&l.h.prefersReducedMotion?(this._map.fire(new l.k("moveend",{originalEvent:x})),S(this._map.getBearing())&&this._map.resetNorth()):(S(C.bearing||this._map.getBearing())&&(C.bearing=0),C.freezeElevation=!0,this._map.easeTo(C,{originalEvent:x})),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new l.k(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Fo("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Il extends l.E{constructor(t,s){super(),this._renderFrameCallback=()=>{const a=Math.min((l.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(a)),a<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new l.L(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,a){return t=l.P.convert(t).mult(-1),this.panTo(this.transform.center,l.e({offset:t},s),a)}panTo(t,s,a){return this.easeTo(l.e({center:t},s),a)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,a){return this.easeTo(l.e({zoom:t},s),a)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,a){return this.easeTo(l.e({bearing:t},s),a)}resetNorth(t,s){return this.rotateTo(0,l.e({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(l.e({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){t=Lt.convert(t);const a=s&&s.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),a,s)}_cameraForBoxAndBearing(t,s,a,u){const h={top:0,bottom:0,right:0,left:0};if(typeof(u=l.e({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},u)).padding=="number"){const de=u.padding;u.padding={top:de,bottom:de,right:de,left:de}}u.padding=l.e(h,u.padding);const g=this.transform,_=g.padding,x=g.project(l.L.convert(t)),b=g.project(l.L.convert(s)),C=x.rotate(-a*Math.PI/180),S=b.rotate(-a*Math.PI/180),z=new l.P(Math.max(C.x,S.x),Math.max(C.y,S.y)),U=new l.P(Math.min(C.x,S.x),Math.min(C.y,S.y)),V=z.sub(U),G=(g.width-(_.left+_.right+u.padding.left+u.padding.right))/V.x,O=(g.height-(_.top+_.bottom+u.padding.top+u.padding.bottom))/V.y;if(O<0||G<0)return void l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const re=Math.min(g.scaleZoom(g.scale*Math.min(G,O)),u.maxZoom),he=l.P.convert(u.offset),K=new l.P((u.padding.left-u.padding.right)/2,(u.padding.top-u.padding.bottom)/2).rotate(a*Math.PI/180),ae=he.add(K).mult(g.scale/g.zoomScale(re));return{center:g.unproject(x.add(b).div(2).sub(ae)),zoom:re,bearing:a}}fitBounds(t,s,a){return this._fitInternal(this.cameraForBounds(t,s),s,a)}fitScreenCoordinates(t,s,a,u,h){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.P.convert(t)),this.transform.pointLocation(l.P.convert(s)),a,u),u,h)}_fitInternal(t,s,a){return t?(delete(s=l.e(t,s)).padding,s.linear?this.easeTo(s,a):this.flyTo(s,a)):this}jumpTo(t,s){this.stop();const a=this._getTransformForUpdate();let u=!1,h=!1,g=!1;return"zoom"in t&&a.zoom!==+t.zoom&&(u=!0,a.zoom=+t.zoom),t.center!==void 0&&(a.center=l.L.convert(t.center)),"bearing"in t&&a.bearing!==+t.bearing&&(h=!0,a.bearing=+t.bearing),"pitch"in t&&a.pitch!==+t.pitch&&(g=!0,a.pitch=+t.pitch),t.padding==null||a.isPaddingEqual(t.padding)||(a.padding=t.padding),this._applyUpdatedTransform(a),this.fire(new l.k("movestart",s)).fire(new l.k("move",s)),u&&this.fire(new l.k("zoomstart",s)).fire(new l.k("zoom",s)).fire(new l.k("zoomend",s)),h&&this.fire(new l.k("rotatestart",s)).fire(new l.k("rotate",s)).fire(new l.k("rotateend",s)),g&&this.fire(new l.k("pitchstart",s)).fire(new l.k("pitch",s)).fire(new l.k("pitchend",s)),this.fire(new l.k("moveend",s))}calculateCameraOptionsFromTo(t,s,a,u=0){const h=l.U.fromLngLat(t,s),g=l.U.fromLngLat(a,u),_=g.x-h.x,x=g.y-h.y,b=g.z-h.z,C=Math.hypot(_,x,b);if(C===0)throw new Error("Can't calculate camera options with same From and To");const S=Math.hypot(_,x),z=this.transform.scaleZoom(this.transform.cameraToCenterDistance/C/this.transform.tileSize),U=180*Math.atan2(_,-x)/Math.PI;let V=180*Math.acos(S/C)/Math.PI;return V=b<0?90-V:90+V,{center:g.toLngLat(),zoom:z,pitch:V,bearing:U}}easeTo(t,s){this._stop(!1,t.easeId),((t=l.e({offset:[0,0],duration:500,easing:l.bb},t)).animate===!1||!t.essential&&l.h.prefersReducedMotion)&&(t.duration=0);const a=this._getTransformForUpdate(),u=this.getZoom(),h=this.getBearing(),g=this.getPitch(),_=this.getPadding(),x="zoom"in t?+t.zoom:u,b="bearing"in t?this._normalizeBearing(t.bearing,h):h,C="pitch"in t?+t.pitch:g,S="padding"in t?t.padding:a.padding,z=l.P.convert(t.offset);let U=a.centerPoint.add(z);const V=a.pointLocation(U),G=l.L.convert(t.center||V);this._normalizeCenter(G);const O=a.project(V),re=a.project(G).sub(O),he=a.zoomScale(x-u);let K,ae;t.around&&(K=l.L.convert(t.around),ae=a.locationPoint(K));const de={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||x!==u,this._rotating=this._rotating||h!==b,this._pitching=this._pitching||C!==g,this._padding=!a.isPaddingEqual(S),this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,de),this.terrain&&this._prepareElevation(G),this._ease(fe=>{if(this._zooming&&(a.zoom=l.B.number(u,x,fe)),this._rotating&&(a.bearing=l.B.number(h,b,fe)),this._pitching&&(a.pitch=l.B.number(g,C,fe)),this._padding&&(a.interpolatePadding(_,S,fe),U=a.centerPoint.add(z)),this.terrain&&!t.freezeElevation&&this._updateElevation(fe),K)a.setLocationAtPoint(K,ae);else{const we=a.zoomScale(a.zoom-u),De=x>u?Math.min(2,he):Math.max(.5,he),Ce=Math.pow(De,1-fe),Fe=a.unproject(O.add(re.mult(fe*Ce)).mult(we));a.setLocationAtPoint(a.renderWorldCopies?Fe.wrap():Fe,U)}this._applyUpdatedTransform(a),this._fireMoveEvents(s)},fe=>{this.terrain&&this._finalizeElevation(),this._afterEase(s,fe)},t),this}_prepareEase(t,s,a={}){this._moving=!0,s||a.moving||this.fire(new l.k("movestart",t)),this._zooming&&!a.zooming&&this.fire(new l.k("zoomstart",t)),this._rotating&&!a.rotating&&this.fire(new l.k("rotatestart",t)),this._pitching&&!a.pitching&&this.fire(new l.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&s!==this._elevationTarget){const a=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(a-(s-(a*t+this._elevationStart))/(1-t)),this._elevationTarget=s}this.transform.elevation=l.B.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const s=t.clone(),{center:a,zoom:u,pitch:h,bearing:g,elevation:_}=this.transformCameraUpdate(s);a&&(s.center=a),u!==void 0&&(s.zoom=u),h!==void 0&&(s.pitch=h),g!==void 0&&(s.bearing=g),_!==void 0&&(s.elevation=_),this.transform.apply(s)}_fireMoveEvents(t){this.fire(new l.k("move",t)),this._zooming&&this.fire(new l.k("zoom",t)),this._rotating&&this.fire(new l.k("rotate",t)),this._pitching&&this.fire(new l.k("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const a=this._zooming,u=this._rotating,h=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,a&&this.fire(new l.k("zoomend",t)),u&&this.fire(new l.k("rotateend",t)),h&&this.fire(new l.k("pitchend",t)),this.fire(new l.k("moveend",t))}flyTo(t,s){if(!t.essential&&l.h.prefersReducedMotion){const Ke=l.F(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ke,s)}this.stop(),t=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.bb},t);const a=this._getTransformForUpdate(),u=this.getZoom(),h=this.getBearing(),g=this.getPitch(),_=this.getPadding(),x="zoom"in t?l.ad(+t.zoom,a.minZoom,a.maxZoom):u,b="bearing"in t?this._normalizeBearing(t.bearing,h):h,C="pitch"in t?+t.pitch:g,S="padding"in t?t.padding:a.padding,z=a.zoomScale(x-u),U=l.P.convert(t.offset);let V=a.centerPoint.add(U);const G=a.pointLocation(V),O=l.L.convert(t.center||G);this._normalizeCenter(O);const re=a.project(G),he=a.project(O).sub(re);let K=t.curve;const ae=Math.max(a.width,a.height),de=ae/z,fe=he.mag();if("minZoom"in t){const Ke=l.ad(Math.min(t.minZoom,u,x),a.minZoom,a.maxZoom),Ot=ae/a.zoomScale(Ke-u);K=Math.sqrt(Ot/fe*2)}const we=K*K;function De(Ke){const Ot=(de*de-ae*ae+(Ke?-1:1)*we*we*fe*fe)/(2*(Ke?de:ae)*we*fe);return Math.log(Math.sqrt(Ot*Ot+1)-Ot)}function Ce(Ke){return(Math.exp(Ke)-Math.exp(-Ke))/2}function Fe(Ke){return(Math.exp(Ke)+Math.exp(-Ke))/2}const Ge=De(!1);let yt=function(Ke){return Fe(Ge)/Fe(Ge+K*Ke)},Le=function(Ke){return ae*((Fe(Ge)*(Ce(Ot=Ge+K*Ke)/Fe(Ot))-Ce(Ge))/we)/fe;var Ot},rt=(De(!0)-Ge)/K;if(Math.abs(fe)<1e-6||!isFinite(rt)){if(Math.abs(ae-de)<1e-6)return this.easeTo(t,s);const Ke=de<ae?-1:1;rt=Math.abs(Math.log(de/ae))/K,Le=function(){return 0},yt=function(Ot){return Math.exp(Ke*K*Ot)}}return t.duration="duration"in t?+t.duration:1e3*rt/("screenSpeed"in t?+t.screenSpeed/K:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=h!==b,this._pitching=C!==g,this._padding=!a.isPaddingEqual(S),this._prepareEase(s,!1),this.terrain&&this._prepareElevation(O),this._ease(Ke=>{const Ot=Ke*rt,gt=1/yt(Ot);a.zoom=Ke===1?x:u+a.scaleZoom(gt),this._rotating&&(a.bearing=l.B.number(h,b,Ke)),this._pitching&&(a.pitch=l.B.number(g,C,Ke)),this._padding&&(a.interpolatePadding(_,S,Ke),V=a.centerPoint.add(U)),this.terrain&&!t.freezeElevation&&this._updateElevation(Ke);const pt=Ke===1?O:a.unproject(re.add(he.mult(Le(Ot))).mult(gt));a.setLocationAtPoint(a.renderWorldCopies?pt.wrap():pt,V),this._applyUpdatedTransform(a),this._fireMoveEvents(s)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(s)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const a=this._onEaseEnd;delete this._onEaseEnd,a.call(this,s)}if(!t){const a=this.handlers;a&&a.stop(!1)}return this}_ease(t,s,a){a.animate===!1||a.duration===0?(t(1),s()):(this._easeStart=l.h.now(),this._easeOptions=a,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,s){t=l.b5(t,-180,180);const a=Math.abs(t-s);return Math.abs(t-360-s)<a&&(t-=360),Math.abs(t+360-s)<a&&(t+=360),t}_normalizeCenter(t){const s=this.transform;if(!s.renderWorldCopies||s.lngRange)return;const a=t.lng-s.center.lng;t.lng+=a>180?-360:a<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(l.L.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}class Tr{constructor(t={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=ee.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=ee.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ee.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){ee.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,s){const a=this._map._getUIString(`AttributionControl.${s}`);t.title=a,t.setAttribute("aria-label",a)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(u=>typeof u!="string"?"":u)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}const s=this._map.style.sourceCaches;for(const u in s){const h=s[u];if(h.used||h.usedForTerrain){const g=h.getSource();g.attribution&&t.indexOf(g.attribution)<0&&t.push(g.attribution)}}t=t.filter(u=>String(u).trim()),t.sort((u,h)=>u.length-h.length),t=t.filter((u,h)=>{for(let g=h+1;g<t.length;g++)if(t[g].indexOf(u)>=0)return!1;return!0});const a=t.join(" | ");a!==this._attribHTML&&(this._attribHTML=a,t.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Qt{constructor(t={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const a=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&a.classList.add("maplibregl-compact"):a.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=ee.create("div","maplibregl-ctrl");const s=ee.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){ee.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class ro{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,a=s?this._queue.concat(s):this._queue;for(const u of a)if(u.id===t)return void(u.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const a of s)if(!a.cancelled&&(a.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const zo={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Fl=l.Q([{name:"a_pos3d",type:"Int16",components:3}]);class Bl extends l.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,s){this.sourceCache.update(t,s),this._renderableTilesKeys=[];const a={};for(const u of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))a[u.key]=!0,this._renderableTilesKeys.push(u.key),this._tiles[u.key]||(u.posMatrix=new Float64Array(16),l.aS(u.posMatrix,0,l.N,0,l.N,0,1),this._tiles[u.key]=new rs(u,this.tileSize));for(const u in this._tiles)a[u]||delete this._tiles[u]}freeRtt(t){for(const s in this._tiles){const a=this._tiles[s];(!t||a.tileID.equals(t)||a.tileID.isChildOf(t)||t.isChildOf(a.tileID))&&(a.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const s={};for(const a of this._renderableTilesKeys){const u=this._tiles[a].tileID;if(u.canonical.equals(t.canonical)){const h=t.clone();h.posMatrix=new Float64Array(16),l.aS(h.posMatrix,0,l.N,0,l.N,0,1),s[a]=h}else if(u.canonical.isChildOf(t.canonical)){const h=t.clone();h.posMatrix=new Float64Array(16);const g=u.canonical.z-t.canonical.z,_=u.canonical.x-(u.canonical.x>>g<<g),x=u.canonical.y-(u.canonical.y>>g<<g),b=l.N>>g;l.aS(h.posMatrix,0,b,0,b,0,1),l.$(h.posMatrix,h.posMatrix,[-_*b,-x*b,0]),s[a]=h}else if(t.canonical.isChildOf(u.canonical)){const h=t.clone();h.posMatrix=new Float64Array(16);const g=t.canonical.z-u.canonical.z,_=t.canonical.x-(t.canonical.x>>g<<g),x=t.canonical.y-(t.canonical.y>>g<<g),b=l.N>>g;l.aS(h.posMatrix,0,l.N,0,l.N,0,1),l.$(h.posMatrix,h.posMatrix,[_*b,x*b,0]),l.a0(h.posMatrix,h.posMatrix,[1/2**g,1/2**g,0]),s[a]=h}}return s}getSourceTile(t,s){const a=this.sourceCache._source;let u=t.overscaledZ-this.deltaZoom;if(u>a.maxzoom&&(u=a.maxzoom),u<a.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(u).key);let h=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!h||!h.dem)&&s)for(;u>=a.minzoom&&(!h||!h.dem);)h=this.sourceCache.getTileByID(t.scaledTo(u--).key);return h}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(s=>s.timeAdded>=t)}}class zl{constructor(t,s,a){this.painter=t,this.sourceCache=new Bl(s),this.options=a,this.exaggeration=typeof a.exaggeration=="number"?a.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,s,a,u=l.N){var h;if(!(s>=0&&s<u&&a>=0&&a<u))return 0;const g=this.getTerrainData(t),_=(h=g.tile)===null||h===void 0?void 0:h.dem;if(!_)return 0;const x=function(V,G,O){var re=G[0],he=G[1];return V[0]=O[0]*re+O[4]*he+O[12],V[1]=O[1]*re+O[5]*he+O[13],V}([],[s/u*l.N,a/u*l.N],g.u_terrain_matrix),b=[x[0]*_.dim,x[1]*_.dim],C=Math.floor(b[0]),S=Math.floor(b[1]),z=b[0]-C,U=b[1]-S;return _.get(C,S)*(1-z)*(1-U)+_.get(C+1,S)*z*(1-U)+_.get(C,S+1)*(1-z)*U+_.get(C+1,S+1)*z*U}getElevationForLngLatZoom(t,s){const{tileID:a,mercatorX:u,mercatorY:h}=this._getOverscaledTileIDFromLngLatZoom(t,s);return this.getElevation(a,u%l.N,h%l.N,l.N)}getElevation(t,s,a,u=l.N){return this.getDEMElevation(t,s,a,u)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const u=this.painter.context,h=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Ut(u,h,u.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Ut(u,new l.R({width:1,height:1}),u.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.ao([])}const s=this.sourceCache.getSourceTile(t,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const u=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new Ut(u,s.dem.getPixels(),u.gl.RGBA,{premultiply:!1}),s.demTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const a=s&&s+s.tileID.key+t.key;if(a&&!this._demMatrixCache[a]){const u=this.sourceCache.sourceCache._source.maxzoom;let h=t.canonical.z-s.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=u?h=t.canonical.z-u:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const g=t.canonical.x-(t.canonical.x>>h<<h),_=t.canonical.y-(t.canonical.y>>h<<h),x=l.bc(new Float64Array(16),[1/(l.N<<h),1/(l.N<<h),0]);l.$(x,x,[g*l.N,_*l.N,0]),this._demMatrixCache[t.key]={matrix:x,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:a?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(t){const s=this.painter,a=s.width/devicePixelRatio,u=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===a&&this._fbo.height===u||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Ut(s.context,{width:a,height:u,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Ut(s.context,{width:a,height:u,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(a,u,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,a,u))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let h=0,g=0;h<this._coordsTextureSize;h++)for(let _=0;_<this._coordsTextureSize;_++,g+=4)s[g+0]=255&_,s[g+1]=255&h,s[g+2]=_>>8<<4|h>>8,s[g+3]=0;const a=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),u=new Ut(t,a,t.gl.RGBA,{premultiply:!1});return u.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=u,u}pointCoordinate(t){const s=new Uint8Array(4),a=this.painter.context,u=a.gl;a.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),u.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,u.RGBA,u.UNSIGNED_BYTE,s),a.bindFramebuffer.set(null);const h=s[0]+(s[2]>>4<<8),g=s[1]+((15&s[2])<<8),_=this.coordsIndex[255-s[3]],x=_&&this.sourceCache.getTileByID(_);if(!x)return null;const b=this._coordsTextureSize,C=(1<<x.tileID.canonical.z)*b;return new l.U(this._allowMercatorOverflow(t,(x.tileID.canonical.x*b+h)/C),(x.tileID.canonical.y*b+g)/C,this.getElevation(x.tileID,h,g,b))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,s=new l.bd,a=new l.b0,u=this.meshSize,h=l.N/u,g=u*u;for(let S=0;S<=u;S++)for(let z=0;z<=u;z++)s.emplaceBack(z*h,S*h,0);for(let S=0;S<g;S+=u+1)for(let z=0;z<u;z++)a.emplaceBack(z+S,u+z+S+1,u+z+S+2),a.emplaceBack(z+S,u+z+S+2,z+S+1);const _=s.length,x=_+2*(u+1);for(const S of[0,1])for(let z=0;z<=u;z++)for(const U of[0,1])s.emplaceBack(z*h,S*l.N,U);for(let S=0;S<2*u;S+=2)a.emplaceBack(x+S,x+S+1,x+S+3),a.emplaceBack(x+S,x+S+3,x+S+2),a.emplaceBack(_+S,_+S+3,_+S+1),a.emplaceBack(_+S,_+S+2,_+S+3);const b=s.length,C=b+2*(u+1);for(const S of[0,1])for(let z=0;z<=u;z++)for(const U of[0,1])s.emplaceBack(S*l.N,z*h,U);for(let S=0;S<2*u;S+=2)a.emplaceBack(b+S,b+S+1,b+S+3),a.emplaceBack(b+S,b+S+3,b+S+2),a.emplaceBack(C+S,C+S+3,C+S+1),a.emplaceBack(C+S,C+S+2,C+S+3);return this._mesh={indexBuffer:t.createIndexBuffer(a),vertexBuffer:t.createVertexBuffer(s,Fl.members),segments:l.S.simpleSegment(0,0,s.length,a.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*l.be/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,s){var a;const{tileID:u}=this._getOverscaledTileIDFromLngLatZoom(t,s);return(a=this.getMinMaxElevation(u).minElevation)!==null&&a!==void 0?a:0}getMinMaxElevation(t){const s=this.getTerrainData(t).tile,a={minElevation:null,maxElevation:null};return s&&s.dem&&(a.minElevation=s.dem.min*this.exaggeration,a.maxElevation=s.dem.max*this.exaggeration),a}_getOverscaledTileIDFromLngLatZoom(t,s){const a=l.U.fromLngLat(t.wrap()),u=(1<<s)*l.N,h=a.x*u,g=a.y*u,_=Math.floor(h/l.N),x=Math.floor(g/l.N);return{tileID:new l.O(s,0,s,_,x),mercatorX:h,mercatorY:g}}_allowMercatorOverflow(t,s){const a=t.x<this.painter.width/2;let u=l.bf(s);const h=this.painter.transform.center.lng;return a&&Math.sign(u)>0&&Math.sign(h)<0||!a&&Math.sign(u)<0&&Math.sign(h)>0?(u=360*Math.sign(h)+u,l.G(u)):s}}class wu{constructor(t,s,a){this._context=t,this._size=s,this._tileSize=a,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),a=new Ut(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return a.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(a.texture),{id:t,fbo:s,texture:a,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(s=>t.id!==s),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const ir={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class so{constructor(t,s){this.painter=t,this.terrain=s,this.pool=new wu(t.context,30,s.sourceCache.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(a=>!t._layers[a].isHidden(s)),this._coordsDescendingInv={};for(const a in t.sourceCaches){this._coordsDescendingInv[a]={};const u=t.sourceCaches[a].getVisibleCoordinates();for(const h of u){const g=this.terrain.sourceCache.getTerrainCoords(h);for(const _ in g)this._coordsDescendingInv[a][_]||(this._coordsDescendingInv[a][_]=[]),this._coordsDescendingInv[a][_].push(g[_])}}this._coordsDescendingInvStr={};for(const a of t._order){const u=t._layers[a],h=u.source;if(ir[u.type]&&!this._coordsDescendingInvStr[h]){this._coordsDescendingInvStr[h]={};for(const g in this._coordsDescendingInv[h])this._coordsDescendingInvStr[h][g]=this._coordsDescendingInv[h][g].map(_=>_.key).sort().join()}}for(const a of this._renderableTiles)for(const u in this._coordsDescendingInvStr){const h=this._coordsDescendingInvStr[u][a.tileID.key];h&&h!==a.rttCoords[u]&&(a.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const s=t.type,a=this.painter,u=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(ir[s]&&(this._prevType&&ir[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(t.id),!u))return!0;if(ir[this._prevType]||ir[s]&&u){this._prevType=s;const h=this._stacks.length-1,g=this._stacks[h]||[];for(const _ of this._renderableTiles){if(this.pool.isFull()&&(Et(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(_),_.rtt[h]){const b=this.pool.getObjectForId(_.rtt[h].id);if(b.stamp===_.rtt[h].stamp){this.pool.useObject(b);continue}}const x=this.pool.getOrCreateFreeObject();this.pool.useObject(x),this.pool.stampObject(x),_.rtt[h]={id:x.id,stamp:x.stamp},a.context.bindFramebuffer.set(x.fbo.framebuffer),a.context.clear({color:l.aT.transparent,stencil:0}),a.currentStencilSource=void 0;for(let b=0;b<g.length;b++){const C=a.style._layers[g[b]],S=C.source?this._coordsDescendingInv[C.source][_.tileID.key]:[_.tileID];a.context.viewport.set([0,0,x.fbo.width,x.fbo.height]),a._renderTileClippingMasks(C,S),a.renderLayer(a,a.style.sourceCaches[C.source],C,S),C.source&&(_.rttCoords[C.source]=this._coordsDescendingInvStr[C.source][_.tileID.key])}}return Et(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),ir[s]}return!1}}const Je=_e,it={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Ta=c=>{c.touchstart=c.dragStart,c.touchmoveWindow=c.dragMove,c.touchend=c.dragEnd},Mo={showCompass:!0,showZoom:!0,visualizePitch:!1};class Po{constructor(t,s,a=!1){this.mousedown=g=>{this.startMouse(l.e({},g,{ctrlKey:!0,preventDefault:()=>g.preventDefault()}),ee.mousePos(this.element,g)),ee.addEventListener(window,"mousemove",this.mousemove),ee.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=g=>{this.moveMouse(g,ee.mousePos(this.element,g))},this.mouseup=g=>{this.mouseRotate.dragEnd(g),this.mousePitch&&this.mousePitch.dragEnd(g),this.offTemp()},this.touchstart=g=>{g.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ee.touchPos(this.element,g.targetTouches)[0],this.startTouch(g,this._startPos),ee.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),ee.addEventListener(window,"touchend",this.touchend))},this.touchmove=g=>{g.targetTouches.length!==1?this.reset():(this._lastPos=ee.touchPos(this.element,g.targetTouches)[0],this.moveTouch(g,this._lastPos))},this.touchend=g=>{g.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const u=t.dragRotate._mouseRotate.getClickTolerance(),h=t.dragRotate._mousePitch.getClickTolerance();this.element=s,this.mouseRotate=Wn({clickTolerance:u,enable:!0}),this.touchRotate=(({enable:g,clickTolerance:_,bearingDegreesPerPixelMoved:x=.8})=>{const b=new Cl;return new Ms({clickTolerance:_,move:(C,S)=>({bearingDelta:(S.x-C.x)*x}),moveStateManager:b,enable:g,assignEvents:Ta})})({clickTolerance:u,enable:!0}),this.map=t,a&&(this.mousePitch=Ps({clickTolerance:h,enable:!0}),this.touchPitch=(({enable:g,clickTolerance:_,pitchDegreesPerPixelMoved:x=-.5})=>{const b=new Cl;return new Ms({clickTolerance:_,move:(C,S)=>({pitchDelta:(S.y-C.y)*x}),moveStateManager:b,enable:g,assignEvents:Ta})})({clickTolerance:h,enable:!0})),ee.addEventListener(s,"mousedown",this.mousedown),ee.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),ee.addEventListener(s,"touchcancel",this.reset)}startMouse(t,s){this.mouseRotate.dragStart(t,s),this.mousePitch&&this.mousePitch.dragStart(t,s),ee.disableDrag()}startTouch(t,s){this.touchRotate.dragStart(t,s),this.touchPitch&&this.touchPitch.dragStart(t,s),ee.disableDrag()}moveMouse(t,s){const a=this.map,{bearingDelta:u}=this.mouseRotate.dragMove(t,s)||{};if(u&&a.setBearing(a.getBearing()+u),this.mousePitch){const{pitchDelta:h}=this.mousePitch.dragMove(t,s)||{};h&&a.setPitch(a.getPitch()+h)}}moveTouch(t,s){const a=this.map,{bearingDelta:u}=this.touchRotate.dragMove(t,s)||{};if(u&&a.setBearing(a.getBearing()+u),this.touchPitch){const{pitchDelta:h}=this.touchPitch.dragMove(t,s)||{};h&&a.setPitch(a.getPitch()+h)}}off(){const t=this.element;ee.removeEventListener(t,"mousedown",this.mousedown),ee.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),ee.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ee.removeEventListener(window,"touchend",this.touchend),ee.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){ee.enableDrag(),ee.removeEventListener(window,"mousemove",this.mousemove),ee.removeEventListener(window,"mouseup",this.mouseup),ee.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ee.removeEventListener(window,"touchend",this.touchend)}}let _i;function Lo(c,t,s){if(c=new l.L(c.lng,c.lat),t){const a=new l.L(c.lng-360,c.lat),u=new l.L(c.lng+360,c.lat),h=s.locationPoint(c).distSqr(t);s.locationPoint(a).distSqr(t)<h?c=a:s.locationPoint(u).distSqr(t)<h&&(c=u)}for(;Math.abs(c.lng-s.center.lng)>180;){const a=s.locationPoint(c);if(a.x>=0&&a.y>=0&&a.x<=s.width&&a.y<=s.height)break;c.lng>s.center.lng?c.lng-=360:c.lng+=360}return c}const $r={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ml(c,t,s){const a=c.classList;for(const u in $r)a.remove(`maplibregl-${s}-anchor-${u}`);a.add(`maplibregl-${s}-anchor-${t}`)}class _n extends l.E{constructor(t){if(super(),this._onKeyPress=s=>{const a=s.code,u=s.charCode||s.keyCode;a!=="Space"&&a!=="Enter"&&u!==32&&u!==13||this.togglePopup()},this._onMapClick=s=>{const a=s.originalEvent.target,u=this._element;this._popup&&(a===u||u.contains(a))&&this.togglePopup()},this._update=s=>{if(!this._map)return;const a=this._map.loaded()&&!this._map.isMoving();((s==null?void 0:s.type)==="terrain"||(s==null?void 0:s.type)==="render"&&!a)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=Lo(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let u="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?u=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(u=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let h="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?h="rotateX(0deg)":this._pitchAlignment==="map"&&(h=`rotateX(${this._map.getPitch()}deg)`),s&&s.type!=="moveend"||(this._pos=this._pos.round()),ee.setTransform(this._element,`${$r[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${h} ${u}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const g=this._map.unproject(this._pos),_=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=g.distanceTo(this._lngLat)>20*_?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=s=>{if(!this._isDragging){const a=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=a}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.k("dragstart"))),this.fire(new l.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.k("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=l.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=ee.create("div"),this._element.setAttribute("aria-label","Map marker");const s=ee.createNS("http://www.w3.org/2000/svg","svg"),a=41,u=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${a}px`),s.setAttributeNS(null,"width",`${u}px`),s.setAttributeNS(null,"viewBox",`0 0 ${u} ${a}`);const h=ee.createNS("http://www.w3.org/2000/svg","g");h.setAttributeNS(null,"stroke","none"),h.setAttributeNS(null,"stroke-width","1"),h.setAttributeNS(null,"fill","none"),h.setAttributeNS(null,"fill-rule","evenodd");const g=ee.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"fill-rule","nonzero");const _=ee.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"transform","translate(3.0, 29.0)"),_.setAttributeNS(null,"fill","#000000");const x=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const re of x){const he=ee.createNS("http://www.w3.org/2000/svg","ellipse");he.setAttributeNS(null,"opacity","0.04"),he.setAttributeNS(null,"cx","10.5"),he.setAttributeNS(null,"cy","5.80029008"),he.setAttributeNS(null,"rx",re.rx),he.setAttributeNS(null,"ry",re.ry),_.appendChild(he)}const b=ee.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"fill",this._color);const C=ee.createNS("http://www.w3.org/2000/svg","path");C.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),b.appendChild(C);const S=ee.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"opacity","0.25"),S.setAttributeNS(null,"fill","#000000");const z=ee.createNS("http://www.w3.org/2000/svg","path");z.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),S.appendChild(z);const U=ee.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"transform","translate(6.0, 7.0)"),U.setAttributeNS(null,"fill","#FFFFFF");const V=ee.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"transform","translate(8.0, 8.0)");const G=ee.createNS("http://www.w3.org/2000/svg","circle");G.setAttributeNS(null,"fill","#000000"),G.setAttributeNS(null,"opacity","0.25"),G.setAttributeNS(null,"cx","5.5"),G.setAttributeNS(null,"cy","5.5"),G.setAttributeNS(null,"r","5.4999962");const O=ee.createNS("http://www.w3.org/2000/svg","circle");O.setAttributeNS(null,"fill","#FFFFFF"),O.setAttributeNS(null,"cx","5.5"),O.setAttributeNS(null,"cy","5.5"),O.setAttributeNS(null,"r","5.4999962"),V.appendChild(G),V.appendChild(O),g.appendChild(_),g.appendChild(b),g.appendChild(S),g.appendChild(U),g.appendChild(V),s.appendChild(g),s.setAttributeNS(null,"height",a*this._scale+"px"),s.setAttributeNS(null,"width",u*this._scale+"px"),this._element.appendChild(s),this._offset=l.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",s=>{s.preventDefault()}),this._element.addEventListener("mousedown",s=>{s.preventDefault()}),Ml(this._element,this._anchor,"marker"),t&&t.className)for(const s of t.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),ee.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=l.L.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const u=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[u,-1*(38.1-13.5+u)],"bottom-right":[-u,-1*(38.1-13.5+u)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(t){return this._offset=l.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const li={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ai=0,Kn=!1;const Da={maxWidth:100,unit:"metric"};function Ia(c,t,s){const a=s&&s.maxWidth||100,u=c._container.clientHeight/2,h=c.unproject([0,u]),g=c.unproject([a,u]),_=h.distanceTo(g);if(s&&s.unit==="imperial"){const x=3.2808*_;x>5280?yn(t,a,x/5280,c._getUIString("ScaleControl.Miles")):yn(t,a,x,c._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?yn(t,a,_/1852,c._getUIString("ScaleControl.NauticalMiles")):_>=1e3?yn(t,a,_/1e3,c._getUIString("ScaleControl.Kilometers")):yn(t,a,_,c._getUIString("ScaleControl.Meters"))}function yn(c,t,s,a){const u=function(h){const g=Math.pow(10,`${Math.floor(h)}`.length-1);let _=h/g;return _=_>=10?10:_>=5?5:_>=3?3:_>=2?2:_>=1?1:function(x){const b=Math.pow(10,Math.ceil(-Math.log(x)/Math.LN10));return Math.round(x*b)/b}(_),g*_}(s);c.style.width=t*(u/s)+"px",c.innerHTML=`${u}&nbsp;${a}`}const Ro={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Oo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Yn(c){if(c){if(typeof c=="number"){const t=Math.round(Math.abs(c)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,c),"top-left":new l.P(t,t),"top-right":new l.P(-t,t),bottom:new l.P(0,-c),"bottom-left":new l.P(t,-t),"bottom-right":new l.P(-t,-t),left:new l.P(c,0),right:new l.P(-c,0)}}if(c instanceof l.P||Array.isArray(c)){const t=l.P.convert(c);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:l.P.convert(c.center||[0,0]),top:l.P.convert(c.top||[0,0]),"top-left":l.P.convert(c["top-left"]||[0,0]),"top-right":l.P.convert(c["top-right"]||[0,0]),bottom:l.P.convert(c.bottom||[0,0]),"bottom-left":l.P.convert(c["bottom-left"]||[0,0]),"bottom-right":l.P.convert(c["bottom-right"]||[0,0]),left:l.P.convert(c.left||[0,0]),right:l.P.convert(c.right||[0,0])}}return Yn(new l.P(0,0))}const $o={extend:(c,...t)=>l.e(c,...t),run(c){c()},logToElement(c,t=!1,s="log"){const a=window.document.getElementById(s);a&&(t&&(a.innerHTML=""),a.innerHTML+=`<br>${c}`)}},No=_e;class Ft{static get version(){return No}static get workerCount(){return Ar.workerCount}static set workerCount(t){Ar.workerCount=t}static get maxParallelImageRequests(){return l.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(t){l.c.MAX_PARALLEL_IMAGE_REQUESTS=t}static get workerUrl(){return l.c.WORKER_URL}static set workerUrl(t){l.c.WORKER_URL=t}static addProtocol(t,s){l.c.REGISTERED_PROTOCOLS[t]=s}static removeProtocol(t){delete l.c.REGISTERED_PROTOCOLS[t]}}return Ft.Map=class extends Il{constructor(c){if(l.bg.mark(l.bh.create),(c=l.e({},it,c)).minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Qa(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies),{bearingSnap:c.bearingSnap}),this._cooperativeGesturesOnWheel=t=>{this._onCooperativeGesture(t,t[this._metaKey],1)},this._contextLost=t=>{t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.k("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.k("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=c.interactive,this._cooperativeGestures=c.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=c.maxTileCacheSize,this._maxTileCacheZoomLevels=c.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=c.preserveDrawingBuffer,this._antialias=c.antialias,this._trackResize=c.trackResize,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles,this._fadeDuration=c.fadeDuration,this._crossSourceCollisions=c.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=c.collectResourceTiming,this._renderTaskQueue=new ro,this._controls=[],this._mapId=l.a2(),this._locale=l.e({},zo,c.locale),this._clickTolerance=c.clickTolerance,this._overridePixelRatio=c.pixelRatio,this._maxCanvasSize=c.maxCanvasSize,this.transformCameraUpdate=c.transformCameraUpdate,this._imageQueueHandle=Ct.addThrottleControl(()=>this.isMoving()),this._requestManager=new Mr(c.transformRequest),typeof c.container=="string"){if(this._container=document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(c.maxBounds&&this.setMaxBounds(c.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let t=!1;const s=gn(a=>{this._trackResize&&!this._removed&&this.resize(a)._update()},50);this._resizeObserver=new ResizeObserver(a=>{t?s(a):t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Bo(this,c),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=c.hash&&new Aa(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,l.e({},c.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=c.localIdeographFontFamily,this._validateStyle=c.validateStyle,c.style&&this.setStyle(c.style,{localIdeographFontFamily:c.localIdeographFontFamily}),c.attributionControl&&this.addControl(new Tr({customAttribution:c.customAttribution})),c.maplibreLogo&&this.addControl(new Qt,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new l.k(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new l.k(`${t.dataType}dataloading`,t))}),this.on("dataabort",t=>{this.fire(new l.k("sourcedataabort",t))})}_getMapId(){return this._mapId}addControl(c,t){if(t===void 0&&(t=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new l.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=c.onAdd(this);this._controls.push(c);const a=this._controlPositions[t];return t.indexOf("bottom")!==-1?a.insertBefore(s,a.firstChild):a.appendChild(s),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new l.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(c);return t>-1&&this._controls.splice(t,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}calculateCameraOptionsFromTo(c,t,s,a){return a==null&&this.terrain&&(a=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(c,t,s,a)}resize(c){var t;const s=this._containerDimensions(),a=s[0],u=s[1],h=this._getClampedPixelRatio(a,u);if(this._resizeCanvas(a,u,h),this.painter.resize(a,u,h),this.painter.overLimit()){const _=this.painter.context.gl;this._maxCanvasSize=[_.drawingBufferWidth,_.drawingBufferHeight];const x=this._getClampedPixelRatio(a,u);this._resizeCanvas(a,u,x),this.painter.resize(a,u,x)}this.transform.resize(a,u),(t=this._requestedCameraState)===null||t===void 0||t.resize(a,u);const g=!this._moving;return g&&(this.stop(),this.fire(new l.k("movestart",c)).fire(new l.k("move",c))),this.fire(new l.k("resize",c)),g&&this.fire(new l.k("moveend",c)),this}_getClampedPixelRatio(c,t){const{0:s,1:a}=this._maxCanvasSize,u=this.getPixelRatio(),h=c*u,g=t*u;return Math.min(h>s?s/h:1,g>a?a/g:1)*u}getPixelRatio(){var c;return(c=this._overridePixelRatio)!==null&&c!==void 0?c:devicePixelRatio}setPixelRatio(c){this._overridePixelRatio=c,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(c){return this.transform.setMaxBounds(Lt.convert(c)),this._update()}setMinZoom(c){if((c=c??-2)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c&&this.setZoom(c),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c??22)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c&&this.setZoom(c),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c&&this.setPitch(c),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c&&this.setPitch(c),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(c){return this._cooperativeGestures=c,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(c){return this.transform.locationPoint(l.L.convert(c),this.style&&this.terrain)}unproject(c){return this.transform.pointLocation(l.P.convert(c),this.terrain)}isMoving(){var c;return this._moving||((c=this.handlers)===null||c===void 0?void 0:c.isMoving())}isZooming(){var c;return this._zooming||((c=this.handlers)===null||c===void 0?void 0:c.isZooming())}isRotating(){var c;return this._rotating||((c=this.handlers)===null||c===void 0?void 0:c.isRotating())}_createDelegatedListener(c,t,s){if(c==="mouseenter"||c==="mouseover"){let a=!1;return{layer:t,listener:s,delegates:{mousemove:h=>{const g=this.getLayer(t)?this.queryRenderedFeatures(h.point,{layers:[t]}):[];g.length?a||(a=!0,s.call(this,new kr(c,this,h.originalEvent,{features:g}))):a=!1},mouseout:()=>{a=!1}}}}if(c==="mouseleave"||c==="mouseout"){let a=!1;return{layer:t,listener:s,delegates:{mousemove:g=>{(this.getLayer(t)?this.queryRenderedFeatures(g.point,{layers:[t]}):[]).length?a=!0:a&&(a=!1,s.call(this,new kr(c,this,g.originalEvent)))},mouseout:g=>{a&&(a=!1,s.call(this,new kr(c,this,g.originalEvent)))}}}}{const a=u=>{const h=this.getLayer(t)?this.queryRenderedFeatures(u.point,{layers:[t]}):[];h.length&&(u.features=h,s.call(this,u),delete u.features)};return{layer:t,listener:s,delegates:{[c]:a}}}}on(c,t,s){if(s===void 0)return super.on(c,t);const a=this._createDelegatedListener(c,t,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(a);for(const u in a.delegates)this.on(u,a.delegates[u]);return this}once(c,t,s){if(s===void 0)return super.once(c,t);const a=this._createDelegatedListener(c,t,s);for(const u in a.delegates)this.once(u,a.delegates[u]);return this}off(c,t,s){return s===void 0?super.off(c,t):(this._delegatedListeners&&this._delegatedListeners[c]&&(a=>{const u=this._delegatedListeners[c];for(let h=0;h<u.length;h++){const g=u[h];if(g.layer===t&&g.listener===s){for(const _ in g.delegates)this.off(_,g.delegates[_]);return u.splice(h,1),this}}})(),this)}queryRenderedFeatures(c,t){if(!this.style)return[];let s;const a=c instanceof l.P||Array.isArray(c),u=a?c:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(a?{}:c)||{},u instanceof l.P||typeof u[0]=="number")s=[l.P.convert(u)];else{const h=l.P.convert(u[0]),g=l.P.convert(u[1]);s=[h,new l.P(g.x,h.y),g,new l.P(h.x,g.y),h]}return this.style.queryRenderedFeatures(s,t,this.transform)}querySourceFeatures(c,t){return this.style.querySourceFeatures(c,t)}setStyle(c,t){return(t=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&c?(this._diffStyle(c,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(c,t))}setTransformRequest(c){return this._requestManager.setTransformRequest(c),this}_getUIString(c){const t=this._locale[c];if(t==null)throw new Error(`Missing UI string '${c}'`);return t}_updateStyle(c,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(c,t));const s=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!c)),c?(this.style=new vi(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof c=="string"?this.style.loadURL(c,t,s):this.style.loadJSON(c,t,s),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new vi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(c,t){if(typeof c=="string"){const s=this._requestManager.transformRequest(c,vt.Style);l.f(s,(a,u)=>{a?this.fire(new l.j(a)):u&&this._updateDiff(u,t)})}else typeof c=="object"&&this._updateDiff(c,t)}_updateDiff(c,t){try{this.style.setState(c,t)&&this._update(!0)}catch(s){l.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(c,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(c,t){return this._lazyInitEmptyStyle(),this.style.addSource(c,t),this._update(!0)}isSourceLoaded(c){const t=this.style&&this.style.sourceCaches[c];if(t!==void 0)return t.loaded();this.fire(new l.j(new Error(`There is no source with ID '${c}'`)))}setTerrain(c){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),c){const t=this.style.sourceCaches[c.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${c.source}`);for(const s in this.style._layers){const a=this.style._layers[s];a.type==="hillshade"&&a.source===c.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new zl(this.painter,t,c),this.painter.renderToTexture=new so(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=s=>{s.dataType==="style"?this.terrain.sourceCache.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==c.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new l.k("terrain",{terrain:c})),this}getTerrain(){var c,t;return(t=(c=this.terrain)===null||c===void 0?void 0:c.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const c=this.style&&this.style.sourceCaches;for(const t in c){const s=c[t]._tiles;for(const a in s){const u=s[a];if(u.state!=="loaded"&&u.state!=="errored")return!1}}return!0}addSourceType(c,t,s){return this._lazyInitEmptyStyle(),this.style.addSourceType(c,t,s)}removeSource(c){return this.style.removeSource(c),this._update(!0)}getSource(c){return this.style.getSource(c)}addImage(c,t,s={}){const{pixelRatio:a=1,sdf:u=!1,stretchX:h,stretchY:g,content:_}=s;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||l.a(t))){if(t.width===void 0||t.height===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:x,height:b,data:C}=t,S=t;return this.style.addImage(c,{data:new l.R({width:x,height:b},new Uint8Array(C)),pixelRatio:a,stretchX:h,stretchY:g,content:_,sdf:u,version:0,userImage:S}),S.onAdd&&S.onAdd(this,c),this}}{const{width:x,height:b,data:C}=l.h.getImageData(t);this.style.addImage(c,{data:new l.R({width:x,height:b},C),pixelRatio:a,stretchX:h,stretchY:g,content:_,sdf:u,version:0})}}updateImage(c,t){const s=this.style.getImage(c);if(!s)return this.fire(new l.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const a=t instanceof HTMLImageElement||l.a(t)?l.h.getImageData(t):t,{width:u,height:h,data:g}=a;if(u===void 0||h===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(u!==s.data.width||h!==s.data.height)return this.fire(new l.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const _=!(t instanceof HTMLImageElement||l.a(t));return s.data.replace(g,_),this.style.updateImage(c,s),this}getImage(c){return this.style.getImage(c)}hasImage(c){return c?!!this.style.getImage(c):(this.fire(new l.j(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(c)}loadImage(c,t){Ct.getImage(this._requestManager.transformRequest(c,vt.Image),t)}listImages(){return this.style.listImages()}addLayer(c,t){return this._lazyInitEmptyStyle(),this.style.addLayer(c,t),this._update(!0)}moveLayer(c,t){return this.style.moveLayer(c,t),this._update(!0)}removeLayer(c){return this.style.removeLayer(c),this._update(!0)}getLayer(c){return this.style.getLayer(c)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(c,t,s){return this.style.setLayerZoomRange(c,t,s),this._update(!0)}setFilter(c,t,s={}){return this.style.setFilter(c,t,s),this._update(!0)}getFilter(c){return this.style.getFilter(c)}setPaintProperty(c,t,s,a={}){return this.style.setPaintProperty(c,t,s,a),this._update(!0)}getPaintProperty(c,t){return this.style.getPaintProperty(c,t)}setLayoutProperty(c,t,s,a={}){return this.style.setLayoutProperty(c,t,s,a),this._update(!0)}getLayoutProperty(c,t){return this.style.getLayoutProperty(c,t)}setGlyphs(c,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(c,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(c,t,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(c,t,s,a=>{a||this._update(!0)}),this}removeSprite(c){return this._lazyInitEmptyStyle(),this.style.removeSprite(c),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(c,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(c,t,s=>{s||this._update(!0)}),this}setLight(c,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(c,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(c,t){return this.style.setFeatureState(c,t),this._update()}removeFeatureState(c,t){return this.style.removeFeatureState(c,t),this._update()}getFeatureState(c){return this.style.getFeatureState(c)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let c=0,t=0;return this._container&&(c=this._container.clientWidth||400,t=this._container.clientHeight||300),[c,t]}_setupContainer(){const c=this._container;c.classList.add("maplibregl-map");const t=this._canvasContainer=ee.create("div","maplibregl-canvas-container",c);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=ee.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),a=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],a);const u=this._controlContainer=ee.create("div","maplibregl-control-container",c),h=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(g=>{h[g]=ee.create("div",`maplibregl-ctrl-${g} `,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=ee.create("div","maplibregl-cooperative-gesture-screen",this._container);let c=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(c=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use  + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${c}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){ee.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(c,t,s){this._canvas.width=Math.floor(s*c),this._canvas.height=Math.floor(s*t),this._canvas.style.width=`${c}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const c={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",a=>{t={requestedAttributes:c},a&&(t.statusMessage=a.statusMessage,t.type=a.type)},{once:!0});const s=this._canvas.getContext("webgl2",c)||this._canvas.getContext("webgl",c);if(!s){const a="Failed to initialize WebGL";throw t?(t.message=a,new Error(JSON.stringify(t))):new Error(a)}this.painter=new Xr(s,this.transform),Te.testSupport(s)}_onCooperativeGesture(c,t,s){return!t&&s<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(c){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_render(c){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(c),this._removed)return;let s=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const u=this.transform.zoom,h=l.h.now();this.style.zoomHistory.update(u,h);const g=new l.a8(u,{now:h,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),_=g.crossFadingFactor();_===1&&_===this._crossFadingFactor||(s=!0,this._crossFadingFactor=_),this.style.update(g)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new l.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.bg.mark(l.bh.load),this.fire(new l.k("load"))),this.style&&(this.style.hasTransitions()||s)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const a=this._sourcesDirty||this._styleDirty||this._placementDirty;return a||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.k("idle")),!this._loaded||this._fullyLoaded||a||(this._fullyLoaded=!0,l.bg.mark(l.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var c;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Ct.removeThrottleControl(this._imageQueueHandle),(c=this._resizeObserver)===null||c===void 0||c.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),ee.remove(this._canvasContainer),ee.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),l.bg.clearMetrics(),this._removed=!0,this.fire(new l.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=l.h.frame(c=>{l.bg.frame(c),this._frame=null,this._render(c)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}get version(){return Je}getCameraTargetElevation(){return this.transform.elevation}},Ft.NavigationControl=class{constructor(c){this._updateZoomButtons=()=>{const t=this._map.getZoom(),s=t===this._map.getMaxZoom(),a=t===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,s)=>{const a=this._map._getUIString(`NavigationControl.${s}`);t.title=a,t.setAttribute("aria-label",a)},this.options=l.e({},Mo,c),this._container=ee.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),ee.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),ee.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=ee.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Po(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){ee.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(c,t){const s=ee.create("button",c,this._container);return s.type="button",s.addEventListener("click",t),s}},Ft.GeolocateControl=class extends l.E{constructor(c){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new l.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const s=new l.L(t.coords.longitude,t.coords.latitude),a=t.coords.accuracy,u=this._map.getBearing(),h=l.e({bearing:u},this.options.fitBoundsOptions),g=Lt.fromLngLat(s,a);this._map.fitBounds(g,h,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const s=new l.L(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Kn)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=ee.create("button","maplibregl-ctrl-geolocate",this._container),ee.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ee.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new _n({element:this._dotElement}),this._circleElement=ee.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new _n({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.k("trackuserlocationend")))})}},this.options=l.e({},li,c)}onAdd(c){return this._map=c,this._container=ee.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(t,s=!1){_i===void 0||s?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(a=>{_i=a.state!=="denied",t(_i)}).catch(()=>{_i=!!window.navigator.geolocation,t(_i)}):(_i=!!window.navigator.geolocation,t(_i)):t(_i)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ee.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ai=0,Kn=!1}_isOutOfMapMaxBounds(c){const t=this._map.getMaxBounds(),s=c.coords;return t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const c=this._map.getBounds(),t=c.getSouthEast(),s=c.getNorthEast(),a=t.distanceTo(s),u=Math.ceil(this._accuracy/(a/this._map._container.clientHeight)*2);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ai--,Kn=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let c;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ai++,ai>1?(c={maximumAge:6e5,timeout:0},Kn=!0):(c=this.options.positionOptions,Kn=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},Ft.AttributionControl=Tr,Ft.LogoControl=Qt,Ft.ScaleControl=class{constructor(c){this._onMove=()=>{Ia(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Ia(this._map,this._container,this.options)},this.options=l.e({},Da,c)}getDefaultPosition(){return"bottom-left"}onAdd(c){return this._map=c,this._container=ee.create("div","maplibregl-ctrl maplibregl-ctrl-scale",c.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){ee.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},Ft.FullscreenControl=class extends l.E{constructor(c={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,c&&c.container&&(c.container instanceof HTMLElement?this._container=c.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=ee.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){ee.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const c=this._fullscreenButton=ee.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);ee.create("span","maplibregl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.title=c}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new l.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},Ft.TerrainControl=class{constructor(c){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=c}onAdd(c){return this._map=c,this._container=ee.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=ee.create("button","maplibregl-ctrl-terrain",this._container),ee.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){ee.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},Ft.Popup=class extends l.E{constructor(c){super(),this.remove=()=>(this._content&&ee.remove(this._content),this._container&&(ee.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new l.k("close")),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=ee.create("div","maplibregl-popup",this._map.getContainer()),this._tip=ee.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const g of this.options.className.split(" "))this._container.classList.add(g);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Lo(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!t)return;const s=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);let a=this.options.anchor;const u=Yn(this.options.offset);if(!a){const g=this._container.offsetWidth,_=this._container.offsetHeight;let x;x=s.y+u.bottom.y<_?["top"]:s.y>this._map.transform.height-_?["bottom"]:[],s.x<g/2?x.push("left"):s.x>this._map.transform.width-g/2&&x.push("right"),a=x.length===0?"bottom":x.join("-")}const h=s.add(u[a]).round();ee.setTransform(this._container,`${$r[a]} translate(${h.x}px,${h.y}px)`),Ml(this._container,a,"popup")},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(Ro),c)}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=l.L.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(document.createTextNode(c))}setHTML(c){const t=document.createDocumentFragment(),s=document.createElement("body");let a;for(s.innerHTML=c;a=s.firstChild,a;)t.appendChild(a);return this.setDOMContent(t)}getMaxWidth(){var c;return(c=this._container)===null||c===void 0?void 0:c.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ee.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(c){this._container&&this._container.classList.add(c)}removeClassName(c){this._container&&this._container.classList.remove(c)}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){if(this._container)return this._container.classList.toggle(c)}_createCloseButton(){this.options.closeButton&&(this._closeButton=ee.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const c=this._container.querySelector(Oo);c&&c.focus()}},Ft.Marker=_n,Ft.Style=vi,Ft.LngLat=l.L,Ft.LngLatBounds=Lt,Ft.Point=l.P,Ft.MercatorCoordinate=l.U,Ft.Evented=l.E,Ft.AJAXError=l.bi,Ft.config=l.c,Ft.CanvasSource=gi,Ft.GeoJSONSource=ct,Ft.ImageSource=Pt,Ft.RasterDEMTileSource=et,Ft.RasterTileSource=je,Ft.VectorTileSource=Pr,Ft.VideoSource=qt,Ft.setRTLTextPlugin=l.bj,Ft.getRTLTextPluginStatus=l.bk,Ft.prewarm=function(){Tn().acquire(St)},Ft.clearPrewarmedResources=function(){const c=Gr;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(St),Gr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},$o.extend(Ft,{isSafari:l.ac,getPerformanceMetrics:l.bg.getPerformanceMetrics}),Ft});var Q=$;return Q})})(xp);var Mf=xp.exports;const Pf=yp(Mf),bp=window.location.hostname,Lf=bp!=="anvaka.github.io",Vs=Lf?`http://${bp}:8080/`:"https://anvaka.github.io/lang-land-data/",Rf=new URLSearchParams(window.location.search),Us=Rf.get("v")||"hsk/v1",sn={serverUrl:Vs+Us+"/",glyphsSource:"https://anvaka.github.io/map-of-github-data/fonts/{fontstack}/{range}.pbf",bordersSource:`${Vs}${Us}/borders.geojson`,pointsSource:`${Vs}${Us}/points.geojson`,placesSource:`${Vs}${Us}/places.geojson`,roadsSource:`${Vs}${Us}/roads.geojson`,regionsSource:`${Vs}${Us}/regions.geojson`,rasterTilesSource:`${Vs}${Us}/tiles/{z}/{x}/{y}.webp`,graphFileUrl:`${Vs}${Us}/graph.dot`,flashcardsUrl:`${Vs}${Us}/flashcards.json`,cardsFolder:`${Vs}${Us}/cards/`,imagesFolder:`${Vs}${Us}/images_optimized/`},dc="hsk-land-word-stats",La={getHistory(){try{const M=localStorage.getItem(dc);return M?JSON.parse(M):{}}catch(M){return console.warn("Failed to parse word stats:",M),{}}},saveHistory(M){try{localStorage.setItem(dc,JSON.stringify(M))}catch(w){console.warn("Failed to save word stats:",w)}},recordClick(M){if(!M)return;const w=this.getHistory(),f=Date.now();w[M]=w[M]||[],w[M].push(f),this.saveHistory(w)},getLastClickTime(M){if(!M)return null;const w=this.getHistory();return!w[M]||w[M].length===0?null:w[M][w[M].length-1]},getClickCount(M){var f;return M&&((f=this.getHistory()[M])==null?void 0:f.length)||0},getMostClicked(){const M=this.getHistory();return Object.entries(M).map(([w,f])=>({word:w,count:f.length,lastClicked:f[f.length-1]})).sort((w,f)=>f.count-w.count||f.lastClicked-w.lastClicked)},getUniqueWordCount(){return Object.keys(this.getHistory()).length},getTotalClickCount(){const M=this.getHistory();return Object.values(M).reduce((w,f)=>w+f.length,0)},getRecentClicks(M=7){const w=this.getHistory(),f=Math.floor(Date.now()/1e3)-M*86400;return Object.entries(w).flatMap(([T,$])=>$.filter(H=>H>=f).map(H=>({word:T,timestamp:H}))).sort((T,$)=>$.timestamp-T.timestamp)},clearAll(){localStorage.removeItem(dc)}},pu={element:null,isOpen:!1,wordClickCallback:null,sortState:{column:"count",direction:"asc"},init(M){this.wordClickCallback=M,this.createSidebar(),this.attachEventHandlers(),document.querySelector("#app").appendChild(this.element)},createSidebar(){this.element=document.createElement("div"),this.element.className="stats-sidebar",this.element.innerHTML=`
      <div class="stats-sidebar-content">
        <button class="stats close-btn" aria-label="Close statistics">&times;</button>
        <div class="stats-content">
          <h3>Word Learning Progress</h3>
          <div class="stats-summary">
            <div class="stat-item">
              <span class="stat-number" id="unique-words">0</span>
              <span class="stat-label">Words Discovered</span>
            </div>
            <div class="stat-item">
              <span class="stat-number" id="total-clicks">0</span>
              <span class="stat-label">Total Views</span>
            </div>
          </div>
          <div class="stats-section">
            <h4>Most Reviewed Words</h4>
            <div class="most-clicked-list" id="most-clicked-list">
              <p class="no-data">No words viewed yet. Start exploring!</p>
            </div>
          </div>
          <div class="stats-actions">
            <button class="clear-stats-btn" id="clear-stats">Reset Progress</button>
          </div>
        </div>
      </div>
    `},attachEventHandlers(){const M=this.element.querySelector(".close-btn"),w=this.element.querySelector("#clear-stats");M.addEventListener("click",()=>this.close()),w.addEventListener("click",()=>this.promptClear()),document.addEventListener("keydown",f=>{f.key==="Escape"&&this.isOpen&&this.close()}),this.element.addEventListener("click",f=>{const T=f.target.closest(".sortable");if(T){const H=T.dataset.sort;this.handleSort(H);return}const $=f.target.closest(".word-stat-item");if($){const H=$.querySelector(".word-name").textContent;H&&this.wordClickCallback&&(f.preventDefault(),this.wordClickCallback(H))}})},handleSort(M){this.sortState.column===M?this.sortState.direction=this.sortState.direction==="asc"?"desc":"asc":(this.sortState.column=M,this.sortState.direction=M==="word"?"asc":"desc"),this.refreshStats()},open(){this.refreshStats(),this.element.classList.add("open"),this.isOpen=!0},close(){this.element.classList.remove("open"),this.isOpen=!1},sortData(M){const{column:w,direction:f}=this.sortState,T=f==="asc"?1:-1;return M.sort(($,H)=>w==="word"?T*$.word.localeCompare(H.word):w==="count"?T*($.count-H.count):w==="lastClicked"?T*($.lastClicked-H.lastClicked):0)},refreshStats(){const M=La.getUniqueWordCount(),w=La.getTotalClickCount();let f=La.getMostClicked();document.getElementById("unique-words").textContent=M,document.getElementById("total-clicks").textContent=w;const T=document.getElementById("most-clicked-list");if(f.length===0)T.innerHTML='<p class="no-data">No words viewed yet. Start exploring!</p>';else{f=this.sortData(f);const $=H=>this.sortState.column!==H?"":this.sortState.direction==="asc"?" ":" ";T.innerHTML=`
        <div style="overflow-y: auto; width: 100%;max-height: 400px;">
          <table class="word-stats-table">
            <thead>
              <tr>
                <th class="word-column sortable" data-sort="word" title="Click to sort alphabetically">Word${$("word")}</th>
                <th class="count-column sortable" data-sort="count" title="Click to sort by view count">Views${$("count")}</th>
                <th class="time-column sortable" data-sort="lastClicked" title="Click to sort by last viewed time">Last Viewed${$("lastClicked")}</th>
              </tr>
            </thead>
            <tbody>
              ${f.map(({word:H,count:Q,lastClicked:l})=>{const _e=this.formatTimestamp(l);return`
                  <tr class="word-stat-item" data-word="${H}">
                    <td class="word-name">${H}</td>
                    <td class="word-count">${Q}</td>
                    <td class="word-last-viewed">${_e}</td>
                  </tr>
                `}).join("")}
            </tbody>
          </table>
        </div>
      `}},promptClear(){confirm("Reset all word learning progress? This cannot be undone.")&&(La.clearAll(),this.refreshStats())},formatTimestamp(M){if(!M)return"Never";const f=(Date.now()-M)/1e3;return f<60?"Just now":f<3600?`${Math.floor(f/60)} min ago`:f<86400?`${Math.floor(f/3600)} hr ago`:f<172800?"Yesterday":new Date(M).toLocaleDateString()}};function Of(M){const w=La.getLastClickTime(M);if(!w)return 1;const T=Date.now()-w;if(T<60*1e3)return 0;const $=7*24*60*60*1e3;return T>$?1:T/$}function $f(){return{background:"#030E2E",circleColor:"#EAEDEF",circleStrokeColor:"#000",circleLabelsColor:"#FFF",circleLabelsHaloColor:"#101",circleLabelsHaloWidth:1.2,placeLabelsColor:"#FFF",placeLabelsHaloColor:"#000",placeLabelsHaloWidth:.2}}function Nf(){const M=$f();return{version:8,glyphs:sn.glyphsSource,sources:{"borders-source":{type:"geojson",data:sn.bordersSource},"points-source":{type:"geojson",data:sn.pointsSource},places:{type:"geojson",data:sn.placesSource},roads:{type:"geojson",data:sn.roadsSource},"highlighted-nodes":{type:"geojson",data:{type:"FeatureCollection",features:[]}},"highlighted-edges":{type:"geojson",data:{type:"FeatureCollection",features:[]}},"highlighted-region":{type:"geojson",data:{type:"FeatureCollection",features:[]}},"clipped-regions-raster":{type:"raster",tiles:[sn.rasterTilesSource],tileSize:512,minzoom:4.3,maxzoom:12},"region-boundaries":{type:"geojson",data:{type:"FeatureCollection",features:[]}}},layers:[{id:"background",type:"background",paint:{"background-color":M.background}},{id:"polygon-layer",type:"fill",source:"borders-source",filter:["==","$type","Polygon"],paint:{"fill-color":["get","fill"]}},{id:"clipped-regions-raster-layer",type:"raster",source:"clipped-regions-raster",layout:{visibility:"none"},paint:{"raster-opacity":1,"raster-resampling":"linear","raster-fade-duration":0}},{id:"region-fill-layer",type:"fill",source:"region-boundaries",minzoom:4.2,paint:{"fill-color":["get","fill"],"fill-opacity":["feature-state","opacity"]}},{id:"region-boundaries-layer",type:"line",source:"region-boundaries",minzoom:4.2,paint:{"line-blur":.4,"line-color":"rgba(255, 255, 255, 0.5)","line-opacity":.4,"line-dasharray":[2,2],"line-width":{base:1.3,stops:[[3,1],[22,15]]}}},{id:"border-highlight",type:"line",source:"borders-source",layout:{},paint:{"line-color":"rgba(255, 255, 255, 0.5)","line-width":["interpolate",["exponential",1.1],["zoom"],3,1,22,20]}},{id:"roads-layer",type:"line",source:"roads",minzoom:4,paint:{"line-color":"#FFF","line-width":["interpolate",["linear"],["zoom"],4,.5,12,2],"line-opacity":["interpolate",["linear"],["zoom"],8,.1,12,.8]}},{id:"highlighted-edges",type:"line",source:"highlighted-edges",paint:{"line-color":"#e56aaa","line-width":2,"line-opacity":.8},layout:{"line-cap":"round","line-join":"round"}},{id:"circle-layer",type:"circle",source:"points-source",paint:{"circle-color":M.circleColor,"circle-opacity":["interpolate",["linear"],["zoom"],5,.1,15,.9],"circle-stroke-color":M.circleStrokeColor,"circle-stroke-width":1,"circle-stroke-opacity":["interpolate",["linear"],["zoom"],8,0,15,.9],"circle-radius":["interpolate",["linear"],["zoom"],5,["*",["get","size"],1.5],23,["*",["get","size"],2]]}},{id:"label-layer",type:"symbol",source:"points-source",filter:[">=",["zoom"],4],layout:{"text-font":["Roboto Condensed Regular"],"text-field":["slice",["get","label"],["+",["index-of","/",["get","label"]],1]],"text-anchor":"top","symbol-sort-key":["-",0,["get","size"]],"symbol-spacing":500,"text-offset":[0,.5],"text-size":["interpolate",["linear"],["zoom"],4.5,12,10,20,13,48]},paint:{"text-color":M.circleLabelsColor,"text-halo-color":M.circleLabelsHaloColor,"text-halo-width":M.circleLabelsHaloWidth}},{id:"highlighted-nodes",type:"circle",source:"highlighted-nodes",paint:{"circle-color":["get","color"],"circle-opacity":1,"circle-stroke-color":"#fff","circle-stroke-width":1.5,"circle-radius":["interpolate",["linear"],["zoom"],5,["*",["get","size"],.25],23,["*",["get","size"],2.5]]}},{id:"highlighted-region-outline",type:"line",source:"highlighted-region",paint:{"line-color":"#ffffff","line-width":3,"line-opacity":.9},layout:{"line-cap":"round","line-join":"round"}},{id:"place-country-1",maxzoom:10,type:"symbol",source:"places",layout:{"text-font":["Roboto Condensed Bold"],"text-size":["interpolate",["cubic-bezier",.2,0,.7,1],["zoom"],1,["step",["get","symbolzoom"],15,4,13,5,12],9,["step",["get","symbolzoom"],22,4,19,5,17]],"symbol-sort-key":["get","symbolzoom"],"text-field":"{name}","text-max-width":6,"text-line-height":1.1,"text-letter-spacing":0},paint:{"text-color":M.placeLabelsColor,"text-halo-color":M.placeLabelsHaloColor,"text-halo-width":M.placeLabelsHaloWidth},filter:["<=",["get","symbolzoom"],["+",["zoom"],4]]}]}}function vc(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}let $a=vc();function wp(M){$a=M}const Ap=/[&<>"']/,Vf=new RegExp(Ap.source,"g"),Ep=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,Uf=new RegExp(Ep.source,"g"),qf={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},hp=M=>qf[M];function es(M,w){if(w){if(Ap.test(M))return M.replace(Vf,hp)}else if(Ep.test(M))return M.replace(Uf,hp);return M}const jf=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function Zf(M){return M.replace(jf,(w,f)=>(f=f.toLowerCase(),f==="colon"?":":f.charAt(0)==="#"?f.charAt(1)==="x"?String.fromCharCode(parseInt(f.substring(2),16)):String.fromCharCode(+f.substring(1)):""))}const Gf=/(^|[^\[])\^/g;function ii(M,w){let f=typeof M=="string"?M:M.source;w=w||"";const T={replace:($,H)=>{let Q=typeof H=="string"?H:H.source;return Q=Q.replace(Gf,"$1"),f=f.replace($,Q),T},getRegex:()=>new RegExp(f,w)};return T}function pp(M){try{M=encodeURI(M).replace(/%25/g,"%")}catch{return null}return M}const ll={exec:()=>null};function dp(M,w){const f=M.replace(/\|/g,(H,Q,l)=>{let _e=!1,ee=Q;for(;--ee>=0&&l[ee]==="\\";)_e=!_e;return _e?"|":" |"}),T=f.split(/ \|/);let $=0;if(T[0].trim()||T.shift(),T.length>0&&!T[T.length-1].trim()&&T.pop(),w)if(T.length>w)T.splice(w);else for(;T.length<w;)T.push("");for(;$<T.length;$++)T[$]=T[$].trim().replace(/\\\|/g,"|");return T}function nu(M,w,f){const T=M.length;if(T===0)return"";let $=0;for(;$<T&&M.charAt(T-$-1)===w;)$++;return M.slice(0,T-$)}function Hf(M,w){if(M.indexOf(w[1])===-1)return-1;let f=0;for(let T=0;T<M.length;T++)if(M[T]==="\\")T++;else if(M[T]===w[0])f++;else if(M[T]===w[1]&&(f--,f<0))return T;return-1}function fp(M,w,f,T){const $=w.href,H=w.title?es(w.title):null,Q=M[1].replace(/\\([\[\]])/g,"$1");if(M[0].charAt(0)!=="!"){T.state.inLink=!0;const l={type:"link",raw:f,href:$,title:H,text:Q,tokens:T.inlineTokens(Q)};return T.state.inLink=!1,l}return{type:"image",raw:f,href:$,title:H,text:es(Q)}}function Wf(M,w){const f=M.match(/^(\s+)(?:```)/);if(f===null)return w;const T=f[1];return w.split(`
`).map($=>{const H=$.match(/^\s+/);if(H===null)return $;const[Q]=H;return Q.length>=T.length?$.slice(T.length):$}).join(`
`)}class du{constructor(w){ui(this,"options");ui(this,"rules");ui(this,"lexer");this.options=w||$a}space(w){const f=this.rules.block.newline.exec(w);if(f&&f[0].length>0)return{type:"space",raw:f[0]}}code(w){const f=this.rules.block.code.exec(w);if(f){const T=f[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:f[0],codeBlockStyle:"indented",text:this.options.pedantic?T:nu(T,`
`)}}}fences(w){const f=this.rules.block.fences.exec(w);if(f){const T=f[0],$=Wf(T,f[3]||"");return{type:"code",raw:T,lang:f[2]?f[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):f[2],text:$}}}heading(w){const f=this.rules.block.heading.exec(w);if(f){let T=f[2].trim();if(/#$/.test(T)){const $=nu(T,"#");(this.options.pedantic||!$||/ $/.test($))&&(T=$.trim())}return{type:"heading",raw:f[0],depth:f[1].length,text:T,tokens:this.lexer.inline(T)}}}hr(w){const f=this.rules.block.hr.exec(w);if(f)return{type:"hr",raw:f[0]}}blockquote(w){const f=this.rules.block.blockquote.exec(w);if(f){const T=nu(f[0].replace(/^ *>[ \t]?/gm,""),`
`),$=this.lexer.state.top;this.lexer.state.top=!0;const H=this.lexer.blockTokens(T);return this.lexer.state.top=$,{type:"blockquote",raw:f[0],tokens:H,text:T}}}list(w){let f=this.rules.block.list.exec(w);if(f){let T=f[1].trim();const $=T.length>1,H={type:"list",raw:"",ordered:$,start:$?+T.slice(0,-1):"",loose:!1,items:[]};T=$?`\\d{1,9}\\${T.slice(-1)}`:`\\${T}`,this.options.pedantic&&(T=$?T:"[*+-]");const Q=new RegExp(`^( {0,3}${T})((?:[	 ][^\\n]*)?(?:\\n|$))`);let l="",_e="",ee=!1;for(;w;){let Te=!1;if(!(f=Q.exec(w))||this.rules.block.hr.test(w))break;l=f[0],w=w.substring(l.length);let Ve=f[2].split(`
`,1)[0].replace(/^\t+/,vt=>" ".repeat(3*vt.length)),Ee=w.split(`
`,1)[0],ft=0;this.options.pedantic?(ft=2,_e=Ve.trimStart()):(ft=f[2].search(/[^ ]/),ft=ft>4?1:ft,_e=Ve.slice(ft),ft+=f[1].length);let ci=!1;if(!Ve&&/^ *$/.test(Ee)&&(l+=Ee+`
`,w=w.substring(Ee.length+1),Te=!0),!Te){const vt=new RegExp(`^ {0,${Math.min(3,ft-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),Mr=new RegExp(`^ {0,${Math.min(3,ft-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),Ji=new RegExp(`^ {0,${Math.min(3,ft-1)}}(?:\`\`\`|~~~)`),lr=new RegExp(`^ {0,${Math.min(3,ft-1)}}#`);for(;w;){const Mi=w.split(`
`,1)[0];if(Ee=Mi,this.options.pedantic&&(Ee=Ee.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),Ji.test(Ee)||lr.test(Ee)||vt.test(Ee)||Mr.test(w))break;if(Ee.search(/[^ ]/)>=ft||!Ee.trim())_e+=`
`+Ee.slice(ft);else{if(ci||Ve.search(/[^ ]/)>=4||Ji.test(Ve)||lr.test(Ve)||Mr.test(Ve))break;_e+=`
`+Ee}!ci&&!Ee.trim()&&(ci=!0),l+=Mi+`
`,w=w.substring(Mi.length+1),Ve=Ee.slice(ft)}}H.loose||(ee?H.loose=!0:/\n *\n *$/.test(l)&&(ee=!0));let Vt=null,Ct;this.options.gfm&&(Vt=/^\[[ xX]\] /.exec(_e),Vt&&(Ct=Vt[0]!=="[ ] ",_e=_e.replace(/^\[[ xX]\] +/,""))),H.items.push({type:"list_item",raw:l,task:!!Vt,checked:Ct,loose:!1,text:_e,tokens:[]}),H.raw+=l}H.items[H.items.length-1].raw=l.trimEnd(),H.items[H.items.length-1].text=_e.trimEnd(),H.raw=H.raw.trimEnd();for(let Te=0;Te<H.items.length;Te++)if(this.lexer.state.top=!1,H.items[Te].tokens=this.lexer.blockTokens(H.items[Te].text,[]),!H.loose){const Ve=H.items[Te].tokens.filter(ft=>ft.type==="space"),Ee=Ve.length>0&&Ve.some(ft=>/\n.*\n/.test(ft.raw));H.loose=Ee}if(H.loose)for(let Te=0;Te<H.items.length;Te++)H.items[Te].loose=!0;return H}}html(w){const f=this.rules.block.html.exec(w);if(f)return{type:"html",block:!0,raw:f[0],pre:f[1]==="pre"||f[1]==="script"||f[1]==="style",text:f[0]}}def(w){const f=this.rules.block.def.exec(w);if(f){const T=f[1].toLowerCase().replace(/\s+/g," "),$=f[2]?f[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",H=f[3]?f[3].substring(1,f[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):f[3];return{type:"def",tag:T,raw:f[0],href:$,title:H}}}table(w){const f=this.rules.block.table.exec(w);if(!f||!/[:|]/.test(f[2]))return;const T=dp(f[1]),$=f[2].replace(/^\||\| *$/g,"").split("|"),H=f[3]&&f[3].trim()?f[3].replace(/\n[ \t]*$/,"").split(`
`):[],Q={type:"table",raw:f[0],header:[],align:[],rows:[]};if(T.length===$.length){for(const l of $)/^ *-+: *$/.test(l)?Q.align.push("right"):/^ *:-+: *$/.test(l)?Q.align.push("center"):/^ *:-+ *$/.test(l)?Q.align.push("left"):Q.align.push(null);for(const l of T)Q.header.push({text:l,tokens:this.lexer.inline(l)});for(const l of H)Q.rows.push(dp(l,Q.header.length).map(_e=>({text:_e,tokens:this.lexer.inline(_e)})));return Q}}lheading(w){const f=this.rules.block.lheading.exec(w);if(f)return{type:"heading",raw:f[0],depth:f[2].charAt(0)==="="?1:2,text:f[1],tokens:this.lexer.inline(f[1])}}paragraph(w){const f=this.rules.block.paragraph.exec(w);if(f){const T=f[1].charAt(f[1].length-1)===`
`?f[1].slice(0,-1):f[1];return{type:"paragraph",raw:f[0],text:T,tokens:this.lexer.inline(T)}}}text(w){const f=this.rules.block.text.exec(w);if(f)return{type:"text",raw:f[0],text:f[0],tokens:this.lexer.inline(f[0])}}escape(w){const f=this.rules.inline.escape.exec(w);if(f)return{type:"escape",raw:f[0],text:es(f[1])}}tag(w){const f=this.rules.inline.tag.exec(w);if(f)return!this.lexer.state.inLink&&/^<a /i.test(f[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(f[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(f[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(f[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:f[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:f[0]}}link(w){const f=this.rules.inline.link.exec(w);if(f){const T=f[2].trim();if(!this.options.pedantic&&/^</.test(T)){if(!/>$/.test(T))return;const Q=nu(T.slice(0,-1),"\\");if((T.length-Q.length)%2===0)return}else{const Q=Hf(f[2],"()");if(Q>-1){const _e=(f[0].indexOf("!")===0?5:4)+f[1].length+Q;f[2]=f[2].substring(0,Q),f[0]=f[0].substring(0,_e).trim(),f[3]=""}}let $=f[2],H="";if(this.options.pedantic){const Q=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec($);Q&&($=Q[1],H=Q[3])}else H=f[3]?f[3].slice(1,-1):"";return $=$.trim(),/^</.test($)&&(this.options.pedantic&&!/>$/.test(T)?$=$.slice(1):$=$.slice(1,-1)),fp(f,{href:$&&$.replace(this.rules.inline.anyPunctuation,"$1"),title:H&&H.replace(this.rules.inline.anyPunctuation,"$1")},f[0],this.lexer)}}reflink(w,f){let T;if((T=this.rules.inline.reflink.exec(w))||(T=this.rules.inline.nolink.exec(w))){const $=(T[2]||T[1]).replace(/\s+/g," "),H=f[$.toLowerCase()];if(!H){const Q=T[0].charAt(0);return{type:"text",raw:Q,text:Q}}return fp(T,H,T[0],this.lexer)}}emStrong(w,f,T=""){let $=this.rules.inline.emStrongLDelim.exec(w);if(!$||$[3]&&T.match(/[\p{L}\p{N}]/u))return;if(!($[1]||$[2]||"")||!T||this.rules.inline.punctuation.exec(T)){const Q=[...$[0]].length-1;let l,_e,ee=Q,Te=0;const Ve=$[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(Ve.lastIndex=0,f=f.slice(-1*w.length+Q);($=Ve.exec(f))!=null;){if(l=$[1]||$[2]||$[3]||$[4]||$[5]||$[6],!l)continue;if(_e=[...l].length,$[3]||$[4]){ee+=_e;continue}else if(($[5]||$[6])&&Q%3&&!((Q+_e)%3)){Te+=_e;continue}if(ee-=_e,ee>0)continue;_e=Math.min(_e,_e+ee+Te);const Ee=[...$[0]][0].length,ft=w.slice(0,Q+$.index+Ee+_e);if(Math.min(Q,_e)%2){const Vt=ft.slice(1,-1);return{type:"em",raw:ft,text:Vt,tokens:this.lexer.inlineTokens(Vt)}}const ci=ft.slice(2,-2);return{type:"strong",raw:ft,text:ci,tokens:this.lexer.inlineTokens(ci)}}}}codespan(w){const f=this.rules.inline.code.exec(w);if(f){let T=f[2].replace(/\n/g," ");const $=/[^ ]/.test(T),H=/^ /.test(T)&&/ $/.test(T);return $&&H&&(T=T.substring(1,T.length-1)),T=es(T,!0),{type:"codespan",raw:f[0],text:T}}}br(w){const f=this.rules.inline.br.exec(w);if(f)return{type:"br",raw:f[0]}}del(w){const f=this.rules.inline.del.exec(w);if(f)return{type:"del",raw:f[0],text:f[2],tokens:this.lexer.inlineTokens(f[2])}}autolink(w){const f=this.rules.inline.autolink.exec(w);if(f){let T,$;return f[2]==="@"?(T=es(f[1]),$="mailto:"+T):(T=es(f[1]),$=T),{type:"link",raw:f[0],text:T,href:$,tokens:[{type:"text",raw:T,text:T}]}}}url(w){var T;let f;if(f=this.rules.inline.url.exec(w)){let $,H;if(f[2]==="@")$=es(f[0]),H="mailto:"+$;else{let Q;do Q=f[0],f[0]=((T=this.rules.inline._backpedal.exec(f[0]))==null?void 0:T[0])??"";while(Q!==f[0]);$=es(f[0]),f[1]==="www."?H="http://"+f[0]:H=f[0]}return{type:"link",raw:f[0],text:$,href:H,tokens:[{type:"text",raw:$,text:$}]}}}inlineText(w){const f=this.rules.inline.text.exec(w);if(f){let T;return this.lexer.state.inRawBlock?T=f[0]:T=es(f[0]),{type:"text",raw:f[0],text:T}}}}const Xf=/^(?: *(?:\n|$))+/,Kf=/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,Yf=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,fl=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Jf=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,Cp=/(?:[*+-]|\d{1,9}[.)])/,Sp=ii(/^(?!bull )((?:.|\n(?!\s*?\n|bull ))+?)\n {0,3}(=+|-+) *(?:\n+|$)/).replace(/bull/g,Cp).getRegex(),bc=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Qf=/^[^\n]+/,wc=/(?!\s*\])(?:\\.|[^\[\]\\])+/,em=ii(/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/).replace("label",wc).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),tm=ii(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,Cp).getRegex(),gu="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Ac=/<!--(?!-?>)[\s\S]*?(?:-->|$)/,im=ii("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))","i").replace("comment",Ac).replace("tag",gu).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),kp=ii(bc).replace("hr",fl).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",gu).getRegex(),rm=ii(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",kp).getRegex(),Ec={blockquote:rm,code:Kf,def:em,fences:Yf,heading:Jf,hr:fl,html:im,lheading:Sp,list:tm,newline:Xf,paragraph:kp,table:ll,text:Qf},mp=ii("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",fl).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",gu).getRegex(),sm={...Ec,table:mp,paragraph:ii(bc).replace("hr",fl).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",mp).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",gu).getRegex()},nm={...Ec,html:ii(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Ac).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:ll,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:ii(bc).replace("hr",fl).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Sp).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},Tp=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,am=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Dp=/^( {2,}|\\)\n(?!\s*$)/,om=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,ml="\\p{P}$+<=>`^|~",lm=ii(/^((?![*_])[\spunctuation])/,"u").replace(/punctuation/g,ml).getRegex(),um=/\[[^[\]]*?\]\([^\(\)]*?\)|`[^`]*?`|<[^<>]*?>/g,cm=ii(/^(?:\*+(?:((?!\*)[punct])|[^\s*]))|^_+(?:((?!_)[punct])|([^\s_]))/,"u").replace(/punct/g,ml).getRegex(),hm=ii("^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)[punct](\\*+)(?=[\\s]|$)|[^punct\\s](\\*+)(?!\\*)(?=[punct\\s]|$)|(?!\\*)[punct\\s](\\*+)(?=[^punct\\s])|[\\s](\\*+)(?!\\*)(?=[punct])|(?!\\*)[punct](\\*+)(?!\\*)(?=[punct])|[^punct\\s](\\*+)(?=[^punct\\s])","gu").replace(/punct/g,ml).getRegex(),pm=ii("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)[punct](_+)(?=[\\s]|$)|[^punct\\s](_+)(?!_)(?=[punct\\s]|$)|(?!_)[punct\\s](_+)(?=[^punct\\s])|[\\s](_+)(?!_)(?=[punct])|(?!_)[punct](_+)(?!_)(?=[punct])","gu").replace(/punct/g,ml).getRegex(),dm=ii(/\\([punct])/,"gu").replace(/punct/g,ml).getRegex(),fm=ii(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),mm=ii(Ac).replace("(?:-->|$)","-->").getRegex(),gm=ii("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",mm).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),fu=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,_m=ii(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",fu).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Ip=ii(/^!?\[(label)\]\[(ref)\]/).replace("label",fu).replace("ref",wc).getRegex(),Fp=ii(/^!?\[(ref)\](?:\[\])?/).replace("ref",wc).getRegex(),ym=ii("reflink|nolink(?!\\()","g").replace("reflink",Ip).replace("nolink",Fp).getRegex(),Cc={_backpedal:ll,anyPunctuation:dm,autolink:fm,blockSkip:um,br:Dp,code:am,del:ll,emStrongLDelim:cm,emStrongRDelimAst:hm,emStrongRDelimUnd:pm,escape:Tp,link:_m,nolink:Fp,punctuation:lm,reflink:Ip,reflinkSearch:ym,tag:gm,text:om,url:ll},xm={...Cc,link:ii(/^!?\[(label)\]\((.*?)\)/).replace("label",fu).getRegex(),reflink:ii(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",fu).getRegex()},gc={...Cc,escape:ii(Tp).replace("])","~|])").getRegex(),url:ii(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},vm={...gc,br:ii(Dp).replace("{2,}","*").getRegex(),text:ii(gc.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},au={normal:Ec,gfm:sm,pedantic:nm},ol={normal:Cc,gfm:gc,breaks:vm,pedantic:xm};class nn{constructor(w){ui(this,"tokens");ui(this,"options");ui(this,"state");ui(this,"tokenizer");ui(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=w||$a,this.options.tokenizer=this.options.tokenizer||new du,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const f={block:au.normal,inline:ol.normal};this.options.pedantic?(f.block=au.pedantic,f.inline=ol.pedantic):this.options.gfm&&(f.block=au.gfm,this.options.breaks?f.inline=ol.breaks:f.inline=ol.gfm),this.tokenizer.rules=f}static get rules(){return{block:au,inline:ol}}static lex(w,f){return new nn(f).lex(w)}static lexInline(w,f){return new nn(f).inlineTokens(w)}lex(w){w=w.replace(/\r\n|\r/g,`
`),this.blockTokens(w,this.tokens);for(let f=0;f<this.inlineQueue.length;f++){const T=this.inlineQueue[f];this.inlineTokens(T.src,T.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(w,f=[]){this.options.pedantic?w=w.replace(/\t/g,"    ").replace(/^ +$/gm,""):w=w.replace(/^( *)(\t+)/gm,(l,_e,ee)=>_e+"    ".repeat(ee.length));let T,$,H,Q;for(;w;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(l=>(T=l.call({lexer:this},w,f))?(w=w.substring(T.raw.length),f.push(T),!0):!1))){if(T=this.tokenizer.space(w)){w=w.substring(T.raw.length),T.raw.length===1&&f.length>0?f[f.length-1].raw+=`
`:f.push(T);continue}if(T=this.tokenizer.code(w)){w=w.substring(T.raw.length),$=f[f.length-1],$&&($.type==="paragraph"||$.type==="text")?($.raw+=`
`+T.raw,$.text+=`
`+T.text,this.inlineQueue[this.inlineQueue.length-1].src=$.text):f.push(T);continue}if(T=this.tokenizer.fences(w)){w=w.substring(T.raw.length),f.push(T);continue}if(T=this.tokenizer.heading(w)){w=w.substring(T.raw.length),f.push(T);continue}if(T=this.tokenizer.hr(w)){w=w.substring(T.raw.length),f.push(T);continue}if(T=this.tokenizer.blockquote(w)){w=w.substring(T.raw.length),f.push(T);continue}if(T=this.tokenizer.list(w)){w=w.substring(T.raw.length),f.push(T);continue}if(T=this.tokenizer.html(w)){w=w.substring(T.raw.length),f.push(T);continue}if(T=this.tokenizer.def(w)){w=w.substring(T.raw.length),$=f[f.length-1],$&&($.type==="paragraph"||$.type==="text")?($.raw+=`
`+T.raw,$.text+=`
`+T.raw,this.inlineQueue[this.inlineQueue.length-1].src=$.text):this.tokens.links[T.tag]||(this.tokens.links[T.tag]={href:T.href,title:T.title});continue}if(T=this.tokenizer.table(w)){w=w.substring(T.raw.length),f.push(T);continue}if(T=this.tokenizer.lheading(w)){w=w.substring(T.raw.length),f.push(T);continue}if(H=w,this.options.extensions&&this.options.extensions.startBlock){let l=1/0;const _e=w.slice(1);let ee;this.options.extensions.startBlock.forEach(Te=>{ee=Te.call({lexer:this},_e),typeof ee=="number"&&ee>=0&&(l=Math.min(l,ee))}),l<1/0&&l>=0&&(H=w.substring(0,l+1))}if(this.state.top&&(T=this.tokenizer.paragraph(H))){$=f[f.length-1],Q&&$.type==="paragraph"?($.raw+=`
`+T.raw,$.text+=`
`+T.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=$.text):f.push(T),Q=H.length!==w.length,w=w.substring(T.raw.length);continue}if(T=this.tokenizer.text(w)){w=w.substring(T.raw.length),$=f[f.length-1],$&&$.type==="text"?($.raw+=`
`+T.raw,$.text+=`
`+T.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=$.text):f.push(T);continue}if(w){const l="Infinite loop on byte: "+w.charCodeAt(0);if(this.options.silent){console.error(l);break}else throw new Error(l)}}return this.state.top=!0,f}inline(w,f=[]){return this.inlineQueue.push({src:w,tokens:f}),f}inlineTokens(w,f=[]){let T,$,H,Q=w,l,_e,ee;if(this.tokens.links){const Te=Object.keys(this.tokens.links);if(Te.length>0)for(;(l=this.tokenizer.rules.inline.reflinkSearch.exec(Q))!=null;)Te.includes(l[0].slice(l[0].lastIndexOf("[")+1,-1))&&(Q=Q.slice(0,l.index)+"["+"a".repeat(l[0].length-2)+"]"+Q.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(l=this.tokenizer.rules.inline.blockSkip.exec(Q))!=null;)Q=Q.slice(0,l.index)+"["+"a".repeat(l[0].length-2)+"]"+Q.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(l=this.tokenizer.rules.inline.anyPunctuation.exec(Q))!=null;)Q=Q.slice(0,l.index)+"++"+Q.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;w;)if(_e||(ee=""),_e=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(Te=>(T=Te.call({lexer:this},w,f))?(w=w.substring(T.raw.length),f.push(T),!0):!1))){if(T=this.tokenizer.escape(w)){w=w.substring(T.raw.length),f.push(T);continue}if(T=this.tokenizer.tag(w)){w=w.substring(T.raw.length),$=f[f.length-1],$&&T.type==="text"&&$.type==="text"?($.raw+=T.raw,$.text+=T.text):f.push(T);continue}if(T=this.tokenizer.link(w)){w=w.substring(T.raw.length),f.push(T);continue}if(T=this.tokenizer.reflink(w,this.tokens.links)){w=w.substring(T.raw.length),$=f[f.length-1],$&&T.type==="text"&&$.type==="text"?($.raw+=T.raw,$.text+=T.text):f.push(T);continue}if(T=this.tokenizer.emStrong(w,Q,ee)){w=w.substring(T.raw.length),f.push(T);continue}if(T=this.tokenizer.codespan(w)){w=w.substring(T.raw.length),f.push(T);continue}if(T=this.tokenizer.br(w)){w=w.substring(T.raw.length),f.push(T);continue}if(T=this.tokenizer.del(w)){w=w.substring(T.raw.length),f.push(T);continue}if(T=this.tokenizer.autolink(w)){w=w.substring(T.raw.length),f.push(T);continue}if(!this.state.inLink&&(T=this.tokenizer.url(w))){w=w.substring(T.raw.length),f.push(T);continue}if(H=w,this.options.extensions&&this.options.extensions.startInline){let Te=1/0;const Ve=w.slice(1);let Ee;this.options.extensions.startInline.forEach(ft=>{Ee=ft.call({lexer:this},Ve),typeof Ee=="number"&&Ee>=0&&(Te=Math.min(Te,Ee))}),Te<1/0&&Te>=0&&(H=w.substring(0,Te+1))}if(T=this.tokenizer.inlineText(H)){w=w.substring(T.raw.length),T.raw.slice(-1)!=="_"&&(ee=T.raw.slice(-1)),_e=!0,$=f[f.length-1],$&&$.type==="text"?($.raw+=T.raw,$.text+=T.text):f.push(T);continue}if(w){const Te="Infinite loop on byte: "+w.charCodeAt(0);if(this.options.silent){console.error(Te);break}else throw new Error(Te)}}return f}}class mu{constructor(w){ui(this,"options");this.options=w||$a}code(w,f,T){var H;const $=(H=(f||"").match(/^\S*/))==null?void 0:H[0];return w=w.replace(/\n$/,"")+`
`,$?'<pre><code class="language-'+es($)+'">'+(T?w:es(w,!0))+`</code></pre>
`:"<pre><code>"+(T?w:es(w,!0))+`</code></pre>
`}blockquote(w){return`<blockquote>
${w}</blockquote>
`}html(w,f){return w}heading(w,f,T){return`<h${f}>${w}</h${f}>
`}hr(){return`<hr>
`}list(w,f,T){const $=f?"ol":"ul",H=f&&T!==1?' start="'+T+'"':"";return"<"+$+H+`>
`+w+"</"+$+`>
`}listitem(w,f,T){return`<li>${w}</li>
`}checkbox(w){return"<input "+(w?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph(w){return`<p>${w}</p>
`}table(w,f){return f&&(f=`<tbody>${f}</tbody>`),`<table>
<thead>
`+w+`</thead>
`+f+`</table>
`}tablerow(w){return`<tr>
${w}</tr>
`}tablecell(w,f){const T=f.header?"th":"td";return(f.align?`<${T} align="${f.align}">`:`<${T}>`)+w+`</${T}>
`}strong(w){return`<strong>${w}</strong>`}em(w){return`<em>${w}</em>`}codespan(w){return`<code>${w}</code>`}br(){return"<br>"}del(w){return`<del>${w}</del>`}link(w,f,T){const $=pp(w);if($===null)return T;w=$;let H='<a href="'+w+'"';return f&&(H+=' title="'+f+'"'),H+=">"+T+"</a>",H}image(w,f,T){const $=pp(w);if($===null)return T;w=$;let H=`<img src="${w}" alt="${T}"`;return f&&(H+=` title="${f}"`),H+=">",H}text(w){return w}}class Sc{strong(w){return w}em(w){return w}codespan(w){return w}del(w){return w}html(w){return w}text(w){return w}link(w,f,T){return""+T}image(w,f,T){return""+T}br(){return""}}class an{constructor(w){ui(this,"options");ui(this,"renderer");ui(this,"textRenderer");this.options=w||$a,this.options.renderer=this.options.renderer||new mu,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new Sc}static parse(w,f){return new an(f).parse(w)}static parseInline(w,f){return new an(f).parseInline(w)}parse(w,f=!0){let T="";for(let $=0;$<w.length;$++){const H=w[$];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[H.type]){const Q=H,l=this.options.extensions.renderers[Q.type].call({parser:this},Q);if(l!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(Q.type)){T+=l||"";continue}}switch(H.type){case"space":continue;case"hr":{T+=this.renderer.hr();continue}case"heading":{const Q=H;T+=this.renderer.heading(this.parseInline(Q.tokens),Q.depth,Zf(this.parseInline(Q.tokens,this.textRenderer)));continue}case"code":{const Q=H;T+=this.renderer.code(Q.text,Q.lang,!!Q.escaped);continue}case"table":{const Q=H;let l="",_e="";for(let Te=0;Te<Q.header.length;Te++)_e+=this.renderer.tablecell(this.parseInline(Q.header[Te].tokens),{header:!0,align:Q.align[Te]});l+=this.renderer.tablerow(_e);let ee="";for(let Te=0;Te<Q.rows.length;Te++){const Ve=Q.rows[Te];_e="";for(let Ee=0;Ee<Ve.length;Ee++)_e+=this.renderer.tablecell(this.parseInline(Ve[Ee].tokens),{header:!1,align:Q.align[Ee]});ee+=this.renderer.tablerow(_e)}T+=this.renderer.table(l,ee);continue}case"blockquote":{const Q=H,l=this.parse(Q.tokens);T+=this.renderer.blockquote(l);continue}case"list":{const Q=H,l=Q.ordered,_e=Q.start,ee=Q.loose;let Te="";for(let Ve=0;Ve<Q.items.length;Ve++){const Ee=Q.items[Ve],ft=Ee.checked,ci=Ee.task;let Vt="";if(Ee.task){const Ct=this.renderer.checkbox(!!ft);ee?Ee.tokens.length>0&&Ee.tokens[0].type==="paragraph"?(Ee.tokens[0].text=Ct+" "+Ee.tokens[0].text,Ee.tokens[0].tokens&&Ee.tokens[0].tokens.length>0&&Ee.tokens[0].tokens[0].type==="text"&&(Ee.tokens[0].tokens[0].text=Ct+" "+Ee.tokens[0].tokens[0].text)):Ee.tokens.unshift({type:"text",text:Ct+" "}):Vt+=Ct+" "}Vt+=this.parse(Ee.tokens,ee),Te+=this.renderer.listitem(Vt,ci,!!ft)}T+=this.renderer.list(Te,l,_e);continue}case"html":{const Q=H;T+=this.renderer.html(Q.text,Q.block);continue}case"paragraph":{const Q=H;T+=this.renderer.paragraph(this.parseInline(Q.tokens));continue}case"text":{let Q=H,l=Q.tokens?this.parseInline(Q.tokens):Q.text;for(;$+1<w.length&&w[$+1].type==="text";)Q=w[++$],l+=`
`+(Q.tokens?this.parseInline(Q.tokens):Q.text);T+=f?this.renderer.paragraph(l):l;continue}default:{const Q='Token with "'+H.type+'" type was not found.';if(this.options.silent)return console.error(Q),"";throw new Error(Q)}}}return T}parseInline(w,f){f=f||this.renderer;let T="";for(let $=0;$<w.length;$++){const H=w[$];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[H.type]){const Q=this.options.extensions.renderers[H.type].call({parser:this},H);if(Q!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(H.type)){T+=Q||"";continue}}switch(H.type){case"escape":{const Q=H;T+=f.text(Q.text);break}case"html":{const Q=H;T+=f.html(Q.text);break}case"link":{const Q=H;T+=f.link(Q.href,Q.title,this.parseInline(Q.tokens,f));break}case"image":{const Q=H;T+=f.image(Q.href,Q.title,Q.text);break}case"strong":{const Q=H;T+=f.strong(this.parseInline(Q.tokens,f));break}case"em":{const Q=H;T+=f.em(this.parseInline(Q.tokens,f));break}case"codespan":{const Q=H;T+=f.codespan(Q.text);break}case"br":{T+=f.br();break}case"del":{const Q=H;T+=f.del(this.parseInline(Q.tokens,f));break}case"text":{const Q=H;T+=f.text(Q.text);break}default:{const Q='Token with "'+H.type+'" type was not found.';if(this.options.silent)return console.error(Q),"";throw new Error(Q)}}}return T}}class ul{constructor(w){ui(this,"options");this.options=w||$a}preprocess(w){return w}postprocess(w){return w}processAllTokens(w){return w}}ui(ul,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"]));var Oa,_c,Bp;class bm{constructor(...w){cp(this,Oa);ui(this,"defaults",vc());ui(this,"options",this.setOptions);ui(this,"parse",su(this,Oa,_c).call(this,nn.lex,an.parse));ui(this,"parseInline",su(this,Oa,_c).call(this,nn.lexInline,an.parseInline));ui(this,"Parser",an);ui(this,"Renderer",mu);ui(this,"TextRenderer",Sc);ui(this,"Lexer",nn);ui(this,"Tokenizer",du);ui(this,"Hooks",ul);this.use(...w)}walkTokens(w,f){var $,H;let T=[];for(const Q of w)switch(T=T.concat(f.call(this,Q)),Q.type){case"table":{const l=Q;for(const _e of l.header)T=T.concat(this.walkTokens(_e.tokens,f));for(const _e of l.rows)for(const ee of _e)T=T.concat(this.walkTokens(ee.tokens,f));break}case"list":{const l=Q;T=T.concat(this.walkTokens(l.items,f));break}default:{const l=Q;(H=($=this.defaults.extensions)==null?void 0:$.childTokens)!=null&&H[l.type]?this.defaults.extensions.childTokens[l.type].forEach(_e=>{const ee=l[_e].flat(1/0);T=T.concat(this.walkTokens(ee,f))}):l.tokens&&(T=T.concat(this.walkTokens(l.tokens,f)))}}return T}use(...w){const f=this.defaults.extensions||{renderers:{},childTokens:{}};return w.forEach(T=>{const $={...T};if($.async=this.defaults.async||$.async||!1,T.extensions&&(T.extensions.forEach(H=>{if(!H.name)throw new Error("extension name required");if("renderer"in H){const Q=f.renderers[H.name];Q?f.renderers[H.name]=function(...l){let _e=H.renderer.apply(this,l);return _e===!1&&(_e=Q.apply(this,l)),_e}:f.renderers[H.name]=H.renderer}if("tokenizer"in H){if(!H.level||H.level!=="block"&&H.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const Q=f[H.level];Q?Q.unshift(H.tokenizer):f[H.level]=[H.tokenizer],H.start&&(H.level==="block"?f.startBlock?f.startBlock.push(H.start):f.startBlock=[H.start]:H.level==="inline"&&(f.startInline?f.startInline.push(H.start):f.startInline=[H.start]))}"childTokens"in H&&H.childTokens&&(f.childTokens[H.name]=H.childTokens)}),$.extensions=f),T.renderer){const H=this.defaults.renderer||new mu(this.defaults);for(const Q in T.renderer){if(!(Q in H))throw new Error(`renderer '${Q}' does not exist`);if(Q==="options")continue;const l=Q,_e=T.renderer[l],ee=H[l];H[l]=(...Te)=>{let Ve=_e.apply(H,Te);return Ve===!1&&(Ve=ee.apply(H,Te)),Ve||""}}$.renderer=H}if(T.tokenizer){const H=this.defaults.tokenizer||new du(this.defaults);for(const Q in T.tokenizer){if(!(Q in H))throw new Error(`tokenizer '${Q}' does not exist`);if(["options","rules","lexer"].includes(Q))continue;const l=Q,_e=T.tokenizer[l],ee=H[l];H[l]=(...Te)=>{let Ve=_e.apply(H,Te);return Ve===!1&&(Ve=ee.apply(H,Te)),Ve}}$.tokenizer=H}if(T.hooks){const H=this.defaults.hooks||new ul;for(const Q in T.hooks){if(!(Q in H))throw new Error(`hook '${Q}' does not exist`);if(Q==="options")continue;const l=Q,_e=T.hooks[l],ee=H[l];ul.passThroughHooks.has(Q)?H[l]=Te=>{if(this.defaults.async)return Promise.resolve(_e.call(H,Te)).then(Ee=>ee.call(H,Ee));const Ve=_e.call(H,Te);return ee.call(H,Ve)}:H[l]=(...Te)=>{let Ve=_e.apply(H,Te);return Ve===!1&&(Ve=ee.apply(H,Te)),Ve}}$.hooks=H}if(T.walkTokens){const H=this.defaults.walkTokens,Q=T.walkTokens;$.walkTokens=function(l){let _e=[];return _e.push(Q.call(this,l)),H&&(_e=_e.concat(H.call(this,l))),_e}}this.defaults={...this.defaults,...$}}),this}setOptions(w){return this.defaults={...this.defaults,...w},this}lexer(w,f){return nn.lex(w,f??this.defaults)}parser(w,f){return an.parse(w,f??this.defaults)}}Oa=new WeakSet,_c=function(w,f){return(T,$)=>{const H={...$},Q={...this.defaults,...H};this.defaults.async===!0&&H.async===!1&&(Q.silent||console.warn("marked(): The async option was set to true by an extension. The async: false option sent to parse will be ignored."),Q.async=!0);const l=su(this,Oa,Bp).call(this,!!Q.silent,!!Q.async);if(typeof T>"u"||T===null)return l(new Error("marked(): input parameter is undefined or null"));if(typeof T!="string")return l(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(T)+", string expected"));if(Q.hooks&&(Q.hooks.options=Q),Q.async)return Promise.resolve(Q.hooks?Q.hooks.preprocess(T):T).then(_e=>w(_e,Q)).then(_e=>Q.hooks?Q.hooks.processAllTokens(_e):_e).then(_e=>Q.walkTokens?Promise.all(this.walkTokens(_e,Q.walkTokens)).then(()=>_e):_e).then(_e=>f(_e,Q)).then(_e=>Q.hooks?Q.hooks.postprocess(_e):_e).catch(l);try{Q.hooks&&(T=Q.hooks.preprocess(T));let _e=w(T,Q);Q.hooks&&(_e=Q.hooks.processAllTokens(_e)),Q.walkTokens&&this.walkTokens(_e,Q.walkTokens);let ee=f(_e,Q);return Q.hooks&&(ee=Q.hooks.postprocess(ee)),ee}catch(_e){return l(_e)}}},Bp=function(w,f){return T=>{if(T.message+=`
Please report this to https://github.com/markedjs/marked.`,w){const $="<p>An error occurred:</p><pre>"+es(T.message+"",!0)+"</pre>";return f?Promise.resolve($):$}if(f)return Promise.reject(T);throw T}};const Ra=new bm;function Kt(M,w){return Ra.parse(M,w)}Kt.options=Kt.setOptions=function(M){return Ra.setOptions(M),Kt.defaults=Ra.defaults,wp(Kt.defaults),Kt};Kt.getDefaults=vc;Kt.defaults=$a;Kt.use=function(...M){return Ra.use(...M),Kt.defaults=Ra.defaults,wp(Kt.defaults),Kt};Kt.walkTokens=function(M,w){return Ra.walkTokens(M,w)};Kt.parseInline=Ra.parseInline;Kt.Parser=an;Kt.parser=an.parse;Kt.Renderer=mu;Kt.TextRenderer=Sc;Kt.Lexer=nn;Kt.lexer=nn.lex;Kt.Tokenizer=du;Kt.Hooks=ul;Kt.parse=Kt;Kt.options;Kt.setOptions;Kt.use;Kt.walkTokens;Kt.parseInline;an.parse;nn.lex;function wm(M,w){function f(){this.constructor=M}f.prototype=w.prototype,M.prototype=new f}function dl(M,w,f,T){this.message=M,this.expected=w,this.found=f,this.location=T,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,dl)}wm(dl,Error);dl.buildMessage=function(M,w){var f={literal:function(ee){return'"'+$(ee.text)+'"'},class:function(ee){var Te="",Ve;for(Ve=0;Ve<ee.parts.length;Ve++)Te+=ee.parts[Ve]instanceof Array?H(ee.parts[Ve][0])+"-"+H(ee.parts[Ve][1]):H(ee.parts[Ve]);return"["+(ee.inverted?"^":"")+Te+"]"},any:function(ee){return"any character"},end:function(ee){return"end of input"},other:function(ee){return ee.description}};function T(ee){return ee.charCodeAt(0).toString(16).toUpperCase()}function $(ee){return ee.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(Te){return"\\x0"+T(Te)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(Te){return"\\x"+T(Te)})}function H(ee){return ee.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(Te){return"\\x0"+T(Te)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(Te){return"\\x"+T(Te)})}function Q(ee){return f[ee.type](ee)}function l(ee){var Te=new Array(ee.length),Ve,Ee;for(Ve=0;Ve<ee.length;Ve++)Te[Ve]=Q(ee[Ve]);if(Te.sort(),Te.length>0){for(Ve=1,Ee=1;Ve<Te.length;Ve++)Te[Ve-1]!==Te[Ve]&&(Te[Ee]=Te[Ve],Ee++);Te.length=Ee}switch(Te.length){case 1:return Te[0];case 2:return Te[0]+" or "+Te[1];default:return Te.slice(0,-1).join(", ")+", or "+Te[Te.length-1]}}function _e(ee){return ee?'"'+$(ee)+'"':"end of input"}return"Expected "+l(M)+" but "+_e(w)+" found."};function Am(M,w){w=w!==void 0?w:{};var f={},T={start:$n},$=$n,H="strict",Q=st("strict",!0),l="graph",_e=st("graph",!0),ee="digraph",Te=st("digraph",!0),Ve="{",Ee=st("{",!1),ft="}",ci=st("}",!1),Vt=function(A,q,ce,ne){ne===null&&(ne=[]);var ge={type:q.toLowerCase(),children:ne};return A&&(ge.strict=!0),ce&&(ge.id=ce),ge},Ct=";",vt=st(";",!1),Mr=function(A,q){return q},Ji=function(A,q){return[A].concat(q)},lr="=",Mi=st("=",!1),oi=function(A,q){return{type:"attr_stmt",target:"graph",attr_list:[{type:"attr",id:A,eq:q}]}},ts="node",mi=st("node",!0),qs="edge",Ut=st("edge",!0),Ur=function(A,q){return{type:"attr_stmt",target:A,attr_list:q}},$i="[",qr=st("[",!1),Ai="]",Pi=st("]",!1),Gi=function(A,q){return(A||[]).concat(q||[])},Hi=function(A,q){return q},jr=",",ys=st(",",!1),js=function(A,q,ce){return[{type:"attr",id:A,eq:q}].concat(ce||[])},xs=function(A,q,ce){var ne=[A];return ne=ne.concat(q.map(function(ge){return ge.id})),{type:"edge_stmt",edge_list:ne,attr_list:ce||[]}},Li="->",Lt=st("->",!1),Ei="--",Pr=st("--",!1),je=function(A,q,ce){return[{type:"edgeRHS",edgeop:A,id:q}].concat(ce||[])},et=function(A,q){return{type:"node_stmt",node_id:A,attr_list:q||[]}},ct=function(A,q){return q?{type:"node_id",id:A,port:q}:{type:"node_id",id:A}},Tt=fr("port"),Pt=":",qt=st(":",!1),gi=function(A,q){return q},vs=function(A,q){return{type:"port",id:A,compass_pt:q||null}},Zr=function(A){return{type:"port",compass_pt:A||null}},Zs="subgraph",bs=st("subgraph",!0),is=function(A){return A?{type:"subgraph",id:A}:{type:"subgraph"}},rs=function(A,q){return A=A||{type:"subgraph"},A.children=q||[],A},ws="n",ye=st("n",!1),Ni="ne",ur=st("ne",!1),Rt="e",St=st("e",!1),Ar="se",Gs=st("se",!1),Gr="s",Tn=st("s",!1),As="sw",ss=st("sw",!1),Es="w",Be=st("w",!1),Er="nw",ri=st("nw",!1),Cs=fr("UNICODE_STRING"),Hr=function(A,q){return A+q.join("")},Me=function(A,q){return A+q},ut="$",at=st("$",!1),Vi="_",Lr=st("_",!1),lt=fr("NUMBER"),Wr="-",j=st("-",!1),D=".",B=st(".",!1),R=/^[0-9]/,Z=Yt([["0","9"]],!1,!1),X=function(A){return parseFloat(ln())},le=function(A){return{type:"id",value:A.slice(1,A.length-1),html:!0}},ie="<",Y=st("<",!1),se=">",xe=st(">",!1),be=function(A){return"<"+A.join("")+">"},ve=da(),We=function(A){return A},nt=function(A){return A.join("")},Ze='"',Qe=st('"',!1),ot=function(A){return A.join("")},It=function(){return ln()},Bt="\\",bt=st("\\",!1),wt=function(A){return A[1]==='"'?'"':A[0]+A[1]},Ri=function(){return""},$t=/^[\n\r\u2028\u2029]/,hi=Yt([`
`,"\r","\u2028","\u2029"],!1,!1),Ci=fr("end of line"),cr=`
`,Na=st(`
`,!1),Ss=`\r
`,Hs=st(`\r
`,!1),go="\r",zt=st("\r",!1),na="\u2028",Dn=st("\u2028",!1),Oi="\u2029",Qi=st("\u2029",!1),_o=fr("COMMENT"),hr=fr("BLOCK_COMMENT"),vi="/*",In=st("/*",!1),Cr="*/",jt=st("*/",!1),kt=function(A){return A},ks=function(A){return A.join("")},si=fr("C_COMMENT"),on="//",pr=st("//",!1),ns=/^[\n]/,er=Yt([`
`],!1,!1),aa=function(A){return A.join("")},oa=fr("MACRO_COMMENT"),Fn="#",Bn=st("#",!1),as=fr("WHITESPACE"),zn=/^[\n\r]/,Ws=Yt([`
`,"\r"],!1,!1),la=/^[ \t]/,Va=Yt([" ","	"],!1,!1),ua=/^[a-z\xB5\xDF-\xF6\xF8-\xFF\u0101\u0103\u0105\u0107\u0109\u010B\u010D\u010F\u0111\u0113\u0115\u0117\u0119\u011B\u011D\u011F\u0121\u0123\u0125\u0127\u0129\u012B\u012D\u012F\u0131\u0133\u0135\u0137-\u0138\u013A\u013C\u013E\u0140\u0142\u0144\u0146\u0148-\u0149\u014B\u014D\u014F\u0151\u0153\u0155\u0157\u0159\u015B\u015D\u015F\u0161\u0163\u0165\u0167\u0169\u016B\u016D\u016F\u0171\u0173\u0175\u0177\u017A\u017C\u017E-\u0180\u0183\u0185\u0188\u018C-\u018D\u0192\u0195\u0199-\u019B\u019E\u01A1\u01A3\u01A5\u01A8\u01AA-\u01AB\u01AD\u01B0\u01B4\u01B6\u01B9-\u01BA\u01BD-\u01BF\u01C6\u01C9\u01CC\u01CE\u01D0\u01D2\u01D4\u01D6\u01D8\u01DA\u01DC-\u01DD\u01DF\u01E1\u01E3\u01E5\u01E7\u01E9\u01EB\u01ED\u01EF-\u01F0\u01F3\u01F5\u01F9\u01FB\u01FD\u01FF\u0201\u0203\u0205\u0207\u0209\u020B\u020D\u020F\u0211\u0213\u0215\u0217\u0219\u021B\u021D\u021F\u0221\u0223\u0225\u0227\u0229\u022B\u022D\u022F\u0231\u0233-\u0239\u023C\u023F-\u0240\u0242\u0247\u0249\u024B\u024D\u024F-\u0293\u0295-\u02AF\u0371\u0373\u0377\u037B-\u037D\u0390\u03AC-\u03CE\u03D0-\u03D1\u03D5-\u03D7\u03D9\u03DB\u03DD\u03DF\u03E1\u03E3\u03E5\u03E7\u03E9\u03EB\u03ED\u03EF-\u03F3\u03F5\u03F8\u03FB-\u03FC\u0430-\u045F\u0461\u0463\u0465\u0467\u0469\u046B\u046D\u046F\u0471\u0473\u0475\u0477\u0479\u047B\u047D\u047F\u0481\u048B\u048D\u048F\u0491\u0493\u0495\u0497\u0499\u049B\u049D\u049F\u04A1\u04A3\u04A5\u04A7\u04A9\u04AB\u04AD\u04AF\u04B1\u04B3\u04B5\u04B7\u04B9\u04BB\u04BD\u04BF\u04C2\u04C4\u04C6\u04C8\u04CA\u04CC\u04CE-\u04CF\u04D1\u04D3\u04D5\u04D7\u04D9\u04DB\u04DD\u04DF\u04E1\u04E3\u04E5\u04E7\u04E9\u04EB\u04ED\u04EF\u04F1\u04F3\u04F5\u04F7\u04F9\u04FB\u04FD\u04FF\u0501\u0503\u0505\u0507\u0509\u050B\u050D\u050F\u0511\u0513\u0515\u0517\u0519\u051B\u051D\u051F\u0521\u0523\u0525\u0527\u0561-\u0587\u1D00-\u1D2B\u1D6B-\u1D77\u1D79-\u1D9A\u1E01\u1E03\u1E05\u1E07\u1E09\u1E0B\u1E0D\u1E0F\u1E11\u1E13\u1E15\u1E17\u1E19\u1E1B\u1E1D\u1E1F\u1E21\u1E23\u1E25\u1E27\u1E29\u1E2B\u1E2D\u1E2F\u1E31\u1E33\u1E35\u1E37\u1E39\u1E3B\u1E3D\u1E3F\u1E41\u1E43\u1E45\u1E47\u1E49\u1E4B\u1E4D\u1E4F\u1E51\u1E53\u1E55\u1E57\u1E59\u1E5B\u1E5D\u1E5F\u1E61\u1E63\u1E65\u1E67\u1E69\u1E6B\u1E6D\u1E6F\u1E71\u1E73\u1E75\u1E77\u1E79\u1E7B\u1E7D\u1E7F\u1E81\u1E83\u1E85\u1E87\u1E89\u1E8B\u1E8D\u1E8F\u1E91\u1E93\u1E95-\u1E9D\u1E9F\u1EA1\u1EA3\u1EA5\u1EA7\u1EA9\u1EAB\u1EAD\u1EAF\u1EB1\u1EB3\u1EB5\u1EB7\u1EB9\u1EBB\u1EBD\u1EBF\u1EC1\u1EC3\u1EC5\u1EC7\u1EC9\u1ECB\u1ECD\u1ECF\u1ED1\u1ED3\u1ED5\u1ED7\u1ED9\u1EDB\u1EDD\u1EDF\u1EE1\u1EE3\u1EE5\u1EE7\u1EE9\u1EEB\u1EED\u1EEF\u1EF1\u1EF3\u1EF5\u1EF7\u1EF9\u1EFB\u1EFD\u1EFF-\u1F07\u1F10-\u1F15\u1F20-\u1F27\u1F30-\u1F37\u1F40-\u1F45\u1F50-\u1F57\u1F60-\u1F67\u1F70-\u1F7D\u1F80-\u1F87\u1F90-\u1F97\u1FA0-\u1FA7\u1FB0-\u1FB4\u1FB6-\u1FB7\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FC7\u1FD0-\u1FD3\u1FD6-\u1FD7\u1FE0-\u1FE7\u1FF2-\u1FF4\u1FF6-\u1FF7\u210A\u210E-\u210F\u2113\u212F\u2134\u2139\u213C-\u213D\u2146-\u2149\u214E\u2184\u2C30-\u2C5E\u2C61\u2C65-\u2C66\u2C68\u2C6A\u2C6C\u2C71\u2C73-\u2C74\u2C76-\u2C7B\u2C81\u2C83\u2C85\u2C87\u2C89\u2C8B\u2C8D\u2C8F\u2C91\u2C93\u2C95\u2C97\u2C99\u2C9B\u2C9D\u2C9F\u2CA1\u2CA3\u2CA5\u2CA7\u2CA9\u2CAB\u2CAD\u2CAF\u2CB1\u2CB3\u2CB5\u2CB7\u2CB9\u2CBB\u2CBD\u2CBF\u2CC1\u2CC3\u2CC5\u2CC7\u2CC9\u2CCB\u2CCD\u2CCF\u2CD1\u2CD3\u2CD5\u2CD7\u2CD9\u2CDB\u2CDD\u2CDF\u2CE1\u2CE3-\u2CE4\u2CEC\u2CEE\u2CF3\u2D00-\u2D25\u2D27\u2D2D\uA641\uA643\uA645\uA647\uA649\uA64B\uA64D\uA64F\uA651\uA653\uA655\uA657\uA659\uA65B\uA65D\uA65F\uA661\uA663\uA665\uA667\uA669\uA66B\uA66D\uA681\uA683\uA685\uA687\uA689\uA68B\uA68D\uA68F\uA691\uA693\uA695\uA697\uA723\uA725\uA727\uA729\uA72B\uA72D\uA72F-\uA731\uA733\uA735\uA737\uA739\uA73B\uA73D\uA73F\uA741\uA743\uA745\uA747\uA749\uA74B\uA74D\uA74F\uA751\uA753\uA755\uA757\uA759\uA75B\uA75D\uA75F\uA761\uA763\uA765\uA767\uA769\uA76B\uA76D\uA76F\uA771-\uA778\uA77A\uA77C\uA77F\uA781\uA783\uA785\uA787\uA78C\uA78E\uA791\uA793\uA7A1\uA7A3\uA7A5\uA7A7\uA7A9\uA7FA\uFB00-\uFB06\uFB13-\uFB17\uFF41-\uFF5A]/,ca=Yt([["a","z"],"",["",""],["",""],"","","","","","","","","","","","","","","","","","","","","","","","","","","",["",""],"","","","","","","",["",""],"","","","","","","","","","","","","","","","","","","","","","","","","",["",""],"","","",["",""],"","",["",""],"","","","","",["",""],"","","","",["",""],["",""],"","","","","","","","","","",["",""],"","","","","","","","",["",""],"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",["",""],"",["",""],"","","","","",["",""],["",""],"","","",["",""],"",["",""],["",""],["",""],"","","","","","","","","","","",["",""],"","",["",""],["",""],"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",["",""],"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",["",""],["",""],["",""],["",""],"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",["",""],"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],"","","","",["",""],["",""],"","",["",""],"",["",""],"","","","",["",""],["",""],"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",["",""],"","","",["",""],"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",["",""],"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",["",""],"","","","","","","","","","","","","","","","","",["",""],["",""],["",""]],!1,!1),Ua=/^[\u02B0-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0374\u037A\u0559\u0640\u06E5-\u06E6\u07F4-\u07F5\u07FA\u081A\u0824\u0828\u0971\u0E46\u0EC6\u10FC\u17D7\u1843\u1AA7\u1C78-\u1C7D\u1D2C-\u1D6A\u1D78\u1D9B-\u1DBF\u2071\u207F\u2090-\u209C\u2C7C-\u2C7D\u2D6F\u2E2F\u3005\u3031-\u3035\u303B\u309D-\u309E\u30FC-\u30FE\uA015\uA4F8-\uA4FD\uA60C\uA67F\uA717-\uA71F\uA770\uA788\uA7F8-\uA7F9\uA9CF\uAA70\uAADD\uAAF3-\uAAF4\uFF70\uFF9E-\uFF9F]/,yo=Yt([["",""],["",""],["",""],"","","","","","",["",""],["",""],"","","","","","","","","","","",["",""],["",""],"",["",""],"","",["",""],["",""],"","","",["",""],"",["",""],["",""],"",["",""],"","",["",""],"","",["",""],"","","",["",""],"",["",""]],!1,!1),qa=/^[\xAA\xBA\u01BB\u01C0-\u01C3\u0294\u05D0-\u05EA\u05F0-\u05F2\u0620-\u063F\u0641-\u064A\u066E-\u066F\u0671-\u06D3\u06D5\u06EE-\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u0800-\u0815\u0840-\u0858\u08A0\u08A2-\u08AC\u0904-\u0939\u093D\u0950\u0958-\u0961\u0972-\u0977\u0979-\u097F\u0985-\u098C\u098F-\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC-\u09DD\u09DF-\u09E1\u09F0-\u09F1\u0A05-\u0A0A\u0A0F-\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32-\u0A33\u0A35-\u0A36\u0A38-\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2-\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0-\u0AE1\u0B05-\u0B0C\u0B0F-\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32-\u0B33\u0B35-\u0B39\u0B3D\u0B5C-\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99-\u0B9A\u0B9C\u0B9E-\u0B9F\u0BA3-\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58-\u0C59\u0C60-\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0-\u0CE1\u0CF1-\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32-\u0E33\u0E40-\u0E45\u0E81-\u0E82\u0E84\u0E87-\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA-\u0EAB\u0EAD-\u0EB0\u0EB2-\u0EB3\u0EBD\u0EC0-\u0EC4\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065-\u1066\u106E-\u1070\u1075-\u1081\u108E\u10D0-\u10FA\u10FD-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17DC\u1820-\u1842\u1844-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE-\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C77\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5-\u1CF6\u2135-\u2138\u2D30-\u2D67\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3006\u303C\u3041-\u3096\u309F\u30A1-\u30FA\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA014\uA016-\uA48C\uA4D0-\uA4F7\uA500-\uA60B\uA610-\uA61F\uA62A-\uA62B\uA66E\uA6A0-\uA6E5\uA7FB-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA6F\uAA71-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5-\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADC\uAAE0-\uAAEA\uAAF2\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40-\uFB41\uFB43-\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF66-\uFF6F\uFF71-\uFF9D\uFFA0-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,ja=Yt(["","","",["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],["",""],"","",["",""],["",""],"",["",""],["",""],["",""],"",["",""],["",""],"","",["",""],["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],"","",["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],"","",["",""],["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],["",""],"","",["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],"","",["",""],["",""],["",""],["",""],["",""],"","",["",""],["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],"",["",""],"","",["",""],["",""],["",""],"","",["",""],["",""],["",""],"",["",""],["",""],"",["",""],["",""],["",""],["",""],"",["",""],["",""],"",["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],"","",["",""],"",["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],"",["",""],["",""],"","",["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""]],!1,!1),Mn=/^[\u01C5\u01C8\u01CB\u01F2\u1F88-\u1F8F\u1F98-\u1F9F\u1FA8-\u1FAF\u1FBC\u1FCC\u1FFC]/,Za=Yt(["","","","",["",""],["",""],["",""],"","",""],!1,!1),Ga=/^[A-Z\xC0-\xD6\xD8-\xDE\u0100\u0102\u0104\u0106\u0108\u010A\u010C\u010E\u0110\u0112\u0114\u0116\u0118\u011A\u011C\u011E\u0120\u0122\u0124\u0126\u0128\u012A\u012C\u012E\u0130\u0132\u0134\u0136\u0139\u013B\u013D\u013F\u0141\u0143\u0145\u0147\u014A\u014C\u014E\u0150\u0152\u0154\u0156\u0158\u015A\u015C\u015E\u0160\u0162\u0164\u0166\u0168\u016A\u016C\u016E\u0170\u0172\u0174\u0176\u0178-\u0179\u017B\u017D\u0181-\u0182\u0184\u0186-\u0187\u0189-\u018B\u018E-\u0191\u0193-\u0194\u0196-\u0198\u019C-\u019D\u019F-\u01A0\u01A2\u01A4\u01A6-\u01A7\u01A9\u01AC\u01AE-\u01AF\u01B1-\u01B3\u01B5\u01B7-\u01B8\u01BC\u01C4\u01C7\u01CA\u01CD\u01CF\u01D1\u01D3\u01D5\u01D7\u01D9\u01DB\u01DE\u01E0\u01E2\u01E4\u01E6\u01E8\u01EA\u01EC\u01EE\u01F1\u01F4\u01F6-\u01F8\u01FA\u01FC\u01FE\u0200\u0202\u0204\u0206\u0208\u020A\u020C\u020E\u0210\u0212\u0214\u0216\u0218\u021A\u021C\u021E\u0220\u0222\u0224\u0226\u0228\u022A\u022C\u022E\u0230\u0232\u023A-\u023B\u023D-\u023E\u0241\u0243-\u0246\u0248\u024A\u024C\u024E\u0370\u0372\u0376\u0386\u0388-\u038A\u038C\u038E-\u038F\u0391-\u03A1\u03A3-\u03AB\u03CF\u03D2-\u03D4\u03D8\u03DA\u03DC\u03DE\u03E0\u03E2\u03E4\u03E6\u03E8\u03EA\u03EC\u03EE\u03F4\u03F7\u03F9-\u03FA\u03FD-\u042F\u0460\u0462\u0464\u0466\u0468\u046A\u046C\u046E\u0470\u0472\u0474\u0476\u0478\u047A\u047C\u047E\u0480\u048A\u048C\u048E\u0490\u0492\u0494\u0496\u0498\u049A\u049C\u049E\u04A0\u04A2\u04A4\u04A6\u04A8\u04AA\u04AC\u04AE\u04B0\u04B2\u04B4\u04B6\u04B8\u04BA\u04BC\u04BE\u04C0-\u04C1\u04C3\u04C5\u04C7\u04C9\u04CB\u04CD\u04D0\u04D2\u04D4\u04D6\u04D8\u04DA\u04DC\u04DE\u04E0\u04E2\u04E4\u04E6\u04E8\u04EA\u04EC\u04EE\u04F0\u04F2\u04F4\u04F6\u04F8\u04FA\u04FC\u04FE\u0500\u0502\u0504\u0506\u0508\u050A\u050C\u050E\u0510\u0512\u0514\u0516\u0518\u051A\u051C\u051E\u0520\u0522\u0524\u0526\u0531-\u0556\u10A0-\u10C5\u10C7\u10CD\u1E00\u1E02\u1E04\u1E06\u1E08\u1E0A\u1E0C\u1E0E\u1E10\u1E12\u1E14\u1E16\u1E18\u1E1A\u1E1C\u1E1E\u1E20\u1E22\u1E24\u1E26\u1E28\u1E2A\u1E2C\u1E2E\u1E30\u1E32\u1E34\u1E36\u1E38\u1E3A\u1E3C\u1E3E\u1E40\u1E42\u1E44\u1E46\u1E48\u1E4A\u1E4C\u1E4E\u1E50\u1E52\u1E54\u1E56\u1E58\u1E5A\u1E5C\u1E5E\u1E60\u1E62\u1E64\u1E66\u1E68\u1E6A\u1E6C\u1E6E\u1E70\u1E72\u1E74\u1E76\u1E78\u1E7A\u1E7C\u1E7E\u1E80\u1E82\u1E84\u1E86\u1E88\u1E8A\u1E8C\u1E8E\u1E90\u1E92\u1E94\u1E9E\u1EA0\u1EA2\u1EA4\u1EA6\u1EA8\u1EAA\u1EAC\u1EAE\u1EB0\u1EB2\u1EB4\u1EB6\u1EB8\u1EBA\u1EBC\u1EBE\u1EC0\u1EC2\u1EC4\u1EC6\u1EC8\u1ECA\u1ECC\u1ECE\u1ED0\u1ED2\u1ED4\u1ED6\u1ED8\u1EDA\u1EDC\u1EDE\u1EE0\u1EE2\u1EE4\u1EE6\u1EE8\u1EEA\u1EEC\u1EEE\u1EF0\u1EF2\u1EF4\u1EF6\u1EF8\u1EFA\u1EFC\u1EFE\u1F08-\u1F0F\u1F18-\u1F1D\u1F28-\u1F2F\u1F38-\u1F3F\u1F48-\u1F4D\u1F59\u1F5B\u1F5D\u1F5F\u1F68-\u1F6F\u1FB8-\u1FBB\u1FC8-\u1FCB\u1FD8-\u1FDB\u1FE8-\u1FEC\u1FF8-\u1FFB\u2102\u2107\u210B-\u210D\u2110-\u2112\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u2130-\u2133\u213E-\u213F\u2145\u2183\u2C00-\u2C2E\u2C60\u2C62-\u2C64\u2C67\u2C69\u2C6B\u2C6D-\u2C70\u2C72\u2C75\u2C7E-\u2C80\u2C82\u2C84\u2C86\u2C88\u2C8A\u2C8C\u2C8E\u2C90\u2C92\u2C94\u2C96\u2C98\u2C9A\u2C9C\u2C9E\u2CA0\u2CA2\u2CA4\u2CA6\u2CA8\u2CAA\u2CAC\u2CAE\u2CB0\u2CB2\u2CB4\u2CB6\u2CB8\u2CBA\u2CBC\u2CBE\u2CC0\u2CC2\u2CC4\u2CC6\u2CC8\u2CCA\u2CCC\u2CCE\u2CD0\u2CD2\u2CD4\u2CD6\u2CD8\u2CDA\u2CDC\u2CDE\u2CE0\u2CE2\u2CEB\u2CED\u2CF2\uA640\uA642\uA644\uA646\uA648\uA64A\uA64C\uA64E\uA650\uA652\uA654\uA656\uA658\uA65A\uA65C\uA65E\uA660\uA662\uA664\uA666\uA668\uA66A\uA66C\uA680\uA682\uA684\uA686\uA688\uA68A\uA68C\uA68E\uA690\uA692\uA694\uA696\uA722\uA724\uA726\uA728\uA72A\uA72C\uA72E\uA732\uA734\uA736\uA738\uA73A\uA73C\uA73E\uA740\uA742\uA744\uA746\uA748\uA74A\uA74C\uA74E\uA750\uA752\uA754\uA756\uA758\uA75A\uA75C\uA75E\uA760\uA762\uA764\uA766\uA768\uA76A\uA76C\uA76E\uA779\uA77B\uA77D-\uA77E\uA780\uA782\uA784\uA786\uA78B\uA78D\uA790\uA792\uA7A0\uA7A2\uA7A4\uA7A6\uA7A8\uA7AA\uFF21-\uFF3A]/,ha=Yt([["A","Z"],["",""],["",""],"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",["",""],"","",["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],"","",["",""],"","",["",""],["",""],"",["",""],"","","","","","","","","","","","","","","","","","","","","","","",["",""],"","","","","","","","","","","","","","","","","","","","","","","","","","","","","",["",""],["",""],"",["",""],"","","","","","","","",["",""],"",["",""],["",""],["",""],"",["",""],"","","","","","","","","","","","","","",["",""],["",""],"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",["",""],"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",["",""],["",""],"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",["",""],["",""],["",""],["",""],["",""],"","","","",["",""],["",""],["",""],["",""],["",""],["",""],"","",["",""],["",""],"",["",""],"","","",["",""],["",""],["",""],"","",["",""],"",["",""],"","","",["",""],"","",["",""],"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",["",""],"","","","","","","","","","","","","","",["",""]],!1,!1),pa=/^[\u16EE-\u16F0\u2160-\u2182\u2185-\u2188\u3007\u3021-\u3029\u3038-\u303A\uA6E6-\uA6EF]/,Ts=Yt([["",""],["",""],["",""],"",["",""],["",""],["",""]],!1,!1),Pn=/^[0-9\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0BE6-\u0BEF\u0C66-\u0C6F\u0CE6-\u0CEF\u0D66-\u0D6F\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F29\u1040-\u1049\u1090-\u1099\u17E0-\u17E9\u1810-\u1819\u1946-\u194F\u19D0-\u19D9\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\uA620-\uA629\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]/,dr=Yt([["0","9"],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""]],!1,!1),I=0,ht=0,os=[{line:1,column:1}],tr=0,ls=[],me=0,dt;if("startRule"in w){if(!(w.startRule in T))throw new Error(`Can't start parsing from rule "`+w.startRule+'".');$=T[w.startRule]}function ln(){return M.substring(ht,I)}function st(A,q){return{type:"literal",text:A,ignoreCase:q}}function Yt(A,q,ce){return{type:"class",parts:A,inverted:q,ignoreCase:ce}}function da(){return{type:"any"}}function Ln(){return{type:"end"}}function fr(A){return{type:"other",description:A}}function Rn(A){var q=os[A],ce;if(q)return q;for(ce=A-1;!os[ce];)ce--;for(q=os[ce],q={line:q.line,column:q.column};ce<A;)M.charCodeAt(ce)===10?(q.line++,q.column=1):q.column++,ce++;return os[A]=q,q}function On(A,q){var ce=Rn(A),ne=Rn(q);return{start:{offset:A,line:ce.line,column:ce.column},end:{offset:q,line:ne.line,column:ne.column}}}function Se(A){I<tr||(I>tr&&(tr=I,ls=[]),ls.push(A))}function fa(A,q,ce){return new dl(dl.buildMessage(A,q),A,q,ce)}function $n(){var A,q;if(A=[],q=un(),q!==f)for(;q!==f;)A.push(q),q=un();else A=f;return A}function un(){var A,q,ce,ne,ge,ke,Xe,Zt,Gt,Sr,Et,Xr,Ui;return A=I,q=Mt(),q!==f?(M.substr(I,6).toLowerCase()===H?(ce=M.substr(I,6),I+=6):(ce=f,me===0&&Se(Q)),ce===f&&(ce=null),ce!==f?(ne=Mt(),ne!==f?(M.substr(I,5).toLowerCase()===l?(ge=M.substr(I,5),I+=5):(ge=f,me===0&&Se(_e)),ge===f&&(M.substr(I,7).toLowerCase()===ee?(ge=M.substr(I,7),I+=7):(ge=f,me===0&&Se(Te))),ge!==f?(ke=Mt(),ke!==f?(Xe=mr(),Xe===f&&(Xe=null),Xe!==f?(Zt=Mt(),Zt!==f?(M.charCodeAt(I)===123?(Gt=Ve,I++):(Gt=f,me===0&&Se(Ee)),Gt!==f?(Sr=ma(),Sr===f&&(Sr=null),Sr!==f?(Et=Mt(),Et!==f?(M.charCodeAt(I)===125?(Xr=ft,I++):(Xr=f,me===0&&Se(ci)),Xr!==f?(Ui=Mt(),Ui!==f?(ht=A,q=Vt(ce,ge,Xe,Sr),A=q):(I=A,A=f)):(I=A,A=f)):(I=A,A=f)):(I=A,A=f)):(I=A,A=f)):(I=A,A=f)):(I=A,A=f)):(I=A,A=f)):(I=A,A=f)):(I=A,A=f)):(I=A,A=f)):(I=A,A=f),A}function ma(){var A,q,ce,ne,ge,ke,Xe,Zt,Gt,Sr,Et;if(A=I,q=Mt(),q!==f)if(ce=Nn(),ce!==f)if(ne=Mt(),ne!==f)if(M.charCodeAt(I)===59?(ge=Ct,I++):(ge=f,me===0&&Se(vt)),ge===f&&(ge=null),ge!==f){for(ke=[],Xe=I,Zt=Mt(),Zt!==f?(Gt=Nn(),Gt!==f?(Sr=Mt(),Sr!==f?(M.charCodeAt(I)===59?(Et=Ct,I++):(Et=f,me===0&&Se(vt)),Et===f&&(Et=null),Et!==f?(ht=Xe,Zt=Mr(ce,Gt),Xe=Zt):(I=Xe,Xe=f)):(I=Xe,Xe=f)):(I=Xe,Xe=f)):(I=Xe,Xe=f);Xe!==f;)ke.push(Xe),Xe=I,Zt=Mt(),Zt!==f?(Gt=Nn(),Gt!==f?(Sr=Mt(),Sr!==f?(M.charCodeAt(I)===59?(Et=Ct,I++):(Et=f,me===0&&Se(vt)),Et===f&&(Et=null),Et!==f?(ht=Xe,Zt=Mr(ce,Gt),Xe=Zt):(I=Xe,Xe=f)):(I=Xe,Xe=f)):(I=Xe,Xe=f)):(I=Xe,Xe=f);ke!==f?(ht=A,q=Ji(ce,ke),A=q):(I=A,A=f)}else I=A,A=f;else I=A,A=f;else I=A,A=f;else I=A,A=f;return A}function Nn(){var A,q,ce,ne,ge,ke;return A=I,q=mr(),q!==f?(ce=Mt(),ce!==f?(M.charCodeAt(I)===61?(ne=lr,I++):(ne=f,me===0&&Se(Mi)),ne!==f?(ge=Mt(),ge!==f?(ke=mr(),ke!==f?(ht=A,q=oi(q,ke),A=q):(I=A,A=f)):(I=A,A=f)):(I=A,A=f)):(I=A,A=f)):(I=A,A=f),A===f&&(A=Xs(),A===f&&(A=xo(),A===f&&(A=Ks(),A===f&&(A=vo(),A===f&&(A=I,q=mr(),q!==f?(M.charCodeAt(I)===61?(ce=lr,I++):(ce=f,me===0&&Se(Mi)),ce!==f?(ne=mr(),ne!==f?(q=[q,ce,ne],A=q):(I=A,A=f)):(I=A,A=f)):(I=A,A=f)))))),A}function Xs(){var A,q,ce;return A=I,M.substr(I,5).toLowerCase()===l?(q=M.substr(I,5),I+=5):(q=f,me===0&&Se(_e)),q===f&&(M.substr(I,4).toLowerCase()===ts?(q=M.substr(I,4),I+=4):(q=f,me===0&&Se(mi)),q===f&&(M.substr(I,4).toLowerCase()===qs?(q=M.substr(I,4),I+=4):(q=f,me===0&&Se(Ut)))),q!==f?(ce=Vn(),ce!==f?(ht=A,q=Ur(q,ce),A=q):(I=A,A=f)):(I=A,A=f),A}function Vn(){var A,q,ce,ne,ge,ke,Xe,Zt,Gt;return A=I,q=Mt(),q!==f?(M.charCodeAt(I)===91?(ce=$i,I++):(ce=f,me===0&&Se(qr)),ce!==f?(ne=Mt(),ne!==f?(ge=Ha(),ge===f&&(ge=null),ge!==f?(ke=Mt(),ke!==f?(M.charCodeAt(I)===93?(Xe=Ai,I++):(Xe=f,me===0&&Se(Pi)),Xe!==f?(Zt=Mt(),Zt!==f?(Gt=Vn(),Gt===f&&(Gt=null),Gt!==f?(ht=A,q=Gi(ge,Gt),A=q):(I=A,A=f)):(I=A,A=f)):(I=A,A=f)):(I=A,A=f)):(I=A,A=f)):(I=A,A=f)):(I=A,A=f)):(I=A,A=f),A}function Ha(){var A,q,ce,ne,ge,ke,Xe,Zt;return A=I,q=Mt(),q!==f?(ce=mr(),ce!==f?(ne=I,ge=Mt(),ge!==f?(M.charCodeAt(I)===61?(ke=lr,I++):(ke=f,me===0&&Se(Mi)),ke!==f?(Xe=Mt(),Xe!==f?(Zt=mr(),Zt!==f?(ht=ne,ge=Hi(ce,Zt),ne=ge):(I=ne,ne=f)):(I=ne,ne=f)):(I=ne,ne=f)):(I=ne,ne=f),ne===f&&(ne=null),ne!==f?(ge=Mt(),ge!==f?(M.charCodeAt(I)===44?(ke=jr,I++):(ke=f,me===0&&Se(ys)),ke===f&&(M.charCodeAt(I)===59?(ke=Ct,I++):(ke=f,me===0&&Se(vt))),ke===f&&(ke=null),ke!==f?(Xe=Ha(),Xe===f&&(Xe=null),Xe!==f?(ht=A,q=js(ce,ne,Xe),A=q):(I=A,A=f)):(I=A,A=f)):(I=A,A=f)):(I=A,A=f)):(I=A,A=f)):(I=A,A=f),A}function xo(){var A,q,ce,ne;return A=I,q=Ks(),q===f&&(q=ga()),q!==f?(ce=Wa(),ce!==f?(ne=Vn(),ne===f&&(ne=null),ne!==f?(ht=A,q=xs(q,ce,ne),A=q):(I=A,A=f)):(I=A,A=f)):(I=A,A=f),A}function Wa(){var A,q,ce,ne,ge,ke,Xe;return A=I,q=Mt(),q!==f?(M.substr(I,2)===Li?(ce=Li,I+=2):(ce=f,me===0&&Se(Lt)),ce===f&&(M.substr(I,2)===Ei?(ce=Ei,I+=2):(ce=f,me===0&&Se(Pr))),ce!==f?(ne=Mt(),ne!==f?(ge=Ks(),ge===f&&(ge=ga()),ge!==f?(ke=Mt(),ke!==f?(Xe=Wa(),Xe===f&&(Xe=null),Xe!==f?(ht=A,q=je(ce,ge,Xe),A=q):(I=A,A=f)):(I=A,A=f)):(I=A,A=f)):(I=A,A=f)):(I=A,A=f)):(I=A,A=f),A}function vo(){var A,q,ce;return A=I,q=ga(),q!==f?(ce=Vn(),ce===f&&(ce=null),ce!==f?(ht=A,q=et(q,ce),A=q):(I=A,A=f)):(I=A,A=f),A}function ga(){var A,q,ce;return A=I,q=mr(),q!==f?(ce=_a(),ce===f&&(ce=null),ce!==f?(ht=A,q=ct(q,ce),A=q):(I=A,A=f)):(I=A,A=f),A}function _a(){var A,q,ce,ne,ge,ke;return me++,A=I,M.charCodeAt(I)===58?(q=Pt,I++):(q=f,me===0&&Se(qt)),q!==f?(ce=mr(),ce!==f?(ne=I,M.charCodeAt(I)===58?(ge=Pt,I++):(ge=f,me===0&&Se(qt)),ge!==f?(ke=Un(),ke!==f?(ht=ne,ge=gi(ce,ke),ne=ge):(I=ne,ne=f)):(I=ne,ne=f),ne===f&&(ne=null),ne!==f?(ht=A,q=vs(ce,ne),A=q):(I=A,A=f)):(I=A,A=f)):(I=A,A=f),A===f&&(A=I,M.charCodeAt(I)===58?(q=Pt,I++):(q=f,me===0&&Se(qt)),q!==f?(ce=Un(),ce!==f?(ht=A,q=Zr(ce),A=q):(I=A,A=f)):(I=A,A=f)),me--,A===f&&(q=f,me===0&&Se(Tt)),A}function Ks(){var A,q,ce,ne,ge,ke;return A=I,q=I,M.substr(I,8).toLowerCase()===Zs?(ce=M.substr(I,8),I+=8):(ce=f,me===0&&Se(bs)),ce!==f?(ne=Mt(),ne!==f?(ge=mr(),ge===f&&(ge=null),ge!==f?(ke=Mt(),ke!==f?(ht=q,ce=is(ge),q=ce):(I=q,q=f)):(I=q,q=f)):(I=q,q=f)):(I=q,q=f),q===f&&(q=null),q!==f?(M.charCodeAt(I)===123?(ce=Ve,I++):(ce=f,me===0&&Se(Ee)),ce!==f?(ne=ma(),ne===f&&(ne=null),ne!==f?(ge=Mt(),ge!==f?(M.charCodeAt(I)===125?(ke=ft,I++):(ke=f,me===0&&Se(ci)),ke!==f?(ht=A,q=rs(q,ne),A=q):(I=A,A=f)):(I=A,A=f)):(I=A,A=f)):(I=A,A=f)):(I=A,A=f),A}function Un(){var A;return M.charCodeAt(I)===110?(A=ws,I++):(A=f,me===0&&Se(ye)),A===f&&(M.substr(I,2)===Ni?(A=Ni,I+=2):(A=f,me===0&&Se(ur)),A===f&&(M.charCodeAt(I)===101?(A=Rt,I++):(A=f,me===0&&Se(St)),A===f&&(M.substr(I,2)===Ar?(A=Ar,I+=2):(A=f,me===0&&Se(Gs)),A===f&&(M.charCodeAt(I)===115?(A=Gr,I++):(A=f,me===0&&Se(Tn)),A===f&&(M.substr(I,2)===As?(A=As,I+=2):(A=f,me===0&&Se(ss)),A===f&&(M.charCodeAt(I)===119?(A=Es,I++):(A=f,me===0&&Se(Be)),A===f&&(M.substr(I,2)===Er?(A=Er,I+=2):(A=f,me===0&&Se(ri))))))))),A}function mr(){var A;return A=Ds(),A===f&&(A=Xa(),A===f&&(A=us(),A===f&&(A=Ya(),A===f&&(A=Ka())))),A}function Ds(){var A,q,ce,ne;if(me++,A=I,q=ya(),q!==f){for(ce=[],ne=qn();ne!==f;)ce.push(ne),ne=qn();ce!==f?(ht=A,q=Hr(q,ce),A=q):(I=A,A=f)}else I=A,A=f;return me--,A===f&&(q=f,me===0&&Se(Cs)),A}function Xa(){var A,q,ce;return A=I,q=us(),q!==f?(ce=Ds(),ce!==f?(ht=A,q=Me(q,ce),A=q):(I=A,A=f)):(I=A,A=f),A}function ya(){var A;return A=xa(),A===f&&(M.charCodeAt(I)===36?(A=ut,I++):(A=f,me===0&&Se(at)),A===f&&(M.charCodeAt(I)===95?(A=Vi,I++):(A=f,me===0&&Se(Lr)))),A}function qn(){var A;return A=ya(),A===f&&(A=ba()),A}function us(){var A,q,ce,ne,ge,ke,Xe,Zt,Gt;if(me++,A=I,q=I,M.charCodeAt(I)===45?(ce=Wr,I++):(ce=f,me===0&&Se(j)),ce===f&&(ce=null),ce!==f){if(ne=I,M.charCodeAt(I)===46?(ge=D,I++):(ge=f,me===0&&Se(B)),ge!==f){if(ke=[],R.test(M.charAt(I))?(Xe=M.charAt(I),I++):(Xe=f,me===0&&Se(Z)),Xe!==f)for(;Xe!==f;)ke.push(Xe),R.test(M.charAt(I))?(Xe=M.charAt(I),I++):(Xe=f,me===0&&Se(Z));else ke=f;ke!==f?(ge=[ge,ke],ne=ge):(I=ne,ne=f)}else I=ne,ne=f;if(ne===f){if(ne=I,ge=[],R.test(M.charAt(I))?(ke=M.charAt(I),I++):(ke=f,me===0&&Se(Z)),ke!==f)for(;ke!==f;)ge.push(ke),R.test(M.charAt(I))?(ke=M.charAt(I),I++):(ke=f,me===0&&Se(Z));else ge=f;if(ge!==f){if(ke=I,M.charCodeAt(I)===46?(Xe=D,I++):(Xe=f,me===0&&Se(B)),Xe!==f){for(Zt=[],R.test(M.charAt(I))?(Gt=M.charAt(I),I++):(Gt=f,me===0&&Se(Z));Gt!==f;)Zt.push(Gt),R.test(M.charAt(I))?(Gt=M.charAt(I),I++):(Gt=f,me===0&&Se(Z));Zt!==f?(Xe=[Xe,Zt],ke=Xe):(I=ke,ke=f)}else I=ke,ke=f;ke===f&&(ke=null),ke!==f?(ge=[ge,ke],ne=ge):(I=ne,ne=f)}else I=ne,ne=f}ne!==f?(ce=[ce,ne],q=ce):(I=q,q=f)}else I=q,q=f;return q!==f&&(ht=A,q=X()),A=q,me--,A===f&&(q=f,me===0&&Se(lt)),A}function Ka(){var A,q;return A=I,q=Rr(),q!==f&&(ht=A,q=le(q)),A=q,A}function Rr(){var A,q,ce,ne;if(A=I,M.charCodeAt(I)===60?(q=ie,I++):(q=f,me===0&&Se(Y)),q!==f){for(ce=[],ne=Is(),ne===f&&(ne=Rr());ne!==f;)ce.push(ne),ne=Is(),ne===f&&(ne=Rr());ce!==f?(M.charCodeAt(I)===62?(ne=se,I++):(ne=f,me===0&&Se(xe)),ne!==f?(ht=A,q=be(ce),A=q):(I=A,A=f)):(I=A,A=f)}else I=A,A=f;return A}function Is(){var A,q,ce,ne,ge;if(A=I,q=[],ce=I,ne=I,me++,M.charCodeAt(I)===62?(ge=se,I++):(ge=f,me===0&&Se(xe)),ge===f&&(M.charCodeAt(I)===60?(ge=ie,I++):(ge=f,me===0&&Se(Y))),me--,ge===f?ne=void 0:(I=ne,ne=f),ne!==f?(M.length>I?(ge=M.charAt(I),I++):(ge=f,me===0&&Se(ve)),ge!==f?(ht=ce,ne=We(ge),ce=ne):(I=ce,ce=f)):(I=ce,ce=f),ce!==f)for(;ce!==f;)q.push(ce),ce=I,ne=I,me++,M.charCodeAt(I)===62?(ge=se,I++):(ge=f,me===0&&Se(xe)),ge===f&&(M.charCodeAt(I)===60?(ge=ie,I++):(ge=f,me===0&&Se(Y))),me--,ge===f?ne=void 0:(I=ne,ne=f),ne!==f?(M.length>I?(ge=M.charAt(I),I++):(ge=f,me===0&&Se(ve)),ge!==f?(ht=ce,ne=We(ge),ce=ne):(I=ce,ce=f)):(I=ce,ce=f);else q=f;return q!==f&&(ht=A,q=nt(q)),A=q,A}function Ya(){var A,q,ce,ne;if(A=I,M.charCodeAt(I)===34?(q=Ze,I++):(q=f,me===0&&Se(Qe)),q!==f){for(ce=[],ne=jn();ne!==f;)ce.push(ne),ne=jn();ce!==f?(M.charCodeAt(I)===34?(ne=Ze,I++):(ne=f,me===0&&Se(Qe)),ne!==f?(ht=A,q=ot(ce),A=q):(I=A,A=f)):(I=A,A=f)}else I=A,A=f;return A}function jn(){var A,q,ce;return A=Dt(),A===f&&(A=I,q=I,me++,M.charCodeAt(I)===34?(ce=Ze,I++):(ce=f,me===0&&Se(Qe)),ce===f&&(ce=bo()),me--,ce===f?q=void 0:(I=q,q=f),q!==f?(ce=Fs(),ce!==f?(ht=A,q=It(),A=q):(I=A,A=f)):(I=A,A=f),A===f&&(A=Jt())),A}function Dt(){var A,q,ce,ne;return A=I,q=I,M.charCodeAt(I)===92?(ce=Bt,I++):(ce=f,me===0&&Se(bt)),ce!==f?(M.length>I?(ne=M.charAt(I),I++):(ne=f,me===0&&Se(ve)),ne!==f?(ce=[ce,ne],q=ce):(I=q,q=f)):(I=q,q=f),q!==f&&(ht=A,q=wt(q)),A=q,A}function Jt(){var A,q,ce;return A=I,M.charCodeAt(I)===92?(q=Bt,I++):(q=f,me===0&&Se(bt)),q!==f?(ce=_t(),ce!==f?(ht=A,q=Ri(),A=q):(I=A,A=f)):(I=A,A=f),A}function bo(){var A;return $t.test(M.charAt(I))?(A=M.charAt(I),I++):(A=f,me===0&&Se(hi)),A}function _t(){var A;return me++,M.charCodeAt(I)===10?(A=cr,I++):(A=f,me===0&&Se(Na)),A===f&&(M.substr(I,2)===Ss?(A=Ss,I+=2):(A=f,me===0&&Se(Hs)),A===f&&(M.charCodeAt(I)===13?(A=go,I++):(A=f,me===0&&Se(zt)),A===f&&(M.charCodeAt(I)===8232?(A=na,I++):(A=f,me===0&&Se(Dn)),A===f&&(M.charCodeAt(I)===8233?(A=Oi,I++):(A=f,me===0&&Se(Qi)))))),me--,A===f&&me===0&&Se(Ci),A}function Fs(){var A;return M.length>I?(A=M.charAt(I),I++):(A=f,me===0&&Se(ve)),A}function Ht(){var A;return me++,A=Wt(),A===f&&(A=cn(),A===f&&(A=Ja())),me--,A===f&&me===0&&Se(_o),A}function Wt(){var A,q,ce,ne,ge,ke;if(me++,A=I,M.substr(I,2)===vi?(q=vi,I+=2):(q=f,me===0&&Se(In)),q!==f){for(ce=[],ne=I,ge=I,me++,M.substr(I,2)===Cr?(ke=Cr,I+=2):(ke=f,me===0&&Se(jt)),me--,ke===f?ge=void 0:(I=ge,ge=f),ge!==f?(M.length>I?(ke=M.charAt(I),I++):(ke=f,me===0&&Se(ve)),ke!==f?(ht=ne,ge=kt(ke),ne=ge):(I=ne,ne=f)):(I=ne,ne=f);ne!==f;)ce.push(ne),ne=I,ge=I,me++,M.substr(I,2)===Cr?(ke=Cr,I+=2):(ke=f,me===0&&Se(jt)),me--,ke===f?ge=void 0:(I=ge,ge=f),ge!==f?(M.length>I?(ke=M.charAt(I),I++):(ke=f,me===0&&Se(ve)),ke!==f?(ht=ne,ge=kt(ke),ne=ge):(I=ne,ne=f)):(I=ne,ne=f);ce!==f?(M.substr(I,2)===Cr?(ne=Cr,I+=2):(ne=f,me===0&&Se(jt)),ne!==f?(ht=A,q=ks(ce),A=q):(I=A,A=f)):(I=A,A=f)}else I=A,A=f;return me--,A===f&&(q=f,me===0&&Se(hr)),A}function cn(){var A,q,ce,ne,ge,ke;if(me++,A=I,M.substr(I,2)===on?(q=on,I+=2):(q=f,me===0&&Se(pr)),q!==f){for(ce=[],ne=I,ge=I,me++,ns.test(M.charAt(I))?(ke=M.charAt(I),I++):(ke=f,me===0&&Se(er)),me--,ke===f?ge=void 0:(I=ge,ge=f),ge!==f?(M.length>I?(ke=M.charAt(I),I++):(ke=f,me===0&&Se(ve)),ke!==f?(ht=ne,ge=We(ke),ne=ge):(I=ne,ne=f)):(I=ne,ne=f);ne!==f;)ce.push(ne),ne=I,ge=I,me++,ns.test(M.charAt(I))?(ke=M.charAt(I),I++):(ke=f,me===0&&Se(er)),me--,ke===f?ge=void 0:(I=ge,ge=f),ge!==f?(M.length>I?(ke=M.charAt(I),I++):(ke=f,me===0&&Se(ve)),ke!==f?(ht=ne,ge=We(ke),ne=ge):(I=ne,ne=f)):(I=ne,ne=f);ce!==f?(ns.test(M.charAt(I))?(ne=M.charAt(I),I++):(ne=f,me===0&&Se(er)),ne===f&&(ne=null),ne!==f?(ht=A,q=aa(ce),A=q):(I=A,A=f)):(I=A,A=f)}else I=A,A=f;return me--,A===f&&(q=f,me===0&&Se(si)),A}function Ja(){var A,q,ce,ne,ge,ke;if(me++,A=I,M.charCodeAt(I)===35?(q=Fn,I++):(q=f,me===0&&Se(Bn)),q!==f){for(ce=[],ne=I,ge=I,me++,ns.test(M.charAt(I))?(ke=M.charAt(I),I++):(ke=f,me===0&&Se(er)),me--,ke===f?ge=void 0:(I=ge,ge=f),ge!==f?(M.length>I?(ke=M.charAt(I),I++):(ke=f,me===0&&Se(ve)),ke!==f?(ht=ne,ge=We(ke),ne=ge):(I=ne,ne=f)):(I=ne,ne=f);ne!==f;)ce.push(ne),ne=I,ge=I,me++,ns.test(M.charAt(I))?(ke=M.charAt(I),I++):(ke=f,me===0&&Se(er)),me--,ke===f?ge=void 0:(I=ge,ge=f),ge!==f?(M.length>I?(ke=M.charAt(I),I++):(ke=f,me===0&&Se(ve)),ke!==f?(ht=ne,ge=We(ke),ne=ge):(I=ne,ne=f)):(I=ne,ne=f);ce!==f?(ns.test(M.charAt(I))?(ne=M.charAt(I),I++):(ne=f,me===0&&Se(er)),ne===f&&(ne=null),ne!==f?(ht=A,q=aa(ce),A=q):(I=A,A=f)):(I=A,A=f)}else I=A,A=f;return me--,A===f&&(q=f,me===0&&Se(oa)),A}function Mt(){var A,q;for(me++,A=[],q=pn(),q===f&&(q=Ht());q!==f;)A.push(q),q=pn(),q===f&&(q=Ht());return me--,A===f&&(q=f,me===0&&Se(as)),A}function hn(){var A,q;if(A=[],zn.test(M.charAt(I))?(q=M.charAt(I),I++):(q=f,me===0&&Se(Ws)),q!==f)for(;q!==f;)A.push(q),zn.test(M.charAt(I))?(q=M.charAt(I),I++):(q=f,me===0&&Se(Ws));else A=f;return A}function pn(){var A,q;if(A=[],la.test(M.charAt(I))?(q=M.charAt(I),I++):(q=f,me===0&&Se(Va)),q===f&&(q=hn()),q!==f)for(;q!==f;)A.push(q),la.test(M.charAt(I))?(q=M.charAt(I),I++):(q=f,me===0&&Se(Va)),q===f&&(q=hn());else A=f;return A}function xa(){var A;return A=mn(),A===f&&(A=Zn(),A===f&&(A=fn(),A===f&&(A=va(),A===f&&(A=dn(),A===f&&(A=wo()))))),A}function Zn(){var A;return ua.test(M.charAt(I))?(A=M.charAt(I),I++):(A=f,me===0&&Se(ca)),A}function va(){var A;return Ua.test(M.charAt(I))?(A=M.charAt(I),I++):(A=f,me===0&&Se(yo)),A}function dn(){var A;return qa.test(M.charAt(I))?(A=M.charAt(I),I++):(A=f,me===0&&Se(ja)),A}function fn(){var A;return Mn.test(M.charAt(I))?(A=M.charAt(I),I++):(A=f,me===0&&Se(Za)),A}function mn(){var A;return Ga.test(M.charAt(I))?(A=M.charAt(I),I++):(A=f,me===0&&Se(ha)),A}function wo(){var A;return pa.test(M.charAt(I))?(A=M.charAt(I),I++):(A=f,me===0&&Se(Ts)),A}function ba(){var A;return Pn.test(M.charAt(I))?(A=M.charAt(I),I++):(A=f,me===0&&Se(dr)),A}if(dt=$(),dt!==f&&I===M.length)return dt;throw dt!==f&&I<M.length&&Se(Ln()),fa(ls,tr<M.length?M.charAt(tr):null,tr<M.length?On(tr,tr+1):On(tr,tr))}var Em={parse:Am},Cm=Em,Sm=Cm.parse,fc,gp;function km(){if(gp)return fc;gp=1,fc=function(T){w(T);var $=M(T);return T.on=$.on,T.off=$.off,T.fire=$.fire,T};function M(f){var T=Object.create(null);return{on:function($,H,Q){if(typeof H!="function")throw new Error("callback is expected to be a function");var l=T[$];return l||(l=T[$]=[]),l.push({callback:H,ctx:Q}),f},off:function($,H){var Q=typeof $>"u";if(Q)return T=Object.create(null),f;if(T[$]){var l=typeof H!="function";if(l)delete T[$];else for(var _e=T[$],ee=0;ee<_e.length;++ee)_e[ee].callback===H&&_e.splice(ee,1)}return f},fire:function($){var H=T[$];if(!H)return f;var Q;arguments.length>1&&(Q=Array.prototype.splice.call(arguments,1));for(var l=0;l<H.length;++l){var _e=H[l];_e.callback.apply(_e.ctx,Q)}return f}}}function w(f){if(!f)throw new Error("Eventify cannot use falsy object as events subject");for(var T=["on","fire","off"],$=0;$<T.length;++$)if(f.hasOwnProperty(T[$]))throw new Error("Subject cannot be eventified, since it already has property '"+T[$]+"'")}return fc}var mc,_p;function Tm(){if(_p)return mc;_p=1,mc=w;var M=km();function w(Q){if(Q=Q||{},"uniqueLinkId"in Q&&(console.warn("ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\nUse `multigraph` option instead\n",`
`,`Note: there is also change in default behavior: From now on each graph
is considered to be not a multigraph by default (each edge is unique).`),Q.multigraph=Q.uniqueLinkId),Q.multigraph===void 0&&(Q.multigraph=!1),typeof Map!="function")throw new Error("ngraph.graph requires `Map` to be defined. Please polyfill it before using ngraph");var l=new Map,_e=new Map,ee={},Te=0,Ve=Q.multigraph?Ut:qs,Ee=[],ft=Li,ci=Li,Vt=Li,Ct=Li,vt={version:20,addNode:Mi,addLink:mi,removeLink:Ai,removeNode:ts,getNode:oi,getNodeCount:Ur,getLinkCount:$i,getEdgeCount:$i,getLinksCount:$i,getNodesCount:Ur,getLinks:qr,forEachNode:Pr,forEachLinkedNode:ys,forEachLink:jr,beginUpdate:Vt,endUpdate:Ct,clear:Hi,hasLink:Gi,hasNode:oi,getLink:Gi};return M(vt),Mr(),vt;function Mr(){var je=vt.on;vt.on=et;function et(){return vt.beginUpdate=Vt=Lt,vt.endUpdate=Ct=Ei,ft=Ji,ci=lr,vt.on=je,je.apply(vt,arguments)}}function Ji(je,et){Ee.push({link:je,changeType:et})}function lr(je,et){Ee.push({node:je,changeType:et})}function Mi(je,et){if(je===void 0)throw new Error("Invalid node identifier");Vt();var ct=oi(je);return ct?(ct.data=et,ci(ct,"update")):(ct=new f(je,et),ci(ct,"add")),l.set(je,ct),Ct(),ct}function oi(je){return l.get(je)}function ts(je){var et=oi(je);if(!et)return!1;Vt();var ct=et.links;return ct&&(ct.forEach(Pi),et.links=null),l.delete(je),ci(et,"remove"),Ct(),!0}function mi(je,et,ct){Vt();var Tt=oi(je)||Mi(je),Pt=oi(et)||Mi(et),qt=Ve(je,et,ct),gi=_e.has(qt.id);return _e.set(qt.id,qt),T(Tt,qt),je!==et&&T(Pt,qt),ft(qt,gi?"update":"add"),Ct(),qt}function qs(je,et,ct){var Tt=H(je,et),Pt=_e.get(Tt);return Pt?(Pt.data=ct,Pt):new $(je,et,ct,Tt)}function Ut(je,et,ct){var Tt=H(je,et),Pt=ee.hasOwnProperty(Tt);if(Pt||Gi(je,et)){Pt||(ee[Tt]=0);var qt="@"+ ++ee[Tt];Tt=H(je+qt,et+qt)}return new $(je,et,ct,Tt)}function Ur(){return l.size}function $i(){return _e.size}function qr(je){var et=oi(je);return et?et.links:null}function Ai(je,et){return et!==void 0&&(je=Gi(je,et)),Pi(je)}function Pi(je){if(!je||!_e.get(je.id))return!1;Vt(),_e.delete(je.id);var et=oi(je.fromId),ct=oi(je.toId);return et&&et.links.delete(je),ct&&ct.links.delete(je),ft(je,"remove"),Ct(),!0}function Gi(je,et){if(!(je===void 0||et===void 0))return _e.get(H(je,et))}function Hi(){Vt(),Pr(function(je){ts(je.id)}),Ct()}function jr(je){if(typeof je=="function")for(var et=_e.values(),ct=et.next();!ct.done;){if(je(ct.value))return!0;ct=et.next()}}function ys(je,et,ct){var Tt=oi(je);if(Tt&&Tt.links&&typeof et=="function")return ct?xs(Tt.links,je,et):js(Tt.links,je,et)}function js(je,et,ct){for(var Tt,Pt=je.values(),qt=Pt.next();!qt.done;){var gi=qt.value,vs=gi.fromId===et?gi.toId:gi.fromId;if(Tt=ct(l.get(vs),gi),Tt)return!0;qt=Pt.next()}}function xs(je,et,ct){for(var Tt,Pt=je.values(),qt=Pt.next();!qt.done;){var gi=qt.value;if(gi.fromId===et&&(Tt=ct(l.get(gi.toId),gi),Tt))return!0;qt=Pt.next()}}function Li(){}function Lt(){Te+=1}function Ei(){Te-=1,Te===0&&Ee.length>0&&(vt.fire("changed",Ee),Ee.length=0)}function Pr(je){if(typeof je!="function")throw new Error("Function is expected to iterate over graph nodes. You passed "+je);for(var et=l.values(),ct=et.next();!ct.done;){if(je(ct.value))return!0;ct=et.next()}}}function f(Q,l){this.id=Q,this.links=null,this.data=l}function T(Q,l){Q.links?Q.links.add(l):Q.links=new Set([l])}function $(Q,l,_e,ee){this.fromId=Q,this.toId=l,this.data=_e,this.id=ee}function H(Q,l){return Q.toString()+" "+l.toString()}return mc}var Dm=Fm,Im=Sm;function Fm(M,w){var f=Im(M);if(f.length>1&&w!==void 0)throw new Error("Dot file contains multiple graphs. Cannot use `saveTo` in this case");return w||(w=Tm()()),Bm(w,f[0])}function Bm(M,w){return kc(M,w),M}function kc(M,w){var f=w.children;if(!f)return M;for(var T=[],$=0;$<f.length;++$){var H=f[$];H.type==="edge_stmt"?cl(T,zm(M,H)):H.type==="node_stmt"?cl(T,Mm(M,H)):H.type==="subgraph"&&cl(T,kc(M,H))}return T}function zm(M,w){var f=w.edge_list;if(f.length!==0){var T=f[0],$=[],H=yc(M,T);cl($,H);for(var Q=zp(w.attr_list),l=1;l<f.length;++l){var _e=yc(M,f[l]);cl($,_e),Pm(M,H,_e,Q),H=_e}return $}}function Mm(M,w){return yc(M,w.node_id,w.attr_list)}function cl(M,w){for(var f=0;f<w.length;++f)M.push(w[f]);return M}function yc(M,w,f){if(w.type==="node_id"){var T=Lm(zp(f),M.getNode(w.id));return T?M.addNode(w.id,T):M.addNode(w.id),[w.id]}else if(w.type==="subgraph")return kc(M,w)}function Pm(M,w,f,T){for(var $=0;$<w.length;++$)for(var H=0;H<f.length;++H)M.addLink(w[$],f[H],T)}function zp(M){if(!(!M||!M.length)){for(var w=Object.create(null),f=0;f<M.length;++f){var T=M[f];if(!(T.type!=="attr"||T.id===void 0)){var $=T.eq[0]==="["&&T.eq[T.eq.length-1]==="]";if($)try{var H=JSON.parse(T.eq);T.eq=H}catch{}w[T.id]=T.eq}}return w}}function Lm(M,w){return!w||!w.data?M:Object.assign(w.data,M)}const Rm=yp(Dm);let ou=null;async function Tc(){if(ou)return ou;try{const w=await(await fetch(sn.graphFileUrl)).text();return ou=Rm(w),ou}catch(M){throw console.error("Failed to load graph data:",M),M}}function Om(M,w){const f=M.getNode(w);if(!f)return null;const T=[],$=[];return M.forEachLinkedNode(w,(H,Q)=>{T.push(H),$.push({from:Q.fromId,to:Q.toId,data:Q.data})}),{node:f,neighbors:T,edges:$}}function $m(M,w){const f=/[\u4e00-\u9fa5]+/g;return M.replace(f,T=>xc(T,w))}function xc(M,w){if(M.length<=1||w.getNode(M))return lu(M,w);for(let f=M.length-1;f>0;f--){const T=M.substring(0,f);if(w.getNode(T)){const $=xc(M.substring(f),w);return lu(T,w)+$}}return lu(M[0],w)+xc(M.substring(1),w)}function lu(M,w){return M?w.getNode(M)?`<a href="https://github.com/anvaka/lang-land-data/blob/main/hsk/v1/cards/${M}.md" class="word-link" data-word="${M}">${M}</a>`:M:""}class Nm{constructor(){this.element=null,this.searchCallback=null,this.inputElement=null,this.searchButton=null,this.eventListeners={},this.dropdownElement=null,this.suggestions=[],this.selectedIndex=-1,this.allNodes=[]}initialize(w){if(this.element)return this;this.searchCallback=w,this.element=document.createElement("div"),this.element.className="search-container";const f=document.createElement("form");f.className="search-form",f.setAttribute("role","search"),f.addEventListener("submit",this.handleSubmit.bind(this));const T=document.createElement("label");T.htmlFor="search-input",T.className="visually-hidden",T.textContent="Search for a word",this.inputElement=document.createElement("input"),this.inputElement.type="search",this.inputElement.id="search-input",this.inputElement.className="search-input",this.inputElement.placeholder="Search for Hanzi ()...",this.inputElement.setAttribute("aria-label","Search for a chinese character"),this.inputElement.setAttribute("autocomplete","off"),this.inputElement.addEventListener("input",Q=>{this.toggleButtonIcon(),this.updateAutocomplete(Q.target.value)}),this.inputElement.addEventListener("keydown",this.handleKeyDown.bind(this));const $='<svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 0 0 1.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 0 0-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 0 0 5.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg>',H='<svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>';return this.searchButton=document.createElement("button"),this.searchButton.type="submit",this.searchButton.className="search-button",this.searchButton.setAttribute("aria-label","Submit search"),this.searchButton.innerHTML=$,this.searchButton.dataset.searchIcon=$,this.searchButton.dataset.clearIcon=H,this.searchButton.addEventListener("click",this.handleButtonClick.bind(this)),this.dropdownElement=document.createElement("div"),this.dropdownElement.className="search-dropdown",this.dropdownElement.style.display="none",this.dropdownElement.setAttribute("role","listbox"),document.addEventListener("click",Q=>{this.element.contains(Q.target)||this.hideDropdown()}),f.appendChild(T),f.appendChild(this.inputElement),f.appendChild(this.searchButton),this.element.appendChild(f),this.element.appendChild(this.dropdownElement),this.loadNodesFromGraph(),this}async loadNodesFromGraph(){try{const w=await Tc();this.allNodes=[],w.forEachNode(f=>{typeof f.id=="string"&&f.id[0]!=="_"&&this.allNodes.push(f.id)})}catch(w){console.error("Failed to load nodes from graph:",w)}}updateAutocomplete(w){const f=w.trim().toLowerCase();if(!f){this.hideDropdown();return}const T=[],$=[],H=[],Q=10;for(const l of this.allNodes){const _e=l.toLowerCase();if(_e===f)T.push(l);else if(_e.startsWith(f)){if($.push(l),T.length+$.length>=Q)break}else if(_e.includes(f)&&(H.push(l),T.length+$.length+H.length>=Q))break}if(this.suggestions=[...T,...$,...H].slice(0,Q),this.suggestions.length===0){this.hideDropdown();return}this.renderSuggestions(),this.showDropdown(),this.selectedIndex=-1}renderSuggestions(){this.dropdownElement.innerHTML="",this.suggestions.forEach((w,f)=>{const T=document.createElement("div");T.className="dropdown-item",T.textContent=w,T.setAttribute("role","option"),T.dataset.index=f,T.addEventListener("click",()=>{this.setValue(w),this.hideDropdown(),this.focus(),this.searchCallback(w)}),T.addEventListener("mouseenter",()=>{this.selectItem(f)}),this.dropdownElement.appendChild(T)})}showDropdown(){this.dropdownElement.style.display="block"}hideDropdown(){this.dropdownElement.style.display="none",this.selectedIndex=-1}selectItem(w){const f=this.dropdownElement.querySelectorAll(".dropdown-item");f.forEach(T=>T.classList.remove("selected")),w>=0&&w<f.length&&(f[w].classList.add("selected"),this.selectedIndex=w,this.scrollItemIntoView(f[w]))}scrollItemIntoView(w){if(!w)return;const f=this.dropdownElement.getBoundingClientRect(),T=w.getBoundingClientRect();T.top<f.top?this.dropdownElement.scrollTop+=T.top-f.top:T.bottom>f.bottom&&(this.dropdownElement.scrollTop+=T.bottom-f.bottom)}handleKeyDown(w){if(this.dropdownElement.style.display!=="none")switch(w.key){case"ArrowDown":w.preventDefault(),this.selectItem(Math.min(this.selectedIndex+1,this.suggestions.length-1));break;case"ArrowUp":w.preventDefault(),this.selectItem(Math.max(this.selectedIndex-1,0));break;case"Enter":if(this.selectedIndex>=0){w.preventDefault();let f=this.suggestions[this.selectedIndex];this.setValue(f),this.hideDropdown(),this.searchCallback(f)}break;case"Escape":w.preventDefault(),this.hideDropdown();break;case"Tab":this.hideDropdown();break}}toggleButtonIcon(){if(!this.searchButton)return;this.inputElement.value.trim().length>0?(this.searchButton.innerHTML=this.searchButton.dataset.clearIcon,this.searchButton.setAttribute("aria-label","Clear search"),this.searchButton.setAttribute("type","button")):(this.searchButton.innerHTML=this.searchButton.dataset.searchIcon,this.searchButton.setAttribute("aria-label","Submit search"),this.searchButton.setAttribute("type","submit"))}handleButtonClick(w){this.inputElement.value&&this.searchButton.getAttribute("type")==="button"&&(w.preventDefault(),this.clear(),this.focus(),this.toggleButtonIcon())}handleSubmit(w){w.preventDefault();const f=this.inputElement.value.trim();f&&this.searchCallback&&(this.hideDropdown(),this.searchCallback(f))}clear(){this.inputElement&&(this.inputElement.value="",this.emit("clear")),this.hideDropdown()}focus(){this.inputElement&&this.inputElement.focus()}setValue(w){return this.inputElement&&(this.inputElement.value=w||"",this.toggleButtonIcon()),this}on(w,f){return this.eventListeners[w]||(this.eventListeners[w]=[]),this.eventListeners[w].push(f),this}off(w,f){return this.eventListeners[w]&&(this.eventListeners[w]=this.eventListeners[w].filter(T=>T!==f)),this}emit(w,...f){return this.eventListeners[w]&&this.eventListeners[w].forEach(T=>T(...f)),this}addToDOM(w){if(!this.element)throw new Error("Search bar not initialized. Call initialize() first.");w.appendChild(this.element)}}const hl=new Nm;let uu=null,cu=null;Tc().then(M=>{uu=M,cu&&(cu(),cu=null)});class Vm{constructor(){this.isOpen=!1,this.flashcards={},this.element=null,this.contentElement=null,this.fontSizeControl=null,this.isLoading=!1,this.baseFontSize=16,this.currentFontSize=this.baseFontSize,document.addEventListener("keydown",w=>{w.key==="Escape"&&this.isOpen&&this.close()}),hl.on("clear",()=>{this.isOpen&&this.close()})}initialize(){return this.element=document.createElement("div"),this.element.className="sidebar",this.element.setAttribute("aria-hidden","true"),this.contentElement=document.createElement("div"),this.contentElement.className="sidebar-content",this.createFontSizeControl(),this.element.appendChild(this.contentElement),this.element.appendChild(this.fontSizeControl),document.querySelector("#app").appendChild(this.element),this.renderWelcomeContent(),this.element.addEventListener("click",w=>{var T,$,H;if(w.target.tagName!=="A"||!w.target.hasAttribute("data-word"))return;const f=w.target.getAttribute("data-word");if(this.openNewWordCallback){const Q=(H=($=(T=uu.getNode(f))==null?void 0:T.data)==null?void 0:$.l)==null?void 0:H.split(",").map(Number);this.openNewWordCallback(f,Q),this.open(f,this.openNewWordCallback),w.preventDefault()}}),this}async loadFlashcard(w){if(!w)return"";if(this.flashcards[w])return this.flashcards[w];if(this._pendingRequests&&this._pendingRequests[w])return this._pendingRequests[w];this._pendingRequests||(this._pendingRequests={});const f=new Promise(async T=>{try{const $=await fetch(`${sn.cardsFolder}${w}.md`,{cache:"force-cache"});if(!$.ok)throw new Error(`Failed to load flashcard for ${w}: ${$.statusText}`);const H=await $.text();this.flashcards[w]=H,T(H)}catch($){console.error(`Error loading flashcard for ${w}:`,$),this.flashcards[w]="",T("")}finally{delete this._pendingRequests[w]}});return this._pendingRequests[w]=f,f}open(w,f=null){return this.lastLabel===w&&this.isOpen?this:(this.lastLabel=w,this.element||this.initialize(),this.openNewWordCallback=f,this.contentElement&&(this.contentElement.scrollTop=0),this.showContentForLabel(w),hl.setValue(w),this.isOpen=!0,this.element.classList.add("open"),this.element.setAttribute("aria-hidden","false"),this)}close(){return this.element?(this.isOpen=!1,this.element.classList.remove("open"),this.element.setAttribute("aria-hidden","true"),hl.clear(),this):this}toggle(w){return this.isOpen?this.close():this.open(w)}async showContentForLabel(w){if(!w){this.renderWelcomeContent();return}this.contentElement.innerHTML=`
      <div class="simple-loading">
        <div class="loading-bar"></div>
      </div>
    `;try{const f=await this.loadFlashcard(w);this.renderContent(w,f)}catch(f){console.error("Error showing content for label:",f),this.contentElement.innerHTML=`
        <div class="load-error">
          Failed to load content.
        </div>
      `}}renderContent(w,f=null){f===null&&(f=w&&this.flashcards[w]?this.flashcards[w]:"No information available for this item.");let T="";w&&(T+=`<img src="${sn.imagesFolder}/${w}.webp" alt="${w}" class="sidebar-image" onerror="this.style.display='none'">`),uu?f=$m(f,uu):cu=this.renderContent.bind(this,w,f),T+=Kt.parse(f),f&&f!=="No information available for this item."&&w&&(T+=qm(w));const $=document.createElement("div");$.innerHTML=T,$.className="content-container",this.contentElement.innerHTML="",this.contentElement.appendChild($)}createFontSizeControl(){this.fontSizeControl=document.createElement("div"),this.fontSizeControl.className="font-size-control";const w=document.createElement("span");w.className="font-size-label",w.textContent="Font Size";const f=document.createElement("input");f.type="range",f.className="font-size-slider",f.min="12",f.max="24",f.value=this.baseFontSize,f.step="1",f.addEventListener("input",$=>{this.setFontSize(parseInt($.target.value))});const T=document.createElement("button");T.className="font-size-reset",T.textContent="Reset",T.addEventListener("click",()=>{this.resetFontSize(),f.value=this.baseFontSize}),this.fontSizeControl.appendChild(w),this.fontSizeControl.appendChild(f),this.fontSizeControl.appendChild(T)}setFontSize(w){this.currentFontSize=w,this.contentElement&&(this.contentElement.style.fontSize=`${w}px`)}resetFontSize(){this.setFontSize(this.baseFontSize)}renderWelcomeContent(){const w=`
      <div class="welcome-content">
        <h2>Welcome to Language Land</h2>
        <p>Click on any word on the map to see its definition.</p>
        <p>This sidebar will show you:</p>
        <ul>
          <li>Word definitions</li>
          <li>Example sentences</li>
          <li>Visual aids when available</li>
        </ul>
        <p>Use the font size controls at the bottom to adjust text size.</p>
      </div>
    `;this.contentElement.innerHTML=w}}const Um=new Vm;function qm(M,w){return M?`
    <hr class="feedback-separator">
    <div class="feedback-link">
      <small>Found an error? <a href="${`https://github.com/anvaka/lang-land-data/blob/main/hsk/v1/cards/${M}.md`}" target="_blank" rel="noopener noreferrer">Please improve this card</a></small>
    </div>
  `:""}class jm{constructor(){this.modal=null,this.isOpen=!1}initialize(){if(this.modal)return this;this.modal=document.createElement("div"),this.modal.className="about-modal",this.modal.setAttribute("aria-hidden","true"),this.modal.setAttribute("role","dialog"),this.modal.setAttribute("aria-labelledby","about-title");const w=document.createElement("div");w.className="about-modal-content";const f=document.createElement("button");f.className="close-btn",f.innerHTML="&times;",f.setAttribute("aria-label","Close about dialog"),f.addEventListener("click",()=>this.close());const T=document.createElement("h2");T.id="about-title",T.textContent="About HSK Land";const $=document.createElement("div");return $.className="about-content",$.innerHTML=this.getAboutContent(),w.appendChild(f),w.appendChild(T),w.appendChild($),this.modal.appendChild(w),this.modal.addEventListener("click",H=>{H.target===this.modal&&this.close()}),document.addEventListener("keydown",H=>{H.key==="Escape"&&this.isOpen&&this.close()}),document.querySelector("#app").appendChild(this.modal),this}getAboutContent(){return`
      <p>Hi! I'm <a href="https://x.com/anvaka" target="_blank" rel="noopener noreferrer">Andrei</a>, and I built HSK Land to help myself learn Mandarin Chinese. I thought it might be helpful for other learners too.</p>
      
      <p>This map shows around 5,000 Chinese words from the HSK vocabulary list. I arranged the words so similar ones appear closer together - it's like a landscape of meaning that helps me see connections between words.</p>
      
      <h3>How it works</h3>
      <p>I used vector embeddings to position words based on their meanings. Click on any word and you'll see its definition, usage examples, and character breakdown. You'll also notice related words highlight on the map, which helps me discover new connections.</p>
      
      <h3>About the data</h3>
      <p>I initially generated the word meanings and character breakdowns using AI, and I'm gradually verifying them as I learn. I'm still a novice Chinese student myself, so there are probably mistakes!</p>
      
      <p>If you spot an error, I'd really appreciate your help - just use the feedback link on any word's page to suggest improvements.</p>
      
      <div class="about-footer">
        <p>
          <a href="https://github.com/anvaka/lang-land" target="_blank" rel="noopener noreferrer">Code on GitHub</a>
           
          <a href="http://paypal.com/paypalme/anvakos/5" target="_blank" rel="noopener noreferrer">Buy me a coffee</a> if you find this useful
        </p>
      </div>
    `}open(){return this.modal||this.initialize(),this.isOpen=!0,this.modal.classList.add("open"),this.modal.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden",this}close(){return this.modal?(this.isOpen=!1,this.modal.classList.remove("open"),this.modal.setAttribute("aria-hidden","true"),document.body.style.overflow="",this):this}toggle(){return this.isOpen?this.close():this.open()}}const Zm=new jm;async function Gm(M,w){try{const f=await Tc(),T=Om(f,M);if(!T)return;const{node:$,neighbors:H,edges:Q}=T,l={type:"FeatureCollection",features:[]},_e={type:"FeatureCollection",features:[]},ee=$.data.l.split(",").map(Number);l.features.push({type:"Feature",geometry:{type:"Point",coordinates:ee},properties:{color:"#bf2072",size:$.data.c/2||1}}),H.forEach(Te=>{if(Te.data&&Te.data.l){const Ve=Te.data.l.split(",").map(Number);l.features.push({type:"Feature",geometry:{type:"Point",coordinates:Ve},properties:{color:"#e56aaa",size:Te.data.c?Te.data.c/5:.8}}),_e.features.push({type:"Feature",geometry:{type:"LineString",coordinates:[ee,Ve]}})}}),w.getSource("highlighted-nodes").setData(l),w.getSource("highlighted-edges").setData(_e)}catch(f){console.error("Failed to highlight node:",f)}}let pl={},hu=null;document.querySelector("#app").innerHTML=`
  <div id="map"></div>
  <div class='control-buttons'>
    <button class="stats-button" aria-label="View learning progress">Stats</button>
    <button class="about-button" aria-label="About HSK Land">About</button>
  </div>
`;const Hm=document.querySelector(".about-button");Hm.addEventListener("click",()=>Zm.open());const Wm=document.querySelector(".stats-button");Wm.addEventListener("click",()=>pu.open());pu.init(Jm);const kn=new Pf.Map({container:"map",style:Nf(),center:[0,0],zoom:2,minZoom:2,hash:!0});kn.touchZoomRotate.disableRotation();kn.on("load",()=>{Xm(kn),Km(kn),tg()});function Xm(M){M.on("mouseenter","label-layer",()=>{M.getCanvas().style.cursor="pointer"}),M.on("mouseleave","label-layer",()=>{M.getCanvas().style.cursor=""}),M.on("click",w=>{const f=M.queryRenderedFeatures(w.point,{layers:["label-layer","region-fill-layer"]});f.length>0&&_u({features:[f[0]]},M)})}async function Km(M){const w={type:"FeatureCollection",features:[]};await Ym(sn.regionsSource,w),pl=eg(w),hu=w,M.getSource("region-boundaries").setData(w),Object.keys(La.getHistory()).forEach(f=>{pl[f]!==void 0&&M.setFeatureState({source:"region-boundaries",id:pl[f]},{opacity:Of(f)})}),setTimeout(()=>{M.setLayoutProperty("clipped-regions-raster-layer","visibility","visible")},100)}async function Ym(M,w){const f=await fetch(M);if(!f.ok)throw new Error(`Failed to fetch region ${M}`);const T=await f.json();T&&T.features&&(w.features=T.features)}function Jm(M){const w=yu(M);if(!w)return;_u({features:[w]},kn);const f=w.geometry.coordinates[0].reduce((T,$)=>(T[0]+=$[0],T[1]+=$[1],T),[0,0]);f[0]/=w.geometry.coordinates[0].length,f[1]/=w.geometry.coordinates[0].length,Dc(f)}function Qm(M,w){Dc(w);const f=yu(M);f&&_u({features:[f]},kn)}function Dc(M){const w=kn.getZoom();kn.flyTo({center:M,zoom:w,speed:1,curve:1.5,essential:!0})}async function _u(M,w){if(!M.features||M.features.length===0)return;const f=M.features[0];if(!f.properties||!f.properties.label)return;const T=f.properties.label;if(La.recordClick(T),pu.isOpen&&pu.refreshStats(),pl[T]!==void 0){w.setFeatureState({source:"region-boundaries",id:pl[T]},{opacity:0});const $=yu(T);if($){const H={type:"FeatureCollection",features:[$]};w.getSource("highlighted-region").setData(H)}}Um.open(T,Qm),await Gm(T,w)}function eg(M){const w={};return M.features.forEach((f,T)=>{const $=f.id,H=T;w[$]=H,f.properties.label=$,f.id=H}),w}function yu(M){return!hu||!hu.features?null:hu.features.find(w=>w.properties.label===M)}function tg(){hl.initialize(ig),hl.addToDOM(document.querySelector("#app"))}function ig(M){if(!M)return;const w=yu(M);if(w){const f=w.geometry.coordinates[0].reduce((T,$)=>(T[0]+=$[0],T[1]+=$[1],T),[0,0]);f[0]/=w.geometry.coordinates[0].length,f[1]/=w.geometry.coordinates[0].length,Dc(f),_u({features:[w]},kn)}else console.log("No matching word found:",M)}
